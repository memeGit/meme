/*1328913228,169775559*/

if (window.CavalryLogger) { CavalryLogger.start_js(["lF\/p\/"]); }

__e("ObjectUtils",["copyProperties","hasArrayNature"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("hasArrayNature"),i={object:function(j){var k=new Function();k.prototype=j;return new k();},isScalar:function(j){return (/string|number|boolean/).test(typeof j);},getKeys:function(j){var k=[];for(var l in j)k.push(l);return k;},getValues:function(j){var k=[];for(var l in j)k.push(j[l]);return k;},countKeys:function(j){var k=0;for(var l in j)k++;return k;},areEqual:function(j,k){return JSON.stringify(j)==JSON.stringify(k);},merge:function(){var j={};for(var k=0;k<arguments.length;k++)g(j,arguments[k]);return j;},coalesce:function(){for(var j=0;j<arguments.length;++j)if(arguments[j]!=null)return arguments[j];return null;},createFrom:function(j,k){var l={},m=h(k);if(typeof k=='undefined')k=true;for(var n=j.length;n--;)l[j[n]]=m?k[n]:k;return l;}};e.exports=i;});
__e("object-extensions",["ObjectUtils"],function(a,b,c,d,e,f){var g=b('ObjectUtils');a.are_equal=g.areEqual;a.coalesce=g.coalesce;a.count=g.countKeys;a.is_scalar=g.isScalar;a.keys=g.getKeys;a.merge=g.merge;a.object=g.object;a.values=g.getValues;Object.from=g.createFrom;},3);
__e("legacy:util",["Util"],function(a,b,c,d){a.Util=b('Util');},3);
__e("legacy:errorutils",["ErrorUtils"],function(a,b,c,d){a.ErrorUtils=b('ErrorUtils');},3);
function _onloadHook(){!window.loaded&&window.CavalryLogger&&CavalryLogger.getInstance().setTimeStamp('t_prehooks');_runHooks('onloadhooks');!window.loaded&&window.CavalryLogger&&CavalryLogger.getInstance().setTimeStamp('t_hooks');window.loaded=true;Arbiter.inform('uipage_onload',true,Arbiter.BEHAVIOR_STATE);}function _onafterloadHook(){_runHooks('onafterloadhooks');window.afterloaded=true;}function _runHook(a,b){return ErrorUtils.applyWithGuard(a,null,null,function(c){c.event_type=b;c.category='runhook';});}function _runHooks(a){var b=a=='onbeforeleavehooks'||a=='onbeforeunloadhooks',c=null;do{var d=window[a];if(!b)window[a]=null;if(!d)break;for(var e=0;e<d.length;e++)if(b){c=c||_runHook(d[e],a);}else _runHook(d[e],a);if(b)break;}while(window[a]);if(b&&c)return c;}function keep_window_set_as_loaded(){if(window.loaded==false){window.loaded=true;_runHooks('onloadhooks');}if(window.afterloaded==false){window.afterloaded=true;_runHooks('onafterloadhooks');}}Arbiter.registerCallback(_onloadHook,[OnloadEvent.ONLOAD_DOMCONTENT_CALLBACK,InitialJSLoader.INITIAL_JS_READY]);Arbiter.registerCallback(_onafterloadHook,[OnloadEvent.ONLOAD_DOMCONTENT_CALLBACK,OnloadEvent.ONLOAD_CALLBACK,InitialJSLoader.INITIAL_JS_READY]);Arbiter.subscribe(OnloadEvent.ONBEFOREUNLOAD,function(a,b){b.warn=_runHooks('onbeforeleavehooks')||_runHooks('onbeforeunloadhooks');if(!b.warn){window.loaded=false;window.afterloaded=false;}},Arbiter.SUBSCRIBE_NEW);Arbiter.subscribe(OnloadEvent.ONUNLOAD,function(a,b){_runHooks('onunloadhooks');},Arbiter.SUBSCRIBE_NEW);
__e("ua",[],function(a,b,c,d,e,f){var g={ie:function(){return g._populate()||this._ie;},ie64:function(){return g.ie()&&this._win64;},firefox:function(){return g._populate()||this._firefox;},opera:function(){return g._populate()||this._opera;},safari:function(){return g._populate()||this._safari;},chrome:function(){return g._populate()||this._chrome;},windows:function(){return g._populate()||this._windows;},osx:function(){return g._populate()||this._osx;},linux:function(){return g._populate()||this._linux;},iphone:function(){return g._populate()||this._iphone;},_populated:false,_populate:function(){if(g._populated)return;g._populated=true;var h=navigator.userAgent,i=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(h),j=/(Mac OS X)|(Windows)|(Linux)/.exec(h),k=/\b(iPhone|iP[ao]d)/.exec(h);g._win64=!!(/Win64/.exec(h));if(i){g._ie=i[1]?parseFloat(i[1]):NaN;if(g._ie&&document.documentMode)g._ie=document.documentMode;g._firefox=i[2]?parseFloat(i[2]):NaN;g._opera=i[3]?parseFloat(i[3]):NaN;g._safari=i[4]?parseFloat(i[4]):NaN;if(g._safari){i=/(?:Chrome\/(\d+\.\d+))/.exec(h);g._chrome=i&&i[1]?parseFloat(i[1]):NaN;}else g._chrome=NaN;}else g._ie=g._firefox=g._opera=g._chrome=g._safari=NaN;if(j){if(j[1]){var l=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(h);g._osx=l?parseFloat(l[1].replace('_','.')):true;}else g._osx=false;g._windows=!!j[2];g._linux=!!j[3];}else g._osx=g._windows=g._linux=false;g._iphone=k;}};a.ua=e.exports=g;},3);
void(0);
__e("DataStore",[],function(a,b,c,d,e,f){var g={},h={},i=1,j=1;function k(n){var o;if(typeof n=='string'){o='str_'+n;}else{o='elem_'+(n.__FB_TOKEN||(n.__FB_TOKEN=[i++]))[0];h[o]=n;}return g[o]||(g[o]={});}function l(n){if(!n.nodeName)return false;try{if(null!=n.offsetParent)return false;}catch(o){}if(document.documentElement.contains){return !document.documentElement.contains(n);}else return (document.documentElement.compareDocumentPosition(n)&j);}var m={set:function(n,o,p){var q=k(n);q[o]=p;return n;},get:function(n,o,p){var q=k(n),r=q[o];if(typeof r==='undefined'&&n.getAttribute){var s=n.getAttribute('data-'+o);r=(null===s)?undefined:s;}if((p!==undefined)&&(r===undefined))r=q[o]=p;return r;},remove:function(n,o){var p=k(n),q=p[o];delete p[o];return q;},cleanup:function(){var n,o;for(n in h){o=h[n];if(l(o)){delete g[n];delete h[n];}}}};e.exports=m;});
__e("string-extensions",[],function(a,b,c,d,e,f){String.prototype.trim=function(){if(this==window)return null;return this.replace(/^\s*|\s*$/g,'');};f.trim=a.trim=function(g){try{return String(g.toString()).trim();}catch(h){return '';}};String.prototype.startsWith=function(g){if(this==window)return null;return this.substring(0,g.length)==g;};String.prototype.endsWith=function(g){if(this==window)return null;return this.length>=g.length&&this.substring(this.length-g.length)==g;};String.prototype.split=(function(g){return function(h,i){var j="";if(h===null||i===null){return [];}else if(typeof h=='string'){return g.call(this,h,i);}else if(h===undefined){return [this.toString()];}else if(h instanceof RegExp){if(!h._2||!h._1){j=h.toString().replace(/^[\S\s]+\//,"");if(!h._1)if(!h.global){h._1=new RegExp(h.source,"g"+j);}else h._1=1;}separator1=h._1===1?h:h._1;var k=(h._2?h._2:h._2=new RegExp("^"+separator1.source+"$",j));if(i===undefined||i<0){i=false;}else{i=Math.floor(i);if(!i)return [];}var l,m=[],n=0,o=0;while((i?o++<=i:true)&&(l=separator1.exec(this))){if((l[0].length===0)&&(separator1.lastIndex>l.index))separator1.lastIndex--;if(separator1.lastIndex>n){if(l.length>1)l[0].replace(k,function(){for(var p=1;p<arguments.length-2;p++)if(arguments[p]===undefined)l[p]=undefined;});m=m.concat(this.substring(n,l.index),(l.index===this.length?[]:l.slice(1)));n=separator1.lastIndex;}if(l[0].length===0)separator1.lastIndex++;}return (n===this.length)?(separator1.test("")?m:m.concat("")):(i?m:m.concat(this.substring(n)));}else return g.call(this,h,i);};})(String.prototype.split);},3);
__e("evalGlobal",[],function(a,b,c,d,e,f){function g(h){if('string'!=typeof(h)){throw new Error('JS sent to eval_global is not a string.  Only strings '+'are permitted.');}else if(''==h)return;var i=document.createElement('script');i.type='text/javascript';try{i.appendChild(document.createTextNode(h));}catch(j){i.text=h;}var k=(document.getElementsByTagName("head")[0]||document.documentElement);k.appendChild(i);k.removeChild(i);}e.exports=g;});
__e("HTML",["function-extensions","string-extensions","ArrayUtils","ua","copyProperties","evalGlobal"],function(a,b,c,d,e,f){b("function-extensions");b("string-extensions");var g=b("ArrayUtils"),h=b("ua"),i=b("copyProperties"),j=b("evalGlobal");function k(l){if(l&&l.__html)l=l.__html;if(!(this instanceof k)){if(l instanceof k)return l;return new k(l);}this._content=l;this._defer=false;this._extra_action='';this._nodes=null;this._inline_js=bagofholding;this._ie_clone_bug=false;return this;}k.isHTML=function(l){return l&&(l instanceof k||l.__html!==undefined);};k.replaceJSONWrapper=function(l){return l&&l.__html!==undefined?new k(l.__html):l;};i(k.prototype,{toString:function(){var l=this._content||'';if(this._extra_action)l+='<script type="text/javascript">'+this._extra_action+'</scr'+'ipt>';return l;},setAction:function(l){this._extra_action=l;return this;},getAction:function(){this._fillCache();var l=function(){this._inline_js();j(this._extra_action);}.bind(this);if(this.getDeferred()){return l.defer.bind(l);}else return l;},setDeferred:function(l){this._defer=!!l;return this;},getDeferred:function(){return this._defer;},getContent:function(){return this._content;},getNodes:function(){this._fillCache();return this._nodes;},getRootNode:function(){return this.getNodes()[0];},ieCloneBug:function(){this._fillCache();return this._ie_clone_bug;},_fillCache:function(){if(null!==this._nodes)return;var l=this._content;if(!l){this._nodes=[];return;}l=l.replace(/(<(\w+)[^>]*?)\/>/g,function(w,x,y){return y.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?w:x+'></'+y+'>';});var m=l.trim().toLowerCase(),n=document.createElement('div'),o=false,p=(!m.indexOf('<opt')&&[1,'<select multiple="multiple" class="__WRAPPER">','</select>'])||(!m.indexOf('<leg')&&[1,'<fieldset class="__WRAPPER">','</fieldset>'])||(m.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,'<table class="__WRAPPER">','</table>'])||(!m.indexOf('<tr')&&[2,'<table><tbody class="__WRAPPER">','</tbody></table>'])||((!m.indexOf('<td')||!m.indexOf('<th'))&&[3,'<table><tbody><tr class="__WRAPPER">','</tr></tbody></table>'])||(!m.indexOf('<col')&&[2,'<table><tbody></tbody><colgroup class="__WRAPPER">','</colgroup></table>'])||null;if(null===p){n.className='__WRAPPER';if(h.ie()){p=[0,'<span style="display:none">&nbsp;</span>',''];o=true;}else p=[0,'',''];}n.innerHTML=p[1]+l+p[2];while(p[0]--)n=n.lastChild;if(o)n.removeChild(n.firstChild);n.className!='__WRAPPER';if(0!==n.getElementsByTagName('option').length||0!==n.getElementsByTagName('object').length)this._ie_clone_bug=true;if(h.ie()){var q;if(!m.indexOf('<table')&&-1==m.indexOf('<tbody')){q=n.firstChild&&n.firstChild.childNodes;}else if(p[1]=='<table>'&&-1==m.indexOf('<tbody')){q=n.childNodes;}else q=[];for(var r=q.length-1;r>=0;--r)if(q[r].nodeName&&q[r].nodeName.toLowerCase()=='tbody'&&q[r].childNodes.length==0)q[r].parentNode.removeChild(q[r]);}var s=n.getElementsByTagName('script'),t=[];for(var u=0;u<s.length;u++)if(s[u].src){t.push(Bootloader.requestResource.bind(Bootloader,'js',s[u].src));}else t.push(j.bind(null,s[u].innerHTML));for(var u=s.length-1;u>=0;u--)s[u].parentNode.removeChild(s[u]);var v=function(){for(var w=0;w<t.length;w++)t[w]();};this._nodes=g.createFrom(n.childNodes);this._inline_js=v;}});e.exports=k;});
__e("dom",["ArrayUtils","css-core","HTML","ObjectUtils","dom-core","copyProperties","ua","tx"],function(a,b,c,d,e,f){var g=b('ArrayUtils'),h=b('css-core'),i=b('HTML'),j=b('ObjectUtils'),k=b('dom-core').$,l=b('copyProperties'),m=b('dom-core').ge,n=b('ua'),o=b('tx');function p(s){function t(u){return q.create('div',{},u).innerHTML;}return function(u,v){var w={};if(v)for(var x in v)w[x]=t(v[x]);return i(s(u,w));};}var q={find:function(s,t){var u=q.scry(s,t);return u[0];},scry:function(s,t){if(!s||!s.getElementsByTagName)return [];var u=t.split(' '),v=[s],w=!!s.documentElement;for(var x=0;x<u.length;x++){if(v.length==0)break;if(u[x]=='')continue;var y=u[x],z=[],aa=false;if(y.charAt(0)=='^')if(x==0){aa=true;y=y.slice(1);}else return [];y=y.replace(/\./g,' .');y=y.replace(/\#/g,' #');y=y.replace(/\[/g,' [');var ba=y.split(' '),ca=ba[0]||'*',da=ba[1]&&ba[1].charAt(0)=='#';if(da){var ea=m(ba[1].slice(1),true);if(ea&&('*'==ca||ea.tagName.toLowerCase()==ca))for(var fa=0;fa<v.length;fa++)if(aa&&q.contains(ea,v[fa])){z=[ea];break;}else if(document==v[fa]||q.contains(v[fa],ea)){z=[ea];break;}}else{var ga=[],ha=v.length;for(var ia=0;ia<ha;ia++){if(aa){var ja=[],ka=v[ia].parentNode,la=ca=='*';while(q.isElementNode(ka)){if(la||ka.tagName.toLowerCase()==ca)ja.push(ka);ka=ka.parentNode;}}else var ja=v[ia].getElementsByTagName(ca);var ma=ja.length;for(var na=0;na<ma;na++)ga.push(ja[na]);}for(var oa=1;oa<ba.length;oa++){var pa=ba[oa],qa=pa.charAt(0)=='.',ra=pa.substring(1);for(var ia=0;ia<ga.length;ia++){var sa=ga[ia];if(!sa)continue;if(qa){if(!h.hasClass(sa,ra))delete ga[ia];continue;}else{var ta=pa.slice(1,pa.length-1);if(ta.indexOf('=')==-1){if(sa.getAttribute(ta)===null){delete ga[ia];continue;}}else{var ua=ta.split('='),va=ua[0],wa=ua[1];wa=wa.slice(1,wa.length-1);if(sa.getAttribute(va)!=wa){delete ga[ia];continue;}}}}}for(var ia=0;ia<ga.length;ia++)if(ga[ia]){z.push(ga[ia]);if(aa)break;}}v=z;}return v;},getText:(function(){var s=document.createElement('div'),t=s.textContent!=null?'textContent':'innerText';return function(u){if(!u){return '';}else if(q.isTextNode(u)){return u.data;}else return u[t];};})(),getSelection:function(){var s=window.getSelection,t=document.selection;if(s){return s()+'';}else if(t)return t.createRange().text;return null;},create:function(s,t,u){s=document.createElement(s);if(t){t=l({},t);if(t.style){l(s.style,t.style);delete t.style;}for(var v in t)if(v.toLowerCase().indexOf('on')==0){if(!(typeof t[v]!='function'))if(window.Event&&Event.listen){Event.listen(s,v.substr(2),t[v]);}else s[v]=t[v];delete t[v];}l(s,t);}if(u!=undefined)q.setContent(s,u);return s;},prependContent:function(s,t){if(!q.isNode(s))throw new Error('DOM.prependContent: reference element is not a node');var u=function(v){if(s.firstChild){s.insertBefore(v,s.firstChild);}else s.appendChild(v);};return q._addContent(t,u,s);},insertAfter:function(s,t){if(!q.isNode(s)||!s.parentNode)throw new Error('DOM.insertAfter: reference element is not a node');var u=function(v){if(s.nextSibling){s.parentNode.insertBefore(v,s.nextSibling);}else s.parentNode.appendChild(v);};return q._addContent(t,u,s.parentNode);},insertBefore:function(s,t){if(!q.isNode(t)||!t.parentNode)throw new Error('DOM.insertBefore: reference element is not a node or '+'does not have a parent.');var u=function(v){t.parentNode.insertBefore(v,t);};return q._addContent(s,u,t.parentNode);},setContent:function(s,t){if(!q.isNode(s))throw new Error('DOM.setContent: reference element is not a node');q.empty(s);return q.appendContent(s,t);},appendContent:function(s,t){if(!q.isNode(s))throw new Error('DOM.appendContent: reference element is not a node');var u=function(v){s.appendChild(v);};return q._addContent(t,u,s);},replace:function(s,t){if(!q.isNode(s)||!s.parentNode)throw new Error('DOM.replace: reference element must be a node with a'+' parent');var u=function(v){s.parentNode.replaceChild(v,s);};return q._addContent(t,u,s.parentNode);},remove:function(s){s=k(s);if(s.parentNode)s.parentNode.removeChild(s);},empty:function(s){s=k(s);while(s.firstChild)q.remove(s.firstChild);},contains:function(s,t){s=m(s);t=m(t);if(!s||!t){return false;}else if(s===t){return true;}else if(q.isTextNode(s)){return false;}else if(q.isTextNode(t)){return q.contains(s,t.parentNode);}else if(s.contains){return s.contains(t);}else if(s.compareDocumentPosition){return !!(s.compareDocumentPosition(t)&16);}else return false;},getRootElement:function(){var s=null;if(window.Quickling&&Quickling.isActive())s=m('content');return s||document.body;},isNode:function(s){return !!(s&&(typeof Node=='object'?s instanceof Node:typeof s=="object"&&typeof s.nodeType=='number'&&typeof s.nodeName=='string'));},isNodeOfType:function(s,t){var u=g.createFrom(t).join('|').toUpperCase().split('|'),v=j.createFrom(u);return q.isNode(s)&&s.nodeName in v;},isElementNode:function(s){return q.isNode(s)&&s.nodeType==1;},isTextNode:function(s){return q.isNode(s)&&s.nodeType==3;},_addContent:function(s,t,u){s=i.replaceJSONWrapper(s);if(s instanceof i&&-1==s.toString().indexOf('<scr'+'ipt')&&''==u.innerHTML){var v=n.ie();if(!v||(v>7&&!q.isNodeOfType(u,['table','tbody','thead','tfoot','tr','select','fieldset']))){var w=v?"<em style=\"display:none;\">&nbsp;</em>":"";u.innerHTML=w+s;v&&u.removeChild(u.firstChild);return g.createFrom(u.childNodes);}}else if(q.isTextNode(u)){u.data=s;return [s];}var x,y=[],z=[],aa=document.createDocumentFragment();if(!(s instanceof Array))s=[s];for(var ba=0;ba<s.length;ba++){x=i.replaceJSONWrapper(s[ba]);if(x instanceof i){z.push(x.getAction());var ca=x.getNodes(),da;for(var ea=0;ea<ca.length;ea++){da=(n.safari()||(n.ie()&&x.ieCloneBug()))?ca[ea]:ca[ea].cloneNode(true);y.push(da);aa.appendChild(da);}}else if(j.isScalar(x)){var fa=document.createTextNode(x);y.push(fa);aa.appendChild(fa);}else if(q.isNode(x)){y.push(x);aa.appendChild(x);}else if(!(x instanceof Array))x!==null;}t(aa);for(var ba=0;ba<z.length;ba++)z[ba]();return y;},getDocumentScrollElement:function(s){s=s||document;if(h.hasClass(s.documentElement,'wrapped')){var t=s.getElementById('body');if(t)return t;}return !(n.chrome()||n.safari())&&s.compatMode==='CSS1Compat'?s.documentElement:s.body;},getDocumentBodyElement:function(s){s=s||document;if(h.hasClass(s.documentElement,'wrapped')){var t=s.getElementById('body');if(t)return t;}return s.body;}};q.tx=p(o);q.tx._=q._tx=p(o._);function r(s,t,u){if(typeof t!='object'||q.isNode(t)||t instanceof Array||i.isHTML(t)){u=t;t=null;}return q.create(s,t,u);}a.$N=q.$N=r;a.DOM=e.exports=q;},3);
__e("event-extensions",["event-form-bubbling","DataStore","dom","ObjectUtils","Parent","ErrorUtils","ua","dom-core","copyProperties","userAction"],function(a,b,c,d,e,f){b('event-form-bubbling');var g=b('DataStore'),h=b('dom'),i=b('ObjectUtils'),j=b('Parent'),k=b('ErrorUtils'),l=b('ua'),m=b('dom-core').$,n=b('copyProperties'),o=b('userAction');Event.DATASTORE_KEY='Event.listeners';if(!Event.prototype)Event.prototype={};function p(y,z,aa){this.target=y;this.type=z;this.data=aa;}p.prototype={getData:function(){this.data=this.data||{};return this.data;},stop:function(){this.cancelBubble=true;this.stopPropagation&&this.stopPropagation();return this;},prevent:function(){this.returnValue=false;this.preventDefault&&this.preventDefault();return this;},kill:function(){this.stop().prevent();return false;},getTarget:function(){var y=this.target||this.srcElement;return y?m(y):null;}};function q(y){if(y instanceof p)return y;y=y||window.event||{};if(!y._inherits_from_prototype)for(var z in Event.prototype)try{y[z]=Event.prototype[z];}catch(aa){}return y;}n(Event.prototype,{_inherits_from_prototype:true,getRelatedTarget:function(){var y=this.relatedTarget||(this.fromElement===this.srcElement?this.toElement:this.fromElement);return y?m(y):null;},getModifiers:function(){var y={control:!!this.ctrlKey,shift:!!this.shiftKey,alt:!!this.altKey,meta:!!this.metaKey};y.access=l.osx()?y.control:y.alt;y.any=y.control||y.shift||y.alt||y.meta;return y;}});n(Event.prototype,p.prototype);n(Event,{listen:function(y,z,aa,ba){if(typeof y=='string')y=m(y);if(typeof ba=='undefined')ba=Event.Priority.NORMAL;if(typeof z=='object'){var ca={};for(var da in z)ca[da]=Event.listen(y,da,z[da],ba);return ca;}if(z.match(/^on/i))throw new TypeError("Bad event name `"+event+"': use `click', not `onclick'.");if(y.nodeName=='LABEL'&&z=='click'){var ea=y.getElementsByTagName('input');y=ea.length==1?ea[0]:y;}else if(y===window&&z==='scroll'){var fa=h.getDocumentScrollElement();if(fa!==document.documentElement&&fa!==document.body)y=fa;}var ga=g.get(y,s,{});if(u[z]){var ha=u[z];z=ha.base;aa=ha.wrap(aa);}v(y,z);var ia=ga[z];if(!(ba in ia))ia[ba]=[];var ja=ia[ba].length,ka=new x(aa,ia[ba],ja);ia[ba].push(ka);return ka;},stop:function(y){return q(y).stop();},prevent:function(y){return q(y).prevent();},kill:function(y){return q(y).kill();},getKeyCode:function(event){event=q(event);if(!event)return false;switch(event.keyCode){case 63232:return 38;case 63233:return 40;case 63234:return 37;case 63235:return 39;case 63272:case 63273:case 63275:return null;case 63276:return 33;case 63277:return 34;}if(event.shiftKey)switch(event.keyCode){case 33:case 34:case 37:case 38:case 39:case 40:return null;}return event.keyCode;},getPriorities:function(){if(!r){var y=i.getValues(Event.Priority);y.sort(function(z,aa){return z-aa;});r=y;}return r;},fire:function(y,z,aa){var ba=new p(y,z,aa),ca;do{var da=Event.__getHandler(y,z);if(da)ca=da(ba);y=y.parentNode;}while(y&&ca!==false&&!ba.cancelBubble);return ca!==false;},__fire:function(y,z,event){var aa=Event.__getHandler(y,z);if(aa)return aa(q(event));},__getHandler:function(y,z){return g.get(y,Event.DATASTORE_KEY+z);}});var r=null,s=Event.DATASTORE_KEY,t=function(y){return function(z){if(!h.contains(this,z.getRelatedTarget()))return y.call(this,z);};},u={mouseenter:{base:'mouseover',wrap:t},mouseleave:{base:'mouseout',wrap:t}},v=function(y,z){var aa='on'+z,ba=w.bind(y),ca=g.get(y,s);if(z in ca)return;ca[z]={};if(y.addEventListener){y.addEventListener(z,ba,false);}else if(y.attachEvent)y.attachEvent(aa,ba);g.set(y,s+z,ba);if(y[aa]){var da=y===document.documentElement?Event.Priority._BUBBLE:Event.Priority.TRADITIONAL,ea=y[aa];y[aa]=null;Event.listen(y,z,ea,da);}if(y.nodeName==='FORM'&&z==='submit')Event.listen(y,z,Event.__bubbleSubmit.curry(y),Event.Priority._BUBBLE);},w=function(event){event=q(event);var y=event.type;if(!g.get(this,s))throw new Error("Bad listenHandler context.");var z=g.get(this,s)[y];if(!z)throw new Error("No registered handlers for `"+y+"'.");if(y=='click'){var aa=j.byTag(event.getTarget(),'a'),ba=o('click',aa,event).set_namespace('evt_ext');if(window.ArbiterMonitor)ArbiterMonitor.initUA(ba,[aa]);}var ca=Event.getPriorities();for(var da=0;da<ca.length;da++){var ea=ca[da];if(ea in z){var fa=z[ea];for(var ga=0;ga<fa.length;ga++){if(!fa[ga])continue;var ha=fa[ga].fire(this,event);if(ha===false){return event.kill();}else if(event.cancelBubble)event.stop();}}}return event.returnValue;};Event.Priority={URGENT:-20,TRADITIONAL:-10,NORMAL:0,_BUBBLE:1000};function x(y,z,aa){this._handler=y;this._container=z;this._index=aa;}x.prototype={remove:function(){delete this._handler;delete this._container[this._index];},fire:function(y,event){return k.applyWithGuard(this._handler,y,[event],function(z){z.event_type=event.type;z.dom_element=y.name||y.id;z.category='eventhandler';});}};a.$E=f.$E=q;});
__e("css",["dom","css-core","copyProperties"],function(a,b,c,d,e,f){var g=b('dom'),h=b('css-core'),i=b('copyProperties');i(h,{shown:function(j){return !h.hasClass(j,'hidden_elem');},toggle:function(j){h.conditionShow(j,!h.shown(j));},setClass:function(j,k){$(j).className=k||'';return j;},setStyle:function(j,k,l){switch(k){case 'opacity':j.style.opacity=l;j.style.filter=l!==''?'alpha(opacity='+l*100+')':'';break;case 'float':j.style.cssFloat=j.style.styleFloat=l;break;default:k=k.replace(/-(.)/g,function(m,n){return n.toUpperCase();});j.style[k]=l;}return j;},getStyle:function(j,k){j=$(j);k=k.replace(/-(.)/g,function(n,o){return o.toUpperCase();});function l(n){return n.replace(/([A-Z])/g,'-$1').toLowerCase();}if(window.getComputedStyle){var m=window.getComputedStyle(j,null);if(m)return m.getPropertyValue(l(k));}if(document.defaultView&&document.defaultView.getComputedStyle){var m=document.defaultView.getComputedStyle(j,null);if(m)return m.getPropertyValue(l(k));if(k=="display")return "none";}if(j.currentStyle)return j.currentStyle[k];return j.style&&j.style[k];},getStyleFloat:function(j,k){return parseFloat(h.getStyle(j,k),10);},getOpacity:function(j){j=$(j);var k=h.getStyle(j,'filter'),l=null;if(k&&(l=/(\d+(?:\.\d+)?)/.exec(k))){return parseFloat(l.pop())/100;}else if(k=h.getStyle(j,'opacity')){return parseFloat(k);}else return 1;},isFixed:function(j){while(j&&j!==document.documentElement){if(h.getStyle(j,'position')==='fixed')return true;j=j.parentNode;}return false;},getScrollParent:(function(){function j(k,l){var m=h.getStyle(k,l);return (m==='auto'||m==='scroll');}return function(k){if(!k)return null;while(k!==document.body){if(j(k,'overflow')||j(k,'overflowY')||j(k,'overflowX'))return k;k=k.parentNode;}return window;};})()});e.exports=h;},3);
__e("AsyncDOM",["css","dom","onload"],function(a,b,c,d,e,f){var g=b("css"),h=b("dom"),i=b("onload"),j={invoke:function(k,l){for(var m=0;m<k.length;++m){var n=k[m],o=n[0],p=n[1],q=n[2],r=n[3],s=(q&&l)||null;if(p)s=h.scry(s||document.documentElement,p)[0];switch(o){case 'eval':(new Function(r)).apply(s);break;case 'hide':g.hide(s);break;case 'show':g.show(s);break;case 'setContent':h.setContent(s,r);break;case 'appendContent':h.appendContent(s,r);break;case 'prependContent':h.prependContent(s,r);break;case 'insertAfter':h.insertAfter(s,r);break;case 'insertBefore':h.insertBefore(r,s);break;case 'remove':h.remove(s);break;case 'replace':h.replace(s,r);break;default:}}}};e.exports=j;});
__e("AsyncResponse",["Env","copyProperties","tx"],function(a,b,c,d,e,f){var g=b("Env"),h=b("copyProperties");a.tx=b("tx");function i(j,k){h(this,{error:0,errorSummary:null,errorDescription:null,onload:null,replay:false,payload:k||null,request:j||null,silentError:false,is_last:true});return this;}h(i,{defaultErrorHandler:function(j){try{if(!j.silentError){i.verboseErrorHandler(j);}else j.logErrorByGroup('silent',10);}catch(k){alert(j);}},verboseErrorHandler:function(j){try{var l=j.getErrorSummary(),m=j.getErrorDescription();j.logErrorByGroup('popup',10);if(j.silentError&&m=='')m="\u67d0\u4e9b\u4e1c\u897f\u51fa\u4e86\u95ee\u9898\u3002\u6211\u4eec\u6b63\u5728\u7aed\u5c3d\u6240\u80fd\u5730\u4fee\u590d\u5b83\u3002\u7a0d\u540e\u4f60\u53ef\u4ee5\u91cd\u8bd5\u3002";Bootloader.loadComponents('dialog',function(){new Dialog().setTitle(l).setBody(m).setButtons([Dialog.OK]).setModal(true).setCausalElement(this.relativeTo).show();});}catch(k){alert(j);}}});h(i.prototype,{getRequest:function(){return this.request;},getPayload:function(){return this.payload;},getError:function(){return this.error;},getErrorSummary:function(){return this.errorSummary;},setErrorSummary:function(j){j=(j===undefined?null:j);this.errorSummary=j;return this;},getErrorDescription:function(){return this.errorDescription;},getErrorIsWarning:function(){return this.errorIsWarning;},logError:function(j,k){if(window.send_error_signal){var l={err_code:this.error,vip:(g.vip||'-')};if(k!==undefined){l.duration=k.duration;l.xfb_ip=k.xfb_ip;}var m=this.request.getURI();l.path=m||'-';l.aid=this.request.userActionID;if(m&&m.indexOf('scribe_endpoint.php')!=-1)j='async_error_double';send_error_signal(j,JSON.stringify(l));}},logErrorByGroup:function(j,k){if(Math.floor(Math.random()*k)==0)if(this.error==1357010||this.error<15000){this.logError('async_error_oops_'+j);}else this.logError('async_error_logic_'+j);}});e.exports=i;});
__e("Cookie",["Env"],function(a,b,c,d,e,f){var g=b("Env"),h={set:function(i,j,k,l,m){if(g.no_cookies&&i!='tpa')return;var n;if(k){var o=new Date();n=new Date();n.setTime(o.getTime()+k);}document.cookie=i+"="+encodeURIComponent(j)+"; "+(k?"expires="+n.toGMTString()+"; ":"")+"path="+(l||'default.htm')+"; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1')+(m?"; secure":"");},clear:function(i){document.cookie=i+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; "+"path=/; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1');},get:function(i){var j=i+"=",k=document.cookie.split(';');for(var l=0;l<k.length;l++){var m=k[l];while(m.charAt(0)==' ')m=m.substring(1,m.length);if(m.indexOf(j)===0)return decodeURIComponent(m.substring(j.length,m.length));}return null;}};e.exports=h;});
__e("URI",["copyProperties"],function(a,b,c,d,e,f){var g=b("copyProperties");function h(i){if(!(this instanceof h))return new h(i||window.location.href);this.parse(i||'');}g(h,{getRequestURI:function(i,j){i=i===undefined||i;if(i&&window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getCurrentURI(!!j).getQualifiedURI();}else return new h(window.location.href);},getMostRecentURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getMostRecentURI().getQualifiedURI();}else return new h(window.location.href);},getNextURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getNextURI().getQualifiedURI();}else return new h(window.location.href);},expression:/(((\w+):\/\/)([^\/:]*)(:(\d+))?)?([^#?]*)(\?([^#]*))?(#(.*))?/,arrayQueryExpression:/^(\w+)((?:\[\w*\])+)=?(.*)/,explodeQuery:function(i){if(!i)return {};var j={};i=i.replace(/%5B/ig,'[').replace(/%5D/ig,']');i=i.split('&');for(var k=0,l=i.length;k<l;k++){var m=i[k].match(h.arrayQueryExpression);if(!m){var n=i[k].split('=');j[h.decodeComponent(n[0])]=n[1]===undefined?null:h.decodeComponent(n[1]);}else{var o=m[2].split(/\]\[|\[|\]/).slice(0,-1),p=m[1],q=h.decodeComponent(m[3]||'');o[0]=p;var r=j;for(var s=0;s<o.length-1;s++)if(o[s]){if(r[o[s]]===undefined)if(o[s+1]&&!o[s+1].match(/^\d+$/)){r[o[s]]={};}else r[o[s]]=[];r=r[o[s]];}else{if(o[s+1]&&!o[s+1].match(/^\d+$/)){r.push({});}else r.push([]);r=r[r.length-1];}if(r instanceof Array&&o[o.length-1]===''){r.push(q);}else r[o[o.length-1]]=q;}}return j;},implodeQuery:function(i,j,k){j=j||'';if(k===undefined)k=true;var l=[];if(i===null||i===undefined){l.push(k?h.encodeComponent(j):j);}else if(i instanceof Array){for(var m=0;m<i.length;++m)try{if(i[m]!==undefined)l.push(h.implodeQuery(i[m],j?(j+'['+m+']'):m));}catch(n){}}else if(typeof(i)=='object'){if(('nodeName' in i)&&('nodeType' in i)){l.push('{node}');}else for(var o in i)try{if(i[o]!==undefined)l.push(h.implodeQuery(i[o],j?(j+'['+o+']'):o));}catch(n){}}else if(k){l.push(h.encodeComponent(j)+'='+h.encodeComponent(i));}else l.push(j+'='+i);return l.join('&');},encodeComponent:function(i){var j=String(i).split(/([\[\]])/);for(var k=0,l=j.length;k<l;k+=2)j[k]=encodeURIComponent(j[k]);return j.join('');},decodeComponent:function(i){return decodeURIComponent(i.replace(/\+/g,' '));},INVALID_DOMAIN:'invalid.invalid',sanitizeDomain:function(i){var j=new RegExp('[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f'+'\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF'+'\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]');if(j.test(i)){return h.INVALID_DOMAIN;}else return i;},fromJSON:function(i){return new h(i.url);}});g(h.prototype,{parse:function(i){var j=i.toString().match(h.expression);g(this,{protocol:j[3]||'',domain:h.sanitizeDomain(j[4]||''),port:j[6]||'',path:j[7]||'',query_s:j[9]||'',fragment:j[11]||''});return this;},setProtocol:function(i){this.protocol=i;return this;},getProtocol:function(){return this.protocol;},setQueryData:function(i){this.query_s=h.implodeQuery(i);return this;},addQueryData:function(i){return this.setQueryData(g(this.getQueryData(),i));},removeQueryData:function(i){if(!(i instanceof Array))i=[i];var j=this.getQueryData();for(var k=0,l=i.length;k<l;++k)delete j[i[k]];return this.setQueryData(j);},getQueryData:function(){return h.explodeQuery(this.query_s);},setFragment:function(i){this.fragment=i;return this;},getFragment:function(){return this.fragment;},setDomain:function(i){this.domain=h.sanitizeDomain(i);return this;},getDomain:function(){return this.domain;},setPort:function(i){this.port=i;return this;},getPort:function(){return this.port;},setPath:function(i){this.path=i;return this;},getPath:function(){return this.path.replace(/^\/+/,'./');},isEmpty:function(){return !(this.path||this.protocol||this.domain||this.port||this.query_s||this.fragment);},toString:function(){var i='';this.protocol&&(i+=this.protocol+'://');this.domain&&(i+=this.domain);this.port&&(i+=':'+this.port);if(this.domain&&!this.path)i+='/';this.path&&(i+=this.path);this.query_s&&(i+='?'+this.query_s);this.fragment&&(i+='#'+this.fragment);return i;},valueOf:function(){return this.toString();},isFacebookURI:function(){if(!h._facebookURIRegex)h._facebookURIRegex=new RegExp('(^|\\.)facebook\\.com([^.]*)$','i');return (!this.domain||h._facebookURIRegex.test(this.domain));},isQuicklingEnabled:function(){return window.Quickling&&Quickling.isActive()&&Quickling.isPageActive(this);},getRegisteredDomain:function(){if(!this.domain)return '';if(!this.isFacebookURI())return null;var i=this.domain.split('.'),j=i.indexOf('facebook');return i.slice(j).join('.');},getUnqualifiedURI:function(){return new h(this).setProtocol(null).setDomain(null).setPort(null);},getQualifiedURI:function(){var i=new h(this);if(!i.getDomain()){var j=h();i.setProtocol(j.getProtocol()).setDomain(j.getDomain()).setPort(j.getPort());}return i;},isSameOrigin:function(i){var j=i||window.location.href;if(!(j instanceof h))j=new h(j.toString());if(this.getProtocol()&&this.getProtocol()!=j.getProtocol())return false;if(this.getDomain()&&this.getDomain()!=j.getDomain())return false;return true;},go:function(i){goURI(this,i);},setSubdomain:function(i){var j=new h(this).getQualifiedURI(),k=j.getDomain().split('.');if(k.length<=2){k.unshift(i);}else k[0]=i;return j.setDomain(k.join('.'));},getSubdomain:function(){if(!this.getDomain())return '';var i=this.getDomain().split('.');if(i.length<=2){return '';}else return i[0];},setSecure:function(i){return this.setProtocol(i?'https':'http');},isSecure:function(){return this.getProtocol()=='https';}});e.exports=h;});
__e("AsyncRequest",["array-extensions","event-extensions","json","Arbiter","AsyncDOM","AsyncResponse","bootloader","Cookie","css-core","dom","Env","JSCC","Parent","URI","Util","bind","copyProperties","evalGlobal","goURI","invokeCallbacks","isEmpty"],function(global,require,requireDynamic,requireLazy,module,exports){require("array-extensions");require("event-extensions");require("json");var Arbiter=require("Arbiter"),AsyncDOM=require("AsyncDOM"),AsyncResponse=require("AsyncResponse"),Bootloader=require("bootloader"),Cookie=require("Cookie"),CSS=require("css-core"),DOM=require("dom"),Env=require("Env"),JSCC=require("JSCC"),Parent=require("Parent"),URI=require("URI"),Util=require("Util"),bind=require("bind"),copyProperties=require("copyProperties"),evalGlobal=require("evalGlobal"),goURI=require("goURI"),invokeCallbacks=require("invokeCallbacks"),isEmpty=require("isEmpty");function AsyncRequest(uri){var dispatchResponse=bind(this,function(asyncResponse){try{this.clearStatusIndicator();if(!this.isRelevant()){invokeErrorHandler(1010);return;}if(this.initialHandler(asyncResponse)!==false){clearTimeout(this.timer);if(asyncResponse.jscc_map){var jscc_map=eval(asyncResponse.jscc_map);JSCC.init(jscc_map);}if(this.handler)try{var suppress_onload=this.handler(asyncResponse);}catch(exception){asyncResponse.is_last&&this.finallyHandler(asyncResponse);throw exception;}if(suppress_onload!==AsyncRequest.suppressOnloadToken){var domOps=asyncResponse.domops;if(domOps)AsyncDOM.invoke(domOps,this.getRelativeTo());asyncResponse.jscalls&&invokeCallbacks([asyncResponse.jscalls]);var onload=asyncResponse.onload;if(onload)for(var ii=0;ii<onload.length;ii++)try{(new Function(onload[ii])).apply(this);}catch(exception){}if(this.lid)Arbiter.inform('tti_ajax',{s:this.lid,d:[this._sendTimeStamp||0,(this._sendTimeStamp&&this._responseTime)?(this._responseTime-this._sendTimeStamp):0]},Arbiter.BEHAVIOR_EVENT);var onafterload=asyncResponse.onafterload;if(onafterload)for(var ii=0;ii<onafterload.length;ii++)try{(new Function(onafterload[ii])).apply(this);}catch(exception){}}asyncResponse.is_last&&this.finallyHandler(asyncResponse);}}catch(exception){}}),dispatchErrorResponse=bind(this,function(asyncResponse,isTransport){try{this.clearStatusIndicator();var async_error=asyncResponse.getError();if(this._sendTimeStamp){var _duration=Date.now()-this._sendTimeStamp,xfb_ip=this._xFbServer||'-';asyncResponse.logError('async_error',{duration:_duration,xfb_ip:xfb_ip});}else asyncResponse.logError('async_error');if((!this.isRelevant())||async_error===1010)return;if(async_error==1357008||async_error==1357007||async_error==1442002||async_error==1357001){var is_confirmation=false;if(async_error==1357008||async_error==1357007)is_confirmation=true;var payload=asyncResponse.getPayload();this._displayServerDialog(payload.__dialog,is_confirmation);}else if(this.initialHandler(asyncResponse)!==false){clearTimeout(this.timer);try{if(isTransport){this.transportErrorHandler(asyncResponse);}else this.errorHandler(asyncResponse);}catch(exception){this.finallyHandler(asyncResponse);throw exception;}this.finallyHandler(asyncResponse);}}catch(exception){}}),_interpretTransportResponse=bind(this,function(){if(this.getOption('suppressEvaluation')){var r=new AsyncResponse(this,this.transport);return {asyncResponse:r};}var _sendError=function(p,error_code,str){if(!window.send_error_signal)return;if(this._xFbServer){error_code='1008_'+error_code;}else error_code='1012_'+error_code;send_error_signal('async_xport_resp',error_code+':'+(this._xFbServer||'-')+':'+p.getURI()+':'+str.length+':'+str.substr(0,1600));},shield="for (;;);",shieldlen=shield.length,text=this.transport.responseText;if(text.length<=shieldlen){_sendError(this,'empty',text);return {transportError:'Response too short on async to '+this.getURI()};}var offset=0;while(text.charAt(offset)==" "||text.charAt(offset)=="\n")offset++;offset&&text.substring(offset,offset+shieldlen)==shield;var safeResponse=text.substring(offset+shieldlen);try{var response=eval('('+safeResponse+')');}catch(exception){_sendError(this,'excep',text);return {transportError:'eval() failed on async to '+this.getURI()};}return interpretResponse(response);}),interpretResponse=bind(this,function(response){if(response.redirect)return {redirect:response.redirect};var r=new AsyncResponse(this);if(response.__ar!=1){r.payload=response;}else{copyProperties(r,response);if(response.tplts)if(window.DynaTemplate)DynaTemplate.registerTemplates(response.tplts);}return {asyncResponse:r};}),invokeResponseHandler=bind(this,function(interp){if(typeof(interp.redirect)!='undefined'){(function(){this.setURI(interp.redirect).send();}).bind(this).defer();return;}if(this.handler||this.errorHandler||this.transportErrorHandler)if(typeof(interp.asyncResponse)!='undefined'){var r=interp.asyncResponse;if(!this.isRelevant()){invokeErrorHandler(1010);return;}if(r.inlinejs)evalGlobal(r.inlinejs);if(r.lid){this._responseTime=Date.now();if(window.CavalryLogger)this.cavalry=CavalryLogger.getInstance(r.lid);this.lid=r.lid;}if(r.getError()&&!r.getErrorIsWarning()){var fn=dispatchErrorResponse;}else var fn=dispatchResponse;Bootloader.setResourceMap(r.resource_map);if(r.bootloadable)Bootloader.enableBootload(r.bootloadable);fn=fn.shield(null,r);fn=fn.defer.bind(fn);var is_transitional=false;if(this.preBootloadHandler)is_transitional=this.preBootloadHandler(r);r.css=r.css||[];r.js=r.js||[];Bootloader.loadResources(r.css.concat(r.js),fn,is_transitional,this.getURI());}else if(typeof(interp.transportError)!='undefined'){if(this._xFbServer){invokeErrorHandler(1008);}else invokeErrorHandler(1012);}else invokeErrorHandler(1007);}),invokeErrorHandler=bind(this,function(explicitError){try{if(!window.loaded&&!this.getOption('handleErrorAfterUnload'))return;}catch(ex){return;}var r=new AsyncResponse(this),err;try{err=explicitError||this.transport.status||1004;}catch(ex){err=1005;}if(this._requestAborted)err=1011;try{if(this.responseText=='')err=1002;}catch(ignore){}if(this.transportErrorHandler){var desc,summary,silent=true;if(false===navigator.onLine){summary="\u65e0\u7f51\u7edc";desc="\u4f60\u7684\u6d4f\u89c8\u5668\u4f3c\u4e4e\u79bb\u7ebf\u3002\u8bf7\u68c0\u67e5\u4f60\u7684\u7f51\u7edc\u8fde\u63a5\u7136\u540e\u518d\u8bd5\u3002";err=1006;}else if(err>=300&&err<=399){summary="\u91cd\u65b0\u5b9a\u5411";desc="\u8fd9\u4e2a\u65f6\u5019\u4f60\u6b63\u5728\u8bbf\u95ee\u7684Facebook\u9875\u9762\u5df2\u88ab\u66f4\u6539\u6216\u88ab\u7b2c\u4e09\u65b9\u7a0b\u5e8f\u963b\u6321\uff0c\u8bf7\u8054\u7edc\u4f60\u7684\u7f51\u7edc\u4f9b\u5e94\u5546\u6216\u5c1d\u8bd5\u91cd\u65b0\u8f7d\u5165\u9875\u9762\u3002";redir_url=this.transport.getResponseHeader("Location");if(redir_url)goURI(redir_url,true);silent=true;}else{summary="\u7cdf\u7cd5";desc="\u67d0\u4e9b\u4e1c\u897f\u51fa\u4e86\u95ee\u9898\u3002\u6211\u4eec\u6b63\u5728\u7aed\u5c3d\u6240\u80fd\u5730\u4fee\u590d\u5b83\u3002\u7a0d\u540e\u4f60\u53ef\u4ee5\u91cd\u8bd5\u3002";}!this.getOption('suppressErrorAlerts');copyProperties(r,{error:err,errorSummary:summary,errorDescription:desc,silentError:silent});dispatchErrorResponse(r,true);}}),handleResponse=function(response){var asyncResponse=this.interpretResponse(response);this.invokeResponseHandler(asyncResponse);},onStateChange=function(){try{if(this.transport.readyState==4){AsyncRequest._inflightPurge();try{if(typeof(this.transport.getResponseHeader)!='undefined'&&this.transport.getResponseHeader('X-FB-Debug'))this._xFbServer=this.transport.getResponseHeader('X-FB-Debug');}catch(ex){}if(this.transport.status>=200&&this.transport.status<300){AsyncRequest.lastSuccessTime=Date.now();invokeResponseHandler(_interpretTransportResponse());}else if(ua.safari()&&(typeof(this.transport.status)=='undefined')){invokeErrorHandler(1002);}else if(window.Env&&window.Env.retry_ajax_on_network_error&&this.transport.status in {0:1,12029:1,12030:1,12031:1,12152:1}&&this.remainingRetries>0){--this.remainingRetries;delete this.transport;this.send(true);return;}else invokeErrorHandler();if(this.getOption('asynchronous')!==false)delete this.transport;}}catch(exception){try{if(!window.loaded)return;}catch(ex){return;}delete this.transport;if(this.remainingRetries>0){--this.remainingRetries;this.send(true);}else{!this.getOption('suppressErrorAlerts');if(window.send_error_signal)send_error_signal('async_xport_resp','1007:'+(this._xFbServer||'-')+':'+this.getURI()+':'+exception.message);invokeErrorHandler(1007);}}},onJSONPResponse=function(data,more_chunked_response){var is_first=(this.is_first===undefined);this.is_first=is_first;if(this.transportIframe&&!more_chunked_response){if(this.cavalry)this.cavalry.collectBrowserTiming(this.transportIframe.contentWindow);(function(x){document.body.removeChild(x);}).bind(null,this.transportIframe).defer();}if(ua.ie()>=9&&window.JSON)data=window.JSON.parse(window.JSON.stringify(data));var r=this.interpretResponse(data);r.asyncResponse.is_first=is_first;r.asyncResponse.is_last=!more_chunked_response;this.invokeResponseHandler(r);return more_chunked_response;};copyProperties(this,{onstatechange:onStateChange,onjsonpresponse:onJSONPResponse,invokeResponseHandler:invokeResponseHandler,interpretResponse:interpretResponse,handleResponse:handleResponse,transport:null,method:'POST',uri:'',timeout:null,timer:null,initialHandler:bagofholding,handler:null,errorHandler:null,transportErrorHandler:null,timeoutHandler:null,finallyHandler:bagofholding,serverDialogCancelHandler:null,relativeTo:null,statusElement:null,statusClass:'',data:{},file:null,context:{},readOnly:false,writeRequiredParams:['post_form_id'],remainingRetries:0,option:{asynchronous:true,suppressErrorHandlerWarning:false,suppressEvaluation:false,suppressErrorAlerts:false,retries:0,jsonp:false,bundle:false,useIframeTransport:false,tfbEndpoint:true,handleErrorAfterUnload:false},userActionID:'-'});this.errorHandler=AsyncResponse.defaultErrorHandler;this.transportErrorHandler=bind(this,'errorHandler');if(uri!=undefined)this.setURI(uri);return this;}Arbiter.subscribe("page_transition",function(type,message){AsyncRequest._id_threshold=message.id;});copyProperties(AsyncRequest,{receiveJSONPResponse:function(id,data,more_chunked_response){if(this._JSONPReceivers[id]){if(!this._JSONPReceivers[id](data,more_chunked_response))delete this._JSONPReceivers[id];}else if(window.logJSError&&!more_chunked_response){var uri=(data.payload&&data.payload.uri)||'';logJSError('ajax',{error:'UnexpectedJsonResponse',extra:{id:id,uri:uri}});}},_bundleRequest:function(request){if(request.getOption('jsonp')||request.getOption('useIframeTransport')){request.setOption('bundle',false);return false;}else if(!request.uri.isFacebookURI()){request.setOption('bundle',false);return false;}else if(!request.getOption('asynchronous')){request.setOption('bundle',false);return false;}var path=request.uri.getPath();if(!AsyncRequest._bundleTimer)AsyncRequest._bundleTimer=setTimeout(function(){AsyncRequest._sendBundledRequests();},0);AsyncRequest._allBundledRequests.push([path,request]);return true;},_sendBundledRequests:function(){clearTimeout(AsyncRequest._bundleTimer);AsyncRequest._bundleTimer=null;var bundled_requests=AsyncRequest._allBundledRequests;AsyncRequest._allBundledRequests=[];if(bundled_requests.length==1){var request=bundled_requests[0][1];request.setOption('bundle',false).send();return request;}if(bundled_requests.length===0)return null;var data=[];for(var ii=0;ii<bundled_requests.length;ii++)data.push([bundled_requests[ii][0],URI.implodeQuery(bundled_requests[ii][1].data)]);var query_data={data:data},request=new AsyncRequest();request.setURI('/ajax/proxy.php').setData(query_data).setMethod('POST').setInitialHandler(bagof(true)).setAllowCrossPageTransition(true).setHandler(function(r){var payload=r.getPayload(),responses=payload.responses;if(responses.length!=bundled_requests.length){return;}else for(var ii=0;ii<bundled_requests.length;ii++){var path=bundled_requests[ii][0],request=bundled_requests[ii][1];request.id=this.id;if(responses[ii][0]!=path){request.invokeResponseHandler({transportError:'Wrong response order in bundled request to '+path});continue;}var asyncResponse=request.interpretResponse(responses[ii][1]);request.invokeResponseHandler(asyncResponse);}}).setTransportErrorHandler(function(response){var paths=[],interp={transportError:response.errorDescription};for(var ii=0;ii<bundled_requests.length;ii++){var path=bundled_requests[ii][0],request=bundled_requests[ii][1];paths.push(path);request.id=this.id;request.invokeResponseHandler(interp);}}).send();return request;},bootstrap:function(href,elem,is_post){var method='GET',readonly=true,data={};if(is_post||elem&&(elem.rel=='async-post'||elem.getAttribute&&elem.getAttribute('forcemethod')=='post')){method='POST';readonly=false;if(href){href=URI(href);data=href.getQueryData();href.setQueryData({});}}var status_elem=Parent.byClass(elem,'stat_elem')||elem;if(status_elem&&CSS.hasClass(status_elem,'async_saving'))return false;var async=new AsyncRequest(href).setReadOnly(readonly).setMethod(method).setData(data).setNectarModuleDataSafe(elem).setRelativeTo(elem).setHandler(function(response){Event.fire(elem,'success',{response:response});}).setErrorHandler(function(response){if(Event.fire(elem,'error',{response:response})!==false)AsyncResponse.defaultErrorHandler(response);});if(status_elem){async.setStatusElement(status_elem);var status_class=status_elem.getAttribute('data-status-class');status_class&&async.setStatusClass(status_class);}async.send();return false;},post:function(href,data){new AsyncRequest(href).setReadOnly(false).setMethod('POST').setData(data).send();return false;},getLastId:function(){return AsyncRequest._last_id;},_JSONPReceivers:{},_allBundledRequests:[],_bundleTimer:null,suppressOnloadToken:{},_last_id:2,_id_threshold:2,_inflight:[],_inflightAdd:bagofholding,_inflightPurge:bagofholding,_inflightEnable:function(){if(ua.ie()){copyProperties(AsyncRequest,{_inflightAdd:function(ar){this._inflight.push(ar);},_inflightPurge:function(){AsyncRequest._inflight=AsyncRequest._inflight.filter(function(ar){return ar.transport&&ar.transport.readyState<4;});}});onunloadRegister(function(){AsyncRequest._inflight.each(function(ar){if(ar.transport&&ar.transport.readyState<4){ar.transport.abort();delete ar.transport;}});});}}});copyProperties(AsyncRequest.prototype,{setMethod:function(m){this.method=m.toString().toUpperCase();return this;},getMethod:function(){return this.method;},setData:function(obj){this.data=obj;return this;},_setDataHash:function(){if(this.method!='POST'||!this.getOption('tfbEndpoint')||this.data.phstamp)return;var input_len=URI.implodeQuery(this.data).length,numeric_csrf_value='';for(var ii=0;ii<this.data.fb_dtsg.length;ii++)numeric_csrf_value+=this.data.fb_dtsg.charCodeAt(ii);this.data.phstamp='1'+numeric_csrf_value+input_len;},setFile:function(file){this.file=file;return this;},getData:function(){return this.data;},setContextData:function(key,value,enabled){enabled=enabled===undefined?true:enabled;if(enabled)this.context['_log_'+key]=value;return this;},_setUserActionID:function(){var ue=window.ArbiterMonitor&&ArbiterMonitor.getUE()||'-';this.userActionID=(window.EagleEye&&EagleEye.getSessionID()||'-')+'/'+ue;},setURI:function(uri){var uri_obj=URI(uri);if(this.getOption('useIframeTransport')&&!uri_obj.isFacebookURI())return this;if(!this.getOption('jsonp')&&!this.getOption('useIframeTransport')&&!uri_obj.isSameOrigin())return this;this._setUserActionID();if(!uri||uri_obj.isEmpty()){if(window.send_error_signal&&window.get_error_stack){var data={err_code:1013,vip:'-',duration:0,xfb_ip:'-',path:window.location.href,aid:this.userActionID};send_error_signal('async_error',JSON.stringify(data));send_error_signal('async_xport_stack','1013:'+window.location.href+'::'+get_error_stack());}return this;}this.uri=uri_obj;return this;},getURI:function(){return this.uri.toString();},setInitialHandler:function(fn){this.initialHandler=fn;return this;},setHandler:function(fn){if(!(typeof(fn)!='function'))this.handler=fn;return this;},getHandler:function(){return this.handler;},setErrorHandler:function(fn){if(!(typeof(fn)!='function'))this.errorHandler=fn;return this;},setTransportErrorHandler:function(fn){this.transportErrorHandler=fn;return this;},getErrorHandler:function(){return this.errorHandler;},getTransportErrorHandler:function(){return this.transportErrorHandler;},setTimeoutHandler:function(timeout,fn){if(!(typeof(fn)!='function')){this.timeout=timeout;this.timeoutHandler=fn;}return this;},resetTimeout:function(timeout){if(!(this.timeoutHandler===null))if(timeout===null){this.timeout=null;clearTimeout(this.timer);this.timer=null;}else{var clear_on_quickling_event=!this._allowCrossPageTransition;this.timeout=timeout;clearTimeout(this.timer);this.timer=this._handleTimeout.bind(this).defer(this.timeout,clear_on_quickling_event);}return this;},_handleTimeout:function(){this.abandon();this.timeoutHandler(this);},setNewSerial:function(){this.id=++AsyncRequest._last_id;return this;},setFinallyHandler:function(fn){this.finallyHandler=fn;return this;},getServerDialogCancelHandler:function(){return this.serverDialogCancelHandler;},setServerDialogCancelHandler:function(fn){this.serverDialogCancelHandler=fn;return this;},setPreBootloadHandler:function(fn){this.preBootloadHandler=fn;return this;},setReadOnly:function(readOnly){if(!(typeof(readOnly)!='boolean'))this.readOnly=readOnly;return this;},setFBMLForm:function(){this.writeRequiredParams=["fb_sig"];return this;},getReadOnly:function(){return this.readOnly;},setRelativeTo:function(element){this.relativeTo=element;return this;},getRelativeTo:function(){return this.relativeTo;},setStatusClass:function(c){this.statusClass=c;return this;},setStatusElement:function(element){this.statusElement=element;return this;},getStatusElement:function(){return ge(this.statusElement);},isRelevant:function(){if(this._allowCrossPageTransition)return true;if(!this.id)return true;return this.id>AsyncRequest._id_threshold;},clearStatusIndicator:function(){var statusElem=this.getStatusElement();if(statusElem){CSS.removeClass(statusElem,'async_saving');CSS.removeClass(statusElem,this.statusClass);}},addStatusIndicator:function(){var statusElem=this.getStatusElement();if(statusElem){CSS.addClass(statusElem,'async_saving');CSS.addClass(statusElem,this.statusClass);}},specifiesWriteRequiredParams:function(){return this.writeRequiredParams.every(function(param){this.data[param]=this.data[param]||Env[param]||(ge(param)||{}).value;if(this.data[param]!==undefined)return true;return false;},this);},setOption:function(opt,v){if(typeof(this.option[opt])!='undefined')this.option[opt]=v;return this;},getOption:function(opt){typeof(this.option[opt])=='undefined';return this.option[opt];},abort:function(){if(this.transport){var old_handler=this.getTransportErrorHandler();this.setOption('suppressErrorAlerts',true);this.setTransportErrorHandler(bagofholding);this._requestAborted=1;this.transport.abort();this.setTransportErrorHandler(old_handler);}},abandon:function(){clearTimeout(this.timer);this.setOption('suppressErrorAlerts',true).setHandler(bagofholding).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding);if(this.transport){this._requestAborted=1;this.transport.abort();}},setNectarData:function(nctrParams){if(nctrParams){if(this.data.nctr===undefined)this.data.nctr={};copyProperties(this.data.nctr,nctrParams);}return this;},setNectarModuleDataSafe:function(elem){if(this.setNectarModuleData)this.setNectarModuleData(elem);return this;},setNectarImpressionIdSafe:function(){if(this.setNectarImpressionId)this.setNectarImpressionId();return this;},setAllowCrossPageTransition:function(allow){this._allowCrossPageTransition=!!allow;if(this.timer)this.resetTimeout(this.timeout);return this;},send:function(isRetry){isRetry=isRetry||false;if(!this.uri)return false;!this.errorHandler&&!this.getOption('suppressErrorHandlerWarning');if(this.getOption('jsonp')&&this.method!='GET')this.setMethod('GET');if(this.getOption('useIframeTransport')&&this.method!='GET')this.setMethod('GET');this.timeoutHandler!==null&&(this.getOption('jsonp')||this.getOption('useIframeTransport'));if(!this.getReadOnly()){this.specifiesWriteRequiredParams();if(this.method!='POST')return false;}if(this.method=='POST'&&this.getOption('tfbEndpoint')){this.data.fb_dtsg=Env.fb_dtsg;this.data.lsd=Cookie.get('lsd');}if(!isEmpty(this.context)&&this.getOption('tfbEndpoint')){copyProperties(this.data,this.context);this.data.ajax_log=1;}if(window.Env&&Env.force_param)copyProperties(this.data,Env.force_param);if(!this.getReadOnly()&&this.getOption('tfbEndpoint')&&this.method=='POST'&&this.data.post_form_id_source===undefined)this.data.post_form_id_source='AsyncRequest';if(window.Env)this.data.__user=Env.user;this._setUserActionID();if(this.getOption('bundle')&&AsyncRequest._bundleRequest(this))return true;this.setNewSerial();if(this.getOption('tfbEndpoint')){this.uri.addQueryData({__a:1});if(!this.getOption('asynchronous'))this.uri.addQueryData({__s:1});if(Env.fb_isb)this.uri.addQueryData({fb_isb:Env.fb_isb});}this.finallyHandler=async_callback(this.finallyHandler,'final');var uri_str,query;if(this.method=='GET'||this.file){uri_str=this.uri.addQueryData(this.data).toString();query='';}else{uri_str=this.uri.toString();this._setDataHash();query=URI.implodeQuery(this.data);}if(this.getOption('jsonp')||this.getOption('useIframeTransport')){uri_str=this.uri.addQueryData({__a:this.id}).toString();AsyncRequest._JSONPReceivers[this.id]=async_callback(bind(this,'onjsonpresponse'),'json');if(this.getOption('jsonp')){(function(){document.body.appendChild($N('script',{src:uri_str,type:"text/javascript"}));}).bind(this).defer();}else{var style={position:'absolute',top:'-9999999px',width:'80px',height:'80px'};this.transportIframe=$N('iframe',{src:"javascript:''",style:style});document.body.appendChild(this.transportIframe);this.transportIframe.src=uri_str;}return true;}if(this.transport)return false;var transport=null;try{transport=new XMLHttpRequest();}catch(ignored){}if(!transport)try{transport=new ActiveXObject("Msxml2.XMLHTTP");}catch(ignored){}if(!transport)try{transport=new ActiveXObject("Microsoft.XMLHTTP");}catch(ignored){}if(!transport)return false;transport.onreadystatechange=async_callback(bind(this,'onstatechange'),'xhr');if(!isRetry)this.remainingRetries=this.getOption('retries');if(window.send_error_signal||window.ArbiterMonitor)this._sendTimeStamp=this._sendTimeStamp||Date.now();this.transport=transport;try{this.transport.open(this.method,uri_str,this.getOption('asynchronous'));}catch(ex){return false;}var svn_rev=Env.svn_rev;if(svn_rev)this.transport.setRequestHeader('X-SVN-Rev',String(svn_rev));if(this.method=='POST')this.transport.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.addStatusIndicator();query=this.file||query;this.transport.send(query);if(this.timeout!==null)this.resetTimeout(this.timeout);AsyncRequest._inflightAdd(this);return true;},_displayServerDialog:function(model,is_confirmation){Bootloader.loadComponents('dialog',function(){var dialog=new Dialog(model);if(is_confirmation)dialog.setHandler(this._displayConfirmationHandler.bind(this,dialog));dialog.setCancelHandler(function(){var handler=this.getServerDialogCancelHandler();if(handler)handler.apply(this,arguments);this.finallyHandler.apply(this,arguments);}.bind(this)).setCausalElement(this.relativeTo).setCloseHandler(this.finallyHandler.bind(this)).show();}.bind(this));},_displayConfirmationHandler:function(dialog){this.data.confirmed=1;copyProperties(this.data,dialog.getFormData());this.send();}});module.exports=AsyncRequest;});
__e("legacy:async",["AsyncRequest","AsyncResponse"],function(a,b,c,d){a.AsyncRequest=b('AsyncRequest');a.AsyncResponse=b('AsyncResponse');},3);
__e("legacy:data-store",["DataStore"],function(a,b,c,d){a.DataStore=a.DataStore||b('DataStore');},3);
function EmuController(a,b){this.impression=b;this.containerId=a;DataStore.set($(a),'emuController',this);return this;}copy_properties(EmuController,{fromContainer:function(a){var b=ge(a);if(!b)return null;return DataStore.get(b,'emuController');},getEventClass:function(a){return "emuEvent"+String(a).trim();}});copy_properties(EmuController.prototype,{EVENT_HANDLER_PATH:'ajax/emu/end.php',CLICK:1,FAN:"fad_fan",event:function(a,b,c,d){var e={eid:this.impression,f:0,ui:this.containerId,en:a,a:1};if(b)e.ed=JSON.stringify(b);if(!d)var d=bagofholding;var f=new AsyncRequest().setURI(this.EVENT_HANDLER_PATH).setData(e).setErrorHandler(d);if(c)f.setHandler(c);f.send();},redirect:function(){var a={eid:this.impression,f:0,ui:this.containerId,en:this.CLICK,a:0,sig:Math.floor(Math.random()*65535)+65536},b=new URI(this.EVENT_HANDLER_PATH);b.setQueryData(a);goURI(b);}});
var ShortClickHandlers={EVENT_NAME_CAME_BACK:'cameback',onclicked:function(a){if(this.onsite)return;if(a.button!==0||a.getModifiers().any)return;this.click_ts=(+new Date());if(this.listeners!==undefined)for(var b in this.listeners)this.listeners[b].remove();this.listeners={focus:Event.listen(window,'focus',ShortClickHandlers.oncameback.bind(this))};},oncameback:function(a){var b=(+new Date())-this.click_ts;this.listeners[a.type].remove();var c={click_ts:this.click_ts,length:b,trigger:a.type};this.sendData(ShortClickHandlers.EVENT_NAME_CAME_BACK,c);}};
function EmuTracker(a,b){this.base=EmuController.fromContainer(a);!this.base;this.onsite=b;var c=DOM.scry($(a),"a."+EmuController.getEventClass(EmuTracker.EVENT_CLICK));c.each(function(d){Event.listen(d,'click',ShortClickHandlers.onclicked.bind(this));}.bind(this));return this;}copy_properties(EmuTracker,{EVENT_CLICK:1});copy_properties(EmuTracker.prototype,{sendData:function(a,b){this.base.event(a,b);}});
__e("Keys",[],function(a,b,c,d,e,f){var g={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,COMMA:188};e.exports=g;});
__e("AjaxRequest",["array-extensions","json","ArrayUtils","ErrorUtils","Keys","URI","Util","ua"],function(a,b,c,d,e,f){b('array-extensions');b('json');var g=b('ArrayUtils'),h=b('ErrorUtils'),i=b('Keys'),j=b('URI'),k=b('Util'),l=b('ua');function m(p,q,r){if(window.XMLHttpRequest){this.xhr=new XMLHttpRequest();}else if(window.ActiveXObject)this.xhr=new ActiveXObject('MSXML2.XMLHTTP.3.0');if(!(q instanceof j))q=new j(q);if(r&&p=='GET'){q.setQueryData(r);}else this._params=r;this.method=p;this.uri=q;this.xhr.open(p,q);}m.corsEnabled=window.XMLHttpRequest&&('withCredentials' in new XMLHttpRequest());m.ERROR='ar:error';m.TIMEOUT='ar:timeout';m.PROXY_ERROR='ar:proxy error';m.TRANSPORT_ERROR='ar:transport error';m.SERVER_ERROR='ar:http error';m.PARSE_ERROR='ar:parse error';m._inflight=[];function n(){var p=m._inflight;m._inflight=[];p.each(function(q){q.abort();});}function o(p){p.onJSON=p.onError=p.onSuccess=null;clearTimeout(p._timer);if(p.xhr&&p.xhr.readyState<4){p.xhr.abort();p.xhr=null;}m._inflight=m._inflight.filter(function(q){return q&&q!=p&&q.xhr&&q.xhr.readyState<4;});}m.prototype={timeout:60000,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(p){if(this[p])this[p](this);},_parseStatus:function(){var p;try{this.status=this.xhr.status;p=this.xhr.statusText;}catch(q){if(this.xhr.readyState>=4){this.errorType=m.TRANSPORT_ERROR;this.errorText=q+'';}return;}if(this.status===0&&!(/^(file|ftp)/.test(this.uri))){this.errorType=m.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=m.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=m.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=m.SERVER_ERROR;}else if(this.status>=500&&this.status<600){this.errorType=m.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=m.TRANSPORT_ERROR;}else{p='unrecognized status code: '+this.status;this.errorType=m.ERROR;}if(!this.errorText)this.errorText=p;},_parseResponse:function(){var p,q=this.xhr.readyState;try{p=this.xhr.responseText||'';}catch(r){if(q>=4){this.errorType=m.ERROR;this.errorText='responseText not available - '+r.message;}return;}while(this.xhr){var s=p.indexOf('\n',this._eol+1);if(s<0&&q==4)s=p.length;if(s<=this._eol)break;var t=p.substr(this._eol+1,s-this._eol+1);this._eol=s;t=t.replace(/^\s*|\s*$/g,'');if(this.prelude)if(this.prelude&&this.prelude.test(t)){this._hasPrelude=true;t=t.replace(this.prelude,'');}if(t){var u=this;h.applyWithGuard(function(){u.json=JSON.parse(t);u._call('onJSON');});}}},_onReadyState:function(){var p=this.xhr&&this.xhr.readyState||0;if(this.status==null&&p>=2)this._parseStatus();if(this.status==null)return;if(p==3){this._parseResponse();}else if(p==4){this._parseResponse();this._call(!this.errorType?'onSuccess':'onError');o(this);}},send:function(p){this.xhr.onreadystatechange=function(){h.applyWithGuard(this._onReadyState,this,arguments);}.bind(this);var q=this.timeout;if(q)this._timer=setTimeout((function(){this.errorType=m.TIMEOUT;this.errorText='timeout after '+q+' ms';this._call('onError');o(this);}).bind(this),q,false);m._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.xhr.send(p?j.implodeQuery(p):'');},abort:function(){o(this);},toString:function(){var p='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)p+=' errorType='+this.errorType+' ('+this.errorText+')';return p+']';},toJSON:function(){var p={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText};for(var q in p)if(p[q]==null)delete p[q];return p;}};if(window.addEventListener&&l.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',n);e.exports=m;});
__e("SystemEvents",["Arbiter","Env","ErrorUtils","ua","Util","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('ua'),k=b('Util'),l=b('copyProperties'),m=new g(),n=[],o=1000;setInterval(function(){for(var x=0;x<n.length;x++)n[x]();},o,false);function p(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var q=h.user,r=navigator.onLine;function s(){if(!r){r=true;m.inform(m.ONLINE,r);}}function t(){if(r){r=false;m.inform(m.ONLINE,r);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=s;document.body.onoffline=t;});}else n.push(function(){(navigator.onLine?s:t)();});}else if(window.addEventListener){window.addEventListener('online',s,false);window.addEventListener('offline',t,false);}var u=q;n.push(function(){var x=p();if(u!=x){m.inform(m.USER,x);u=x;}});var v=Date.now();function w(){var x=Date.now(),y=x-v,z=y<0||y>10000;v=x;if(z)m.inform(m.TIME_TRAVEL,y);return z;}n.push(w);n.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});a.SystemEvents=e.exports=l(m,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(x){return (x||p())==q;},isOnline:function(){return r;},checkTimeTravel:w});},3);
__e("ChannelConstants",[],function(a,b,c,d,e,f){var g='presence/',h={ON_SHUTDOWN:g+'shutdown',ON_INVALID_HISTORY:g+'invalid_history',ON_CONFIG:g+'config',ON_ENTER_STATE:g+'enter_state',ON_EXIT_STATE:g+'exit_state',OK:'ok',ERROR:'error',ERROR_MAX:'error_max',ERROR_MISSING:'error_missing',ERROR_MSG_TYPE:'error_msg_type',ERROR_SHUTDOWN:'error_shutdown',HINT_AUTH:'shutdown auth',HINT_CONN:'shutdown conn',HINT_DISABLED:'shutdown disabled',HINT_INVALID_STATE:'shutdown invalid state',HINT_MAINT:'shutdown maint',HINT_UNSUPPORTED:'shutdown unsupported',reason_Unknown:0,reason_AsyncError:1,reason_TooLong:2,reason_Refresh:3,reason_RefreshDelay:4,reason_UIRestart:5,reason_NeedSeq:6,reason_PrevFailed:7,reason_IFrameLoadGiveUp:8,reason_IFrameLoadRetry:9,reason_IFrameLoadRetryWorked:10,reason_PageTransitionRetry:11,reason_IFrameLoadMaxSubdomain:12,reason_NoChannelInfo:13,reason_NoChannelHost:14,getArbiterType:function(i){return g+'message:'+i;}};e.exports=h;});
__e("DocRPC",["array-extensions","json"],function(a,b,c,d,e,f){b('array-extensions');b('json');var g={_apis:{},origin:location.origin||(location+'').replace(/([^:\/])\/.*/,'$1'),originFilter:/\.facebook\.com(:\d+)?$/,_init:function(){var h=function(event){event=event||window.event;var i=event.domain||event.origin;if(g.originFilter.test(i))g._dispatch(event.data);};if(window.postMessage)if(window.addEventListener){window.addEventListener('message',h,false);}else window.onmessage=h;this._init=function(){};},_dispatch:function(h){h=JSON.parse(h);var i=JSON.stringify(h.params);if(g._apis.hasOwnProperty(h.api)){var j=g._apis[h.api];if(j[h.method])j[h.method].apply(j,h.params);}},publish:function(h,i){g._init();g._apis[i]=h;},proxy:function(h,i,j,k){g._init();var l={_proxyId:Math.random().toString(36),_seq:0};function m(o){l[o]=function(){var p={api:i,method:o,params:Array.prototype.slice.call(arguments)},q=JSON.stringify(p.params);p=JSON.stringify(p);if(h.postMessage){h.postMessage(p,k);}else if(h.DocRPC)h.DocRPC._dispatch(p);};}for(var n=0;n<j.length;n++)m(j[n]);return l;}};e.exports=a.DocRPC=g;},3);
__e("ChannelTransport",["copyProperties","bind","Util","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('Util'),j=b('AjaxRequest'),k=b('URI'),l=b('JSLogger'),m=b('DocRPC'),n=b('ChannelConstants'),o=l.create('channel');function p(){return (1048576*Math.random()|0).toString(36);}function q(x,y){var z=x.subdomain;z=z===null?'':(z+'-');var aa=new k(y).setDomain(z+x.host+'.facebook.com').setPort(x.port).setSecure(k().isSecure());return aa;}function r(x,y,z){var aa=new Image(),ba=function(ea){aa.abort();return ea?y():z();};aa.onload=ba.bind(null,true);aa.onerror=ba.bind(null,false);var ca=setTimeout(aa.onerror,10000,false);aa.abort=function(){if(ca){clearTimeout(ca);ca=null;}aa.onload=aa.onerror=null;};var da={cb:p()};aa.src=q(x,'ping').setQueryData(da);return aa;}function s(x,y,z,aa){var ba=(new Date()-x.userActive)/1000|0,ca={channel:x.user_channel,seq:x.seq,clientid:x.sessionID,cb:p(),idle:ba};if(ba<60)ca.state='active';var da=q(x,'pull').setQueryData(ca),ea=new j('GET',da);if(j.corsEnabled)ea.xhr.withCredentials=true;ea.onJSON=y;ea.onSuccess=z;ea.onError=aa;ea.send();return ea;}function t(x){this.manager=x;(this.init&&this.init());}function u(x){t.apply(this,arguments);}u.prototype={logName:'CORS',enterState:function(x,y){if(this._request){this._request.abort();this._request=null;}if(x=='init')setTimeout(h(this.manager,'exitState',{status:n.OK,stateId:y.stateId}),3000,false);if(!/pull|ping/.test(x))return;var z=this.manager;if(x=='ping'){this._request=r(y,h(z,'exitState',{status:n.OK,stateId:y.stateId}),h(z,'exitState',{status:n.ERROR,stateId:y.stateId}));}else if(x=='pull')this._request=s(y,h(z,'_processTransportData',y.stateId),h(z,'exitState',{status:n.OK,stateId:y.stateId}),h(z,'exitState',{status:n.ERROR,stateId:y.stateId}));}};function v(x){o.log('iframe_init_constructor');t.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);m.publish(this,'outerTransport');}v.prototype={logName:'iframe',_initIframe:function(x){o.log('iframe_init_start',x);window.onchanneliframeready=function(){o.log('iframe_resources');return x.resources;};window.onchanneliframeloaded=function(){o.log('iframe_loaded');};if(x){this._iframeURI=q(x,x.path);if(x.bustIframe)this._iframeURI.setQueryData({cb:p()});}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);o.log('iframe_uri_set');}catch(y){o.error('iframe_uri_set_error',y);this.exitState({status:n.ERROR,stateId:x.stateId},y+'');}},enterState:function(x,y){if(x=='init'){this._initIframe(y);}else if(/idle|ping|pull/.test(x)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(x!='idle')this.exitState({status:n.ERROR,stateId:y.stateId},'iframe not yet loaded');}else if(x=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(x){if(this.manager.state=='init'&&x.status==n.OK)this._iframeProxy=m.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}};function w(){this.init=this.init.bind(this);t.apply(this,arguments);}w.prototype={logName:'iframe(inner)',init:function(){m.publish(this,'innerTransport');try{var y=m.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,y);this.exitState({status:n.OK,stateId:1e+06});}catch(x){o.error('iframe_inner_init_error',x);}},enterState:function(x,y){if(this._request){this._request.abort();this._request=null;}if(x=='ping'){this._request=r(y,h(this,'exitState',{status:n.OK,stateId:y.stateId}),h(this,'exitState',{status:n.ERROR,stateId:y.stateId}));}else if(x=='pull')this._request=s(y,h(this,'_processTransportData',y.stateId),h(this,'exitState',{status:n.OK,stateId:y.stateId}),h(this,'exitState',{status:n.ERROR,stateId:y.stateId}));}};if(window!==window.parent&&/iframe/.test(window.location))a.transport=new w();e.exports={getURI:q,Transport:t,CORSTransport:u,IframeTransport:v,IframeInnerTransport:w};});
__e("FBAjaxRequest",["dom-core","Env","AjaxRequest"],function(a,b,c,d,e,f){var g=b('dom-core').$,h=b('Env'),i=b('AjaxRequest');function j(k,l,m){m=m||{};m.__a=1;m.__user=h.user;m.post_form_id=g('post_form_id').value;var n=new i(k,l,m),o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=i.SERVER_ERROR;this.errorText='AsyncResponse error: '+o.error;}this.json=this.json.payload;}o.apply(this,arguments);};return n;}e.exports=j;});
__e("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__e("math-extensions",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=e.exports={rand32:function(){return Math.floor(Math.random()*4294967295);},verifyNumber:function(i){if(typeof i=='undefined'||isNaN(i)||i==Number.POSITIVE_INFINITY||i==Number.NEGATIVE_INFINITY)i=0;return i;},mod:function(i,j){var k=i%j;if(k*j<0)k+=j;return k;},clip:function(i,j,k){return Math.max(j,Math.min(i,k));}};g(a,h);},3);
__e("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__e("UserActivity",["event-extensions","Arbiter","FunctionUtils"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("FunctionUtils"),i=Date.now(),j={DEFAULT_IDLE_MS:5000,EVENT_INTERVAL_MS:500,subscribeOnce:function(l){var m=j.subscribe(function(){j.unsubscribe(m);l();});},subscribe:function(l){return g.subscribe('useractivity/activity',l);},unsubscribe:function(l){g.unsubscribe(l);},isActive:function(l){return (new Date()-i<(l||j.DEFAULT_IDLE_MS));}},k=h.throttle(function(event){var l=Date.now(),m=l-i;i=l;g.inform('useractivity/activity',{event:event,idleness:m});},j.EVENT_INTERVAL_MS,false);Event.listen(document.documentElement,{mouseover:k,keydown:k,click:k});e.exports=j;});
__e("ChannelManager",["array-extensions","function-extensions","json","onload","AjaxRequest","Arbiter","ArrayUtils","AsyncRequest","ChannelConstants","ChannelTransport","Env","FBAjaxRequest","FunctionUtils","JSLogger","MovingStat","PresenceState","PresenceUtil","SystemEvents","URI","UserActivity","copyProperties","presence-cookie-manager","ChannelInitialData"],function(a,b,c,d,e,f){b('array-extensions');b('function-extensions');b('json');b('onload');var g=b('AjaxRequest'),h=b('Arbiter'),i=b('ArrayUtils'),j=b('AsyncRequest'),k=b('ChannelConstants'),l=b('ChannelTransport'),m=b('Env'),n=b('FBAjaxRequest'),o=b('FunctionUtils'),p=b('JSLogger'),q=b('MovingStat'),r=b('onload'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('SystemEvents'),v=b('URI'),w=b('UserActivity'),x=b('copyProperties'),y=b('presence-cookie-manager'),z=c('ChannelInitialData'),aa,ba=p.create('channel'),ca={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'pull',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping'},reconnect:{ok:'init!',error:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!'}},da=6,ea={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16)},fa=1,ga={},ha=0;function ia(ua){return ua.toLowerCase().replace(/[^0-9a-z]+/g,'_');}function ja(ua){ba.log(ia('arbiter_'+ua));h.inform.apply(h,arguments);}function ka(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}var la=false;function ma(){if(ea.subdomain==null){var ua=0,va=y.getSubCookie('ch');if(va&&va.sub){for(var wa=0;wa<va.sub.length;wa++)if(!va.sub[wa]){ua=wa;break;}if(wa==va.sub.length)if(wa==da&&v().isSecure()){ua=null;p.create('channel_cookie').error('iframe_max_subdomains_reached');}else ua=va.sub.length;}ea.subdomain=ua;}}function na(){var ua={};if(aa.getConfig('host')){if(ea._subdomain!=null){var va=y.getSubCookie('ch'),wa=(va&&va.sub)?va.sub:[],xa=wa.length;wa[ea._subdomain]=la?0:1;ua.sub=wa.map(function(ya){return ya?1:0;});}ua[aa.getConfig('user_channel')]=aa.getConfig('seq',0);}return ua;}function oa(){var ua=Date.now(),va=Date.now(),wa={total:0},xa='idle',ya=null,za=false;u.subscribe([u.USER,u.ONLINE,u.TIME_TRAVEL],function(){va=null;ya=Date.now();aa.enterState(aa.shouldIdle()?'idle!':'ping!');});var ab=function(cb,db){var eb=Date.now(),fb;if(db){ua=eb;fb=db.nextState||db.state;}else fb=xa;u.checkTimeTravel();if(va){var gb=Math.round((eb-va)/1000);if(gb>0){wa[xa]=(wa[xa]||0)+gb;wa.total+=gb;}}xa=fb;va=eb;if(!cb){wa.lastSuccessTime=ka();wa.online=u.isOnline();ba.log('rollup',wa);}};h.subscribe(k.ON_ENTER_STATE,ab);setInterval(ab,60000,false);h.subscribe(k.ON_EXIT_STATE,function(cb,db){if(db.state=='pull'&&db.status==k.OK)ya=Date.now();});h.subscribe(p.DUMP_EVENT,function(cb,db){db.channelRollup=wa;});var bb=function(){if(aa.isShutdown()||aa.shouldIdle())return;u.checkTimeTravel();var cb=Date.now()-(ya||m.start);if(!za&&cb>120000){var db=ka();ba.error('stall',{lastSuccessTime:db,rollupState:xa});za=true;}var eb=Date.now()-ua;if(aa.state=='pull'&&eb>90000){ua=null;ba.warn('jumpstart',{state:aa.state,dormant:eb});aa.enterState('init');}};setInterval(bb,10000,false);}function pa(){var ua=new Date(),va=1;function wa(){setTimeout(wa,va*1000,false);var bb=aa.state;if(bb=='idle'&&aa.shouldIdle())return;ba.bump('conn_t',va);if(bb=='pull')ba.bump('conn_t_pull',va);}wa();var xa=[15,30,60,120,240],ya=false,za=false;function ab(bb){setTimeout(function(){ba.rate('pullenter_'+bb,ya);ba.rate('pullexit_'+bb,za);},bb*1000,false);}while(xa.length)ab(xa.shift());h.subscribe(k.ON_ENTER_STATE,function(bb,cb){if(cb.state=='pull')ya=true;ua=new Date();});h.subscribe(k.ON_EXIT_STATE,function(bb,cb){if(cb.state!='pull'||!ua)return;var db=cb.status==k.OK?k.OK:(cb&&cb.errorType);switch(db){case k.OK:za=true;db='ok';break;case g.ERROR:db='error';break;case g.TIMEOUT:db='timeout';break;case g.PROXY_ERROR:db='proxy';break;case g.TRANSPORT_ERROR:db='transport';break;case g.SERVER_ERROR:db='http';break;case g.PARSE_ERROR:db='parse';break;default:db='other';break;}var eb=(new Date()-ua)/1000;if(eb<0){return;}else if(eb>3600)eb=3600;ba.bump('conn_num');ba.bump('conn_exit',eb);ba.bump('conn_num_'+db);ba.bump('conn_exit_'+db,eb);});}function qa(ua){if(ua){ha=0;ga={};}else ha++;}aa={state:'idle',nextState:null,init:function(ua){this.init=function(){};if(typeof(w)!='undefined')w.subscribe(function(){ea.userActive=Date.now();}.bind(this));y.register('ch',na);var va=function(){la=true;s.doSync(true);};if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',va);}else r.runOnload(va);this._transportRate=new q(30000);var wa=(g.corsEnabled&&!ea.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new l[wa](this);if(ua)this.enterState.apply(this,arguments);s.doSync();h.subscribe(p.DUMP_EVENT,function(event,xa){xa.transportRate=this._transportRate.tally();xa.transportType=wa;xa.transportVersion=2;}.bind(this));oa();pa();},configure:function(){i.createFrom(arguments).each(x.bind(null,ea));h.inform(k.ON_CONFIG,this);},getConfig:function(ua,va){return ua in ea?ea[ua]:va;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !u.isPageOwner()||!u.isOnline();},_sendIframeError:function(ua){var va=new j().setURI('ajax/presence/reconnect.php').setData({reason:ua,iframe_loaded:this.iframeEverLoaded}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);va.specifiesWriteRequiredParams()&&va.send();},_getDelay:function(){var ua=aa.getConfig('MIN_RETRY_INTERVAL',10000),va=aa.getConfig('MAX_RETRY_INTERVAL',60000),wa=Math.min(ua*Math.pow(2,Math.max(0,ha-1)),va);return wa*(.75+Math.random()/2)|0;},enterState:function(){this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ua){this._inEnterState=false;throw ua;}},_enterState:function(ua){var va=0,wa=null,xa=i.createFrom(arguments);if(this.isShutdown())return;if(ua!='idle!'&&this.shouldIdle())return;fa++;ea.stateId=fa;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ua)){var ya=this._transportRate.tally().timeAverage,za=aa.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ya>=za)va=1000/za;}else if(!(/#$/.test(ua)))va=this._getDelay();ua=ua.replace(/\W*$/,'');if(!ca[ua])throw new Error('invalid state:'+ua);var ab;if(va<=0){ab={state:ua};this._transportRate.add(1);this.state=ua;var bb=this['_enter_'+this.state];if(bb){xa.shift();bb.apply(this,xa);}if(/init|idle|pull|ping/.test(this.state)){ma();this.transport.enterState(this.state,ea);}}else{this.state='idle';this.nextState=ua;ab={state:this.state,delay:va,nextState:ua};xa[0]=ua+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,xa);}).bind(this).defer(va,false);}ba.log('enter_'+this.state,ab);h.inform(k.ON_ENTER_STATE,ab);},exitState:function(ua,va){var wa=ua.stateId,xa=ua.status;if(this.isShutdown()||wa<fa)return;var ya=i.createFrom(arguments),za=this.state;ya[0]=ua.status;var ab={state:za,status:xa};if(va&&va.errorType){ab.errorType=va.errorType;ab.errorText=va.errorText;}if(va&&va.json){if(va.json.t)ab.t=va.json.t;if(va.json.reason)ab.reason=va.json.reason;if(va.json.seq)ab.seq=va.json.seq;}ba.log('exit_'+za,ab);h.inform(k.ON_EXIT_STATE,ab);var bb=this['_exit_'+za];if(bb)xa=bb.apply(this,ya)||xa;if(xa!=k.OK){qa();ga[za]=(ga[za]||0)+1;}var cb=ca[za][xa]||ca._all[xa],db=cb&&cb.replace(/!*$/,'');if(!db){ba.error('terminal_transition',ab);this._shutdownHint=k.HINT_INVALID_STATE;cb='shutdown!';}this._lastState=za;this._lastStatus=xa;this.enterState(cb);},_processTransportData:function(ua,va){var wa=va.json,xa=wa.t;if('s' in wa){wa.seq=wa.s;delete wa.s;}var ya=ea.seq;if('seq' in wa){ea.seq=wa.seq;s.doSync();}switch(xa){case 'continue':qa(true);this.exitState({status:k.OK,stateId:ua});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(wa.reason||0),stateId:ua},va);break;case 'fullReload':y.clear();ba.log(ia('arbiter_'+k.ON_INVALID_HISTORY));ja(k.ON_INVALID_HISTORY);this.exitState({status:k.ERROR_MISSING,stateId:ua},va);break;case 'msg':var za,ab,bb,cb;qa(true);if(wa.msgs){ab=wa.msgs;var db=0;for(za=0;za<ab.length;za++)if(ab[za].seq!==-1)db++;bb=ea.seq-db;for(za=0;za<ab.length;za++){if(bb>=ya){cb=ab[za].msg;if(cb.type)ja(k.getArbiterType(cb.type),{obj:cb});}else ba.warn('seq_regression',{seq:bb,last_seq:ya,non_transient:db,messages:ab.length});if(ab[za].seq!==-1)bb++;}}else{ab=wa.ms;bb=ea.seq-ab.length;for(za=0;za<ab.length;za++,bb++)if(bb>=ya){cb=ab[za];if(cb.type)ja(k.getArbiterType(cb.type),{obj:cb});}else ba.warn('seq_regression',{seq:bb,last_seq:ya,messages:ab.length});}break;default:ba.error('unknown_msg_type',{type:xa});break;}},_enter_init:function(){if(ga.init>=2)return this.exitState.bind(this,{status:k.ERROR_MAX,stateId:fa}).defer();this._initTimer=this.exitState.bind(this,{status:k.ERROR,stateId:fa},'timeout').defer(aa.getConfig('IFRAME_LOAD_TIMEOUT',30000),false);},_enter_reconnect:function(ua){var va=fa;if(!t.hasUserCookie()){ba.warn('no_user_cookie');(function(){aa._shutdownHint=k.HINT_AUTH;aa.exitState({status:k.ERROR_SHUTDOWN,stateId:va});}).defer();return;}var wa=new n('GET','/ajax/presence/reconnect.php',{reason:ua,iframe_loaded:this.iframeEverLoaded});wa.onSuccess=(function(){aa.configure(null,wa.json);y.store();this.exitState({status:k.OK,stateId:va});}).bind(this);wa.onError=(function(){var xa=wa.json&&wa.json.error;if(wa.errorType==g.TRANSPORT_ERROR||wa.errorType==g.PROXY_ERROR)this._shutdownHint=k.HINT_CONN;if(xa&&xa==1356007){this._shutdownHint=k.HINT_MAINT;}else if(xa==1357001||xa==1357004||xa==1348009){this._shutdownHint=k.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?k.ERROR_SHUTDOWN:k.ERROR,stateId:va},wa);}).bind(this);wa.send();},_enter_shutdown:function(){ja(k.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(ua){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ua==k.OK){this.iframeEverLoaded=true;}else if(ua==k.ERROR_MAX)this._sendIframeError(k.reason_IFrameLoadGiveUp);}};e.exports=aa;if(z.serverInitialized==null){aa.configure(z.channelConfig);if(/shutdown/.test(z.state)){aa._shutdownHint=k[z.reason];}else z.reconnectReason;aa.init(z.state,z.reason);}if(aa.getConfig('streamProbe')){var ra=[],sa=new v('/probe').setDomain(ea.host+'.facebook.com').setPort(ea.port).setSecure(v().isSecure()),ta=new g('GET',sa);ta.onJSON=function(ua,va){ra.push(Date.now());};ta.onSuccess=function(ua){if(ra.length==2){var va=ra[1]-ra[0];ba.log('probe_ok',{time:va});}else ba.error('probe_error',{error:'beats.length = '+ra.length});};ta.onError=function(ua){ba.error('probe_error',ua);};ba.log('probe_request');ta.send();}});
__e("ChannelConnection",["Arbiter","copyProperties","ChatConfig","SystemEvents","onload","ChannelConstants","ChannelManager","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('SystemEvents'),k=b('onload'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=n.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ba){v();q=w.defer(ba,false);o.log('mute_warning',{time:ba});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ba,ca){y();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var da=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){r=(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);o.log('reconnecting',{delay:ea});if(u.disconnected())o.log('reconnecting_ui',{delay:ea});s=u.RECONNECTING;(ca.state==='idle')&&t++;if(t>1){u.inform(u.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')z(ba,ca);}).defer(500,false);}else if(ba===l.ON_SHUTDOWN){o.log('shutdown',{reason:ca.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,ca.reason);}}function aa(ba){if(m.state==='ping'||m.isShutdown())return;o.log('reconnect',{now:ba});u.inform(u.RECONNECTING,0);if(!!ba){if(p!==null){clearTimeout(p);p=null;}m.enterState('ping!');}else if(!p)p=setTimeout(function(){m.enterState('ping!');p=null;},i.get('channel_manual_reconnect_defer_msec'),false);}if(m.isShutdown()){z(l.ON_SHUTDOWN,m._shutdownHint);}else z(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],z);j.subscribe(j.TIME_TRAVEL,function(){aa();x(i.get('mute_warning_time_msec'));});k.runBeforeUnload(y,false);h(u,{disconnected:function(){return s===u.SHUTDOWN||(s===u.RECONNECTING&&!q&&t>1);},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:aa,unmuteWarning:w});e.exports=u;});
__e("Button",["event-extensions","css","DataStore","dom","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('css'),h=b('DataStore'),i=b('dom'),j=b('Parent'),k=(function(){var l='uiButtonDisabled',m='uiButtonDepressed',n='button:blocker',o='href';function p(s,t){var u=h.get(s,n);if(t){if(u){u.remove();h.remove(s,n);}}else if(!u)h.set(s,n,Event.listen(s,'click',bagof(false),Event.Priority.URGENT));}function q(s){var t=j.byClass(s,'uiButton');if(!t)throw new Error('invalid use case');return t;}function r(s){return i.isNodeOfType(s,'a');}return {getInputElement:function(s){s=q(s);if(r(s))throw new Error('invalid use case');return i.find(s,'input');},isEnabled:function(s){return !g.hasClass(q(s),l);},setEnabled:function(s,t){s=q(s);g.conditionClass(s,l,!t);if(r(s)){var u=s.href,v=h.get(s,o,'#');if(t){if(!u)s.href=v;}else{if(u&&u!==v)h.set(s,o,u);s.removeAttribute('href');}p(s,t);}else{var w=k.getInputElement(s);w.disabled=!t;p(w,t);}},setDepressed:function(s,t){g.conditionClass(q(s),m,t);},isDepressed:function(s){return g.hasClass(q(s),m);},setLabel:function(s,t){s=q(s);if(r(s)){var u=i.find(s,'span.uiButtonText');i.setContent(u,t);}else k.getInputElement(s).value=t;g.conditionClass(s,'uiButtonNoText',!t);},setIcon:function(s,t){if(!i.isNode(t))return;g.addClass(t,'customimg');s=q(s);var u=i.scry(s,'.img')[0];if(u!=t)if(u){i.replace(u,t);}else i.prependContent(s,t);}};})();a.Button=e.exports=k;},3);
__e("DOMControl",["DataStore","dom-core"],function(a,b,c,d,e,f){var g=b("DataStore"),h=b("dom-core").$;function i(j){this.root=h(j);this.updating=false;g.set(j,'DOMControl',this);}i.prototype={getRoot:function(){return this.root;},beginUpdate:function(){if(this.updating)return false;this.updating=true;return true;},endUpdate:function(){this.updating=false;},update:function(j){if(!this.beginUpdate())return this;this.onupdate(j);this.endUpdate();},onupdate:function(j){}};i.getInstance=function(j){return g.get(j,'DOMControl');};e.exports=i;});
__e("InputSelection",["dom","Input"],function(a,b,c,d,e,f){var g=b("dom"),h=b("Input"),i={get:function(j){if(!document.selection)return {start:j.selectionStart,end:j.selectionEnd};var k=document.selection.createRange();if(k.parentElement()!==j)return {start:0,end:0};var l=j.value.length;if(g.isNodeOfType(j,'input')){return {start:-k.moveStart('character',-l),end:-k.moveEnd('character',-l)};}else{var m=k.duplicate();m.moveToElementText(j);m.setEndPoint('StartToEnd',k);var n=l-m.text.length;m.setEndPoint('StartToStart',k);return {start:l-m.text.length,end:n};}},set:function(j,k,l){if(typeof l=='undefined')l=k;if(document.selection){if(j.tagName=='TEXTAREA'){var m=(j.value.slice(0,k).match(/\r/g)||[]).length,n=(j.value.slice(k,l).match(/\r/g)||[]).length;k-=m;l-=m+n;}var o=j.createTextRange();o.collapse(true);o.moveStart('character',k);o.moveEnd('character',l-k);o.select();}else{j.selectionStart=k;j.selectionEnd=Math.min(l,j.value.length);h.focus(j);}}};e.exports=i;});
__e("enforceMaxLength",["event-extensions","function-extensions","dom","Input","InputSelection"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("dom"),h=b("Input"),i=b("InputSelection"),j=function(l,m){var n=h.getValue(l),o=n.length,p=o-m;if(p>0){var q,r;try{q=i.get(l);r=q.end;}catch(s){q=null;r=0;}if(r>=p)o=r;var t=o-p;if(t&&(n.charCodeAt(t-1)&64512)===55296)t--;r=Math.min(r,t);h.setValue(l,n.slice(0,t)+n.slice(o));if(q)i.set(l,Math.min(q.start,r),r);}},k=function(event){var l=event.getTarget(),m=l.getAttribute&&parseInt(l.getAttribute('maxlength'),10);if(m>0&&g.isNodeOfType(l,['input','textarea']))j.bind(null,l,m).defer();};Event.listen(document.documentElement,{keydown:k,paste:k});e.exports=j;});
__e("Input",["bootloader","css-core","dom","DOMControl"],function(a,b,c,d,e,f){var g=b("bootloader"),h=b("css-core"),i=b("dom"),j=b("DOMControl"),k=function(m){var n=m.getAttribute('maxlength');if(n&&n>0)d(["enforceMaxLength"],function(o){o(m,n);});},l={focus:function(m){try{m.focus();}catch(n){}},isEmpty:function(m){return !(/\S/).test(m.value||'')||h.hasClass(m,'DOMControl_placeholder');},getValue:function(m){return l.isEmpty(m)?'':m.value;},setValue:function(m,n){h.removeClass(m,'DOMControl_placeholder');m.value=n||'';k(m);var o=j.getInstance(m);o&&o.resetHeight&&o.resetHeight();},setPlaceholder:function(m,n){m.setAttribute('title',n);m.setAttribute('placeholder',n);if(m==document.activeElement)return;if(l.isEmpty(m)){h.conditionClass(m,'DOMControl_placeholder',n);m.value=n||'';}},reset:function(m){var n=m!==document.activeElement?(m.getAttribute('placeholder')||''):'';m.value=n;h.conditionClass(m,'DOMControl_placeholder',n);m.style.height='';},setSubmitOnEnter:function(m,n){h.conditionClass(m,'enter_submit',n);},getSubmitOnEnter:function(m){return h.hasClass(m,'enter_submit');},setMaxLength:function(m,n){if(n>0){m.setAttribute('maxlength',n);k(m);}else m.removeAttribute('maxlength');}};e.exports=l;});
__e("Vector",["dom","ua","event-extensions","copyProperties"],function(a,b,c,d,e,f){var g=b("dom"),h=b("ua"),i=b("event-extensions").$E,j=b("copyProperties");function k(l,m,n){j(this,{x:parseFloat(l),y:parseFloat(m),domain:n||'pure'});}j(k.prototype,{toString:function(){return '('+this.x+', '+this.y+')';},add:function(l,m){if(arguments.length==1){if(l.domain!='pure')l=l.convertTo(this.domain);return this.add(l.x,l.y);}var n=parseFloat(l),o=parseFloat(m);return new k(this.x+n,this.y+o,this.domain);},mul:function(l,m){if(typeof m=="undefined")m=l;return new k(this.x*l,this.y*m,this.domain);},sub:function(l,m){if(arguments.length==1){return this.add(l.mul(-1));}else return this.add(-l,-m);},distanceTo:function(l){return this.sub(l).magnitude();},magnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y));},convertTo:function(l){if(l!='pure'&&l!='viewport'&&l!='document')return new k(0,0);if(l==this.domain)return new k(this.x,this.y,this.domain);if(l=='pure')return new k(this.x,this.y);if(this.domain=='pure')return new k(0,0);var m=k.getScrollPosition('document'),n=this.x,o=this.y;if(this.domain=='document'){n-=m.x;o-=m.y;}else{n+=m.x;o+=m.y;}return new k(n,o,l);},setElementPosition:function(l){var m=this.convertTo('document');l.style.left=parseInt(m.x)+'px';l.style.top=parseInt(m.y)+'px';return this;},setElementDimensions:function(l){return this.setElementWidth(l).setElementHeight(l);},setElementWidth:function(l){l.style.width=parseInt(this.x,10)+'px';return this;},setElementHeight:function(l){l.style.height=parseInt(this.y,10)+'px';return this;},scrollElementBy:function(l){if(l==document.body){window.scrollBy(this.x,this.y);}else{l.scrollLeft+=this.x;l.scrollTop+=this.y;}return this;}});j(k,{getEventPosition:function(l,m){m=m||'document';l=i(l);var n=g.getDocumentScrollElement(),o=l.pageX||(l.clientX+n.scrollLeft),p=l.pageY||(l.clientY+n.scrollTop),q=new k(o,p,'document');return q.convertTo(m);},getScrollPosition:function(l){l=l||'document';var m=g.getDocumentScrollElement(),n=m.scrollLeft,o=m.scrollTop;return new k(n,o,'document').convertTo(l);},getElementPosition:function(l,m){m=m||'document';if(!l)return;if(!('getBoundingClientRect' in l))return new k(0,0,'document');var n=l.getBoundingClientRect(),o=document.documentElement,p=Math.round(n.left)-o.clientLeft,q=Math.round(n.top)-o.clientTop;return new k(p,q,'viewport').convertTo(m);},getElementDimensions:function(l){return new k(l.offsetWidth||0,l.offsetHeight||0);},getViewportDimensions:function(){var l=(window&&window.innerWidth)||(document&&document.documentElement&&document.documentElement.clientWidth)||(document&&document.body&&document.body.clientWidth)||0,m=(window&&window.innerHeight)||(document&&document.documentElement&&document.documentElement.clientHeight)||(document&&document.body&&document.body.clientHeight)||0;return new k(l,m,'viewport');},getDocumentDimensions:function(l){l=l||document;var m=g.getDocumentScrollElement(l);if(m===l.body&&h.firefox())m=l.documentElement;var n=m.scrollWidth||0,o=m.scrollHeight||0;return new k(n,o,'document');},deserialize:function(l){var m=l.split(',');return new k(m[0],m[1]);}});e.exports=k;});
__e("Form",["event-extensions","ArrayUtils","AsyncRequest","AsyncResponse","DataStore","dom","Env","Input","Parent","URI","Vector","trackReferrer"],function(a,b,c,d,e,f){b("event-extensions");var g=b("ArrayUtils"),h=b("AsyncRequest"),i=b("AsyncResponse"),j=b("DataStore"),k=b("dom"),l=b("Env"),m=b("Input"),n=b("Parent"),o=b("URI"),p=b("Vector"),q=b("trackReferrer"),r={getInputs:function(s){s=s||document;return [].concat(g.createFrom(k.scry(s,'input')),g.createFrom(k.scry(s,'select')),g.createFrom(k.scry(s,'textarea')),g.createFrom(k.scry(s,'button')));},getSelectValue:function(s){return s.options[s.selectedIndex].value;},setSelectValue:function(s,t){for(var u=0;u<s.options.length;++u)if(s.options[u].value==t){s.selectedIndex=u;break;}},getRadioValue:function(s){for(var t=0;t<s.length;t++)if(s[t].checked)return s[t].value;return null;},getElements:function(s){return g.createFrom(s.tagName=='FORM'?s.elements:r.getInputs(s));},getAttribute:function(s,t){return (s.getAttributeNode(t)||{}).value||null;},setDisabled:function(s,t){r.getElements(s).forEach(function(u){if(u.disabled!=undefined){var v=j.get(u,'origDisabledState');if(t){if(v===undefined)j.set(u,'origDisabledState',u.disabled);u.disabled=t;}else{if(v!==true)u.disabled=false;j.remove(u,'origDisabledState');}}});},bootstrap:function(s,t){var u=(r.getAttribute(s,'method')||'GET').toUpperCase();t=n.byTag(t,'button')||t;var v=n.byClass(t,'stat_elem')||s;if(CSS.hasClass(v,'async_saving'))return;if(t&&(t.form!==s||(t.nodeName!='INPUT'&&t.nodeName!='BUTTON')||t.type!='submit')){var w=k.scry(s,'.enter_submit_target')[0],x=t;w&&(t=w);}var y=r.serialize(s,t);r.setDisabled(s,true);var z=r.getAttribute(s,'ajaxify')||r.getAttribute(s,'action');q(s,z);var aa=new h(z);aa.setData(y).setNectarModuleDataSafe(s).setReadOnly(u=='GET').setMethod(u).setRelativeTo(s).setStatusElement(v).setInitialHandler(r.setDisabled.curry(s,false)).setHandler(function(ba){Event.fire(s,'success',{response:ba});}).setErrorHandler(function(ba){if(Event.fire(s,'error',{response:ba})!==false)i.defaultErrorHandler(ba);}).setFinallyHandler(r.setDisabled.curry(s,false)).send();},serialize:function(s,t){var u={};r.getElements(s).forEach(function(v){if(v.name&&!v.disabled&&v.type!='submit')if(!v.type||((v.type=='radio'||v.type=='checkbox')&&v.checked)||v.type=='text'||v.type=='password'||v.type=='hidden'||v.tagName=='TEXTAREA'){var w;if(v.name=='post_form_id')w=l.post_form_id;r._serializeHelper(u,v.name,w||m.getValue(v));}else if(v.tagName=='SELECT')for(var x=0,y=v.options.length;x<y;++x){var z=v.options[x];if(z.selected)r._serializeHelper(u,v.name,z.value);}});if(t&&t.name&&'submit'==t.type&&k.contains(s,t)&&k.isNodeOfType(t,['input','button']))r._serializeHelper(u,t.name,t.value);return r._serializeFix(u);},_serializeHelper:function(s,t,u){var v=/([^\]]+)\[([^\]]*)\](.*)/.exec(t);if(v){s[v[1]]=s[v[1]]||{};if(v[2]==''){var w=0;while(s[v[1]][w]!=undefined)w++;}else w=v[2];if(v[3]==''){s[v[1]][w]=u;}else r._serializeHelper(s[v[1]],w.concat(v[3]),u);}else s[t]=u;},_serializeFix:function(s){var t=[];for(var u in s){if(s[u] instanceof Object)s[u]=r._serializeFix(s[u]);t.push(u);}if(t.length>0){var v=0,w=true;t.sort().each(function(y){if(y!=v++)w=false;});if(w){var x=[];t.each(function(y){x[y]=s[y];});return x;}}return s;},post:function(s,t,u){var v=document.createElement('form');v.action=s.toString();v.method='POST';v.style.display='none';if(u)v.target=u;if(ge('post_form_id'))t.post_form_id=$('post_form_id').value;t.fb_dtsg=l.fb_dtsg;t.post_form_id_source='dynamic_post';r.createHiddenInputs(t,v);k.getRootElement().appendChild(v);v.submit();return false;},createHiddenInputs:function(s,t,u,v){u=u||{};var w,x=o.implodeQuery(s,'',false),y=x.split('&');for(var z=0;z<y.length;z++)if(y[z]){var aa=y[z].split('='),ba=aa[0],ca=aa[1];if(ba===undefined||ca===undefined)continue;ca=o.decodeComponent(ca);if(u[ba]&&v){u[ba].value=ca;}else{w=$N('input',{type:'hidden',name:ba,value:ca});u[ba]=w;t.appendChild(w);}}return u;},getFirstElement:function(s,t){t=t||['input[type="text"]','textarea','input[type="password"]','input[type="button"]','input[type="submit"]'];var u=[];for(var v=0;v<t.length;v++){u=k.scry(s,t[v]);for(var w=0;w<u.length;w++){var x=u[w];try{var z=p.getElementPosition(x,'document');if(z.y>0&&z.x>0)return x;}catch(y){}}}return null;},focusFirst:function(s){var t=r.getFirstElement(s);if(t){t.focus();return true;}return false;}};e.exports=r;});
__e("legacy:dom-form",["Form"],function(a,b,c,d){a.Form=b('Form');},3);
__e("legacy:event-extensions",["event-extensions"],function(a,b,c,d){b('event-extensions');},3);
__e("legacy:input-methods",["Input","copyProperties"],function(a,b,c,d){var e=b('Input'),f=b('copyProperties');f(a.Input||(a.Input={}),e);},3);
__e("URLScraper",["event-extensions","Class"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class");function h(ba){this.input=ba;this.enable();}g.mixin(h,'Arbiter',{reset:function(){this.lastMatch=null;},enable:function(){if(this.events)return;var ba=function(ca){setTimeout(this.check.bind(this,ca),30);};this.events=Event.listen(this.input,{paste:ba.bind(this,false),keydown:ba.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(ba){var ca=this.input.value;if(ba&&h.trigger(ca))return;var da=h.match(ca);if(da&&da!=this.lastMatch){this.lastMatch=da;this.inform('match',{url:da});}}});var i='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',j='\u2000-\u206F\u00ab\u00bb',k='(?:(?:ht|f)tps?)://',l='(?:(?:\\d{1,3}[.]){3}\\d{1,3})',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+i+j+']',o='(?:(?:[.:\\-_%@]|'+n+')*'+n+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[\/?#])',s='(?:'+'(?:'+k+o+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[\/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>]+',w='[^\\s'+i+j+']',x='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+'(?:'+u+'|'+w+')'+')*'+')*',y=new RegExp('('+'(?:'+s+')'+'(?:'+x+')'+')','im'),z=new RegExp('('+'(?:'+k+o+q+')|'+'(?:'+m+o+p+q+')'+')'),aa=/[\s'";]/;h.match=function(ba){var ca=(y.exec(ba)||[])[1]||null;if(ca&&ca.indexOf('@')!=-1){return (z.exec(ca))?ca:null;}else return ca;};h.trigger=function(ba){return !aa.test(ba.charAt(ba.length-1));};e.exports=h;});
__e("legacy:url-scraper",["URLScraper"],function(a,b,c,d){a.URLScraper=b('URLScraper');},3);
(function(){var a=1,b=2,c={},d=function(){var g=DOM.scry(this.root,'span.linkAttachment')[0];if(!g&&this.isMetaComposer)g=DOM.scry(this.root,'span.attachmentAcceptsLink')[0];if(!g)return;var h=Parent.byTag(g,'form');this.scraper=new URLScraper(this.input);this.scraper.subscribe('match',function(i,j){if(this.isMetaComposer){var k=this.form.xhpc_targetid,l=new URI('ajax/metacomposer/attachment/link/scraper.php');l.addQueryData({scrape_url:encodeURIComponent(j.url),targetid:k.value});h.action=l.toString();}else{CSS.show(g);h.action='ajax/composer/attachment/link/scraper.php@scrape_url='+encodeURIComponent(j.url);}h.xhpc.value=g.id;h.xhpc.disabled=false;h.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();},e=function(){var g=this.form.xhpc_targetid,h=g.value,i=Arbiter.subscribe('ComposerAudienceSelector/group',function(k,l){g.value=l.group;}),j=Arbiter.subscribe('ComposerAudienceSelector/nongroup',function(){g.value=h;});onunloadRegister(Arbiter.unsubscribe.curry(i));onunloadRegister(Arbiter.unsubscribe.curry(j));},f=function(g){if(this.inform('submit')===false){g.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};window.Composer=function(g,h,i,j){c[g.id]=this;this.root=g;this.resetCfg=h;this.dataSource=j;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;Bootloader.loadComponents('dom',function(){this.focus=DOM.find(g,'div.focus_target');this.form=DOM.find(g,'form.attachmentForm');this.content=DOM.find(g,'div.attachmentContent');this.isMetaComposer=i;if(this.isMetaComposer){this.messageBox=DOM.find(g,'div.uiMetaComposerMessageBox');this.metaArea=DOM.find(g,'div.attachmentMetaArea');this.bottomArea=DOM.find(g,'div.attachmentBottomArea');this.barArea=DOM.find(g,'div.attachmentBarArea');this.blurb=DOM.find(g,'div.uiMetaComposerMessageBox div.textBlurb');this.input=DOM.find(g,'div.uiMetaComposerMessageBox textarea.input');this.button=DOM.find(g,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=DOM.find(g,'div.uiMetaComposerMessageBox li.privacyWidget');}else{this.blurb=DOM.find(g,'div.uiComposerMessageBox div.textBlurb');this.input=DOM.find(g,'div.uiComposerMessageBox textarea.input');this.button=DOM.find(g,'div.uiComposerMessageBox label.submitBtn');this.privacy=DOM.find(g,'div.uiComposerMessageBox li.privacyWidget');}Event.listen(this.form,'submit',f.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(Parent.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}Arbiter.inform('xhpc/construct/'+g.id,this,Arbiter.BEHAVIOR_STATE);}.bind(this));};Class.mixin(Composer,'Arbiter',{init:function(g){this.mentionsInput=g;if(this.mentionsInput){this.mentionsInput.subscribe('init',function(){var h=this.mentionsInput.getTypeahead().getView();h.subscribe(['reset','render'],function(i){CSS.conditionClass(this.root,'uiComposerMention',(i=='render'));}.bind(this));}.bind(this));this.mentionsInput.subscribe('update',function(h,i){Arbiter.inform('Composer/mentions',keys(i.mentioned));});}d.call(this);if(this.isMetaComposer)e.call(this);this.inform('init',null,Arbiter.BEHAVIOR_PERSISTENT);onbeforeunloadRegister(this._handleUnsavedChanges.bind(this));},setBlurb:function(g){DOM.setContent(this.blurb,g);},setEnabled:function(g){Button.setEnabled(this.button,g);},setLoading:function(g){CSS.conditionClass(this.root,'async_saving',!!g);},setContentVisible:function(g){CSS.conditionClass(this.root,'uiComposerHideContent',!g);},setMessageBoxVisible:function(g){CSS.conditionClass(this.root,'uiComposerHideMessageBox',!g);},setInputVisible:function(g){CSS.conditionClass(this.root,'uiComposerHideInput',!g);},setTopicTaggerVisible:function(g){CSS.conditionClass(this.root,'uiTagComposerHidden',!g);},mutate:function(g){var h=ge(g.xhpc);if(h){var i=DOM.scry(this.root,'.uiComposerAttachmentSelected')[0];if(g.confirmAugmentation&&i!==h)return;i&&CSS.removeClass(i,'uiComposerAttachmentSelected');CSS.addClass(h,'uiComposerAttachmentSelected');if(!g.disableCache)Event.listen(h,'click',function(k){$E(k).stop();g.disableCache=true;this.mutate(g);}.bind(this));}if(!g.keepContentAreas){this.setContentVisible(false);DOM.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);DOM.empty(this.metaArea);DOM.empty(this.bottomArea);DOM.empty(this.barArea);}}if(g.content){DOM.setContent(this.content,HTML(g.content));this.setContentVisible(true);}if(this.isMetaComposer){g.metaContent&&DOM.setContent(this.metaArea,HTML(g.metaContent));g.bottomContent&&DOM.setContent(this.bottomArea,HTML(g.bottomContent));g.barContent&&DOM.setContent(this.barArea,HTML(g.barContent));}this.setMessageBoxVisible(!g.messageBoxHidden);CSS.conditionClass(this.root,'uiComposerWhiteMessageBox',!g.messageBoxHidden&&!g.inputHidden&&!g.content);this.setInputVisible(!g.inputHidden);CSS.conditionShow(this.privacy,!g.privacyWidgetHidden);Input.setPlaceholder(this.input,g.placeholder);Button.setLabel(this.button,g.buttonLabel);this.setBlurb(HTML(g.blurb));if(g.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!g.disabled);this.setTopicTaggerVisible(!g.hideTopicTagger);this.form.setAttribute('action',g.endpoint);if(g.formType==a){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');if(g.formType==b){this.form.target=g.iframeName;this.form.enctype=this.form.encoding='multipart/form-data';}else{this.form.removeAttribute('target');this.form.removeAttribute('enctype');this.form.removeAttribute('encoding');}this.submitHandler=g.submitHandler;this.lazyEndpoint=g.lazyEndpoint;g.attachmentJS&&(new Function(g.attachmentJS)).apply(this);CSS.addClass(this.root,'uiComposerInteracted');CSS.addClass(this.root,'uiComposerOpen');if(g.messageBoxFocused){var j=document.activeElement;if(j===document.body||Parent.byClass(j,'attachmentLink'))this.focusInput.bind(this).defer();}Arbiter.inform('composer/mutate',this);},subscribeToMutate:function(g){return Arbiter.subscribe('composer/mutate',function(h,i){if(i===this)g();}.bind(this));},reset:function(g,h){if(!g){Input.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();}if(this.isMetaComposer){DOM.empty(this.metaArea);DOM.empty(this.bottomArea);DOM.empty(this.barArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var i=DOM.scry(this.root,'.uiComposerAttachmentSelected')[0];if(i)CSS.removeClass(i,'uiComposerAttachmentSelected');}CSS.removeClass(this.root,'uiComposerInteracted');CSS.setClass(this.focus,'focus_target');this.setLoading(false);if(h){var j=DOM.scry(this.root,'.widget')[0];j&&DOM.replace(j,h);}Arbiter.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var g=DOM.find(this.root,'form.attachmentSelectForm'),h=new URI(this.lazyEndpoint);h.setQueryData({isAugmentation:true});g.action=h.toString();var i=DOM.scry(this.root,'.uiComposerAttachmentSelected')[0];g.xhpc.value=i&&i.id;g.xhpc.click();CSS.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){Input.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(g){if(this.dataSource)this.dataSource.updateToken(g);},_handleUnsavedChanges:function(){var g=PageTransitions.getNextURI();if(g.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!Input.isEmpty(this.input)&&!(window.Dialog&&Dialog.getCurrent()))return "\u4f60\u8fd8\u6ca1\u6709\u5b8c\u6210\u4f60\u8981\u53d1\u5e03\u7684\u5e16\u5b50\u3002\u8fd8\u6ca1\u5b8c\u6210\u4f60\u662f\u5426\u8981\u79bb\u5f00\uff1f";}});copy_properties(Composer,{publish:function(g,h){h=h||{};h.composer=Composer.getInstance($(g));h.composer.reset(false,h.audienceMarkup);h.audienceMarkup=null;if(h.streamMarkup)h.streamStory=HTML(h.streamMarkup).getRootNode();Arbiter.inform('composer/publish',h);},getInstance:function(g){var h=Parent.byClass($(g),'uiComposer');return h?c[h.id]:null;}});})();
function MetaComposerMessageBox(){}MetaComposerMessageBox.prototype={init:function(a,b){this.inputContainer=DOM.scry(a,'div.inputContainer')[0];this.textInput=DOM.scry(a,'textarea.mentionsTextarea')[0];this.metaArea=DOM.scry(a,'div.attachmentMetaArea')[0];this.bottomArea=DOM.scry(a,'div.attachmentBottomArea')[0];this.barArea=DOM.scry(a,'div.attachmentBarArea')[0];Event.listen(this.inputContainer,'click',function(c){var d=c.getTarget();if(!DOM.contains(this.metaArea,d)&&d!==this.textInput)this.textInput.focus();}.bind(this));}};
__e("XD",["function-extensions","copyProperties","ua","URI","Arbiter"],function(a,b,c,d,e,f){b("function-extensions");var g=b("copyProperties"),h=b("ua"),i=b("URI"),j=b("Arbiter"),k={_callbacks:[],_opts:{autoResize:false,allowShrink:true,channelUrl:null,hideOverflow:false,newResizeMethod:false,resizeTimeout:100,resizeWidth:false,expectResizeAck:false,resizeAckTimeout:6000},_lastResizeAckId:0,_resizeCount:0,_resizeTimestamp:0,init:function(m){this._opts=g(g({},this._opts),m);if(this._opts.autoResize)this._startResizeMonitor();j.subscribe('Connect.Unsafe.resize.ack',function(n,o){if(!o.id)o.id=this._resizeCount;if(o.id>this._lastResizeAckId)this._lastResizeAckId=o.id;}.bind(this));},send:function(m,n){n=n||this._opts.channelUrl;if(!n)return;if(n.substr(0,4)!='http')return;var o=n+'&'+i.implodeQuery(m),p='f'+(Math.random()*(1<<30)).toString(16).replace('.',''),q=document.body.appendChild(document.createElement('div')),r=false;q.style.position='absolute';q.style.top='-10000px';q.style.width='1px';q.style.height='1px';k._callbacks[p]=function(){if(r){(function(){q.parentNode.removeChild(q);}).defer(3000);delete k._callbacks[p];}};if(h.ie()){var s,t=document.createElement('div');s='<iframe onload="XD._callbacks.'+p+'()"></iframe>';t.innerHTML=s;t.firstChild.setAttribute('src',o);s=t.innerHTML;q.innerHTML='<iframe src="javascript:false"></iframe>';r=true;(function(){q.innerHTML=s;}).defer();}else{var u=document.createElement('iframe');u.onload=k._callbacks[p];q.appendChild(u);r=true;u.src=o;}},_computeSize:function(){return {width:this._opts.resizeWidth?this._calcWidth(k.forced_min_width):0,height:this._calcHeight(this._opts.newResizeMethod)};},_calcHeight:function(m){var n=document.body,o=document.documentElement,p=0;if(m){p=Math.max(Math.max(n.offsetHeight,n.scrollHeight)+n.offsetTop,Math.max(o.offsetHeight,o.scrollHeight)+o.offsetTop);}else{if(h.ie()){p=Math.max(n.offsetHeight,n.scrollHeight)+n.offsetTop;}else p=o.offsetHeight+o.offsetTop;if(window.Dialog)p=Math.max(p,Dialog.max_bottom);}return p;},_calcWidth:function(m){var n=document.body,o=document.documentElement,p=0;if(n.offsetWidth<n.scrollWidth){p=n.scrollWidth+n.offsetLeft;}else{var q=n.childNodes;for(var r=0;r<q.length;r++){var s=q[r],t=s.offsetWidth+s.offsetLeft;if(t>p)p=t;}}if(m)p=Math.max(p,m);if(o.clientLeft>0)p+=(o.clientLeft*2);if(o.clientTop>0)height+=(o.clientTop*2);return p;},_startResizeMonitor:function(){var m,n=document.documentElement;if(this._opts.hideOverflow){n.style.overflow='hidden';document.body.style.overflow='hidden';}setInterval((function(){var o=this._computeSize(),p=Date.now(),q=this._lastResizeAckId<this._resizeCount&&(p-this._resizeTimestamp)>this._opts.resizeAckTimeout;if(!m||(this._opts.expectResizeAck&&q)||(this._opts.allowShrink&&m.width!=o.width)||(!this._opts.allowShrink&&m.width<o.width)||(this._opts.allowShrink&&m.height!=o.height)||(!this._opts.allowShrink&&m.height<o.height)){m=o;this._resizeCount++;this._resizeTimestamp=p;var r={type:'resize',height:o.height,ackData:{id:this._resizeCount}};if(o.width&&o.width!=0)r.width=o.width;try{if(i(document.referrer).isFacebookURI()&&window.parent!=window&&window.name&&window.parent.location&&window.parent.location.toString&&i(window.parent.location).isFacebookURI()){var t=window.parent.document.getElementsByTagName('iframe');for(var u=0;u<t.length;u=u+1)if(t[u].name==window.name){if(this._opts.resizeWidth)t[u].style.width=r.width+'px';t[u].style.height=r.height+'px';}}this.send(r);}catch(s){this.send(r);}}}).bind(this),this._opts.resizeTimeout);}},l=g({},k);e.exports.UnverifiedXD=l;e.exports.XD=k;a.UnverifiedXD=l;a.XD=k;});
__e("legacy:connect-xd",["XD"],function(a,b,c,d){a.UnverifiedXD=b('XD').UnverifiedXD;a.XD=b('XD').XD;},3);
window.__UIControllerRegistry=window.__UIControllerRegistry||{};
__e("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
function adjustImage(a,b){if(!b){var c=a.parentNode;while(c.parentNode&&(CSS.getStyle(c,'display')!='block'||c.offsetWidth==0))c=c.parentNode;b=c.offsetWidth;}var d=a.offsetWidth;if(d==0){var e=a.nextSibling,f=a.parentNode;document.body.appendChild(a);d=a.offsetWidth;if(e){f.insertBefore(a,e);}else f.appendChild(a);}if(d>b)try{if(ua.ie()<8){var h=document.createElement('div');h.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+a.src.replace('"','%22')+'", sizingMethod="scale")';h.style.width=b+'px';h.style.height=Math.floor(((b/a.offsetWidth)*a.offsetHeight))+'px';if(a.parentNode.tagName=='A')h.style.cursor='pointer';a.parentNode.insertBefore(h,a);a.parentNode.removeChild(a);}else throw 1;}catch(g){a.style.width=b+'px';}CSS.removeClass(a,'img_loading');}function imageConstrainSize(a,b,c,d){var e=new Image();e.onload=function(){if(e.width>0&&e.height>0){var f=e.width,g=e.height;if(f>b||g>c){var h=c/b,i=g/f;if(i>h){f=f*(c/g);g=c;}else{g=g*(b/f);f=b;}}var j=ge(d);if(j){var k=document.createElement('img');k.src=a;k.width=f;k.height=g;j.parentNode.insertBefore(k,j);j.parentNode.removeChild(j);}}};e.src=a;}function image_has_failed(a){if((a.complete==null&&a.width==20&&a.height==20)||(a.mimeType!=null&&a.complete&&a.mimeType=='')||(a.naturalHeight!=null&&a.complete&&a.naturalHeight==0))return true;}
(function(){var a='facebook.desktopplugin';FbDesktopDetect={mimeType:'application/x-facebook-desktop-1',isPluginInstalled:function(){var b=null;if(window.ActiveXObject){try{b=new ActiveXObject(a);if(b)return true;}catch(c){}}else if(navigator.plugins){navigator.plugins.refresh(false);for(var d=0,e=navigator.plugins.length;d<e;d++){b=navigator.plugins[d];if(b.length&&b[0].type===this.mimeType)return true;}}return false;},patchLoginForm:function(){if(this.isPluginInstalled()){new AsyncRequest('ajax/desktop/loginmessage').send();var b=$('persist_box');if(b)b.checked=true;}},setContextualDialog:function(b){var c=$('persist_box');if(!c.checked)this.toggleWarning(b);var d=function(){c.checked?b.hide():b.show();};Event.listen(c,'click',d);Event.listen(c,'keydown',d);}};})();
(function(){FbDesktopPlugin={_plugin:'_not_checked',getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(FbDesktopDetect.isPluginInstalled()){var a=DOM.create('div');document.body.appendChild(a);DOM.setContent(a,HTML('<object id="kiwi_plugin" '+'type="'+FbDesktopDetect.mimeType+'" width="0" height="0">'+'</object>'));this._plugin=$('kiwi_plugin');}}return this._plugin;},isAppRunning:function(){var a=this.getPlugin();return a&&'isAppRunning' in a&&a.isAppRunning();},logout:function(a){a=a||"0";var b=this.getPlugin();if(b)b.logout(a);},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressSidebar:function(){var a=this.getPlugin();return a&&'isAppDocked' in a&&a.isAppDocked();},transferAuthToken:function(a,b){if(a&&a.length>0){var c=this.getPlugin();if(c)c.setAccessToken(a,b);}if(this.redirectHome)window.location.href=URI().setPath().toString();}};})();
__e("AsyncSignal",["Env"],function(a,b,c,d,e,f){var g=b("Env");function h(i,j){this.data=j||{};if(g.tracking_domain&&i.charAt(0)=='default.htm')i=g.tracking_domain+i;this.uri=i;this.handler=null;}h.prototype.setHandler=function(i){this.handler=i;return this;};h.prototype.send=function(){var i=this.handler,j=this.data,k=this.uri,l=[],m=new Image(),n=document.getElementById('post_form_id');j.asyncSignal=Math.floor(Math.random()*10000)+1;if(n)j.post_form_id=n.value;j.__user=g.user;if(g.fb_isb)j.fb_isb=g.fb_isb;for(var o in j)l.push(encodeURIComponent(o)+'='+encodeURIComponent(j[o]));if(k.indexOf('?')==-1)k+='?';k+=l.join('&');if(i)m.onload=m.onerror=(function(p,q){return function(){q((p.height==1));};})(m,i);m.src=k;return this;};e.exports=h;});
__e("legacy:async-signal",["AsyncSignal"],function(a,b,c,d){a.AsyncSignal=b('AsyncSignal');},3);
__e("legacy:uri",["URI"],function(a,b,c,d){a.URI=b('URI');},3);
function detect_broken_proxy_cache(a,b){var c=getCookie(b);if((c!=a)&&(c!=null)&&(a!='0')){var d={c:'si_detect_broken_proxy_cache',m:b+' '+a+' '+c},e=new URI('/common/scribe_endpoint.php').getQualifiedURI().toString();new AsyncSignal(e,d).send();}}
__e("goOrReplace",["URI"],function(a,b,c,d,e,f){var g=b("URI");function h(i,j,k){var l=new g(j);if(i.pathname=='default.htm'&&l.getPath()!='default.htm'&&l.isQuicklingEnabled()){var m=i.search?{}:{q:''};l=new g().setPath('default.htm').setQueryData(m).setFragment(l.getUnqualifiedURI()).toString();j=l.toString();}if(k&&!(ua.ie()<8)){i.replace(j);}else if(i.href==j){i.reload();}else i.href=j;}e.exports=h;});
__e("AjaxPipeRequest",["Arbiter","AsyncRequest","BigPipe","dom","Env","JSCC","copyProperties","goOrReplace","dom-core"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("AsyncRequest"),i=b("BigPipe"),j=b("dom"),k=b("Env"),l=b("JSCC"),m=b("copyProperties"),n=b("goOrReplace"),o=b("dom-core").ge;function p(s,t){var u=o(s);if(u){if(!t)u.style.minHeight='600px';for(var v in i.pageletIDs)if(s!==v&&j.contains(u,v)){l.clearForPagelet(v);delete i.pageletIDs[v];}j.empty(u);}}function q(s,t){var u=o(s);if(u)if(!t)u.style.minHeight='100px';}function r(s,t){this._uri=s;this._query_data=t;this._request=new h();this._canvas_id=null;this._allow_cross_page_transition=true;}m(r.prototype,{setCanvasId:function(s){this._canvas_id=s;return this;},setURI:function(s){this._uri=s;return this;},setData:function(s){this._query_data=s;return this;},getData:function(s){return this._query_data;},setAllowCrossPageTransition:function(s){this._allow_cross_page_transition=s;return this;},setAppend:function(s){this._append=s;return this;},send:function(){this._request.setOption('useIframeTransport',true).setURI(this._uri).setData(m({ajaxpipe:1,ajaxpipe_token:k.ajaxpipe_token},this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(this._allow_cross_page_transition);r._current_request=this._request;this._request.send();return this;},_preBootloadFirstResponse:function(s){return false;},_fireDomContentCallback:function(){this._arbiter.inform('ajaxpipe/domcontent_callback',true,g.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this._arbiter.inform('ajaxpipe/onload_callback',true,g.BEHAVIOR_STATE);},_isRelevant:function(s){return this._request==r._current_request||this._jsNonBlock;},_preBootloadHandler:function(s){var t=s.getPayload();if(!t||t.redirect||!this._isRelevant(s))return false;var u=false;if(s.is_first){!this._append&&!this._displayCallback&&p(this._canvas_id,this._constHeight);this._arbiter=new g();u=this._preBootloadFirstResponse(s);this.pipe=new i({arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:this._request.lid,rrEnabled:s.payload.roadrunner_enabled,isAjax:true,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:'ajaxpipe/domcontent_callback',onloadEvt:'ajaxpipe/onload_callback',jsNonBlock:this._jsNonBlock,displayCallback:this._displayCallback});}return u;},_redirect:function(s){if(s.redirect){if(s.force||!this.isPageActive(s.redirect)){var t=['ajaxpipe','ajaxpipe_token'].concat(this.getSanitizedParameters());n(window.location,URI(s.redirect).removeQueryData(t),true);}else PageTransitions.go(s.redirect,true);return true;}else return false;},isPageActive:function(s){return true;},getSanitizedParameters:function(){return [];},_versionCheck:function(s){return true;},_onInitialResponse:function(s){var t=s.getPayload();if(!this._isRelevant(s))return false;if(!t)return true;if(this._redirect(t)||!this._versionCheck(t))return false;return true;},_processFirstResponse:function(s){var t=s.getPayload();if(o(this._canvas_id)&&t.canvas_class!==null)CSS.setClass(this._canvas_id,t.canvas_class);},setFirstResponseCallback:function(s){this._firstResponseCallback=s;return this;},setFirstResponseHandler:function(s){this._processFirstResponse=s;return this;},_onResponse:function(s){var t=s.payload;if(!this._isRelevant(s))return h.suppressOnloadToken;if(s.is_first){this._processFirstResponse(s);this._firstResponseCallback&&this._firstResponseCallback();t.provides=t.provides||[];t.provides.push('uipage_onload');if(this._append)t.append=this._canvas_id;}if(t){if('content' in t.content&&this._canvas_id!==null&&this._canvas_id!='content'){t.content[this._canvas_id]=t.content.content;delete t.content.content;}this.pipe.onPageletArrive(t);}if(s.is_last)q(this._canvas_id,this._constHeight);return h.suppressOnloadToken;},setNectarModuleDataSafe:function(s){this._request.setNectarModuleDataSafe(s);return this;},setFinallyHandler:function(s){this._request.setFinallyHandler(s);return this;},setErrorHandler:function(s){this._request.setErrorHandler(s);return this;},abort:function(){this._request.abort();if(r._current_request==this._request)r._current_request=null;this._request=null;return this;},setJSNonBlock:function(s){this._jsNonBlock=s;return this;},setDisplayCallback:function(s){this._displayCallback=s;return this;},setConstHeight:function(s){this._constHeight=s;return this;},getAsyncRequest:function(){return this._request;}});m(r,{getCurrentRequest:function(){return r._current_request;},setCurrentRequest:function(s){r._current_request=s;}});e.exports=a.AjaxPipeRequest||r;});
__e("legacy:ajaxpipe",["AjaxPipeRequest"],function(a,b,c,d){a.AjaxPipeRequest=b('AjaxPipeRequest');},3);
__e("computeRelativeURI",["array-extensions","URI","Util","isEmpty"],function(a,b,c,d,e,f){b("array-extensions");var g=b("URI"),h=b("Util"),i=b("isEmpty");function j(l,m){if(!m)return l;if(m.charAt(0)=='default.htm')return m;var n=l.split('/').slice(0,-1);n[0]!=='';m.split('/').forEach(function(o){if(!(o=='.'))if(o=='..'){if(n.length>1)n=n.slice(0,-1);}else n.push(o);});return n.join('./');}function k(l,m){var n=new g(),o=m;l=new g(l);m=new g(m);if(m.getDomain()&&!m.isFacebookURI())return o;var p=l,q=['Protocol','Domain','Port','Path','QueryData','Fragment'];q.forEach(function(r){var s=r=='Path'&&p===l;if(s)n.setPath(j(l.getPath(),m.getPath()));if(!i(m['get'+r]()))p=m;if(!s)n['set'+r](p['get'+r]());});return n;}e.exports=k;});
__e("HistoryManager",["event-extensions","function-extensions","Cookie","Env","ua","URI","copyProperties","goOrReplace"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("Cookie"),h=b("Env"),i=b("ua"),j=b("URI"),k=b("copyProperties"),l=b("goOrReplace"),m={_IFRAME_BASE_URI:'../static.ak.facebook.com/common/history_manager.php',history:null,current:0,fragment:null,_setIframeSrcFragment:function(n){n=n.toString();var o=m.history.length-1;m.iframe.src=m._IFRAME_BASE_URI+'?|index='+o+'#'+encodeURIComponent(n);return m;},getIframeSrcFragment:function(){return decodeURIComponent(j(m.iframe.contentWindow.document.location.href).getFragment());},nextframe:function(n,o){if(o){m._setIframeSrcFragment(n);return;}if(n!==undefined){m.iframeQueue.push(n);}else{m.iframeQueue.splice(0,1);m.iframeTimeout=null;m.checkURI();}if(m.iframeQueue.length&&!m.iframeTimeout){var p=m.iframeQueue[0];m.iframeTimeout=setTimeout(function(){m._setIframeSrcFragment(p);},100,false);}},isInitialized:function(){return !!m._initialized;},init:function(){if(!h.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(m._initialized)return m;var n=j(),o=n.getFragment()||'';if(o.charAt(0)==='!'){o=o.substr(1);n.setFragment(o);}if(j.getRequestURI(false).getProtocol().toLowerCase()=='https')m._IFRAME_BASE_URI='../https@s-static.ak.facebook.com/common/history_manager.php';k(m,{_initialized:true,fragment:o,orig_fragment:o,history:[n],callbacks:[],lastChanged:Date.now(),canonical:j('#'),fragmentTimeout:null,user:0,iframeTimeout:null,iframeQueue:[],enabled:true,debug:bagofholding});if(window.history&&history.pushState){this.lastURI=document.URL;window.history.replaceState(this.lastURI,null);Event.listen(window,'popstate',function(p){if(p&&p.state&&m.lastURI!=p.state){m.lastURI=p.state;m.lastChanged=Date.now();m.notify(j(p.state).getUnqualifiedURI().toString());}}.bind(m));if(i.safari()<534||i.chrome()<=13){setInterval(m.checkURI,42,false);m._updateRefererURI(this.lastURI);}return m;}m._updateRefererURI(j.getRequestURI(false));if(i.safari()<500||i.firefox()<2){m.enabled=false;return m;}if(i.ie()<8){m.iframe=document.createElement('iframe');k(m.iframe.style,{width:'0',height:'0',frameborder:'0',left:'0',top:'0',position:'absolute'});m._setIframeSrcFragment(o);document.body.insertBefore(m.iframe,document.body.firstChild);}else if('onhashchange' in window){Event.listen(window,'hashchange',function(){m.checkURI.bind(m).defer();});}else setInterval(m.checkURI,42,false);return m;},registerURIHandler:function(n){m.callbacks.push(n);return m;},setCanonicalLocation:function(n){m.canonical=j(n);return m;},notify:function(n){if(n==m.orig_fragment)n=m.canonical.getFragment();for(var o=0;o<m.callbacks.length;o++)try{if(m.callbacks[o](n))return true;}catch(p){}return false;},checkURI:function(){if(Date.now()-m.lastChanged<400)return;if(window.history&&history.pushState){var n=j(document.URL).removeQueryData('ref').toString(),o=j(m.lastURI).removeQueryData('ref').toString();if(n!=o){m.lastChanged=Date.now();m.lastURI=n;if(i.safari()<534)m._updateRefererURI(n);m.notify(j(n).getUnqualifiedURI().toString());}return;}if(i.ie()<8&&m.iframeQueue.length)return;if(i.safari()&&window.history.length==200){if(!m.warned)m.warned=true;return;}var p=j().getFragment();if(p.charAt(0)=='!')p=p.substr(1);if(i.ie()<8)p=m.getIframeSrcFragment();p=p.replace(/%23/g,'#');if(p!=m.fragment.replace(/%23/g,'#')){m.debug([p,' vs ',m.fragment,'whl: ',window.history.length,'QHL: ',m.history.length].join(' '));for(var q=m.history.length-1;q>=0;--q)if(m.history[q].getFragment().replace(/%23/g,'#')==p)break;++m.user;if(q>=0){m.go(q-m.current);}else m.go('#'+p);--m.user;}},_updateRefererURI:function(n){n=n.toString();if(n.charAt(0)!='default.htm'&&n.indexOf('//')==-1)return;var o=new j(window.location);if(o.isFacebookURI()){var p=o.getPath()+window.location.search;}else var p='';var q=j(n).getQualifiedURI().setFragment(p).toString(),r=2048;if(q.length>r)q=q.substring(0,r)+'...';g.set('x-referer',q);},go:function(n,o,p){if(window.history&&history.pushState){o||typeof(n)=='number';var q=j(n).removeQueryData('ref').toString();m.lastChanged=Date.now();this.lastURI=q;if(p){window.history.replaceState(n,null,q);}else window.history.pushState(n,null,q);if(i.safari()<534)m._updateRefererURI(n);return false;}m.debug('go: '+n);if(o===undefined)o=true;if(!m.enabled)if(!o)return false;if(typeof(n)=='number'){if(!n)return false;var r=n+m.current,s=Math.max(0,Math.min(m.history.length-1,r));m.current=s;r=m.history[s].getFragment()||m.orig_fragment;r=j(r).removeQueryData('ref').getUnqualifiedURI().toString();m.fragment=r;m.lastChanged=Date.now();if(i.ie()<8){if(m.fragmentTimeout)clearTimeout(m.fragmentTimeout);m._temporary_fragment=r;m.fragmentTimeout=setTimeout(function(){window.location.hash='#!'+r;delete m._temporary_fragment;},750,false);if(!m.user)m.nextframe(r,p);}else if(!m.user)l(window.location,window.location.href.split('#')[0]+'#!'+r,p);if(o)m.notify(r);m._updateRefererURI(r);return false;}n=j(n);if(n.getDomain()==j().getDomain())n=j('#'+n.getUnqualifiedURI());var t=m.history[m.current].getFragment(),u=n.getFragment();if(u==t||(t==m.orig_fragment&&u==m.canonical.getFragment())){if(o)m.notify(u);m._updateRefererURI(u);return false;}if(p)m.current--;var v=(m.history.length-m.current)-1;m.history.splice(m.current+1,v);m.history.push(j(n));return m.go(1,o,p);},getCurrentFragment:function(){var n=m._temporary_fragment!==undefined?m._temporary_fragment:j.getRequestURI(false).getFragment();return n==m.orig_fragment?m.canonical.getFragment():n;}};e.exports=m;});
__e("animation",["css"],function(a,b,c,d,e,f){var g=b('css');function h(i){if(i==undefined)return;if(a==this){return new h(i);}else{this.obj=i;this._reset_state();this.queue=[];this.last_attr=null;}}h.resolution=20;h.offset=0;h.prototype._reset_state=function(){this.state={attrs:{},duration:500};};h.prototype.stop=function(){this._reset_state();this.queue=[];return this;};h.prototype._build_container=function(){if(this.container_div){this._refresh_container();return;}if(this.obj.firstChild&&this.obj.firstChild.__animation_refs){this.container_div=this.obj.firstChild;this.container_div.__animation_refs++;this._refresh_container();return;}var i=document.createElement('div');i.style.padding='0px';i.style.margin='0px';i.style.border='0px';i.__animation_refs=1;var j=this.obj.childNodes;while(j.length)i.appendChild(j[0]);this.obj.appendChild(i);this._orig_overflow=this.obj.style.overflow;this.obj.style.overflow='hidden';this.container_div=i;this._refresh_container();};h.prototype._refresh_container=function(){this.container_div.style.height='auto';this.container_div.style.width='auto';this.container_div.style.height=this.container_div.offsetHeight+'px';this.container_div.style.width=this.container_div.offsetWidth+'px';};h.prototype._destroy_container=function(){if(!this.container_div)return;if(!--this.container_div.__animation_refs){var i=this.container_div.childNodes;while(i.length)this.obj.appendChild(i[0]);this.obj.removeChild(this.container_div);}this.container_div=null;this.obj.style.overflow=this._orig_overflow;};h.ATTR_TO=1;h.ATTR_BY=2;h.ATTR_FROM=3;h.prototype._attr=function(i,j,k){i=i.replace(/-[a-z]/gi,function(m){return m.substring(1).toUpperCase();});var l=false;switch(i){case 'background':this._attr('backgroundColor',j,k);return this;case 'margin':j=h.parse_group(j);this._attr('marginBottom',j[0],k);this._attr('marginLeft',j[1],k);this._attr('marginRight',j[2],k);this._attr('marginTop',j[3],k);return this;case 'padding':j=h.parse_group(j);this._attr('paddingBottom',j[0],k);this._attr('paddingLeft',j[1],k);this._attr('paddingRight',j[2],k);this._attr('paddingTop',j[3],k);return this;case 'backgroundColor':case 'borderColor':case 'color':j=h.parse_color(j);break;case 'opacity':j=parseFloat(j,10);break;case 'height':case 'width':if(j=='auto'){l=true;}else j=parseInt(j,10);break;case 'borderWidth':case 'lineHeight':case 'fontSize':case 'marginBottom':case 'marginLeft':case 'marginRight':case 'marginTop':case 'paddingBottom':case 'paddingLeft':case 'paddingRight':case 'paddingTop':case 'bottom':case 'left':case 'right':case 'top':case 'scrollTop':case 'scrollLeft':j=parseInt(j,10);break;default:throw new Error(i+' is not a supported attribute!');}if(this.state.attrs[i]===undefined)this.state.attrs[i]={};if(l)this.state.attrs[i].auto=true;switch(k){case h.ATTR_FROM:this.state.attrs[i].start=j;break;case h.ATTR_BY:this.state.attrs[i].by=true;case h.ATTR_TO:this.state.attrs[i].value=j;break;}};h._get_box_width=function(i){var j=parseInt(g.getStyle(i,'paddingLeft'),10),k=parseInt(g.getStyle(i,'paddingRight'),10),l=parseInt(g.getStyle(i,'borderLeftWidth'),10),m=parseInt(g.getStyle(i,'borderRightWidth'),10);return i.offsetWidth-(j?j:0)-(k?k:0)-(l?l:0)-(m?m:0);};h._get_box_height=function(i){var j=parseInt(g.getStyle(i,'paddingTop'),10),k=parseInt(g.getStyle(i,'paddingBottom'),10),l=parseInt(g.getStyle(i,'borderTopWidth'),10),m=parseInt(g.getStyle(i,'borderBottomWidth'),10);return i.offsetHeight-(j?j:0)-(k?k:0)-(l?l:0)-(m?m:0);};h.prototype.to=function(i,j){if(j===undefined){this._attr(this.last_attr,i,h.ATTR_TO);}else{this._attr(i,j,h.ATTR_TO);this.last_attr=i;}return this;};h.prototype.by=function(i,j){if(j===undefined){this._attr(this.last_attr,i,h.ATTR_BY);}else{this._attr(i,j,h.ATTR_BY);this.last_attr=i;}return this;};h.prototype.from=function(i,j){if(j===undefined){this._attr(this.last_attr,i,h.ATTR_FROM);}else{this._attr(i,j,h.ATTR_FROM);this.last_attr=i;}return this;};h.prototype.duration=function(i){this.state.duration=i?i:0;return this;};h.prototype.checkpoint=function(i,j){if(i===undefined)i=1;this.state.checkpoint=i;this.queue.push(this.state);this._reset_state();this.state.checkpointcb=j;return this;};h.prototype.blind=function(){this.state.blind=true;return this;};h.prototype.hide=function(){this.state.hide=true;return this;};h.prototype.show=function(){this.state.show=true;return this;};h.prototype.ease=function(i){this.state.ease=i;return this;};h.prototype.go=function(){var i=(new Date()).getTime();this.queue.push(this.state);for(var j=0;j<this.queue.length;j++){this.queue[j].start=i-h.offset;if(this.queue[j].checkpoint)i+=this.queue[j].checkpoint*this.queue[j].duration;}h.push(this);return this;};h.prototype._show=function(){g.show(this.obj);};h.prototype._hide=function(){g.hide(this.obj);};h.prototype._frame=function(i){var j=true,k=false,l=false,m;function n(x){return document.documentElement[x]||document.body[x];}for(var o=0;o<this.queue.length;o++){var p=this.queue[o];if(p.start>i){j=false;continue;}if(p.checkpointcb){this._callback(p.checkpointcb,i-p.start);p.checkpointcb=null;}if(p.started===undefined){if(p.show)this._show();for(var q in p.attrs){if(p.attrs[q].start!==undefined)continue;switch(q){case 'backgroundColor':case 'borderColor':case 'color':m=h.parse_color(g.getStyle(this.obj,q=='borderColor'?'borderLeftColor':q));if(p.attrs[q].by){p.attrs[q].value[0]=Math.min(255,Math.max(0,p.attrs[q].value[0]+m[0]));p.attrs[q].value[1]=Math.min(255,Math.max(0,p.attrs[q].value[1]+m[1]));p.attrs[q].value[2]=Math.min(255,Math.max(0,p.attrs[q].value[2]+m[2]));}break;case 'opacity':m=g.getOpacity(this.obj);if(p.attrs[q].by)p.attrs[q].value=Math.min(1,Math.max(0,p.attrs[q].value+m));break;case 'height':m=h._get_box_height(this.obj);if(p.attrs[q].by)p.attrs[q].value+=m;break;case 'width':m=h._get_box_width(this.obj);if(p.attrs[q].by)p.attrs[q].value+=m;break;case 'scrollLeft':case 'scrollTop':m=(this.obj===document.body)?n(q):this.obj[q];if(p.attrs[q].by)p.attrs[q].value+=m;p['last'+q]=m;break;default:m=parseInt(g.getStyle(this.obj,q),10)||0;if(p.attrs[q].by)p.attrs[q].value+=m;break;}p.attrs[q].start=m;}if((p.attrs.height&&p.attrs.height.auto)||(p.attrs.width&&p.attrs.width.auto)){if(ua.firefox()<3)l=true;this._destroy_container();for(var q in {height:1,width:1,fontSize:1,borderLeftWidth:1,borderRightWidth:1,borderTopWidth:1,borderBottomWidth:1,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1})if(p.attrs[q])this.obj.style[q]=p.attrs[q].value+(typeof p.attrs[q].value=='number'?'px':'');if(p.attrs.height&&p.attrs.height.auto)p.attrs.height.value=h._get_box_height(this.obj);if(p.attrs.width&&p.attrs.width.auto)p.attrs.width.value=h._get_box_width(this.obj);}p.started=true;if(p.blind)this._build_container();}var r=(i-p.start)/p.duration;if(r>=1){r=1;if(p.hide)this._hide();}else j=false;var s=p.ease?p.ease(r):r;if(!k&&r!=1&&p.blind)k=true;if(l&&this.obj.parentNode){var t=this.obj.parentNode,u=this.obj.nextSibling;t.removeChild(this.obj);}for(var q in p.attrs)switch(q){case 'backgroundColor':case 'borderColor':case 'color':this.obj.style[q]='rgb('+h.calc_tween(s,p.attrs[q].start[0],p.attrs[q].value[0],true)+','+h.calc_tween(s,p.attrs[q].start[1],p.attrs[q].value[1],true)+','+h.calc_tween(s,p.attrs[q].start[2],p.attrs[q].value[2],true)+')';break;case 'opacity':g.setStyle(this.obj,'opacity',h.calc_tween(s,p.attrs[q].start,p.attrs[q].value));break;case 'height':case 'width':this.obj.style[q]=s==1&&p.attrs[q].auto?'auto':h.calc_tween(s,p.attrs[q].start,p.attrs[q].value,true)+'px';break;case 'scrollLeft':case 'scrollTop':var v=this.obj===document.body;m=v?n(q):this.obj[q];if(p['last'+q]!==m){delete p.attrs[q];}else{var w=h.calc_tween(s,p.attrs[q].start,p.attrs[q].value,true);if(!v){w=this.obj[q]=w;}else{if(q=='scrollLeft'){a.scrollTo(w,n('scrollTop'));}else a.scrollTo(n('scrollLeft'),w);w=n(q);}p['last'+q]=w;}break;default:this.obj.style[q]=h.calc_tween(s,p.attrs[q].start,p.attrs[q].value,true)+'px';break;}if(r==1){this.queue.splice(o--,1);this._callback(p.ondone,i-p.start-p.duration);}}if(l)t[u?'insertBefore':'appendChild'](this.obj,u);if(!k&&this.container_div)this._destroy_container();return !j;};h.prototype.ondone=function(i){this.state.ondone=i;return this;};h.prototype._callback=function(i,j){if(i){h.offset=j;i.call(this);h.offset=0;}};h.calc_tween=function(i,j,k,l){return (l?parseInt:parseFloat)((k-j)*i+j,10);};h.parse_color=function(i){var j=/^#([a-f0-9]{1,2})([a-f0-9]{1,2})([a-f0-9]{1,2})$/i.exec(i);if(j){return [parseInt(j[1].length==1?j[1]+j[1]:j[1],16),parseInt(j[2].length==1?j[2]+j[2]:j[2],16),parseInt(j[3].length==1?j[3]+j[3]:j[3],16)];}else{var k=/^rgba? *\(([0-9]+), *([0-9]+), *([0-9]+)(?:, *([0-9]+))?\)$/.exec(i);if(k){if(k[4]==='0'){return [255,255,255];}else return [parseInt(k[1],10),parseInt(k[2],10),parseInt(k[3],10)];}else if(i=='transparent'){return [255,255,255];}else throw 'Named color attributes are not supported.';}};h.parse_group=function(i){i=trim(i).split(/ +/);if(i.length==4){return i;}else if(i.length==3){return [i[0],i[1],i[2],i[1]];}else if(i.length==2){return [i[0],i[1],i[0],i[1]];}else return [i[0],i[0],i[0],i[0]];};h.push=function(i){if(!h.active)h.active=[];h.active.push(i);if(h.active.length===1){if(!h.requestAnimationFrame){var j=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame;if(j)h.requestAnimationFrame=j.bind(a);}if(h.requestAnimationFrame){h.requestAnimationFrame(h._animate);}else h.timeout=setInterval(h._animate,h.resolution,false);}if(h.requestAnimationFrame)h._updateEndingTimer();h._animate(Date.now(),true);};h._updateEndingTimer=function(){if(!h.requestAnimationFrame)throw new Error('Ending timer only valid with requestAnimationFrame');var i=0;for(var j=0;j<h.active.length;j++){var k=h.active[j];for(var l=0;l<k.queue.length;l++){var m=k.queue[l].start+k.queue[l].duration;if(m>i)i=m;}}if(h.timeout){clearTimeout(h.timeout);delete h.timeout;}var n=Date.now();if(i>n)h.timeout=setTimeout(h._animate.shield(),i-n,false);};h._animate=function(i,j){i=i||Date.now();for(var k=(j===true)?h.active.length-1:0;k<h.active.length;k++)try{if(!h.active[k]._frame(i))h.active.splice(k--,1);}catch(l){h.active.splice(k--,1);}if(h.active.length===0){if(h.timeout){if(h.requestAnimationFrame){clearTimeout(h.timeout);}else clearInterval(h.timeout);delete h.timeout;}}else if(h.requestAnimationFrame)h.requestAnimationFrame(h._animate);};h.ease={};h.ease.begin=function(i){return Math.sin(Math.PI/2*(i-1))+1;};h.ease.end=function(i){return Math.sin(.5*Math.PI*i);};h.ease.both=function(i){return .5*Math.sin(Math.PI*(i-.5))+.5;};h.prependInsert=function(i,j){h.insert(i,j,DOM.prependContent);};h.appendInsert=function(i,j){h.insert(i,j,DOM.appendContent);};h.insert=function(i,j,k){g.setStyle(j,'opacity',0);k(i,j);h(j).from('opacity',0).to('opacity',1).duration(400).go();};a.animation=e.exports=h;},3);
__e("css-support",["css-core","copyProperties"],function(a,b,c,d,e,f){var g=b('css-core'),h=b('copyProperties');h(g,{supportsBorderRadius:function(){var i=['KhtmlBorderRadius','OBorderRadius','MozBorderRadius','WebkitBorderRadius','msBorderRadius','borderRadius'],j=false,k=document.createElement('div');for(var l=i.length;l>=0;l--)if(j=k.style[i[l]]!==undefined)break;g.supportsBorderRadius=bagof(j);return j;}});e.exports=g;},3);
__e("Locale",["css"],function(a,b,c,d,e,f){var g=b("css"),h={isRTL:function(){return 'rtl'===g.getStyle(document.body,'direction');}};e.exports=h;});
__e("getOverlayZIndex",["css"],function(a,b,c,d,e,f){var g=b("css");function h(i,j){j=j||document.body;var k=[];while(i&&i!==j){k.push(i);i=i.parentNode;}if(i!==j)return 0;for(var l=k.length-1;l>=0;l--){var m=k[l];if(g.getStyle(m,'position')!='static'){var n=parseInt(g.getStyle(m,'z-index'),10);if(!isNaN(n))return n;}}return 0;}e.exports=h;});
__e("Dialog",["array-extensions","event-extensions","AjaxPipeRequest","animation","Arbiter","ArrayUtils","AsyncRequest","bootloader","Button","css-support","dom","Form","HTML","Input","Keys","Locale","ObjectUtils","onload","Parent","ua","URI","Vector","bind","copyProperties","getOverlayZIndex","tx"],function(global,require,requireDynamic,requireLazy,module,exports){require("array-extensions");require("event-extensions");var AjaxPipeRequest=require("AjaxPipeRequest"),animation=require("animation"),Arbiter=require("Arbiter"),ArrayUtils=require("ArrayUtils"),AsyncRequest=require("AsyncRequest"),Bootloader=require("bootloader"),Button=require("Button"),CSS=require("css-support"),DOM=require("dom"),Form=require("Form"),HTML=require("HTML"),Input=require("Input"),Keys=require("Keys"),Locale=require("Locale"),ObjectUtils=require("ObjectUtils"),Onload=require("onload"),Parent=require("Parent"),ua=require("ua"),URI=require("URI"),Vector=require("Vector"),bind=require("bind"),copyProperties=require("copyProperties"),getOverlayZIndex=require("getOverlayZIndex");global.tx=require("tx");var _supportsPositionFixed=function(){var body=document.body,test=document.createElement('div'),control=document.createElement('div');body.insertBefore(test,body.firstChild);body.insertBefore(control,body.firstChild);test.style.position='fixed';test.style.top='20px';var result=test.offsetTop!==control.offsetTop;body.removeChild(test);body.removeChild(control);_supportsPositionFixed=bagof(result);return result;};function Dialog(model){this._show_loading=true;this._auto_focus=true;this._submit_on_enter=false;this._fade_enabled=true;this._onload_handlers=[];this._top=125;this._uniqueID='dialog_'+Dialog._globalCount++;this._content=null;this._obj=null;this._popup=null;this._overlay=null;this._shim=null;this._causal_elem=null;this._previous_focus=null;this._buttons=[];this._buildDialog();if(model)this._setFromModel(model);Dialog._init();}copyProperties(Dialog,{OK:{name:'ok',label:"\u786e\u5b9a"},CANCEL:{name:'cancel',label:"\u53d6\u6d88",className:'inputaux'},CLOSE:{name:'close',label:"\u5173\u95ed"},NEXT:{name:'next',label:"\u4e0b\u4e00\u9875"},SAVE:{name:'save',label:"\u50a8\u5b58"},SUBMIT:{name:'submit',label:"\u63d0\u4ea4"},CONFIRM:{name:'confirm',label:"\u786e\u8ba4"},DELETE:{name:'delete',label:"\u5220\u9664"},_globalCount:0,_bottoms:[0],max_bottom:0,_updateMaxBottom:function(){Dialog.max_bottom=Math.max.apply(Math,Dialog._bottoms);}});copyProperties(Dialog,{OK_AND_CANCEL:[Dialog.OK,Dialog.CANCEL],_STANDARD_BUTTONS:[Dialog.OK,Dialog.CANCEL,Dialog.CLOSE,Dialog.SAVE,Dialog.SUBMIT,Dialog.CONFIRM,Dialog.DELETE],SIZE:{WIDE:555,STANDARD:445},_HALO_WIDTH:10,_BORDER_WIDTH:1,_PADDING_WIDTH:10,_PAGE_MARGIN:40,_stack:[],_isUsingCSSBorders:function(){return CSS.supportsBorderRadius()||ua.ie()<7;},newButton:function(name,label,className,handler){var button={name:name,label:label};if(className)button.className=className;if(handler)button.handler=handler;return button;},getCurrent:function(){var stack=Dialog._stack;return stack.length?stack[stack.length-1]:null;},bootstrap:function(uri,data,read_only,method,model,elem){data=data||{};var use_pipe=elem&&elem.rel=='dialog-pipe';copyProperties(data,new URI(uri).getQueryData());method=method||(read_only?'GET':'POST');var status_elem=Parent.byClass(elem,'stat_elem')||elem;if(status_elem&&CSS.hasClass(status_elem,'async_saving'))return false;var request;if(use_pipe){request=new AjaxPipeRequest();}else request=new AsyncRequest().setReadOnly(!!read_only).setMethod(method).setRelativeTo(elem).setStatusElement(status_elem);request.setURI(uri).setNectarModuleDataSafe(elem).setData(data);var dialog=new Dialog(model).setCausalElement(elem).setAsync(request,use_pipe);dialog.show();return false;},_init:function(){this._init=bagofholding;Onload.runOnleave(Dialog._tearDown.shield(null,false));Arbiter.subscribe('page_transition',Dialog._tearDown.shield(null,true));Event.listen(document.documentElement,'keydown',function(event){if(Event.getKeyCode(event)==Keys.ESC&&!event.getModifiers().any){if(Dialog._escape())event.kill();}else if(Event.getKeyCode(event)==Keys.RETURN&&!event.getModifiers().any)if(Dialog._enter())event.kill();});Event.listen(window,'resize',function(event){var dialog=Dialog.getCurrent();dialog&&dialog._resetDialogObj();});},_findButton:function(buttons,name){if(buttons)for(var i=0;i<buttons.length;++i)if(buttons[i].name==name)return buttons[i];return null;},_tearDown:function(is_page_transition){var stack=Dialog._stack.slice();for(var ii=stack.length-1;ii>=0;ii--)if(!(is_page_transition&&stack[ii]._cross_transition))stack[ii].hide();},_escape:function(){var dialog=Dialog.getCurrent();if(!dialog)return false;var semi_modal=dialog._semi_modal,buttons=dialog._buttons;if(!buttons.length&&!semi_modal)return false;if(semi_modal&&!buttons.length){dialog.hide();return true;}var button_to_simulate,cancel_button=Dialog._findButton(buttons,'cancel');if(dialog._cancelHandler){dialog.cancel();return true;}else if(cancel_button){button_to_simulate=cancel_button;}else if(buttons.length==1){button_to_simulate=buttons[0];}else return false;dialog._handleButton(button_to_simulate);return true;},_enter:function(){var dialog=Dialog.getCurrent();if(!dialog||!dialog._submit_on_enter)return false;if(document.activeElement!=dialog._frame)return false;var buttons=dialog._buttons;if(!buttons)return false;dialog._handleButton(buttons[0]);return true;},call_or_eval:function(obj,func,args){if(!func)return undefined;args=args||{};if(typeof(func)=='string'){var params=ObjectUtils.getKeys(args).join(', ');func=eval('({f: function('+params+') { '+func+'}})').f;}return func.apply(obj,ObjectUtils.getValues(args));}});copyProperties(Dialog.prototype,{_cross_transition:false,_loading:false,_showing:false,show:function(){if(this._async_request&&this._show_loading){this.showLoading();}else{this._showing=true;this._update();}return this;},showLoading:function(){this._loading=true;CSS.addClass(this._frame,'dialog_loading_shown');this._renderDialog();return this;},hide:function(){if(!this._showing&&!this._loading)return this;this._showing=false;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}if(this._fade_enabled&&Dialog._stack.length<=1){this._fadeOut();}else this._hide();return this;},cancel:function(){if(!this._cancelHandler||this._cancelHandler()!==false)this.hide();},getRoot:function(){return this._obj;},getBody:function(){return DOM.scry(this._obj,'div.dialog_body')[0];},getButtonElement:function(button){if(typeof button=='string')button=Dialog._findButton(this._buttons,button);if(!button||!button.name)return null;var inputs=DOM.scry(this._popup,'input'),name_filter=function(elem){return elem.name==button.name;};return inputs.filter(name_filter)[0]||null;},getContentNode:function(){return DOM.find(this._content,'div.dialog_content');},getFormData:function(){return Form.serialize(this.getContentNode());},setAllowCrossPageTransition:function(allow){this._cross_transition=allow;return this;},setShowing:function(){this.show();return this;},setHiding:function(){this.hide();return this;},setTitle:function(title){var node=this._nodes.title,inner_node=this._nodes.title_inner,content_node=this._nodes.content;DOM.setContent(inner_node,this._format(title||''));CSS.conditionShow(node,!!title);CSS.conditionClass(content_node,'dialog_content_titleless',!title);return this;},setBody:function(body){DOM.setContent(this._nodes.body,this._format(body));return this;},setExtraData:function(data){this._extra_data=data;return this;},setReturnData:function(data){this._return_data=data;return this;},setShowLoading:function(show){this._show_loading=show;return this;},setFullBleed:function(is_full_bleed){this._full_bleed=is_full_bleed;this._updateWidth();CSS.conditionClass(this._obj,'full_bleed',is_full_bleed);return this;},setCausalElement:function(elem){this._causal_elem=elem;return this;},setUserData:function(data){this._user_data=data;return this;},getUserData:function(){return this._user_data;},setAutohide:function(autohide){if(autohide){if(this._showing){this._autohide_timeout=setTimeout(this.hide.shield(this),autohide);}else this._autohide=autohide;}else{this._autohide=null;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}}return this;},setSummary:function(summary){var node=this._nodes.summary;DOM.setContent(node,this._format(summary||''));CSS.conditionShow(node,!!summary);return this;},setButtons:function(b){var buttons,button;if(!(b instanceof Array)){buttons=ArrayUtils.createFrom(arguments);}else buttons=b;for(var i=0;i<buttons.length;++i)if(typeof buttons[i]=='string'){button=Dialog._findButton(Dialog._STANDARD_BUTTONS,buttons[i]);buttons[i]=button;}this._buttons=buttons;var button_content=[];if(buttons&&buttons.length>0)for(var ii=0;ii<buttons.length;ii++){button=buttons[ii];var button_input=DOM.$N('input',{type:'button',name:button.name||'',value:button.label}),button_node=DOM.$N('label',{className:'uiButton uiButtonLarge uiButtonConfirm'},button_input);if(button.className){button.className.split(/\s+/).each(function(e){CSS.addClass(button_node,e);});if(CSS.hasClass(button_node,'inputaux')){CSS.removeClass(button_node,'inputaux');CSS.removeClass(button_node,'uiButtonConfirm');}if(CSS.hasClass(button_node,'uiButtonSpecial'))CSS.removeClass(button_node,'uiButtonConfirm');}if(button.icon)DOM.prependContent(button_node,DOM.$N('img',{src:button.icon,className:'img mrs'}));if(button.disabled)Button.setEnabled(button_node,false);Event.listen(button_input,'click',this._handleButton.bind(this,button.name));for(var attr in button)if(attr.indexOf('data-')===0&&attr.length>5)button_input.setAttribute(attr,button[attr]);button_content.push(button_node);}DOM.setContent(this._nodes.buttons,button_content);this._updateButtonVisibility();return this;},setButtonsMessage:function(message){DOM.setContent(this._nodes.button_message,this._format(message||''));this._has_button_message=!!message;this._updateButtonVisibility();return this;},_updateButtonVisibility:function(){var show=this._buttons.length>0||this._has_button_message;CSS.conditionShow(this._nodes.button_wrapper,show);CSS.conditionClass(this._obj,'omitDialogFooter',!show);},setClickButtonOnEnter:function(input_id,button){this._clickOnEnterTarget=input_id;if(!this._clickOnEnterListener)this._clickOnEnterListener=Event.listen(this._nodes.body,'keypress',function(event){var target=event.getTarget();if(target&&target.id===this._clickOnEnterTarget)if(Event.getKeyCode(event)==Keys.RETURN){this._handleButton(button);event.kill();}return true;}.bind(this));return this;},setStackable:function(stackable,shown){this._is_stackable=stackable;this._shown_while_stacked=stackable&&shown;return this;},setHandler:function(handler){this._handler=handler;return this;},setCancelHandler:function(cancelHandler){this._cancelHandler=Dialog.call_or_eval.bind(null,this,cancelHandler);return this;},setCloseHandler:function(close_handler){this._close_handler=Dialog.call_or_eval.bind(null,this,close_handler);return this;},clearHandler:function(){return this.setHandler(null);},setPostURI:function(post_uri,asynchronous){if(asynchronous===undefined)asynchronous=true;if(asynchronous){this.setHandler(this._submitForm.bind(this,'POST',post_uri));}else this.setHandler(function(){Form.post(post_uri,this.getFormData());this.hide();}.bind(this));return this;},setGetURI:function(get_uri){this.setHandler(this._submitForm.bind(this,'GET',get_uri));return this;},setModal:function(modal){this._modal=modal;CSS.conditionClass(this._obj,'generic_dialog_modal',modal);return this;},setSemiModal:function(clickout){if(clickout){this.setModal(true);this._semiModalListener=Event.listen(this._obj,'click',function(e){if(!DOM.contains(this._popup,e.getTarget()))this.hide();}.bind(this));}else this._semiModalListener&&this._semiModalListener.remove();this._semi_modal=clickout;return this;},setWideDialog:function(is_wide){this._wide_dialog=is_wide;this._updateWidth();return this;},setContentWidth:function(width){this._content_width=width;this._updateWidth();return this;},setTitleLoading:function(loading){if(loading===undefined)loading=true;var header=DOM.find(this._popup,'h2.dialog_title');if(header)CSS.conditionClass(header,'loading',loading);return this;},setSecure:function(is_secure){CSS.conditionClass(this._nodes.title,'secure',is_secure);return this;},setClassName:function(class_name){CSS.addClass(this._obj,class_name);return this;},setFadeEnabled:function(enabled){this._fade_enabled=enabled;return this;},setFooter:function(footer){var node=this._nodes.footer;DOM.setContent(node,this._format(footer||''));CSS.conditionShow(node,!!footer);return this;},setAutoFocus:function(focus){this._auto_focus=focus;return this;},setTop:function(top){this._top=top;this._resetDialogObj();return this;},onloadRegister:function(handler){ArrayUtils.createFrom(handler).forEach(function(i){if(typeof i=='string')i=new Function(i);this._onload_handlers.push(i.bind(this));}.bind(this));return this;},setAsyncURL:function(url){return this.setAsync(new AsyncRequest(url));},setAsync:function(async_request,use_pipe){var handler=function(response){if(this._async_request!=async_request)return;this._async_request=null;var payload=response.getPayload(),dialog=payload,fn=function(){if(this._loading)this._showing=true;if(typeof dialog=='string'){this.setBody(dialog);}else this._setFromModel(dialog);this._update();}.bind(this);if(use_pipe){dialog=payload.dialog;Bootloader.setResourceMap(payload.resource_map);Bootloader.loadResources(payload.css,fn);}else fn();}.bind(this),data=async_request.getData();data.__d=1;async_request.setData(data);var request;if(use_pipe){async_request.setFirstResponseHandler(handler);request=async_request.getAsyncRequest();}else{var orig_handler=async_request.getHandler()||bagofholding;async_request.setHandler(function(response){orig_handler(response);handler(response);});request=async_request;}var orig_error_handler=request.getErrorHandler()||bagofholding,orig_trans_error_handler=request.getTransportErrorHandler()||bagofholding,handle_error=function(){this._async_request=null;if(this._showing){this._update();}else this._hide();}.bind(this),server_cancel_handler=request.getServerDialogCancelHandler()||handle_error;request.setAllowCrossPageTransition(this._cross_transition).setErrorHandler(function(response){handle_error();orig_error_handler(response);}).setTransportErrorHandler(function(response){handle_error();orig_trans_error_handler(response);}).setServerDialogCancelHandler(server_cancel_handler);async_request.send();this._async_request=async_request;this._update();return this;},_format:function(content){if(typeof content=='string'){content=HTML(content);}else content=HTML.replaceJSONWrapper(content);if(content instanceof HTML)content.setDeferred(true);return content;},_update:function(){if(!this._showing)return;if(this._autohide&&!this._async_request&&!this._autohide_timeout)this._autohide_timeout=setTimeout(bind(this,'hide'),this._autohide);if(this._async_request&&this._show_loading){this.showLoading();}else{CSS.removeClass(this._frame,'dialog_loading_shown');this._loading=false;this._renderDialog();this._runOnloads();this._previous_focus=document.activeElement;Input.focus(this._frame);}},_runOnloads:function(){for(var i=0;i<this._onload_handlers.length;++i)try{this._onload_handlers[i]();}catch(ex){}this._onload_handlers=[];},_updateWidth:function(){var dialog_width=2*Dialog._BORDER_WIDTH;if(Dialog._isUsingCSSBorders())dialog_width+=2*Dialog._HALO_WIDTH;if(this._content_width){dialog_width+=this._content_width;if(!this._full_bleed)dialog_width+=2*Dialog._PADDING_WIDTH;}else if(this._wide_dialog){dialog_width+=Dialog.SIZE.WIDE;}else dialog_width+=Dialog.SIZE.STANDARD;this._popup.style.width=dialog_width+'px';},_renderDialog:function(){this._showDialog();this._submit_on_enter=false;if(this._auto_focus){var input=Form.getFirstElement(this._content,['input[type="text"]','textarea','input[type="password"]']);if(input){Form.focusFirst.bind(this,this._content).defer();}else this._submit_on_enter=true;}var bottom=Vector.getElementDimensions(this._content).y+Vector.getElementPosition(this._content).y;Dialog._bottoms.push(bottom);this._bottom=bottom;Dialog._updateMaxBottom();return this;},_buildDialog:function(){this._obj=DOM.$N('div',{className:'generic_dialog',id:this._uniqueID});this._obj.style.display='none';document.body.appendChild(this._obj);if(!this._popup)this._popup=DOM.$N('div',{className:'generic_dialog_popup'});this._popup.style.left=this._popup.style.top='';this._obj.appendChild(this._popup);if(ua.ie()<7&&!this._shim)Bootloader.loadComponents('iframe-shim',function(){this._shim=new IframeShim(this._popup);});this._buildDialogContainer();this._buildDialogContent();},_showDialog:function(){if(!this._hasSetZIndex&&this._causal_elem){var z_index=getOverlayZIndex(this._causal_elem);this._hasSetZIndex=z_index>(this._modal?400:200);CSS.setStyle(this._obj,'z-index',this._hasSetZIndex?z_index:'');}this._pushOntoStack();this._obj.style.height=(this._modal&&ua.ie()<7)?Vector.getDocumentDimensions().y+'px':null;if(this._obj&&this._obj.style.display){this._obj.style.visibility='hidden';this._obj.style.display='';this.resetDialogPosition();this._obj.style.visibility='';this._obj.dialog=this;}else this.resetDialogPosition();clearInterval(this.active_hiding);this.active_hiding=setInterval(this._activeResize.bind(this),500);return this;},_updateShim:function(){return this._shim&&this._shim.show();},_activeResize:function(){if(this.last_offset_height!=this._content.offsetHeight){this.last_offset_height=this._content.offsetHeight;this.resetDialogPosition();}},_buildDialogContainer:function(){CSS.addClass(this._obj,'pop_dialog');if(Locale.isRTL())CSS.addClass(this._obj,'pop_dialog_rtl');var markup;if(Dialog._isUsingCSSBorders()){markup='<div class="pop_container_advanced">'+'<div class="pop_content" id="pop_content"></div>'+'</div>';}else markup='<div class="pop_container">'+'<div class="pop_verticalslab"></div>'+'<div class="pop_horizontalslab"></div>'+'<div class="pop_topleft"></div>'+'<div class="pop_topright"></div>'+'<div class="pop_bottomright"></div>'+'<div class="pop_bottomleft"></div>'+'<div class="pop_content pop_content_old" id="pop_content"></div>'+'</div>';DOM.setContent(this._popup,HTML(markup));var frame=DOM.find(this._popup,'div.pop_content');frame.setAttribute('tabIndex','0');frame.setAttribute('role','alertdialog');this._frame=this._content=frame;},_buildDialogContent:function(){var loading=DOM.$N('div',{className:'dialog_loading'},"\u52a0\u8f7d\u4e2d..."),title_inner=DOM.$N('span'),title=DOM.$N('h2',{className:'dialog_title hidden_elem',id:'title_'+this._uniqueID},title_inner),summary=DOM.$N('div',{className:'dialog_summary hidden_elem'}),body=DOM.$N('div',{className:'dialog_body'}),buttons=DOM.$N('div'),button_message=DOM.$N('div',{className:'dialog_buttons_msg'}),button_wrapper=DOM.$N('div',{className:'dialog_buttons clearfix hidden_elem'},[button_message,buttons]),footer=DOM.$N('div',{className:'dialog_footer hidden_elem'}),content=DOM.$N('div',{className:'dialog_content'},[summary,body,button_wrapper,footer]);this._nodes={summary:summary,body:body,buttons:buttons,button_message:button_message,button_wrapper:button_wrapper,footer:footer,content:content,title:title,title_inner:title_inner};DOM.setContent(this._frame,[title,content,loading]);},resetDialogPosition:function(){if(!this._popup)return;this._resetDialogObj();this._updateShim();},_resetDialogObj:function(){var total_margin=2*Dialog._PAGE_MARGIN,viewport_dimensions=Vector.getViewportDimensions(),viewport_width=viewport_dimensions.x-total_margin,viewport_height=viewport_dimensions.y-total_margin,total_halo_width=2*Dialog._HALO_WIDTH,content_dimensions=Vector.getElementDimensions(this._content),content_width=content_dimensions.x+total_halo_width,content_height=content_dimensions.y+total_halo_width,top=this._top,empty_horiz_space=viewport_width-content_width,empty_vertical_space=viewport_height-content_height;if(empty_vertical_space<0){top=Dialog._PAGE_MARGIN;}else if(top>empty_vertical_space)top=Dialog._PAGE_MARGIN+(Math.max(empty_vertical_space,0)/2);var is_fixed=_supportsPositionFixed();if(!is_fixed)top+=Vector.getScrollPosition().y;CSS.setStyle(this._popup,'top',top+'px');var scroll=is_fixed&&(empty_horiz_space<0||empty_vertical_space<0);CSS.conditionClass(this._obj,'generic_dialog_fixed_overflow',scroll);CSS.conditionClass(document.documentElement,'generic_dialog_overflow_mode',scroll);},_fadeOut:function(temporary){if(!this._popup)return;try{animation(this._obj).duration(0).checkpoint().to('opacity',0).hide().duration(250).ondone(this._hide.bind(this,temporary)).go();}catch(e){this._hide(temporary);}},_hide:function(temporary){if(this._obj)this._obj.style.display='none';CSS.removeClass(document.documentElement,'generic_dialog_overflow_mode');this._updateShim();clearInterval(this.active_hiding);if(this._bottom){var bs=Dialog._bottoms;bs.splice(bs.indexOf(this._bottom),1);Dialog._updateMaxBottom();}if(this._previous_focus&&document.activeElement&&DOM.contains(this._obj,document.activeElement))Input.focus(this._previous_focus);if(temporary)return;this.destroy();},destroy:function(){this._popFromStack();if(this._obj){DOM.remove(this._obj);this._obj=null;this._shim&&this._shim.hide();this._shim=null;}this._clickOnEnterListener&&this._clickOnEnterListener.remove();if(this._close_handler)this._close_handler({return_data:this._return_data});},_handleButton:function(button){if(typeof button=='string')button=Dialog._findButton(this._buttons,button);var value=Dialog.call_or_eval(button,button.handler);if(value===false)return;if(button.name=='cancel'){this.cancel();}else if(Dialog.call_or_eval(this,this._handler,{button:button})!==false)this.hide();},_submitForm:function(method,uri,button){var data=this.getFormData();if(button)data[button.name]=button.label;if(this._extra_data)copyProperties(data,this._extra_data);var async_request=new AsyncRequest().setURI(uri).setData(data).setMethod(method).setNectarModuleDataSafe(this._causal_elem).setReadOnly(method=='GET');this.setAsync(async_request);return false;},_setFromModel:function(original_model){var model={};copyProperties(model,original_model);for(var propertyName in model){if(propertyName=='onloadRegister'){this.onloadRegister(model[propertyName]);continue;}var mutator=this['set'+propertyName.substr(0,1).toUpperCase()+propertyName.substr(1)];mutator.apply(this,ArrayUtils.createFrom(model[propertyName]));}},_updateBottom:function(){var bottom=Vector.getElementDimensions(this._content).y+Vector.getElementPosition(this._content).y;Dialog._bottoms[Dialog._bottoms.length-1]=bottom;Dialog._updateMaxBottom();},_pushOntoStack:function(){var stack=Dialog._stack;if(!stack.length)Arbiter.inform('layer_shown',{type:'Dialog'});stack.remove(this);stack.push(this);for(var i=stack.length-2;i>=0;i--){var prev_dialog=stack[i];if(!prev_dialog._is_stackable&&!prev_dialog._async_request){prev_dialog._hide();}else if(!prev_dialog._shown_while_stacked)prev_dialog._hide(true);}},_popFromStack:function(){var stack=Dialog._stack,was_top=(stack[stack.length-1]===this);stack.remove(this);if(stack.length){if(was_top)stack[stack.length-1]._showDialog();}else Arbiter.inform('layer_hidden',{type:'Dialog'});}});module.exports=Dialog;});
__e("DOMScroll",["bootloader","css","Vector","dom","dom-core"],function(a,b,c,d,e,f){var g=b("bootloader"),h=b("css"),i=b("Vector"),j=b("dom").$N,k=b("dom-core").ge,l={getScrollState:function(){var m=i.getViewportDimensions(),n=i.getDocumentDimensions(),o=(n.x>m.x),p=(n.y>m.y);o+=0;p+=0;return new i(o,p);},_scrollbarSize:null,_initScrollbarSize:function(){var m=j('p');m.style.width='100%';m.style.height='200px';var n=j('div');n.style.position='absolute';n.style.top='0px';n.style.left='0px';n.style.visibility='hidden';n.style.width='200px';n.style.height='150px';n.style.overflow='hidden';n.appendChild(m);document.body.appendChild(n);var o=m.offsetWidth;n.style.overflow='scroll';var p=m.offsetWidth;if(o==p)p=n.clientWidth;document.body.removeChild(n);l._scrollbarSize=o-p;},getScrollbarSize:function(){if(l._scrollbarSize===null)l._initScrollbarSize();return l._scrollbarSize;},scrollTo:function(m,n,o,p,q){if(typeof n=='undefined'||n===true)n=750;if(!(m instanceof i)){var r=i.getScrollPosition().x,s=i.getElementPosition(k(m)).y;m=new i(r,s,'document');if(!p){var t=k('blueBar');if(t&&h.isFixed(t))m.y-=i.getElementDimensions(t).y/(o?2:1);}}if(o){m.y-=i.getViewportDimensions().y/2;}else if(p){m.y-=i.getViewportDimensions().y;m.y+=p;}m=m.convertTo('document');if(n){g.loadComponents('animation',function(){var u=document.body;animation(u).to('scrollTop',m.y).to('scrollLeft',m.x).ease(animation.ease.end).duration(n).ondone(q).go();});}else if(window.scrollTo){window.scrollTo(m.x,m.y);q&&q();}}};e.exports=l;});
__e("LinkController",["event-extensions","DataStore","Parent","trackReferrer"],function(a,b,c,d,e,f){b("event-extensions");var g=b("DataStore"),h=b("Parent"),i=b("trackReferrer"),j='LinkControllerHandler',k=[],l=[];function m(event){var q=h.byTag(event.getTarget(),'a'),r=q&&q.getAttribute('href',2);if(!r||q.rel||!o(r)||g.get(q,j))return;var s=Event.listen(q,'click',function(t){if(r.charAt(r.length-1)=='#'){t.prevent();return;}i(q,r);n(q,t);});g.set(q,j,s);}function n(q,event){if(q.target||event.getModifiers().any||(event.which&&event.which!=1))return;var r=k.concat(l);for(var s=0,t=r.length;s<t;s++)if(r[s](q,event)===false)return event.kill();}function o(q){var r=q.match(/^(\w+):/);return !r||r[1].match(/^http/i);}var p={registerHandler:function(q){k.push(q);},registerFallbackHandler:function(q){l.push(q);}};if(a.LinkController){e.exports=a.LinkController;}else{Event.listen(document.documentElement,'mousedown',m);Event.listen(document.documentElement,'keydown',m);e.exports=p;}});
__e("PageTransitions",["event-extensions","function-extensions","string-extensions","Arbiter","Dialog","dom","DOMScroll","Env","Form","HistoryManager","JSLogger","LinkController","ObjectUtils","ua","URI","Util","Vector","computeRelativeURI","copyProperties","dom-core","goOrReplace","userAction","tx"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");b("string-extensions");var g=b("Arbiter"),h=b("Dialog"),i=b("dom"),j=b("DOMScroll"),k=b("Env"),l=b("Form"),m=b("HistoryManager"),n=b("JSLogger"),o=b("LinkController"),p=b("ObjectUtils"),q=b("ua"),r=b("URI"),s=b("Util"),t=b("Vector"),u=b("computeRelativeURI"),v=b("copyProperties"),w=b("dom-core").ge,x=b("goOrReplace"),y=b("userAction");a.tx=b("tx");var z={_transition_handlers:[],_scroll_positions:{},_scroll_locked:false,isInitialized:function(){return !!z._initialized;},_init:function(){if(!k.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(z._initialized)return z;z._initialized=true;var ba=r.getRequestURI(false),ca=ba.getUnqualifiedURI(),da=r(ca).setFragment(null),ea=ca.getFragment();if(ea.charAt(0)==='!'&&da.toString()===ea.substr(1))ca=da;v(z,{_current_uri:ca,_most_recent_uri:ca,_next_uri:ca});var fa;if(ba.getFragment().startsWith('default.htm')){fa=ba.getFragment();}else fa=ca;m.init().setCanonicalLocation('#'+fa).registerURIHandler(z._historyManagerHandler);o.registerFallbackHandler(z._rewriteHref);o.registerFallbackHandler(z._onlinkclick);Event.listen(document.documentElement,'submit',z._onformsubmit);Event.listen(window,'scroll',function(){if(!z._scroll_locked)z._scroll_positions[z._current_uri]=t.getScrollPosition();});return z;},registerHandler:function(ba,ca){z._init();ca=ca||5;if(!z._transition_handlers[ca])z._transition_handlers[ca]=[];z._transition_handlers[ca].push(ba);},getCurrentURI:function(ba){if(!z._current_uri&&!ba)return new r(z._most_recent_uri);return new r(z._current_uri);},getMostRecentURI:function(){return new r(z._most_recent_uri);},getNextURI:function(){return new r(z._next_uri);},_rewriteHref:function(ba){var ca=ba.getAttribute('href'),da=u(z._most_recent_uri.getQualifiedURI(),ca).toString();if(ca!=da)ba.setAttribute('href',da);},_onlinkclick:function(ba){aa.lookBusy(ba);z.go(ba.getAttribute('href'));return false;},_onformsubmit:function(event){var ba=event.getTarget();if(l.getAttribute(ba,'rel')||l.getAttribute(ba,'target'))return;var ca=y('form',ba,event).set_namespace('page_transition');if(window.ArbiterMonitor)ArbiterMonitor.initUA(ca,[ba]);var da=new r(l.getAttribute(ba,'action')||''),ea=u(z._most_recent_uri,da);ba.setAttribute('action',ea.toString());if((l.getAttribute(ba,'method')||'GET').toUpperCase()==='GET'){z.go(ea.addQueryData(l.serialize(ba)));event.kill();}},go:function(ba,ca){var da=new r(ba).removeQueryData('quickling').getQualifiedURI(),ea=da.getUnqualifiedURI();delete z._scroll_positions[ea];!ca&&y('uri',{href:da.toString()},null,'INDIRECT');aa.lookBusy();z._loadPage(da,function(fa){if(fa){m.go(da.toString(),false,ca);}else x(window.location,da,ca);});},_historyManagerHandler:function(ba){if(ba.charAt(0)!='default.htm')return false;y('h',{href:ba},null);z._loadPage(new r(ba),function(ca){if(!ca)x(window.location,ba,true);});return true;},_loadPage:function(ba,ca){if(r(ba).getFragment()&&p.areEqual(r(ba).setFragment(null).getQualifiedURI(),r(z._current_uri).setFragment(null).getQualifiedURI())){z._current_uri=z._most_recent_uri=ba;z.restoreScrollPosition();aa.stopLookingBusy();return;}var da=z._scroll_positions[z._current_uri];z._current_uri=null;z._next_uri=ba;if(da)j.scrollTo(da,false);var ea=function(){z._scroll_locked=true;var ga=z._handleTransition(ba);ca&&ca(ga);},fa=_runHooks('onbeforeleavehooks');if(fa){aa.stopLookingBusy();z._warnBeforeLeaving(fa,ea);}else ea();},_handleTransition:function(ba){window.onbeforeleavehooks=undefined;aa.lookBusy();if(!ba.isSameOrigin())return false;var ca=window.AsyncRequest&&window.AsyncRequest.getLastId();g.inform("pre_page_transition",{from:z.getMostRecentURI(),to:ba});for(var da=z._transition_handlers.length-1;da>=0;--da){var ea=z._transition_handlers[da];if(!ea)continue;for(var fa=ea.length-1;fa>=0;--fa)if(ea[fa](ba)===true){var ga={sender:this,uri:ba,id:ca};try{g.inform("page_transition",ga);}catch(ha){}return true;}else ea.splice(fa,1);}return false;},unifyURI:function(){z._current_uri=z._most_recent_uri=z._next_uri;},transitionComplete:function(ba){z._executeCompletionCallback();aa.stopLookingBusy();z.unifyURI();if(!ba)z.restoreScrollPosition();try{if(document.activeElement&&document.activeElement.nodeName==='A')document.activeElement.blur();}catch(ca){}},_executeCompletionCallback:function(){if(z._completionCallback)z._completionCallback();z._completionCallback=null;},setCompletionCallback:function(ba){z._completionCallback=ba;},rewriteCurrentURI:function(ba,ca){z.registerHandler(function(){if(ba==z.getMostRecentURI().getUnqualifiedURI().toString()){z.transitionComplete();return true;}});z.go(ca,true);},_warnBeforeLeaving:function(ba,ca){new h().setTitle("\u4f60\u786e\u5b9a\u60f3\u8981\u79bb\u5f00\u8fd9\u4e2a\u9875\u9762\u5417\uff1f").setBody(htmlize(ba)).setButtons([{name:'leave_page',label:"\u79bb\u5f00\u6b64\u9875",handler:ca},{name:'continue_editing',label:"\u7559\u5728\u6b64\u9875",className:'inputaux'}]).setModal(true).show();},restoreScrollPosition:function(){z._scroll_locked=false;var ba=z._current_uri,ca=z._scroll_positions[ba];if(ca){j.scrollTo(ca,false);return;}function da(ga){return (ga||null)&&(i.scry(document.body,"a[name='"+escape_js_quotes(ga)+"']")[0]||w(ga));}var ea=da(r(ba).getFragment());if(ea){var fa=t.getElementPosition(ea);fa.x=0;j.scrollTo(fa);}}},aa=window._BusyUIManager||{_looking_busy:false,_original_cursors:[],lookBusy:function(ba){if(ba)aa._giveProgressCursor(ba);if(aa._looking_busy)return;aa._looking_busy=true;aa._giveProgressCursor(document.documentElement);},stopLookingBusy:function(){if(!aa._looking_busy)return;aa._looking_busy=false;while(aa._original_cursors.length){var ba=aa._original_cursors.pop(),ca=ba[0],da=ba[1];if(ca.style)ca.style.cursor=da||'';}},_giveProgressCursor:function(ba){if(!q.safari()){aa._original_cursors.push([ba,ba.style.cursor]);ba.style.cursor='progress';}}};e.exports=z;});
__e("legacy:page-transitions",["goOrReplace","computeRelativeURI","HistoryManager","PageTransitions"],function(a,b,c,d){a.go_or_replace=b('goOrReplace');a.computeRelativeURI=b('computeRelativeURI');a.HistoryManager=a.HistoryManager||b('HistoryManager');a.PageTransitions=a.PageTransitions||b('PageTransitions');},3);
__e("NavigationMessage",[],function(a,b,c,d,e,f){var g={NAVIGATION_BEGIN:'NavigationMessage/navigationBegin',NAVIGATION_SELECT:'NavigationMessage/navigationSelect',NAVIGATION_FIRST_RESPONSE:'NavigationMessage/navigationFirstResponse',NAVIGATION_COMPLETED:'NavigationMessage/navigationCompleted',NAVIGATION_FAILED:'NavigationMessage/navigationFailed',NAVIGATION_COUNT_UPDATE:'NavigationMessage/navigationCount',NAVIGATION_FAVORITE_UPDATE:'NavigationMessage/navigationFavoriteUpdate',NAVIGATION_ITEM_REMOVED:'NavigationMessage/navigationItemRemoved',NAVIGATION_ITEM_HIDDEN:'NavigationMessage/navigationItemHidden',INTERNAL_LOADING_BEGIN:'NavigationMessage/internalLoadingBegin',INTERNAL_LOADING_COMPLETED:'NavigationMessage/internalLoadingCompleted'};e.exports=g;});
__e("legacy:ui-side-nav-message",["NavigationMessage"],function(a,b,c,d){a.NavigationMessage=b('NavigationMessage');},3);
function AsyncLayout(){}AsyncLayout.prototype={init:function(a){this.canvas_id=a;if(ge('rightCol'))this.auxiliary_id='rightCol';if(ge('headerArea'))this.header_id='headerArea';if(ge('toolbarContainer'))this.toolbar_id='toolbarContainer';this.waitingForAux=false;PageTransitions.registerHandler(this.catchPageTransition.bind(this));this.subscription=Arbiter.subscribe(NavigationMessage.NAVIGATION_BEGIN,this.onNavigate.bind(this));return this;},catchPageTransition:function(a){Arbiter.unsubscribe(this.subscription);return false;},getCanvasID:function(a){return this.customCanvasID?this.customCanvasID:(a.sidecol?'contentCol':'contentArea');},onNavigate:function(a,b){var c=b.useAjaxPipe;b=b.params;if(b.endpoint){if(this.request){this.request.setFinallyHandler(bagofholding);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(c){this.request=new AjaxPipeRequest().setURI(b.endpoint).setData(b).setCanvasId(this.getCanvasID(b)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{b.handled=true;this.waitingForAux=b.sidecol;var d=!!b.iframe,e=new AsyncRequest().setOption('useIframeTransport',d).setURI(new URI(b.endpoint)).setReadOnly(true).setMethod('GET').setData(b).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=e;e.send();}}},onSideResponse:function(a){var b=a.getPayload();if(b&&this.auxiliary_id)this.receivedAux(b);},receivedAux:function(a){!this.waitingForAux;this.waitingForAux=false;DOM.setContent($(this.auxiliary_id),HTML(a));},onResponse:function(a){var b=a.getPayload();if(b.redirect){goURI(b.redirect);}else{var c=b.html||b;DOM.setContent($(this.canvas_id),HTML(c));if(b.side_html&&this.auxiliary_id)this.receivedAux(b.side_html);if(this.header_id&&!b.keep_header){var d=$(this.header_id);DOM.setContent(d,HTML(b.header_html||''));CSS.conditionShow(d,b.header_html);}if(b.toolbar_html&&this.toolbar_id)DOM.setContent($(this.toolbar_id),HTML(b.toolbar_html));if(b.js)(new Function(b.js))();CSS.conditionClass('contentCol','hasRightCol',this.auxiliary_id&&!b.noRightSide);var e=ge('rightCol');if(e&&b.noRightSide)DOM.empty(e);}var f=a.getRequest().getData();Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED,f.key);},errorHandler:function(a){AsyncResponse.verboseErrorHandler(a);Arbiter.inform(NavigationMessage.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(a){window.scrollTo(0,0);Arbiter.inform(NavigationMessage.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(a){this.request=null;PageTransitions.transitionComplete(true);Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED);}};
__e("legacy:vector",["Vector"],function(a,b,c,d){a.Vector2=b('Vector');},3);
function FutureSideNav(){FutureSideNav.instance&&FutureSideNav.instance.uninstall();FutureSideNav.instance=this;}FutureSideNav.instance=null;FutureSideNav.getInstance=function(){return FutureSideNav.instance||new FutureSideNav();};FutureSideNav.prototype={init:function(a,b,c){this.root=a;this.items={};this.sections={};this.editor=null;this.editing=false;this.selected=null;this.loading=null;this.keyParam='sk';this.defaultKey=b;this.uri=URI.getRequestURI();this.ajaxPipe=c;this.ajaxPipeEndpoints={};this.sidecol=true;this._installed=true;this._handlePageTransitions=true;PageTransitions.registerHandler(function(d){return this._handlePageTransitions&&this.handlePageTransition(d);}.bind(this));this._eventHandlers=[];this._arbiterSubscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_COMPLETED,this.navigationComplete.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAILED,this.navigationFailed.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_COUNT_UPDATE,this.navigationCountUpdate.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_SELECT,this.navigationSelect.bind(this)),Arbiter.subscribe(PresenceMessage.getArbiterMessageType('nav_update_counts'),this.navigationCountUpdateFromPresence.bind(this))];this._explicitHover=[];this._ensureHover('sideNavItem');this._eventHandlers.push(Event.listen(window,'resize',this._handleResize.bind(this)));this._checkNarrow();this._selectorSubscriptions=[];window.Selector&&this._selectorSubscriptions.push(Selector.subscribe(['open','close'],function(d,e){var f=Parent.byClass(e.selector,'sideNavItem');f&&CSS.conditionClass(f,'editMenuOpened',d==='open');}));onleaveRegister(this.uninstall.bind(this));},_handleResize:(function(){var a;return function(){a&&clearTimeout(a);a=this._checkNarrow.bind(this).defer(200);};})(),_checkNarrow:function(){CSS.conditionClass(this.root,'uiNarrowSideNav',Vector2.getElementPosition(this.root).x<20);},_ensureHover:function(a){if(ua.ie()<8)Bootloader.loadComponents('explicit-hover',function(){this._explicitHover.push(new ExplicitHover(this.root,a));}.bind(this));},uninstall:function(){if(this._installed){this._installed=false;this._handlePageTransitions=false;this._arbiterSubscriptions.forEach(Arbiter.unsubscribe);this._selectorSubscriptions.forEach(Selector.unsubscribe.bind(Selector));this._eventHandlers.forEach(function(a){a.remove();});this._explicitHover.forEach(function(a){a.uninstall();});}},initSection:function(a,b){this._initItems(b);this._initSection(a);},addItem:function(a,b){this._initItem(a,b);},_initItems:function(a){var b=function(c,d){var e=this._initItem(c,d);$(c.children).forEach(function(f){b(f,e);});}.bind(this);$A(a).forEach(function(c){b(c,null);});},_initItem:function(a,b){var c=this.items[a.id]=this._constructItem(a,b);if(c.equals(this.selected)||a.selected)this.setSelected(c);var d=c.getLinkNode();d&&this._eventHandlers.push(Event.listen(d,'click',function(event){return !this.editing;}.bind(this)));return c;},_initSection:function(a){var b=this.sections[a.id]=this._constructSection(a);this._eventHandlers.push(Event.listen(b.node,'click',this.handleSectionClick.bind(this,b)));DOM.scry(b.node,'div.bookmarksMenuButton').forEach(CSS.show);return b;},_constructItem:function(a,b){return new FutureSideNavItem(a,b);},_constructSection:function(a){return new FutureSideNavSection(a);},handleSectionClick:function(a,event){var b=this._getEventTarget(event,'a'),c=this._getItemForNode(b);if(!b){return;}else if(CSS.hasClass(b.parentNode,'uiMenuItem')){this._handleMenuClick(a,c,b.parentNode,event);}else this._handleLinkClick(a,b,event);},_getEventTarget:function(event,a){var b=event.getTarget();if(b.tagName!==a.toUpperCase()){return Parent.byTag(b,a);}else return b;},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'rearrange'))this.beginEdit(a);},_handleLinkClick:function(a,b,event){if(CSS.hasClass(b,'navEditDone')){this.editing?this.endEdit():this.beginEdit(a);event.kill();}},getItem:function(a){if(this._isCurrentPath(a)){return this._getItemForKey(this._getKey(a.getQueryData())||this.defaultKey);}else return this._getItemForPath(a.getPath());},getNodeForKey:function(a){var b=this._getItemForKey(a);if(b)return b.node;},_isCurrentPath:function(a){return a.getDomain()===this.uri.getDomain()&&a.getPath()===this.uri.getPath();},_getKey:function(a){return a[this.keyParam];},_getItemForNode:function(a){a=Parent.byClass(a,'sideNavItem');return a&&this.items[a.id];},_getItemForKey:function(a){return this._findItem(function(b){return b.matchKey(a);});},_getItemForPath:function(a){return this._findItem(function(b){return b.matchPath(a);});},_findItem:function(a){for(var b in this.items)if(a(this.items[b]))return this.items[b];},removeItem:function(a){if(a&&this.items[a.id]){DOM.remove(a.node);delete this.items[a.id];}},removeItemByKey:function(a){this.removeItem(this._getItemForKey(a));},moveItem:function(a,b,c){var d=DOM.find(a.node,'ul.uiSideNav');(c?DOM.prependContent:DOM.appendContent)(d,b.node);},setLoading:function(a){this.loading&&this.loading.hideLoading();this.loading=a;this.loading&&this.loading.showLoading();},setSelected:function(a){this.setLoading(null);if(this.selected){this.selected.hideSelected();this.selected.getTop().hideChildren();}this.selected=a;if(this.selected){this.selected.showSelected();this.selected.getTop().showChildren();}},handlePageTransition:function(a){var b=this.getItem(a),c=b&&b.endpoint&&this._doPageTransition(b,a);return c;},_doPageTransition:function(a,b){this.setLoading(a);this._sendPageTransition(a.endpoint,copy_properties(this._getTransitionData(a,b),b.getQueryData()));return true;},_sendPageTransition:function(a,b){b.endpoint=a;Arbiter.inform(NavigationMessage.NAVIGATION_BEGIN,{useAjaxPipe:this._useAjaxPipe(a),params:b});},_getTransitionData:function(a,b){var c={};c.sidecol=this.sidecol;c.path=b.getPath();c[this.keyParam]=a.textKey;c.key=a.textKey;return c;},_useAjaxPipe:function(a){return this.ajaxPipe||this.ajaxPipeEndpoints[a];},navigationComplete:function(){this.loading&&this.setSelected(this.loading);},navigationFailed:function(){this.setLoading(null);},navigationSelect:function(a,b){var c=this._getItemForKey(this._getKey(b));if(b.asLoading){this.setLoading(c);}else this.setSelected(c);},navigationCountUpdate:function(a,b){var c=this._getItemForKey(b&&b.key);if(c)if(typeof b.count!=="undefined"){c.setCount(b.count,b.hide);}else if(typeof b.increment!=="undefined")c.incrementCount(b.increment,b.hide);},navigationCountUpdateFromPresence:function(a,b){b=b.obj;if(b)if(!b.class_name||b.class_name&&CSS.hasClass(this.root,b.class_name))if(b.items)for(var c=0;c<b.items.length;c++)this.navigationCountUpdate(a,b.items[c]);},beginEdit:function(a){if(!this.editing){this.editing=true;CSS.addClass(this.root,'editMode');this._updateTrackingData();Bootloader.loadComponents('sortable-side-nav-js',this._initEditor.bind(this,a));}},endEdit:function(){if(this.editing){CSS.removeClass(this.root,'editMode');this.editor.endEdit();this.editor=null;this.editing=false;this._updateTrackingData();}},_updateTrackingData:function(a){var b=this.root.getAttribute('data-gt')||"{}";try{b=JSON.parse(b);if(this.editing){b.editing=true;}else delete b.editing;this.root.setAttribute('data-gt',JSON.stringify(b));}catch(c){}},_initEditor:function(a){this.editor=a.getEditor();this.editor.beginEdit();}};function FutureSideNavSection(a){this.id=a.id;this.node=this.node||$(a.id);this.editEndpoint=a.editEndpoint;}FutureSideNavSection.prototype={equals:function(a){return a&&a.id===this.id;},getEditor:function(){return new SortableSideNav(DOM.find(this.node,'ul.uiSideNav'),this.editEndpoint);}};function FutureSideNavItem(a,b){this.id=a.id;this.up=b;this.endpoint=a.endpoint;this.type=a.type;this.node=a.node||$(a.id);this.paths=a.path?$A(a.path):[];this.keys=a.key?$A(a.key):[];var c=this._findKeys(this.keys);this.numericKey=c.numeric||this.keys[0];this.textKey=c.text||this.keys[0];this._pathPattern=this._buildRegex(this.paths);this._keyPattern=this._buildRegex(this.keys);this.hideLoading();this.hideSelected();}FutureSideNavItem.prototype={equals:function(a){return a&&a.id===this.id;},getLinkNode:function(){return (DOM.scry(this.node,'a.item')[0]||DOM.scry(this.node,'a.subitem')[0]);},matchPath:function(a){return this._matchInput(this._pathPattern,a);},matchKey:function(a){return this._matchInput(this._keyPattern,a);},_matchInput:function(a,b){var c=a&&a.exec(b);return c&&c.slice(1);},getTop:function(){return this.isTop()?this:this.up.getTop();},isTop:function(a){return !this.up;},setCount:function(a,b){return this._updateCount(a,true);},incrementCount:function(a,b){return this._updateCount(a,false);},_updateCount:function(a,b,c){var d=DOM.scry(this.node,'span.count')[0],e=d&&DOM.scry(d,'span.countValue')[0];if(e){var f=b?0:parseInt(DOM.getText(e),10),g=Math.max(0,f+a),h=this.isTop()?'hidden':'hiddenSubitem';DOM.setContent(e,g);c&&CSS.conditionClass(this.node,h,!g);CSS.conditionClass(d,'hidden_elem',!g);if(this.isTop()){var i=DOM.scry(this.node,'div.linkWrap')[0];if(i){CSS.conditionClass(i,'noCount',!g);CSS.conditionClass(i,'hasCount',g);}}}Arbiter.inform('NavigationMessage.COUNT_UPDATE_DONE');},showLoading:function(){CSS.addClass(this.node,'loading');},hideLoading:function(){CSS.removeClass(this.node,'loading');},showSelected:function(){CSS.addClass(this.node,'selectedItem');CSS.hasClass(this.node,'hider')&&CSS.addClass(this._getExpanderParent(),'expandedMode');},hideSelected:function(){CSS.removeClass(this.node,'selectedItem');},showChildren:function(){CSS.addClass(this.node,'open');},hideChildren:function(){CSS.removeClass(this.node,'open');},_getExpanderParent:function(){return Parent.byClass(this.node,'expandableSideNav');},_buildRegex:function(a){if(a.length){var b=a.map(function(c){if(typeof c==="string"){return c.replace(/([^a-z0-9_])/ig,'\\$1');}else if(c&&c.regex)return c.regex;});return new RegExp('^(?:'+b.join('|')+')$');}},_findKeys:function(a){var b=/^(app|group|fl)_/,c={};for(var d=0;d<a.length;d++){var e=b.test(a[d]);if(e&&!c.numeric){c.numeric=a[d];}else if(!e&&!c.text)c.text=a[d];if(c.numeric&&c.text)break;}return c;}};
function FutureProfileSideNav(){this.parent.construct(this);}Class.extend(FutureProfileSideNav,'FutureSideNav');FutureProfileSideNav.prototype={init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.altKeyParam='v';this.sidecol=false;},_constructItem:function(a,b){return new FutureProfileSideNavItem(a,b);},_doPageTransition:function(a,b){if(!this._profileChanged(b)&&!this._scopeChanged(a))return this.parent._doPageTransition(a,b);},_profileChanged:function(a){var b=a.getQueryData(),c=this.uri.getQueryData();return (b.id!==c.id||b.viewas!==c.viewas||b.and!==c.and);},_scopeChanged:function(a){return (!this.selected||a.layoutType!==this.selected.layoutType);},_getKey:function(a){return this.parent._getKey(a)||a[this.altKeyParam];}};function FutureProfileSideNavItem(a,b){this.parent.construct(this,a,b);this.layoutType=a.layouttype;}Class.extend(FutureProfileSideNavItem,'FutureSideNavItem');
function useFacebookReferer(a,b,c){var d=false;function e(){if(d)return;d=true;a.contentWindow.document.body.style.margin=0;b();}var f=(URI().isSecure()?'../https@s-static.ak.facebook.com/':'../static.ak.facebook.com/')+'/common/referer_frame.php';if(c)f+='@fb_source='+c;Event.listen(a,'load',e);a.src=f;}function useFacebookRefererHtml(a,b,c){useFacebookReferer(a,function(){a.contentWindow.document.body.innerHTML=b;},c);}
__e("StringEscape",[],function(a,b,c,d,e,f){var g={escapeJSQuotes:function(h){if(typeof h=='undefined'||h==null||!h.valueOf())return '';return h.toString().replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/"/g,'\\x22').replace(/'/g,'\\\'').replace(/</g,'\\x3c').replace(/>/g,'\\x3e').replace(/&/g,'\\x26');},htmlSpecialChars:function(h){if(typeof h=='undefined'||h===null||!h.toString)return '';if(h===false){return '0';}else if(h===true)return '1';return h.toString().replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#039;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},htmlize:function(h){return g.htmlSpecialChars(h).replace(/\r\n|[\r\n]/g,'<br />');}};e.exports=g;});
__e("legacy:string-escape",["StringEscape"],function(a,b,c,d){var e=b('StringEscape');a.escape_js_quotes=e.escapeJSQuotes;a.htmlspecialchars=e.htmlSpecialChars;a.htmlize=e.htmlize;},3);
if(typeof deconcept=="undefined")var deconcept={};if(typeof deconcept.util=="undefined")deconcept.util={};if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil={};deconcept.SWFObject=function(a,b,c,d,e,f,g,h,i,j){if(!document.getElementById)return;this.DETECT_KEY=j?j:'detectflash';this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(a)this.setAttribute('swf',a);if(b)this.setAttribute('id',b);if(c)this.setAttribute('width',c);if(d)this.setAttribute('height',d);this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(e){if(!(e instanceof Array))e=[e];var k;e.each(function(n){k=new deconcept.PlayerVersion(n.toString().split('.'));if(k.major==this.installedVer.major){this.setAttribute('version',k);return;}else if(!this.getAttribute('version')||k.major<this.getAttribute('version').major)this.setAttribute('version',k);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}if(f)this.addParam('bgcolor',f);var l=g?g:'high';this.addParam('quality',l);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var m=(h)?h:window.location;this.setAttribute('xiRedirectUrl',m);this.setAttribute('redirectUrl','');if(i)this.setAttribute('redirectUrl',i);this.setAttribute('useIframe',false);};deconcept.SWFObject.ieWorkaroundApplied=false;deconcept.SWFObject.ensureIEWorkaroundAttached=function(){if(!deconcept.SWFObject.ieWorkaroundApplied&&document.attachEvent){deconcept.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',deconcept.SWFObject.onDocumentPropertyChange);}};deconcept.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var a=document.title;if(a!=null&&a.indexOf('#!')!=-1){a=a.substring(0,a.indexOf('#!'));document.title=a;}}};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"swf/expressinstall.swf":a;this.setAttribute('useExpressInstall',true);},setAttribute:function(a,b){this.attributes[a]=b;},getAttribute:function(a){return this.attributes[a]||"";},addParam:function(a,b){this.params[a]=b;},getParams:function(){return this.params;},addVariable:function(a,b){this.variables[a]=b;},getVariable:function(a){return this.variables[a]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var a=[],b,c=this.getVariables();for(b in c)a[a.length]=b+"="+c[b];return a.join('&');},getSWFHTML:function(){var a,b,c;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}b={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var d=this.getParams();for(var e in d)b[e]=d[e];c=this.getVariablePairs();if(c)b.flashvars=c;a=render_tag_as_htmlstring('embed',b,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}b={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var f=render_tag_as_htmlstring('param',{name:'movie',value:this.getAttribute('swf')},null),d=this.getParams();for(var e in d)f+=render_tag_as_htmlstring('param',{name:e,value:d[e]},null);c=this.getVariablePairs();if(c)f+=render_tag_as_htmlstring('param',{name:'flashvars',value:c},null);a=render_tag_as_htmlstring('object',b,f);}return a;},write:function(a){if(this.getAttribute('useExpressInstall')){var b=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(b)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var c=(typeof a=='string')?document.getElementById(a):a;if(!c)return false;CSS.addClass(c,'swfObject');c.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){deconcept.SWFObject.ensureIEWorkaroundAttached();c.innerHTML=this.getSWFHTML();}else this._createIframe(c);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));need_version=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').rev;have_version=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.rev;this.fallback_js_fcn(have_version,need_version);c.innerHTML=this.fallback_html;}return false;},_createIframe:function(a){var b=$N('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});DOM.empty(a);a.appendChild(b);useFacebookRefererHtml.bind(null,b,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var a=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){for(var b=0;b<navigator.plugins.length;b++)try{var d=navigator.plugins[b];if(d.name=='Shockwave Flash'){PlayerVersion_tmp=new deconcept.PlayerVersion(d.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof a=='undefined'||PlayerVersion_tmp.major>a.major||(PlayerVersion_tmp.major==a.major&&(PlayerVersion_tmp.minor>a.minor||(PlayerVersion_tmp.minor==a.minor&&PlayerVersion_tmp.rev>a.rev))))a=PlayerVersion_tmp;}}catch(c){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var e=1,f=3;while(e)try{f++;e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+f);a=new deconcept.PlayerVersion([f,0,0]);}catch(g){e=null;}}else{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(h){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");a=new deconcept.PlayerVersion([6,0,21]);e.AllowScriptAccess="always";}catch(i){if(a.major==6)return a;}try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(j){}}if(e!=null)a=new deconcept.PlayerVersion(e.GetVariable("$version").split(" ")[1].split(","));}return a;};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major)return false;if(this.major>a.major)return true;if(this.minor<a.minor)return false;if(this.minor>a.minor)return true;if(this.rev<a.rev)return false;return true;};deconcept.util={getRequestParameter:function(a){var b=document.location.search||document.location.hash;if(a==null)return b;if(b){var c=b.substring(1).split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return c[d].substring((c[d].indexOf("=")+1));}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var a=document.getElementsByTagName("OBJECT");for(var b=a.length-1;b>=0;b--){a[b].style.display='none';for(var c in a[b])if(typeof a[b][c]=='function')a[b][c]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(a){return document.all[a];};var getQueryParamValue=deconcept.util.getRequestParameter,FlashObject=deconcept.SWFObject,SWFObject=deconcept.SWFObject;function spawn_flash_update_dialog(){new AsyncRequest().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();}function setFlashFallback(a,b){var c=ge(a),d=deconcept.SWFObjectUtil.getPlayerVersion(),e;b.each(function(h){h=new deconcept.PlayerVersion(h.toString().split('.'));if(h.major==d.major){e=h;return;}else if(typeof e=='undefined'||h.major<e.major)e=h;}.bind(this));if(c&&d.major>0){var f=d.major+'.'+d.minor+'.'+d.rev,g=e.major+'.'+e.minor+'.'+e.rev;c.innerHTML=tx._("\u9700\u8981\u7528 Flash {required-version} \u64ad\u653e\u5668\u67e5\u770b\u6b64\u5185\u5bb9\u3002\u4f60\u5f53\u524d\u7684\u7248\u672c\u662f {current-version}\u3002\u8bf7\u4e0b\u8f7d\u6700\u65b0\u7248\u7684 Flash \u64ad\u653e\u5668\u3002",{'required-version':g,'current-version':f});}}function showFlashErrorDialog(a,b){Bootloader.loadComponents('error-dialog',function(){ErrorDialog.show(a,b);});}function render_tag_as_htmlstring(a,b,c){var d=/^[A-Za-z0-9\-]+$/;if(!a.match(d))throw new Error('Invalid tag '+a);var e='<'+a;for(var f in b){if(!f.match(d))throw new Error('Invalid attr '+f);e+=' '+f+'="'+htmlspecialchars(b[f])+'"';}if(c===null){return e+'/>';}else return e+'>'+c+'</'+a+'>';}
function Flash(){}copy_properties(Flash,{INIT:'flash/init',READY:'flash/ready',FAILED:'flash/failed'});
__e("ContextualThing",["dom"],function(a,b,c,d,e,f){var g=b("dom"),h=[],i={register:function(j,k){i.remove(j);h.push({node:j,context:k});},remove:function(j){for(var k=0;k<h.length;k++)if(h[k].node===j){h.splice(k,1);k--;}},getContext:function(j){var k=null;h.forEach(function(l){if(g.contains(l.node,j))k=l.context;});return k;},containsIncludingLayers:function(j,k){while(k){if(g.contains(j,k))return true;k=i.getContext(k);}return false;}};e.exports=i;});
__e("BehaviorsMixin",[],function(a,b,c,d,e,f){function g(k){this._behavior=k;this._enabled=false;}g.prototype={enable:function(){if(!this._enabled){this._enabled=true;this._behavior.enable();}},disable:function(){if(this._enabled){this._enabled=false;this._behavior.disable();}}};var h=0;function i(k){if(!k.__BEHAVIOR_ID)k.__BEHAVIOR_ID=h++;return k.__BEHAVIOR_ID;}var j={_initBehaviors:function(){if(!this._behaviors)this._behaviors={};},enableBehaviors:function(k){this._initBehaviors();for(var l=0;l<k.length;l++){var m=i(k[l]);if(!this._behaviors[m]){var n=new k[l](this);if(n)this._behaviors[m]=new g(n);}this._behaviors[m].enable();}return this;},disableBehaviors:function(k){this._initBehaviors();for(var l=0;l<k.length;l++){var m=i(k[l]);if(this._behaviors[m])this._behaviors[m].disable();}return this;},disableAllBehaviors:function(){this._initBehaviors();for(var k in this._behaviors)this._behaviors[k].disable();this._behaviors={};}};e.exports=j;});
__e("Layer",["function-extensions","animation","Arbiter","BehaviorsMixin","Class","css-core","DataStore","dom","HTML","getOverlayZIndex"],function(a,b,c,d,e,f){b("function-extensions");var g=b("animation"),h=b("Arbiter"),i=b("BehaviorsMixin"),j=b("Class"),k=b("css-core"),l=b("DataStore"),m=b("dom"),n=b("HTML"),o=b("getOverlayZIndex");function p(){}Function.mixin(p,'Arbiter');j.mixin(p,'Arbiter',i,{_root:null,_shown:false,_fadeOnShow:false,_fadeOnHide:false,_destroyOnHide:false,init:function(q){if(q){var r=m.isNode(q),s=typeof q==='string'||n.isHTML(q);if(s)q=n(q).getRootNode();}this._root=this._buildWrapper(q);l.set(this._root,'layer',this);return this;},getInsertParent:function(){return this._insertParent||m.getDocumentBodyElement();},getRoot:function(){return this._root;},_buildWrapper:function(q){return q;},setFadeOnShow:function(q){this._fadeOnShow=q;return this;},setFadeOnHide:function(q){this._fadeOnHide=q;return this;},setDestroyOnHide:function(q){this._destroyOnHide=q;return this;},setInsertParent:function(q){if(q){if(this._shown&&q!==this.getInsertParent()){m.appendContent(q,this._root);this.updatePosition();}this._insertParent=q;}return this;},show:function(){if(this._shown)return this;if(this._fadeOnShow)k.setStyle(this._root,'opacity',0);k.setStyle(this._root,'visibility','hidden');k.show(this._root);m.appendContent(this.getInsertParent(),this._root);if(this.updatePosition()!==false){this._shown=true;this.inform('show');p.inform('show',this);if(this._fadeOnShow)g(this._root).from('opacity',0).to('opacity',1).duration(100).ondone(k.setStyle.curry(this._root,'opacity','')).go();}else m.remove(this._root);k.setStyle(this._root,'visibility','');return this;},hide:function(){if(!this._shown||this.inform('beforehide')===false)return this;if(this._fadeOnHide){g(this._root).from('opacity',1).to('opacity',0).duration(250).ondone(this._finishHide.bind(this)).go();}else this._finishHide();return this;},_finishHide:function(){this._shown=false;m.remove(this._root);this.inform('hide');p.inform('hide',this);this._destroyOnHide&&this.destroy();},isShown:function(){return this._shown;},updatePosition:function(){return true;},destroy:function(){this.hide();this.inform('destroy');l.remove(this._root,'layer');this._root=null;this.disableAllBehaviors();}});e.exports=p;});
__e("LayerHideOnTransition",["Arbiter","Class","copyProperties"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("Class"),i=b("copyProperties");function j(k){this._layer=k;}i(j.prototype,{_subscription:null,enable:function(){this._subscription=g.subscribe('page_transition',this._layer.hide.shield(this._layer),g.SUBSCRIBE_NEW);},disable:function(){if(this._subscription){g.unsubscribe(this._subscription);this._subscription=null;}}});e.exports=j;});
__e("Rect",["Vector","copyProperties"],function(a,b,c,d,e,f){var g=b("Vector"),h=b("copyProperties");function i(j,k,l,m,n){if(arguments.length===1){if(j instanceof i)return j;if(j instanceof g)return new i(j.y,j.x,j.y,j.x,j.domain);return i.getElementBounds($(j));}h(this,{t:j,r:k,b:l,l:m,domain:n||'pure'});}h(i.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(j){j=new i(j).convertTo(this.domain);var k=this;return (k.l<=j.l&&k.r>=j.r&&k.t<=j.t&&k.b>=j.b);},add:function(j,k){if(arguments.length==1){if(j.domain!='pure')j=j.convertTo(this.domain);return this.add(j.x,j.y);}var l=parseFloat(j),m=parseFloat(k);return new i(this.t+m,this.r+l,this.b+m,this.l+l,this.domain);},sub:function(j,k){if(arguments.length==1){return this.add(j.mul(-1));}else return this.add(-j,-k);},boundWithin:function(j){var k=0,l=0;if(this.l<j.l){k=j.l-this.l;}else if(this.r>j.r)k=j.r-this.r;if(this.t<j.t){l=j.t-this.t;}else if(this.b>j.b)l=j.b-this.b;return this.add(k,l);},getCenter:function(){return new g(this.l+this.w()/2,this.t+this.h()/2,this.domain);},getPositionVector:function(){return new g(this.l,this.t,this.domain);},getDimensionVector:function(){return new g(this.w(),this.h(),'pure');},convertTo:function(j){if(this.domain==j)return this;if(j=='pure')return new i(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new i(0,0,0,0);var k=new g(this.l,this.t,this.domain).convertTo(j);return new i(k.y,k.x+this.w(),k.y+this.h(),k.x,j);}});h(i,{deserialize:function(j){var k=j.split(':');return new i(k[1],k[2],k[3],k[0]);},newFromVectors:function(j,k){return new i(j.y,j.x+k.x,j.y+k.y,j.x,j.domain);},getElementBounds:function(j){return i.newFromVectors(g.getElementPosition(j),g.getElementDimensions(j));},getViewportBounds:function(){return i.newFromVectors(g.getScrollPosition(),g.getViewportDimensions());},minimumBoundingBox:function(j){var k=new i(Math.min(),Math.max(),Math.max(),Math.min()),l;for(var m=0;m<j.length;m++){l=j[m];k.t=Math.min(k.t,l.t);k.r=Math.max(k.r,l.r);k.b=Math.max(k.b,l.b);k.l=Math.min(k.l,l.l);}return k;}});e.exports=i;});
onloadRegister_DEPRECATED(function(){add_properties('__behaviors',{});if(__behaviors.TinyViewport)return;__behaviors.TinyViewport=true;var a=document.documentElement,b=DOM.getDocumentScrollElement(),c=debounce(function(){var d=a.clientHeight<400||b.clientWidth<b.scrollWidth;CSS.conditionClass(a,'tinyViewport',d);CSS.conditionClass(a,'canHaveFixedElements',!d);});Event.listen(window,'resize',c);c();});
__e("ContextualLayer",["array-extensions","event-extensions","Arbiter","Class","ContextualThing","css","DataStore","dom","Layer","LayerHideOnTransition","Locale","Parent","Rect","Vector","copyProperties","dom-core","getOverlayZIndex"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("Arbiter"),h=b("Class"),i=b("ContextualThing"),j=b("css"),k=b("DataStore"),l=b("dom"),m=b("Layer"),n=b("LayerHideOnTransition"),o=b("Locale"),p=b("Parent"),q=b("Rect"),r=b("Vector"),s=l.$N,t=b("copyProperties"),u=b("dom-core").ge,v=b("getOverlayZIndex");function w(){return this.parent.construct(this);}var x=[];g.subscribe('reflow',function(){x.forEach(function(aa){if(aa.updatePosition()===false)aa.hide();});});h.extend(w,m);t(w,{OPPOSITE:{above:'below',below:'above',left:'right',right:'left'}});var y=function(){var aa=u('blueBar'),ba=aa?aa.offsetHeight:0;y=bagof(ba);return ba;};function z(){return document.body.offsetWidth-(window.ChatSidebar&&ChatSidebar.getVisibleWidth()||0);}t(w.prototype,{_contentWrapper:null,_content:null,_context:null,_parentLayer:null,_parentSubscriptions:null,_preferredPosition:'above',_preferredAlignment:'left',_position:'above',_alignment:'left',_offsetX:0,_offsetY:0,_autoFlip:true,init:function(aa){this._content=aa;this.parent.init(this._content);this._updateWrapperPosition();this.enableBehaviors([n]);return this;},_buildWrapper:function(aa){var ba=this._generatePositionClass(this._position,this._alignment);this._contentWrapper=s('div',{className:'uiContextualLayer '+ba},aa);return s('div',{className:'uiContextualLayerPositioner'},this._contentWrapper);},getInsertParent:function(){var aa=this._insertParent;if(!aa&&this._context)aa=p.byClass(this._context,'uiContextualLayerParent');return aa||this.parent.getInsertParent();},setContent:function(aa){this._content=aa;l.setContent(this._contentWrapper,this._content);this._shown&&this.updatePosition();return this;},setContext:function(aa){this._context=aa;this._contextScrollParent=null;if(this._shown){i.register(this._root,this._context);this.updatePosition();}this._setParentSubscriptions();return this;},_setParentSubscriptions:function(){var aa=this._context,ba=null;while(aa!==null){ba=k.get(aa,'layer');if(ba)break;aa=aa.parentNode;}if(ba===this._parentLayer)return;if(this._parentLayer&&this._parentSubscriptions){this._parentSubscriptions.forEach(function(ca){this._parentLayer.unsubscribe(ca);}.bind(this));this._parentSubscriptions=null;}if(ba)this._parentSubscriptions=[ba.subscribe('hide',this.hide.bind(this)),ba.subscribe('destroy',this.destroy.bind(this))];this._parentLayer=ba;},setPosition:function(aa){this._preferredPosition=aa||'above';this._shown&&this.updatePosition();return this;},setAlignment:function(aa){this._preferredAlignment=aa||'left';this._shown&&this.updatePosition();return this;},setOffsetX:function(aa){this._offsetX=aa||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(aa){this._offsetY=aa||0;this._shown&&this.updatePosition();return this;},setAutoFlip:function(aa){this._autoFlip=!!aa;this._shown&&this.updatePosition();return this;},getContext:function(){return this._context;},getContextScrollParent:function(){if(!this._contextScrollParent)this._contextScrollParent=j.getScrollParent(this._context);return this._contextScrollParent;},show:function(){this.parent.show();if(this._shown){i.register(this._root,this._context);x.push(this);this._resizeListener=this._resizeListener||Event.listen(window,'resize',this.updatePosition.bind(this));}return this;},hide:function(){i.remove(this._root);x.remove(this);this._resizeListener&&this._resizeListener.remove();this._resizeListener=null;return this.parent.hide();},updatePosition:function(){if(!this._context||!this._context.offsetParent)return false;if(this._autoFlip){this._adjustPosition();}else this._position=this._preferredPosition;if(!this._position)return false;this._updateWrapperPosition();var aa=j.isFixed(this._context)&&!j.isFixed(this.getInsertParent());j.conditionClass(this._root,'uiContextualLayerPositionerFixed',aa);var ba,ca;if(aa){ba='viewport';ca=new r(0,0);}else{ba='document';var da=this._root.offsetParent;if(!da)return false;ca=r.getElementPosition(da,ba);if(da!==l.getDocumentBodyElement())ca=ca.sub(new r(da.scrollLeft,da.scrollTop));}var ea=r.getElementPosition(this._context,ba),fa=ea.x-ca.x,ga=ea.y-ca.y,ha=this._getOffsetX(this._position,this._alignment);if(this._position=='below')ga+=this._context.offsetHeight;var ia=this._position=='above'||this._position=='below';if((this._position=='right'||(ia&&this._alignment=='right'))!=o.isRTL())fa+=this._context.offsetWidth;if(ia&&this._alignment=='center')ha+=(this._context.offsetWidth-this._content.offsetWidth)/2;j.setStyle(this._root,'left',(fa+(o.isRTL()?-1:1)*ha)+'px');j.setStyle(this._root,'top',(ga+this._getOffsetY(this._position,this._alignment))+'px');var ja=v(this._context,this.getInsertParent());j.setStyle(this._root,'z-index',ja>200?ja:'');return true;},destroy:function(){this.parent.destroy();this._contentWrapper=null;this._content=null;return this;},_updateWrapperPosition:function(){if(this._position=='above'){j.setStyle(this._contentWrapper,'bottom','0');}else j.setStyle(this._contentWrapper,'bottom','');var aa=o.isRTL()?'left':'right',ba=this._position=='above'||this._position=='below';if(this._position=='left'||(ba&&this._alignment=='right')){j.setStyle(this._contentWrapper,aa,'0');}else j.setStyle(this._contentWrapper,aa,'');this._addPositionClass(this._position,this._alignment);},_adjustPosition:function(){this._removePositionClass(this._position,this._alignment);this._position=null;var aa=u('globalContainer'),ba=(aa&&l.contains(aa,this._context))||v(this._context)<300,ca=new q(ba?y():0,ba?z():document.body.offsetWidth,r.getViewportDimensions().y,0),da=function(fa,ga){if(this._canSeeContextEdge(fa)){this._position=fa;if(this._willElementFit(ca,fa,ga)){this._alignment=ga;return true;}}return false;}.bind(this);if(da(this._preferredPosition,this._preferredAlignment))return;if(da(w.OPPOSITE[this._preferredPosition],this._preferredAlignment))return;if(this._preferredPosition=='above'||this._preferredPosition=='below'){var ea=this._preferredAlignment=='left'?'right':'left';if(da(this._preferredPosition,ea))return;}},_canSeeContextEdge:function(aa){var ba=this.getContextScrollParent(),ca;if(ba===window){ca=y();}else ca=r.getElementPosition(ba,'viewport').y;var da=r.getElementPosition(this._context,'viewport').y;if(aa!='below'){return da>=ca;}else{var ea;if(ba===window){ea=r.getViewportDimensions().y;}else ea=ca+ba.offsetHeight;var fa=da+this._context.offsetHeight;return fa<=ea;}},_willElementFit:function(aa,ba,ca){var da=r.getElementPosition(this._context,'viewport'),ea=da.y+this._getOffsetY(ba,ca);if(ba=='above'){ea-=this._content.offsetHeight;}else if(ba=='below')ea+=this._context.offsetHeight;var fa=ea+this._content.offsetHeight,ga=da.x+this._getOffsetX(ba,ca);if(ba=='right'||ba=='left'){if((ba=='right')!==o.isRTL()){ga+=this._context.offsetWidth;}else ga-=this._content.offsetWidth;}else if((ca=='right')!==o.isRTL())ga+=this._context.offsetWidth-this._content.offsetWidth;right=ga+this._content.offsetWidth;return aa.contains(new q(ea,right,fa,ga));},_getOffsetX:function(aa,ba){if(aa=='left'||aa=='right'){if(this._preferredPosition!=aa)return -this._offsetX;}else if(this._preferredAlignment!=ba)return -this._offsetX;return this._offsetX;},_getOffsetY:function(aa){if((aa=='above'||aa=='below')&&this._preferredPosition!=aa)return -this._offsetY;return this._offsetY;},_generatePositionClass:function(aa,ba){if(aa=='above'||aa=='below')return aa+ba;return aa;},_removePositionClass:function(aa,ba){j.removeClass(this._contentWrapper,this._generatePositionClass(aa,ba));},_addPositionClass:function(aa,ba){j.addClass(this._contentWrapper,this._generatePositionClass(aa,ba));}});e.exports=w;});
__e("KeyStatus",["event-extensions"],function(a,b,c,d,e,f){b("event-extensions");var g=null;Event.listen(document.documentElement,'keydown',function(i){g=Event.getKeyCode(i);},Event.Priority.URGENT);Event.listen(document.documentElement,'keyup',function(i){g=null;},Event.Priority.URGENT);var h={isKeyDown:function(){return !!g;},getKeyDownCode:function(){return g;}};e.exports=h;});
__e("Menu",["event-extensions","Arbiter","css","DataStore","dom","HTML","Keys","onload","Parent","ua","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("css"),i=b("DataStore"),j=b("dom"),k=b("HTML"),l=b("Keys"),m=b("onload"),n=b("Parent"),o=b("ua"),p=b("copyProperties"),q=null,r='menu:mouseover',s=null;function t(ba){return n.byClass(ba,'uiMenu');}function u(ba){return n.byClass(ba,'uiMenuItem');}function v(ba){if(document.activeElement){var ca=u(document.activeElement);return ba.indexOf(ca);}return -1;}function w(ba){return j.find(ba,'a.itemAnchor');}function x(ba){return h.hasClass(ba,'checked');}function y(ba){return !h.hasClass(ba,'disabled')&&h.getStyle(ba,'display')!=='none';}function z(event){var ba=document.activeElement;if(!ba||!n.byClass(ba,'uiMenu')||!j.isNodeOfType(ba,['input','textarea'])){var ca=u(event.getTarget());ca&&q.focusItem(ca);}}function aa(ba){o.firefox()&&w(ba).blur();q.inform('select',{menu:t(ba),item:ba});}m.runOnload(function(){var ba={};ba.click=function(event){var ca=u(event.getTarget());if(ca&&y(ca)){aa(ca);var da=w(ca),ea=da.href,fa=da.getAttribute('rel');return (fa&&fa!=='ignore')||(ea&&ea.charAt(ea.length-1)!=='#');}};ba.keydown=function(event){var ca=event.getTarget();if(event.getModifiers().any)return;if(!s||j.isNodeOfType(ca,['input','textarea']))return;var da=Event.getKeyCode(event),ea;switch(da){case l.UP:case l.DOWN:var fa=q.getEnabledItems(s);ea=v(fa);q.focusItem(fa[ea+(da===l.UP?-1:1)]);return false;case l.SPACE:var ga=u(ca);if(ga){aa(ga);event.prevent();}break;default:var ha=String.fromCharCode(da).toLowerCase(),ia=q.getEnabledItems(s);ea=v(ia);var ja=ea,ka=ia.length;while((~ea&&(ja=++ja%ka)!==ea)||(!~ea&&++ja<ka)){var la=q.getItemLabel(ia[ja]);if(la&&la.charAt(0).toLowerCase()===ha){q.focusItem(ia[ja]);return false;}}}};Event.listen(document.body,ba);});q=e.exports=p(new g(),{focusItem:function(ba){if(ba&&y(ba)){this._removeSelected(t(ba));h.addClass(ba,'selected');w(ba).focus();}},getEnabledItems:function(ba){return q.getItems(ba).filter(y);},getCheckedItems:function(ba){return q.getItems(ba).filter(x);},getItems:function(ba){return j.scry(ba,'li.uiMenuItem');},getItemLabel:function(ba){return ba.getAttribute('data-label',2)||'';},isItemChecked:function(ba){return h.hasClass(ba,'checked');},register:function(ba,ca){ba=t(ba);if(!i.get(ba,r))i.set(ba,r,Event.listen(ba,'mouseover',z));if(ca!==false)s=ba;},setItemEnabled:function(ba,ca){if(!ca&&!j.scry(ba,'span.disabledAnchor')[0])j.appendContent(ba,j.$N('span',{className:j.find(ba,'a').className+' disabledAnchor'},k(w(ba).innerHTML)));h.conditionClass(ba,'disabled',!ca);},toggleItem:function(ba){var ca=!q.isItemChecked(ba);q.setItemChecked(ba,ca);},setItemChecked:function(ba,ca){h.conditionClass(ba,'checked',ca);w(ba).setAttribute('aria-checked',ca);},unregister:function(ba){ba=t(ba);var ca=i.remove(ba,r);ca&&ca.remove();s=null;this._removeSelected(ba);},_removeSelected:function(ba){q.getItems(ba).filter(function(ca){return h.hasClass(ca,'selected');}).each(function(ca){h.removeClass(ca,'selected');});}});});
__e("LayerCancel",["event-extensions","Parent"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Parent");function h(i){this._layer=i;}h.prototype={_listener:null,enable:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._handleClick.bind(this));},disable:function(){if(this._listener){this._listener.remove();this._listener=null;}},_handleClick:function(i){if(g.byClass(i.getTarget(),'layerCancel')){this._layer.inform('cancel')!==false&&this._layer.hide();i.prevent();}}};e.exports=h;});
__e("LayerFormHooks",["event-extensions","Form"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Form");function h(i){this._layer=i;}h.prototype={_subscriptions:null,enable:function(){var i=this._layer.getRoot();this._subscriptions=[Event.listen(i,'submit',this._onSubmit.bind(this)),Event.listen(i,'success',this._onSuccess.bind(this)),Event.listen(i,'error',this._onError.bind(this))];},disable:function(){if(this._subscriptions){this._subscriptions.forEach(function(i){i.remove();});this._subscriptions=null;}},_onSubmit:function(i){var j=i.getTarget();if(this._layer.inform('submit')===false){i.kill();return;}var k=(g.getAttribute(j,'rel')==='async');if(!k)return this._onSuccess(i);},_onSuccess:function(i){this._layer.inform('success');},_onError:function(i){var j=i.getData();if(this._layer.inform('error',{response:j.response})===false)i.kill();}};e.exports=h;});
__e("LayerHideOnBlur",["event-extensions","Class","ContextualThing","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("ContextualThing"),i=b("copyProperties");function j(k){this._layer=k;}i(j.prototype,{_listener:null,_layerSubscriptions:null,enable:function(){if(!this._layerSubscriptions){this._layerSubscriptions=[this._layer.subscribe('show',this._attachListener.bind(this)),this._layer.subscribe('hide',this._removeListener.bind(this))];if(this._layer.isShown())this._attachListener();}},disable:function(){this._removeListener();if(this._layerSubscriptions){while(this._layerSubscriptions.length)this._layer.unsubscribe(this._layerSubscriptions.pop());this._layerSubscriptions=null;}},_attachListener:function(){(function(){this._listener=Event.listen(document.documentElement,'click',function(k){if(!h.containsIncludingLayers(this._getNodeToCheck(),k.getTarget()))this._layer.setFadeOnHide(false).hide();}.bind(this));}).bind(this).defer();},_getNodeToCheck:function(){return this._layer.getRoot();},_removeListener:function(){if(this._listener){this._listener.remove();this._listener=null;}}});e.exports=j;});
__e("LayerHideOnEscape",["event-extensions","Class","copyProperties","dom","Keys"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("copyProperties"),i=b("dom"),j=b("Keys");function k(l){this._layer=l;}h(k.prototype,{_escHandler:null,_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachEscHandler.bind(this)),this._layer.subscribe('hide',this._removeEscHandler.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this._removeEscHandler();},_attachEscHandler:function(){this._escHandler=Event.listen(document.documentElement,'keydown',function(l){var m=this._layer.getRoot();if(Event.getKeyCode(l)==j.ESC&&(document.activeElement==document.body||i.contains(m,document.activeElement)))this._layer.hide();}.bind(this));},_removeEscHandler:function(){if(this._escHandler){this._escHandler.remove();this._escHandler=null;}}});e.exports=k;});
__e("LayerHideOnSuccess",[],function(a,b,c,d,e,f){function g(h){this._layer=h;}g.prototype={_subscription:null,enable:function(){this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}}};e.exports=g;});
__e("LayerMouseHooks",["event-extensions","ContextualThing","dom","Layer"],function(a,b,c,d,e,f){b("event-extensions");var g=b("ContextualThing"),h=b("dom"),i=b("Layer");function j(k){this._layer=k;}j.prototype={_mouseSubscriptions:[],_layerSubscriptions:[],enable:function(){var k=this._layer.getRoot();this._mouseSubscriptions=[Event.listen(k,'mouseenter',this._onMouseEnter.bind(this)),Event.listen(k,'mouseleave',this._onMouseLeave.bind(this))];this._layerSubscriptions=[i.subscribe('show',this._onLayerShow.bind(this)),i.subscribe('hide',this._onLayerHide.bind(this))];},disable:function(){this._mouseSubscriptions.each(function(k){k.remove();});this._mouseSubscriptions=[];this._layerSubscriptions.each(function(k){i.unsubscribe(k);});this._layerSubscriptions=[];},_onMouseEnter:function(k){this._fireMouseLeaveOnLayerHide=false;if(!this._spawnedLayer)this._layer.inform('mouseenter');},_onMouseLeave:function(k){if(!this._spawnedLayer)this._layer.inform('mouseleave');this._fireMouseLeaveOnLayerHide=!!this._spawnedLayer;},_onLayerShow:function(k,l){var m=l.getContext&&l.getContext();if(m)if(h.contains(this._layer.getRoot(),m))this._spawnedLayer=l;},_onLayerHide:function(k,l){if(l===this._spawnedLayer){this._spawnedLayer=null;if(this._fireMouseLeaveOnLayerHide)this._onMouseLeave.bind(this).defer();}}};e.exports=j;});
__e("Overlay",["event-extensions","animation","Arbiter","Class","ContextualThing","css","DataStore","dom","Keys","Layer","LayerCancel","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerMouseHooks","Locale","Parent","dom-core","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("animation"),h=b("Arbiter"),i=b("Class"),j=b("ContextualThing"),k=b("css"),l=b("DataStore"),m=b("dom"),n=b("Keys"),o=b("Layer"),p=b("LayerCancel"),q=b("LayerFormHooks"),r=b("LayerHideOnBlur"),s=b("LayerHideOnEscape"),t=b("LayerHideOnSuccess"),u=b("LayerHideOnTransition"),v=b("LayerMouseHooks"),w=b("Locale"),x=b("Parent"),y=b("dom-core").$,z=m.$N,aa=b("copyProperties");function ba(){this.parent.construct(this);}i.extend(ba,o);aa(ba,{getInstance:function(ca){var da=x.byClass(ca,'uiOverlay');return da?l.get(da,'overlay'):null;}});aa(ba.prototype,{_shouldBuildWrapper:true,_hasFooter:false,init:function(ca){this.parent.init(ca);this._overlay=m.scry(this._root,'div.uiOverlay')[0]||this._root;k.hide(this._root);m.appendContent(this.getInsertParent(),this._root);l.set(this._overlay,'overlay',this);var da=l.get(this._overlay,'width');da&&this.setWidth(da);this.setFadeOnShow(l.get(this._overlay,'fadeonshow')!='false');this.setFadeOnHide(l.get(this._overlay,'fadeonhide')!='false');this.setHideOnBlur(l.get(this._overlay,'hideonblur')=='true');this.setDestroyOnHide(l.get(this._overlay,'destroyonhide')!='false');this.setFixed(l.get(this._overlay,'fixed')=='true');this._hasFooter=l.get(this._overlay,'hasfooter',false);var ea=m.scry(this._root,'.uiOverlayFooterLink')[0]||null;if(ea){Event.listen(ea,'mouseenter',function(){k.addClass(this._overlay,'uiOverlayHoverFooterArrow');}.bind(this));Event.listen(ea,'mouseleave',function(){k.removeClass(this._overlay,'uiOverlayHoverFooterArrow');}.bind(this));}this.subscribe('show',function(){h.inform('layer_shown',{type:'Overlay'});h.inform('Overlay/show',{overlay:this});}.bind(this));this.subscribe('hide',function(){h.inform('layer_hidden',{type:'Overlay'});h.inform('Overlay/hide',{overlay:this});}.bind(this));this.enableBehaviors([p,q,v,s,u]);if(l.get(this._overlay,'hideonsuccess')!='false')this.enableBehaviors([t]);return this;},initWithoutBuildingWrapper:function(){this._shouldBuildWrapper=false;return this.init.apply(this,arguments);},_buildWrapper:function(ca){ca=this.parent._buildWrapper(ca);if(!this._shouldBuildWrapper)return ca;var da=z('div',{className:'uiOverlayContent'},ca);return z('div',{className:'uiOverlay'},da);},setHideOnBlur:function(ca){if(ca){this.enableBehaviors([r]);}else this.disableBehaviors([r]);return this;},setWidth:function(ca){this.width=parseInt(ca,10);return this;},setFixed:function(ca){this.fixed=ca;return this;},getOverlay:function(){return this._overlay;},updatePosition:function(){if(this.width)k.setStyle(this._overlay,'width',this.width+'px');return true;},destroy:function(){l.remove(this._root,'overlay');this.parent.destroy();}});e.exports=ba;});
__e("ContextualDialogX",["event-extensions","Arbiter","bootloader","Class","ContextualThing","css","DataStore","dom","Locale","Overlay","Parent","Vector","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("bootloader"),i=b("Class"),j=b("ContextualThing"),k=b("css"),l=b("DataStore"),m=b("dom"),n=b("Locale"),o=b("Overlay"),p=b("Parent"),q=b("Vector"),r=b("copyProperties"),s=m.$N,t=b("getOverlayZIndex");function u(){this.parent.construct(this);}i.extend(u,o);r(u,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:8,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiOverlayArrowBottom',top:'uiOverlayArrowTop',right:'uiOverlayArrowRight',left:'uiOverlayArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'},getInstance:function(v){var w=l.get(v,'ContextualDialogX');if(!w){var x=p.byClass(v,'uiContextualDialog');w=x&&o.getInstance(x);}return w;}});r(u.prototype,{_scrollListener:null,_scrollParent:null,init:function(v){this.parent.init(v);var w=l.get.curry(this._root);this.setAlignH(w('alignh','left'));this.setOffsetX(w('offsetx',0));this.setOffsetY(w('offsety',0));this.setPosition(w('position','above'));var x=w('context');if(x){this.setContext($(x));}else{x=w('contextselector');if(x)this.setContext(m.find(document,x));}this._content=m.scry(this._root,'.uiContextualDialogContent')[0];var y=null,z=null;this.subscribe('show',function(){var aa=this.updatePosition.shield(this);y=Event.listen(window,'resize',aa);z=g.subscribe('reflow',aa);this._setupScrollListener(this._scrollParent);j.register(this._root,this.context);}.bind(this));this.subscribe('hide',function(){y.remove();g.unsubscribe(z);this._teardownScrollListener();j.remove(this._root);}.bind(this));g.subscribe('Hovercard/hide',function(aa,ba){if(Hovercard.contains(this.getContext()))this.hide();}.bind(this));return this;},_buildWrapper:function(v){var w=this.parent._buildWrapper(v);if(!this._shouldBuildWrapper)return w;k.addClass(w,'uiContextualDialog');return s('div',{className:'uiContextualDialogPositioner'},w);},setAlignH:function(v){this.alignH=v;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(v){v=$(v);if(this.context&&this.context!=v)l.remove(this.context,'ContextualDialogX');this.context=v;var w=p.byClass(v,'fbPhotoSnowbox')||p.byClass(v,'fbPhotoSnowlift');this.setInsertParent(w||m.getDocumentBodyElement());if(this._scrollListener&&this._scrollParent!==w){this._teardownScrollListener();this._setupScrollListener(w);}this._scrollParent=w;var x=t(v,this._insertParent);k.setStyle(this._root,'z-index',x>200?x:'');l.set(this.context,'ContextualDialogX',this);return this;},listen:function(v,w){return Event.listen(this._root,v,w);},setFixed:function(v){k.conditionClass(this._root,'uiContextualDialogFixed',v);return this.parent.setFixed(v);},setOffsetX:function(v){this.offsetX=parseInt(v,10)||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(v){this.offsetY=parseInt(v,10)||0;this._shown&&this.updatePosition();return this;},setPosition:function(v){this.position=v;for(var w in u.POSITION_TO_CLASS)k.conditionClass(this._root,u.POSITION_TO_CLASS[w],v==w);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;},updatePosition:function(){if(!this.context)return false;this.parent.updatePosition();var v=this.fixed?'viewport':'document',w=q.getElementPosition(this.context,v),x=this._scrollParent;if(x)w=w.sub(q.getElementPosition(x,'document')).add(x.scrollLeft,x.scrollTop);var y=q.getElementDimensions(this.context),z=this.position=='above'||this.position=='below',aa=n.isRTL();if((this.position=='right'||(z&&this.alignH=='right'))!=aa)w=w.add(y.x,0);if(this.position=='below')w=w.add(0,y.y);var ba=new q(0,0);if(z&&this.alignH=='center'){ba=ba.add((y.x-this.width)/2,0);}else{var ca=z?y.x:y.y,da=2*u.ARROW_INSET;if(ca<da){var ea=ca/2-u.ARROW_INSET;ba=ba.add(z?ea:0,z?0:ea);}}ba=ba.add(this.offsetX,this.offsetY);if(aa)ba=ba.mul(-1,1);w=w.add(ba);if(this.fixed)w=new q(w.x,w.y,'document');w.setElementPosition(this._root);this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;},scrollTo:function(){if(this.context)h.loadComponents('dom-scroll',function(){DOMScroll.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.context&&l.remove(this.context,'ContextualDialogX');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right'){k.setStyle(this._overlay,'top','');return;}var v=q.getElementPosition(this._root,'viewport').y,w=q.getElementDimensions(this._overlay).y,x=q.getViewportDimensions().y,y=u.TOP_MARGIN,z=Math.min(Math.max(0,v+w+u.BOTTOM_MARGIN-x),Math.max(-y,v-y),w-2*u.ARROW_INSET);k.setStyle(this._overlay,'top',(-1*z)+'px');k.setStyle(this._arrow,'top',u.ARROW_OFFSET+'px');k.setStyle(this._arrow,'marginTop',z+'px');},_adjustHorizontalPosition:function(){if((this.position!='above'&&this.position!='below')||this.alignH!='left'){k.setStyle(this._overlay,'left','');k.setStyle(this._overlay,'right','');return;}var v=q.getElementPosition(this._root,'viewport').x,w=q.getElementDimensions(this._overlay).x,x=q.getViewportDimensions().x,y=n.isRTL(),z;if(!y){z=v+w+u.RIGHT_MARGIN-x;}else z=u.LEFT_MARGIN+w-v;z=Math.min(Math.max(0,z),w-2*u.ARROW_INSET);k.setStyle(this._overlay,y?'right':'left',-1*z+'px');k.setStyle(this._arrow,y?'right':'left',u.ARROW_OFFSET+'px');k.setStyle(this._arrow,y?'marginRight':'marginLeft',z+'px');},_updateArrow:function(){var v=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':v=50;break;case 'right':v=100;break;}this._renderArrow(u.POSITION_TO_ARROW[this.position],v);},_renderArrow:function(v,w){for(var x in u.ARROW_CLASS)k.conditionClass(this._overlay,u.ARROW_CLASS[x],v==x);k.conditionClass(this._overlay,'uiOverlayWithFooterArrowBottom',v=='bottom'&&this._hasFooter);if(v=='none')return;if(!this._arrow){this._arrow=s('i',{className:'uiOverlayArrow'});m.appendContent(this._overlay,this._arrow);}k.setStyle(this._arrow,'top','');k.setStyle(this._arrow,'left','');k.setStyle(this._arrow,'right','');k.setStyle(this._arrow,'margin','');var y=v=='top'||v=='bottom',z=y?(n.isRTL()?'right':'left'):'top';w=w||0;k.setStyle(this._arrow,z,w+'%');var aa=u.ARROW_LENGTH+u.ARROW_OFFSET*2;k.setStyle(this._arrow,'margin-'+z,-(aa*w/100-u.ARROW_OFFSET)+'px');},_updateAlignmentClass:function(){k.conditionClass(this._root,u.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');},_setupScrollListener:function(v){this._scrollListener=Event.listen(v||window,'scroll',this._adjustVerticalPosition.shield(this));},_teardownScrollListener:function(){this._scrollListener.remove();this._scrollListener=null;}});e.exports=u;});
__e("Toggler",["array-extensions","event-extensions","Arbiter","ArrayUtils","Class","copyProperties","ContextualThing","ContextualDialogX","css","DataStore","Dialog","dom","dom-core","ObjectUtils"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("Arbiter"),h=b("ArrayUtils"),i=b("Class"),j=b("copyProperties"),k=b("ContextualThing"),l=b("ContextualDialogX"),m=b("css"),n=b("DataStore"),o=b("Dialog"),p=b("dom"),q=b("dom-core").ge,r=b("ObjectUtils"),s=[],t;function u(){u=bagofholding;Event.listen(document.documentElement,'click',function(event){var y=event.getTarget();s.each(function(z){z.active&&!z.sticky&&!k.containsIncludingLayers(z.getActive(),y)&&!z.inTargetFlyout(y)&&z.inActiveDialog()&&z.hide();});},Event.Priority.URGENT);}var v=function(){this.active=null;this.togglers={};this.setSticky(false);s.push(this);this.subscribe(['show','hide'],v.inform.bind(v));return u();};i.mixin(v,'Arbiter',{show:function(y){var z=w(this,y),aa=z.active;if(y!==aa){aa&&z.hide();z.active=y;m.addClass(y,'openToggler');var ba=p.scry(y,'a[rel="toggle"]');if(ba.length>0&&ba[0].getAttribute('data-target'))m.removeClass(q(ba[0].getAttribute('data-target')),'toggleTargetClosed');p.appendContent(y,z.getToggler('next'));p.prependContent(y,z.getToggler('prev'));z.inform('show',z);}},hide:function(y){var z=w(this,y),aa=z.active;if(aa&&(!y||y===aa)){m.removeClass(aa,'openToggler');var ba=p.scry(aa,'a[rel="toggle"]');if(ba.length>0&&ba[0].getAttribute('data-target'))m.addClass(q(ba[0].getAttribute('data-target')),'toggleTargetClosed');r.getValues(z.togglers).each(p.remove);z.inform('hide',z);z.active=null;}},toggle:function(y){var z=w(this,y);if(z.active===y){z.hide();}else z.show(y);},getActive:function(){return w(this).active;},inTargetFlyout:function(y){var z=x(this.getActive());return z&&k.containsIncludingLayers(z,y);},inActiveDialog:function(){var y=o.getCurrent();return !y||p.contains(y.getRoot(),this.getActive());},getToggler:function(y){var z=w(this);if(!z.togglers[y])z.togglers[y]=p.create('button',{className:'hideToggler',onfocus:function(){var aa=p.scry(z.active,'a[rel="toggle"]')[0];aa&&aa.focus();z.hide();}});return this.togglers[y];},setSticky:function(y){var z=w(this);y=y!==false;if(y!==z.sticky){z.sticky=y;if(y){z._pt&&g.unsubscribe(z._pt);}else z._pt=g.subscribe('page_transition',z.hide.bind(z,null));}return z;}});j(v,v.prototype);j(v,{bootstrap:function(y){var z=y.parentNode;v.getInstance(z).toggle(z);},createInstance:function(y){var z=new v().setSticky(true);n.set(y,'toggler',z);return z;},getInstance:function(y){while(y){var z=n.get(y,'toggler');if(z)return z;if(m.hasClass(y,'uiToggleContext'))return v.createInstance(y);y=y.parentNode;}return (t=t||new v());},listen:function(y,z,aa){return v.subscribe(h.createFrom(y),function(ba,ca){if(ca.getActive()===z)return aa(ba,ca);});},subscribe:(function(y){return function(z,aa){z=h.createFrom(z);if(z.contains('show'))s.each(function(ba){if(ba.getActive())aa.curry('show',ba).defer();});return y(z,aa);};})(v.subscribe.bind(v))});function w(y,z){if(y instanceof v)return y;return v.getInstance(z);}function x(y){var z=p.scry(y,'a[rel="toggle"]');if(z.length>0&&z[0].getAttribute('data-target'))return q(z[0].getAttribute('data-target'));}e.exports=a.Toggler||v;});
__e("Tooltip",["event-extensions","AsyncRequest","AsyncResponse","copyProperties","ContextualLayer","css","DataStore","dom","dom-core","HTML","StringEscape"],function(a,b,c,d,e,f){b("event-extensions");var g=b("AsyncRequest"),h=b("AsyncResponse"),i=b("copyProperties"),j=b("ContextualLayer"),k=b("css"),l=b("DataStore"),m=b("dom"),n=b("dom-core").ge,o=b("HTML"),p=b("StringEscape"),q=null,r=null,s=null,t=[];function u(){if(!r){s=m.create('div',{className:'tooltipContent'});var x=m.create('i',{className:'arrow'}),y=m.create('div',{className:'uiTooltipX'},[s,x]);r=new j();r.init(y);}}function v(x){return i({position:x.getAttribute('tooltip-position')||'above',alignH:x.getAttribute('tooltip-alignh')||'left'},l.get(x,'tooltip'));}var w={process:function(x,y){if(!m.contains(x,y))return;if(x!==q){var z=x.getAttribute('tooltip-uri');if(z){x.removeAttribute('tooltip-uri');new g(z).setHandler(function(ca){w.set(x,ca.getPayload());}).setErrorHandler(bagofholding).send();}var aa=x.getAttribute('title');if(aa){x.setAttribute('title','');var ba=v(x);!ba.content&&w.set(x,aa);}w.show(x);}},remove:function(x){l.remove(x,'tooltip');x.removeAttribute('data-hover');x.removeAttribute('tooltip-position');x.removeAttribute('tooltip-alignh');x===q&&w.hide();},hide:function(){if(q){r.hide();q=null;while(t.length)t.pop().remove();}},set:function(x,y,z,aa){var ba=v(x);l.set(x,'tooltip',i(ba,{content:y,position:z||ba.position,alignH:aa||ba.alignH}));x.setAttribute('data-hover','tooltip');x===q&&w.show(x);},show:function(x){u();w.hide();var y=v(x);if(!y.content)return;var z=0,aa=0;if(y.position==='left'||y.position==='right'){aa=(x.offsetHeight-20)/2;}else if(y.alignH!=='center'){var ba=x.offsetWidth;if(ba<18)z=(ba-18)/2*(y.alignH==='right'?-1:1);}r.setContext(x).setOffsetX(z).setOffsetY(aa).setPosition(y.position).setAlignment(y.alignH);if(typeof y.content==='string'){k.addClass(r,'invisible_elem');var ca=m.create('span',{},o(p.htmlize(y.content))),da=m.create('div',{className:'tooltipText'},ca);m.setContent(s,da);r.show();if(da.offsetWidth<ca.offsetWidth){k.addClass(da,'tooltipWrap');r.updatePosition();}k.removeClass(r,'invisible_elem');}else{m.setContent(s,y.content);r.show();}t.push(Event.listen(document.documentElement,'mouseover',function(fa){if(!m.contains(q,fa.getTarget()))w.hide();}));var ea=k.getScrollParent(x);if(ea!==window)t.push(Event.listen(ea,'scroll',w.hide));t.push(Event.listen(x,'click',w.hide));q=x;}};Event.listen(window,'scroll',w.hide);e.exports=a.Tooltip||w;});
__e("Selector",["event-extensions","Arbiter","Button","ContextualLayer","copyProperties","css","DataStore","dom","HTML","Input","Keys","KeyStatus","Menu","Parent","Toggler","Tooltip","Vector"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("Button"),i=b("ContextualLayer"),j=b("copyProperties"),k=b("css"),l=b("DataStore"),m=b("dom"),n=b("HTML"),o=b("Input"),p=b("Keys"),q=b("KeyStatus"),r=b("Menu"),s=b("Parent"),t=b("Toggler"),u=b("Tooltip"),v=b("Vector"),w,x,y=[],z;function aa(la){return s.byClass(la,'uiSelector');}function ba(la){return s.byClass(la,'uiSelectorButton');}function ca(){if(!x)x=new i().init().setPosition('below');return x;}function da(la){return m.scry(la,'select')[0];}function ea(la){return m.find(la,'div.uiSelectorMenuWrapper');}function fa(){fa=bagofholding;r.subscribe('select',function(la,ma){if(!w||!ma||ma.menu!==ka.getSelectorMenu(w))return;var na=ga(w),oa=ha(ma.item);if(oa){var pa=w,qa=ka.isOptionSelected(ma.item),ra=ka.inform('select',{selector:pa,option:ma.item});if(ra===false)return;if(na||!qa){ka.setSelected(pa,ka.getOptionValue(ma.item),!qa);ka.inform('toggle',{selector:pa,option:ma.item});ka.inform('change',{selector:pa});g.inform('Form/change',{node:pa});if(ia(pa))l.set(pa,'dirty',true);}}if(!na||!oa)w&&ka.toggle(w);});}function ga(la){return !!la.getAttribute('data-multiple');}function ha(la){return k.hasClass(la,'uiSelectorOption');}function ia(la){return !!la.getAttribute('data-autosubmit');}var ja={};ja.keydown=function(event){var la=event.getTarget();if(m.isNodeOfType(la,['input','textarea']))return;switch(Event.getKeyCode(event)){case p.DOWN:case p.SPACE:case p.UP:if(ba(la)){var ma=aa(la);ka.toggle(ma);return false;}break;case p.ESC:if(w){ka.toggle(w);return false;}break;}};Event.listen(window,ja);t.subscribe(['show','hide'],function(la,ma){var na=aa(ma.getActive());if(na){fa();var oa=ka.getSelectorButton(na),pa=ka.getSelectorMenu(na),qa=la==='show';if(qa){w=na;if(k.hasClass(oa,'uiButtonDisabled')){ka.setEnabled(na,false);return false;}pa=pa||ka.loadMenu(na);var ra=k.getScrollParent(na),sa=ra!==window&&ra!==m.getDocumentScrollElement();if(sa||k.hasClass(na,'uiSelectorUseLayer')){if(sa)y.push(Event.listen(ra,'scroll',function(){ma.hide();}));z=m.create('div',{className:na.className});k.addClass(z,'invisible_elem');v.getElementDimensions(na).setElementDimensions(z);m.replace(na,z);var ta=k.hasClass(na,'uiSelectorRight');ca().setContext(z).setContent(na).setAlignment(ta?'right':'left').show();}r.register(pa);if(q.isKeyDown()){var ua=r.getCheckedItems(pa);if(!ua.length)ua=r.getEnabledItems(pa);r.focusItem(ua[0]);}}else{w=null;if(z){while(y.length)y.pop().remove();m.replace(z,na);ca().hide();z=null;}pa&&r.unregister(pa);if(q.isKeyDown())o.focus(oa);if(ia(na)&&l.get(na,'dirty')){var va=m.scry(na,'input.submitButton')[0];va&&va.click();l.remove(na,'dirty');}}k.conditionClass(ka.getSelectorButton(na),'selected',qa);ka.inform(qa?'open':'close',{selector:na});}});var ka=j(new g(),{attachMenu:function(la,ma,na){la=aa(la);if(la){w&&r.unregister(ka.getSelectorMenu(w));m.setContent(ea(la),ma);w&&r.register(ka.getSelectorMenu(la));z&&ca().updatePosition();if(na){var oa=la.getAttribute('data-name');oa&&na.setAttribute('name',oa);if(!ga(la))na.setAttribute('multiple',false);var pa=da(la);if(pa){m.replace(pa,na);}else m.insertAfter(la.firstChild,na);}return true;}},enableLazyLoad:function(la){if(la)var ma=Event.listen(la,'mouseover',function(){ma.remove();ka.loadMenu(la);});},getOption:function(la,ma){var na=ka.getOptions(la),oa=na.length;while(oa--)if(ma===ka.getOptionValue(na[oa]))return na[oa];return null;},getOptions:function(la){var ma=r.getItems(ka.getSelectorMenu(la));return ma.filter(ha);},getEnabledOptions:function(la){var ma=r.getEnabledItems(ka.getSelectorMenu(la));return ma.filter(ha);},getSelectedOptions:function(la){return r.getCheckedItems(ka.getSelectorMenu(la));},getOptionText:function(la){return r.getItemLabel(la);},getOptionValue:function(la){var ma=aa(la),na=da(ma),oa=ka.getOptions(ma).indexOf(la);return oa>=0?na.options[oa+1].value:'';},getSelectorButton:function(la){return m.find(la,'a.uiSelectorButton');},getSelectorMenu:function(la){return m.scry(la,'div.uiSelectorMenu')[0];},getValue:function(la){var ma=da(la);if(!ma)return null;if(!ga(la))return ma.value;var na=[],oa=ma.options;for(var pa=1,qa=oa.length;pa<qa;pa++)if(oa[pa].selected)na.push(oa[pa].value);return na;},isOptionSelected:function(la){return r.isItemChecked(la);},listen:function(la,ma,na){return this.subscribe(ma,function(oa,pa){if(pa.selector===la)return na(pa,oa);});},loadMenu:function(la){var ma=ka.getSelectorMenu(la);if(!ma){var na=ka.getSelectorButton(la),oa=na.getAttribute('ajaxify');if(oa){d(["AsyncRequest"],function(qa){qa.bootstrap(oa,na);});var pa=n('<div class="uiSelectorMenuWrapper uiToggleFlyout">'+'<div class="uiMenu uiSelectorMenu loading">'+'<ul class="uiMenuInner">'+'<li><span></span></li>'+'</ul>'+'</div>'+'</div>');m.appendContent(na.parentNode,pa);ma=ka.getSelectorMenu(la);na.removeAttribute('onmouseover');}}return ma;},setButtonLabel:function(la,ma){var na=ka.getSelectorButton(la),oa=parseInt(na.getAttribute('data-length'),10);ma=ma||na.getAttribute('data-label')||'';h.setLabel(na,ma);if(typeof ma==='string'){k.conditionClass(na,'uiSelectorBigButtonLabel',ma.length>oa);if(oa&&ma.length>oa){na.setAttribute('title',ma);}else na.removeAttribute('title');}},setButtonTooltip:function(la,ma){var na=ka.getSelectorButton(la),oa=s.byTag(na,'a');oa&&u.set(s.byTag(na,'a'),ma||na.getAttribute('data-tooltip')||'');},setEnabled:function(la,ma){if(!ma&&w&&aa(la)===w)ka.toggle(la);h.setEnabled(ka.getSelectorButton(la),ma);},setOptionEnabled:function(la,ma){r.setItemEnabled(la,ma);},setSelected:function(la,ma,na){na=na!==false;var oa=ka.getOption(la,ma);if(!oa)return;var pa=ka.isOptionSelected(oa);if(na!==pa){if(!ga(la)&&!pa){var qa=ka.getSelectedOptions(la)[0];qa&&r.toggleItem(qa);}r.toggleItem(oa);ka.updateSelector(la);}},toggle:function(la){t.toggle(m.scry(aa(la),'div.wrap')[0]);},updateSelector:function(la){var ma=ka.getOptions(la),na=ka.getSelectedOptions(la),oa=da(la).options,pa=[],qa=[];for(var ra=0,sa=ma.length;ra<sa;ra++){var ta=na.contains(ma[ra]);oa[ra+1].selected=ta;if(ta){var ua=ka.getOptionText(ma[ra]);pa.push(ua);qa.push(ma[ra].getAttribute('data-tooltip')||ua);}}oa[0].selected=!na.length;var va=k.hasClass(la,'uiSelectorDynamicLabel'),wa=k.hasClass(la,'uiSelectorDynamicTooltip');if(va||wa){var xa='';if(ga(la)){var ya=ka.getSelectorButton(la);xa=ya.getAttribute('data-delimiter')||', ';}pa=pa.join(xa);qa=qa.join(xa);va&&ka.setButtonLabel(la,pa);wa&&ka.setButtonTooltip(la,qa);}}});e.exports=a.Selector||ka;});
__e("legacy:Selector",["Selector"],function(a,b,c,d){a.Selector=b('Selector');},3);
function SubMenu(){}SubMenu.prototype={_subMenu:null,_mainMenu:null,_forward:null,_backward:null,init:function(a,b,c,d){this._subMenu=a;this._mainMenu=b;this._forward=c;this._backward=d;Arbiter.subscribe('SubMenu/Reset',this._goToMainMenu.bind(this));Event.listen(c,'click',this._goToSubMenu.bind(this));Event.listen(d,'click',this._goToMainMenu.bind(this));},initAsyncChildMenu:function(a){Event.listen(this._forward,'click',function(){this._goToSubMenu();a.load();}.bind(this));},_goToMainMenu:function(){if(CSS.shown(this._mainMenu))return;CSS.hide(this._subMenu);CSS.show(this._mainMenu);},_goToSubMenu:function(){if(CSS.shown(this._subMenu))return;CSS.hide(this._mainMenu);CSS.show(this._subMenu);}};
function SwapButton(){}SwapButton.prototype={_swapperButton:null,_swappeeButton:null,swap:function(){CSS.hide(this._swapperButton);CSS.show(this._swappeeButton);},unswap:function(){CSS.show(this._swapperButton);CSS.hide(this._swappeeButton);},init:function(a,b){this._swapperButton=a;this._swappeeButton=b;Event.listen(a,'click',this.swap.bind(this));}};
window.SubscriptionLevels={ALL:'162318810514679',DEFAULT:'271670892858696',TOP:'266156873403755'};window.EditSubscriptions=window.EditSubscriptions||(function(){var a=13,b=45,c=[SubscriptionLevels.ALL,SubscriptionLevels.DEFAULT,SubscriptionLevels.TOP],d={},e={},f={},g={},h={},i={},j="ajax/follow/follow_profile.php",k="ajax/follow/unfollow_profile.php";function l(aa){return c.contains(aa);}function m(aa,ba,ca,da){var ea=Parent.byClass(da,'uiMenuItem');if(!ea||!DOM.contains(aa,ea)){return;}else if(CSS.hasClass(ea,'SubscribeMenuSubscribe')){o(aa,ba);return false;}else if(CSS.hasClass(ea,'SubscribeMenuUnsubscribe')){p(aa,ba);return false;}else if(CSS.hasClass(ea,'SubscriptionMenuItem')){n(aa,ba,ca,ea);return false;}}function n(aa,ba,ca,da){if(CSS.hasClass(da,'SubscriptionMenuLevel')){if(Menu.isItemChecked(da))return;z(aa,ba,t(da),true,ca);}else if(CSS.hasClass(da,'SubscriptionMenuCategory'))x(ba,da,!Menu.isItemChecked(da),true,ca);}function o(aa,ba){var ca={profile_id:ba};Arbiter.inform('FollowingUser',ca);new AsyncRequest().setURI(j).setMethod('POST').setData({profile_id:ba,location:q(aa)}).setErrorHandler(Arbiter.inform.curry('FollowUserFail',ca)).send();}function p(aa,ba){var ca={profile_id:ba};Arbiter.inform('UnfollowingUser',ca);new AsyncRequest().setURI(k).setMethod('POST').setData({profile_id:ba,location:q(aa)}).setErrorHandler(Arbiter.inform.curry('UnfollowUserFail',ca)).send();}function q(aa){if(CSS.hasClass(aa,'followButtonFlyout')){return a;}else return b;}function r(aa,ba,ca){var da={profile_id:aa,level:f[aa],custom_categories:g[aa],location:ca};new AsyncRequest().setURI('ajax/follow/manage_subscriptions.php').setData(da).send();}function s(aa,ba){var ca=g[ba]||[],da=Menu.getItems(aa);da.forEach(function(ea){if(CSS.hasClass(ea,'SubscriptionMenuCategory')){var fa=t(ea);if(ca.contains(fa)){v(ea);}else w(ea);}});z(aa,ba,f[ba],false);}function t(aa){var ba=DOM.scry(aa,'input')[0];return ba&&ba.value;}function u(aa){return DOM.find(aa,'a.itemAnchor');}function v(aa){CSS.addClass(aa,'checked');u(aa).setAttribute('aria-checked',true);}function w(aa){CSS.removeClass(aa,'checked');u(aa).setAttribute('aria-checked',false);}function x(aa,ba,ca,da,ea){if(ca){v(ba);}else w(ba);var fa=t(ba);if(l(fa)){ca&&y(aa,fa);}else if(ca){if(!g[aa].contains(fa))g[aa].push(fa);}else{var ga=g[aa].indexOf(fa);if(ga!==-1)g[aa].splice(ga,1);}if(da)r(aa,fa,ea);}function y(aa,ba){f[aa]=ba;Arbiter.inform('SubscriptionLevelUpdated',{profile_id:aa,level:ba});}function z(aa,ba,ca,da,ea){var fa=DOM.scry(aa,'.SubscriptionMenuLevel'),ga=null;fa.forEach(function(ha){if(t(ha)==ca){ga=ha;}else if(Menu.isItemChecked(ha))x(ba,ha,false,false);});ga&&x(ba,ga,true,da,ea);}Arbiter.subscribe('UnfollowUser',function(aa,ba){if(h[ba.profile_id]){y(ba.profile_id,h[ba.profile_id]);g[ba.profile_id]=i[ba.profile_id].slice();}});Arbiter.subscribe('UpdateSubscriptionLevel',function(aa,ba){var ca=ba.profile_id+'',da=ba.level+'';y(ca,da);var ea;for(ea in d)if(d[ea]===ca){var fa=ge(ea);fa&&z(fa,ca,da,false);}});return {init:function(aa,ba,ca){var da=aa.id;if(!d[da])Event.listen(aa,'click',function(ea){return m(aa,d[da],ca,ea.getTarget());});if(f[ba])s(aa,ba);d[da]=ba;CSS.conditionClass(aa,'NonFriendSubscriptionMenu',!e[ba]);Arbiter.subscribe(['FollowUser','FollowingUser'],function(ea,fa){CSS.conditionClass(aa,'isUnsubscribed',false);}.bind(this));Arbiter.subscribe(['UnfollowUser','UnfollowingUser'],function(ea,fa){CSS.conditionClass(aa,'isUnsubscribed',true);Arbiter.inform('SubMenu/Reset');}.bind(this));},getSubscriptions:function(aa){return {level:f[aa],custom_categories:g[aa]};},setSubscriptions:function(aa,ba,ca,da,ea,fa){y(aa,ca+'');e[aa]=ba;h[aa]=ea+'';g[aa]=da.map(String);i[aa]=fa.map(String);}};})();
function HoverFlyout(){}Class.mixin(HoverFlyout,'Arbiter',{init:function(a){this._flyout=a;this._showDelay=0;this._hideDelay=100;this._showTimeout=null;this._hideTimeout=null;this._flyoutSubscriptions=[this._flyout.subscribe('mouseenter',this._onFlyoutMouseEnter.bind(this)),this._flyout.subscribe('mouseleave',this.hideFlyout.shield(this))];this._nodes=[];this._dataStoreUnique='HoverFlyout_'+Date.now();this._flyout.setDestroyOnHide(false);return this;},initNode:function(a){this._nodes.push(a);DataStore.set(a,this._dataStoreUnique+'_listeners',[Event.listen(a,'mouseenter',this._onNodeMouseEnter.bind(this,a)),Event.listen(a,'mouseleave',this.hideFlyout.shield(this))]);return this;},deactivateNode:function(a){var b=DataStore.get(a,this._dataStoreUnique+'_listeners');if(b)while(b.length)b.pop().remove();this._nodes.remove(a);},setShowDelay:function(a){this._showDelay=a;return this;},setHideDelay:function(a){this._hideDelay=a;return this;},showFlyout:function(a,b){this.setActiveNode(a);if(b){this._flyout.setContext(a).show();this.inform('show',a);}else this._showTimeout=this.showFlyout.bind(this,a,true).defer(this._showDelay);return this;},hideFlyout:function(a){clearTimeout(this._showTimeout);if(a){this._flyout.hide();this.inform('hide',this._activeNode);this._activeNode=null;}else this._hideTimeout=this.hideFlyout.bind(this,true).defer(this._hideDelay);},hideFlyoutDelayed:function(a){clearTimeout(this._showTimeout);clearTimeout(this._hideTimeout);this._hideTimeout=this.hideFlyout.bind(this,true).defer(a);},getActiveNode:function(){return this._activeNode;},setActiveNode:function(a){clearTimeout(this._hideTimeout);if(this._activeNode&&this._activeNode!==a)this.hideFlyout(true);this._activeNode=a;return this;},destroy:function(){while(this._flyoutSubscriptions.length)this._flyout.unsubscribe(this._flyoutSubscriptions.pop());for(var a=0;a<this._nodes.length;a++){var b=DataStore.get(this._nodes[a],this._dataStoreUnique+'_listeners');if(b)while(b.length)b.pop().remove();}},_onNodeMouseEnter:function(a){if(this._activeNode===a){clearTimeout(this._hideTimeout);}else this.showFlyout(a);},_onFlyoutMouseEnter:function(){clearTimeout(this._hideTimeout);}});
var SubscriptionFlyoutController=(function(){var a=null,b,c,d;function e(){var h=EditSubscriptions.getSubscriptions(d);if(h){var i=h.custom_categories;if(i&&i.length===0)Arbiter.inform('UnfollowUser',{profile_id:d,from_hide_flyout:true});}}function f(h,i){d=DataStore.get(i,'profile_id');var j=DataStore.get(i,'loc');EditSubscriptions.init(c,d,j);CSS.addClass(i,'selected');CSS.addClass(i,'uiButtonHover');if(DataStore.get(i,'onclose'))clearTimeout(DataStore.remove(i,'onclosetimeout'));}function g(h,i){d=null;CSS.removeClass(i,'selected');CSS.removeClass(i,'uiButtonHover');if(DataStore.get(i,'onclose'))DataStore.set(i,'onclosetimeout',function(){var j=DataStore.remove(i,'onclose');j&&j();}.defer(1500));}return {init:function(h,i){SubscriptionFlyoutController.init=bagofholding;b=h;c=i;a=new HoverFlyout();a.init(h);a.setShowDelay(100).setHideDelay(150);a.subscribe('show',f);a.subscribe('hide',g);Arbiter.subscribe(['UnfollowUser','UnfollowingUser'],function(j,k){if(!k.from_hide_flyout&&k.profile_id==d){if(window.Hovercard&&Hovercard.contains&&b)if(Hovercard.contains(b.getContext()))Hovercard.hide();a.hideFlyout(true);}});},initNode:function(h,i,j){DataStore.set(h,'profile_id',i);DataStore.set(h,'loc',j);a.initNode(h);},setActiveNode:function(h){a.setActiveNode(h);},show:function(h){a.showFlyout(h,true);},setCloseListener:function(h,i){if(a.getActiveNode()!==h){i();}else DataStore.set(h,'onclose',i);}};})();
FriendRequestMessage={STATUS:'FriendRequest/change',UNFRIEND:'FriendRequest/unfriend',CANCEL:'FriendRequest/cancel',CANCELLING:'FriendRequest/cancelling',CANCEL_FAIL:'FriendRequest/cancelFail',SENT:'FriendRequest/sent',SENDING:'FriendRequest/sending',SEND_FAIL:'FriendRequest/sendFail',CONFIRM:'FriendRequest/confirm',CONFIRMING:'FriendRequest/confirming',CONFIRM_FAIL:'FriendRequest/confirmFail'};function FriendStatus(a,b,c){this.id=a;this.update(b,c);}FriendStatus.prototype={update:function(a,b){a&&(this.status=a);if(b){this.lists=$A(b).map(String);this._informListChange();}},isComplete:function(){return !!this.lists;},addToList:function(a){if(this.lists&&!this.lists.contains(a))this.lists.push(a);this._informListChange();},removeFromList:function(a){if(this.lists){var b=this.lists.indexOf(a);b!==-1&&this.lists.splice(b,1);}this._informListChange();},updateList:function(a,b){b?this.addToList(a):this.removeFromList(a);},_informListChange:function(){Arbiter.inform('FriendListMembershipChange',{uid:this.id,lists:this.lists});}};copy_properties(FriendStatus,{ARE_FRIENDS:1,INCOMING_REQUEST:2,OUTGOING_REQUEST:3,CAN_REQUEST:4});(function(){var a={},b={};function c(d,e,f){if(!a[f.uid]){a[f.uid]=new FriendStatus(f.uid,d);}else a[f.uid].update(d);Arbiter.inform(FriendRequestMessage.STATUS,{uid:f.uid,status:d});}onloadRegister_DEPRECATED(function(){Arbiter.subscribe([FriendRequestMessage.CANCEL,FriendRequestMessage.UNFRIEND,FriendRequestMessage.SEND_FAIL],c.curry(FriendStatus.CAN_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM_FAIL],c.curry(FriendStatus.INCOMING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CANCEL_FAIL,FriendRequestMessage.SENT,FriendRequestMessage.SENDING],c.curry(FriendStatus.OUTGOING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM,FriendRequestMessage.CONFIRMING],c.curry(FriendStatus.ARE_FRIENDS));});copy_properties(FriendStatus,{CLOSE_FRIENDS:null,ACQUAINTANCES:null,getFriend:function(d,e){if(a[d]&&a[d].isComplete()){e(a[d]);}else if(b[d]){b[d].push(e);}else{b[d]=[e];new AsyncRequest().setURI("ajax/friends/status.php").setData({friend:d}).setHandler(function(f){var g=f.getPayload();FriendStatus.initFriend(d,g.status,g.lists);}).send();}},initFriend:function(d,e,f){var g=a[d]||new FriendStatus(d);g.update(g.status||e,g.lists||f);a[d]=g;b[d]&&b[d].forEach(function(h){h(g);});b[d]=null;},setSpecialLists:function(d){FriendStatus.CLOSE_FRIENDS=d.close+'';FriendStatus.ACQUAINTANCES=d.acq+'';}});})();
function SimpleDrag(a){Event.listen(a,'mousedown',this._start.bind(this));}Class.mixin(SimpleDrag,'Arbiter',{_start:function(event){this.inform('start',event);var a=ua.ie()<9?document.documentElement:window,b=Event.listen(a,{selectstart:Event.prevent,mousemove:this.inform.bind(this,'update'),mouseup:function(event){for(var c in b)b[c].remove();this.inform('end',event);}.bind(this)});return false;}});
function ScrollableArea(){}copy_properties(ScrollableArea,{fromNative:function(a,b){if(!CSS.hasClass(a,'uiScrollableArea')||!CSS.hasClass(a,'native'))return;b=b||{};CSS.removeClass(a,'native');var c=$N('div',{className:'uiScrollableAreaTrack'},$N('div',{className:'uiScrollableAreaGripper'}));if(b.fade!==false){CSS.addClass(a,'fade');CSS.addClass(c,'invisible_elem');}else CSS.addClass(a,'nofade');DOM.appendContent(a,c);var d=new ScrollableArea();d.init(a,b);d.resize();return d;},getInstance:function(a){var b=Parent.byClass(a,'uiScrollableArea');return b?DataStore.get(b,'ScrollableArea'):null;},poke:function(a){var b=ScrollableArea.getInstance(a);b&&b.poke();}});ScrollableArea.prototype={init:function(a,b){b=b||{};this._elem=a;this._wrap=DOM.find(a,'div.uiScrollableAreaWrap');this._body=DOM.find(this._wrap,'div.uiScrollableAreaBody');this._track=DOM.find(a,'div.uiScrollableAreaTrack');this._gripper=DOM.find(this._track,'div.uiScrollableAreaGripper');this._options=b;this.adjustGripper();this._listeners=[Event.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(b.fade!==false)this._listeners.push(Event.listen(a,'mouseenter',this.adjustGripper.shield(this)),Event.listen(a,'mouseenter',this.showScrollbar.shield(this)),Event.listen(a,'mousemove',this._handleMousemove.bind(this)),Event.listen(a,'mouseout',this.hideScrollbar.shield(this)));this.initDrag();DataStore.set(this._elem,'ScrollableArea',this);if(!b.persistent)onleaveRegister(this.destroy.bind(this));},initDrag:function(){var a=new SimpleDrag(this._gripper);a.subscribe('start',function(b,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var c=Vector2.getEventPosition(event).y,d=this._gripper.offsetTop,e=a.subscribe('update',function(g,event){var h=Vector2.getEventPosition(event).y-c,i=this._elem.clientHeight,j=this._body.offsetHeight,k=this._track.offsetHeight,l=i/j*k,m=j-this._wrap.offsetHeight,n=d+h,o=k-l;n=Math.max(Math.min(n,o),0);var p=n/o*m;this._wrap.scrollTop=p;}.bind(this)),f=a.subscribe('end',function(){a.unsubscribe(e);a.unsubscribe(f);});}.bind(this));},adjustGripper:function(){var a=this._elem.clientHeight,b=this._body.offsetHeight,c=this._track.offsetHeight,d=a/b*c;if(d<c){CSS.setStyle(this._gripper,'height',d+'px');var e=this._wrap.scrollTop/b*c;CSS.setStyle(this._gripper,'top',e+'px');CSS.show(this._gripper);}else CSS.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){CSS.conditionClass(this._elem,'contentBefore',this._wrap.scrollTop>0);CSS.conditionClass(this._elem,'contentAfter',!this.isScrolledToBottom());},destroy:function(){this._listeners.forEach(function(a){a.remove();});this._listeners.length=0;},_handleMousemove:function(event){var a=Vector2.getElementPosition(this._track).x,b=Vector2.getElementDimensions(this._track).x;if(Math.abs(a+b/2-Vector2.getEventPosition(event).x)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=animation(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(CSS.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},resize:function(){var a=Vector2.getElementDimensions(this._elem).x;if(!this._options.fade)a-=10;CSS.setStyle(this._body,'width',a+'px');return this;},showScrollbar:function(a){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}CSS.setStyle(this._track,'opacity',1);CSS.removeClass(this._track,'invisible_elem');if(a!==false)this.hideScrollbar();return this;},isScrolledToBottom:function(){return this._wrap.scrollTop>=this._wrap.scrollHeight-this._wrap.clientHeight;},scrollToBottom:function(a){if(a!==false){animation(this._wrap).to('scrollTop',this._wrap.scrollHeight).ease(animation.ease.end).go();}else this._wrap.scrollTop=this._wrap.scrollHeight;},poke:function(){var a=this._wrap.scrollTop;this._wrap.scrollTop+=1;this._wrap.scrollTop-=1;this._wrap.scrollTop=a;return this.showScrollbar(false);}};
__e("legacy:dialog",["Dialog"],function(a,b,c,d){var e=b('Dialog');a.Dialog=e;},3);
var DynamicFriendListEducation=(function(){var a,b,c,d,e,f,g=function(){c&&c.hide();d&&d.hide();},h=function(j){b.remove(j);g();e({accept_tag_education:true});},i=function(){g();e({nux_cancel:true});};return {init:function(j,k){a=j;b=$A(k).map(String);PageTransitions.registerHandler(function(){g();a=false;e=undefined;b=[];});},showDialog:function(j,k,l){if(a&&b.contains(j)){g();Arbiter.inform('DynamicFriendListEducation/dialogOpen',{uid:k,flid:j});e=l;c=new Dialog().setAsync(new AsyncRequest('ajax/friends/lists/smart_list_education.php').setMethod('GET').setData({flid:j,uid:k}).setReadOnly(true)).setHandler(h.bind(this,j)).setCloseHandler(function(){Arbiter.inform('DynamicFriendListEducation/dialogClosed',{uid:k,flid:j});}).setCancelHandler(function(){Arbiter.inform('DynamicFriendListEducation/dialogCancel',{uid:k,flid:j});}).show();}else l();},showContextualDialog:function(j,k,l,m){if(a&&b.contains(j)){g();f=l;e=m;new AsyncRequest('ajax/friends/lists/smart_list_contextual_education.php').setMethod('GET').setData({flid:j,uid:k}).setReadOnly(true).send();}else m();},setContextualDialog:function(j,k,l,m){d=j;d.setContext(f);d.show();Event.listen(k,'click',h.bind(this,m));Event.listen(l,'click',i);}};})();
var FriendEditLists=(function(){var a=7,b={},c="ajax/profile/removefriendconfirm.php",d="friends/ajax/remove_friend.php@type=friend&fbx=1",e;function f(n,o,p){var q=b[n.id],r=function(s){var t={action:p?'add_list':'del_list',to_friend:q.id,friendlists:[o],source:e};if(s)copy_properties(t,s);q.updateList(o,p);var u;if(p&&o==FriendStatus.CLOSE_FRIENDS){u=i(n,FriendStatus.ACQUAINTANCES);if(Menu.isItemChecked(u)){Menu.toggleItem(u);f(n,FriendStatus.ACQUAINTANCES,false);}}else if(p&&o==FriendStatus.ACQUAINTANCES){u=i(n,FriendStatus.CLOSE_FRIENDS);if(Menu.isItemChecked(u)){Menu.toggleItem(u);f(n,FriendStatus.CLOSE_FRIENDS,false);}}var v={flid:o,uid:q.id},w=p?'FriendListHovercard/add':'FriendListHovercard/remove';Arbiter.inform(w,v);new AsyncRequest().setURI('ajax/add_friend/action.php').setData(t).send();};if(p){DynamicFriendListEducation.showDialog(o,q.id,r);}else r();}function g(n){var o=DOM.scry(n,'input')[0];return o&&o.value;}function h(n,o,p){var q={uid:o.id};new AsyncRequest().setURI(d).setMethod('POST').setData({friend:o.id}).setHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL,q)).setErrorHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL_FAIL,q)).setStatusElement(p).send();}function i(n,o){var p=Menu.getItems(n);for(var q=0;q<p.length;q++)if(g(p[q])==o)return p[q];return null;}function j(n,o){var p=Menu.getItems(n);p.forEach(function(q){var r=g(q),s=o.lists.contains(r);if(Menu.isItemChecked(q)!==s)Menu.toggleItem(q);});}function k(n){var o=Menu.getItems(n),p=!CSS.hasClass(n,'followButtonFlyout')&&!CSS.hasClass(n,'likeButtonFlyout'),q=[],r=[],s=0,t=0;o.forEach(function(y){if(CSS.hasClass(y,'neverHide')){CSS.removeClass(y,'underShowMore');s++;}else if(Menu.isItemChecked(y)){q.push(y);}else if(CSS.hasClass(y,'neverShow')||CSS.hasClass(y,'FriendListCreateTrigger')||(!p&&CSS.hasClass(y,'friendOptionsOnly'))){CSS.addClass(y,'underShowMore');t++;}else r.push(y);});var u=a-s,v=q.concat(r),w=t;v.forEach(function(y){if(CSS.hasClass(y,'ShowMoreItem')){u--;return;}if(u){CSS.removeClass(y,'underShowMore');u--;}else{CSS.addClass(y,'underShowMore');w=true;}});CSS.conditionClass(n,'hasMoreFriendListItems',w);var x=DOM.scry(n,'.FriendListMenuShowMore');x.forEach(function(y){CSS.removeClass(y,'FriendListMenuShowMore');});}function l(n,o){var p=DOM.scry(n,'.FriendListUnfriend')[0],q=DOM.scry(n,'.FriendListCancel')[0];if(q)CSS.conditionShow(q,o.status==FriendStatus.OUTGOING_REQUEST);if(p){CSS.conditionShow(p,o.status==FriendStatus.ARE_FRIENDS);DOM.find(p,'a').setAttribute('ajaxify',URI(c).addQueryData({uid:o.id}).toString());}}var m=function(){m=bagofholding;Arbiter.subscribe(FriendRequestMessage.STATUS,function(n,o){for(var p in b){var q=ge(p),r=b[p];if(q&&r&&r.id==o.uid){j(q,r);l(q,r);k(q);}}});Menu.subscribe('select',function(n,o){if(CSS.hasClass(o.item,'ShowMoreItem')&&CSS.hasClass(o.menu,'FriendListMenu')){CSS.addClass(o.menu,'FriendListMenuShowMore');ScrollableArea.poke(o.item);}});};return {init:function(n,o,p){n=$(n);e=p;m();if(!b[n.id])Menu.subscribe('select',function(q,r){if(DOM.contains(n,r.item))if(Parent.byClass(r.item,'FriendListItem')){Menu.toggleItem(r.item);var s=g(r.item);f(n,s,Menu.isItemChecked(r.item));}else if(Parent.byClass(r.item,'FriendListCancel')){h(n,b[n.id],r.item);}else if(Parent.byClass(r.item,'FriendListUnfriend'))FriendListFlyoutController.hide(false);});CSS.addClass(n,'async_saving');FriendStatus.getFriend(o,function(q){j(n,q);l(n,q);b[n.id]=q;k(n);CSS.removeClass(n,'async_saving');}.bind(this));}};})();
var FriendListFlyoutController=(function(){var a,b,c=null,d=null,e,f,g,h,i,j,k=1500;function l(){clearTimeout(h);}function m(){if(e){CSS.removeClass(e,'selected');CSS.removeClass(e,'uiButtonHover');if(DataStore.get(e,'flfcloselistener')){var x=e;DataStore.set(e,'flfcloselistenertimeout',w.curry(x).defer(k));}}b=false;o();e=null;}function n(x){if(DOM.isNodeOfType(x,'label')&&CSS.hasClass(x,'uiButton'))x=Button.getInputElement(x);return DataStore.get(x,'profileid');}function o(){f&&f.remove();f=null;i&&Arbiter.unsubscribe(i);i=null;h&&clearTimeout(h);h=null;}function p(x){var y=n(x),z=DataStore.get(x,'flloc');FriendEditLists.init(c,y,z);CSS.conditionClass(c,'followButtonFlyout',CSS.hasClass(x,'profileFollowButton'));CSS.conditionClass(c,'friendButtonFlyout',CSS.hasClass(x,'FriendRequestFriends')||CSS.hasClass(x,'FriendRequestIncoming')||CSS.hasClass(x,'FriendRequestOutgoing'));CSS.conditionClass(c,'likeButtonFlyout',CSS.hasClass(x,'profileLikeButton'));var aa=DOM.scry(c,'div.uiScrollableArea')[0];aa&&ScrollableArea.poke(aa);}function q(x){if(!a||b)return;a.setContext(x);CSS.addClass(x,'selected');CSS.addClass(x,'uiButtonHover');a.setFixed(CSS.isFixed(x)).show();e=x;b=true;if(c){p(x);}else new AsyncRequest().setURI('ajax/friends/lists/flyout_content.php').setStatusElement(a.getOverlay()).send();o();f=Event.listen(x,'mouseleave',s);i=Arbiter.subscribe('Overlay/show',u);if(DataStore.get(x,'flfcloselistener'))clearTimeout(DataStore.remove(x,'flfcloselistenertimeout'));var y=n(x);FriendStatus.getFriend(y,function(z){if(!d)return;if(z.status==FriendStatus.OUTGOING_REQUEST){CSS.show(d);AsyncRequest.bootstrap('ajax/friends/lists/nux_flyout.php',null,true);}else CSS.hide(d);});}function r(x){e=x;g=q.curry(x).defer(350);f=Event.listen(x,'mouseleave',function(){clearTimeout(g);e=null;f&&f.remove();});}function s(){h=u.defer(150);}function t(){var x=Dialog.getCurrent(),y=x&&x.getBody();return !!(y&&DOM.scry(y,'.friendListDialogTourCarousel')[0]);}function u(){if(j||t())return;ua.ie()<8&&document.documentElement.focus();a&&a.hide();}function v(event){var x=Parent.byTag(event.getTarget(),'a');if(x&&CSS.hasClass(x,'FriendListActionItem'))s();}function w(x){var y=DataStore.remove(x,'flfcloselistener');y&&y();}return {init:function(x){FriendListFlyoutController.init=bagofholding;a=x;a.subscribe('mouseenter',l);a.subscribe('mouseleave',s);a.subscribe('hide',m);if(c)DOM.setContent(a.getContent(),[c,d]);Event.listen(document.documentElement,'mouseover',function(y){var z=Parent.byClass(y.getTarget(),'enableFriendListFlyout');if(z)if(e===z){clearTimeout(h);}else{b&&u();r(z);}});Arbiter.subscribe('DynamicFriendListEducation/dialogOpen',function(){j=true;});Arbiter.subscribe('DynamicFriendListEducation/dialogClosed',function(){j=false;s();});},initContent:function(x){var y=x.getRootNode();DOM.appendContent(document.body,y);(function(){if(!c){c=y;a&&DOM.setContent(a.getContent(),[c,d]);CSS.show(c);Event.listen(c,'click',v);b&&p(e);}else{DOM.remove(y);y=null;}}).defer();},initNux:function(x){if(d)return;d=x.getRootNode();a&&DOM.setContent(a.getContent(),[c,d]);},show:function(x){q(x);},hide:function(x){x===false?u():s();},setActiveNode:function(x){b&&u();e=x;f=Event.listen(x,'mouseleave',function(){e=null;f&&f.remove();});},setCloseListener:function(x,y){DataStore.set(x,'flfcloselistener',y);if(e!=x)DataStore.set(x,'flfcloselistenertimeout',w.curry(x).defer(k));},setCloseListenerTimeout:function(x){k=x;}};})();
var FollowButton=window.FollowButton||(function(){var a=14;function b(e,f,g){CSS.conditionShow(f,g);CSS.conditionShow(e,!g);}function c(e,f){if(f&&CSS.hasClass(e,'enableFriendListFlyout')){FriendListFlyoutController.show(e);}else FriendListFlyoutController.hide();}function d(e,f,g){var h=DOM.scry(e,'.lowIcon')[0],i=DOM.scry(e,'.medIcon')[0],j=DOM.scry(e,'.highIcon')[0];if(!h||!i||!j)return;Arbiter.subscribe('SubscriptionLevelUpdated',function(k,l){if(g===l.profile_id)switch(l.level){case SubscriptionLevels.ALL:Button.setIcon(f,j);break;case SubscriptionLevels.DEFAULT:Button.setIcon(f,i);break;case SubscriptionLevels.TOP:Button.setIcon(f,h);break;}});}return {init:function(e,f,g,h,i,j){if(!CSS.hasClass(g,'enableFriendListFlyout'))SubscriptionFlyoutController.initNode(g,h,i);if(i==a&&CSS.shown(g))SubscriptionFlyoutController.show(g);Event.listen(f,'click',function(){b(f,g,true);SubscriptionFlyoutController.setActiveNode(g);var m=new URI(f.getAttribute('ajaxify')),n={profile_id:h,location:i,source:'follow-button',subscribed_button_id:g.id,xids:m.getQueryData().xids};new AsyncRequest().setURI(j).setData(n).setRelativeTo(g).send();});e&&d(e,g,h);Arbiter.subscribe(['FollowUser','FollowingUser','UnfollowUser','UnfollowingUser'],function(m,n){if(n.profile_id==h)b(f,g,m=='FollowUser'||m=='FollowingUser');c(g,m=='FollowUser');});var k=false;Arbiter.subscribe('UnfollowingUser',function(m,n){if(n.profile_id==h){k=CSS.shown(g);k&&b(f,g,false);}});Arbiter.subscribe('UnfollowUserFail',function(m,n){if(n.profile_id==h&&k)b(f,g,true);});Arbiter.subscribe('FollowUserFail',function(m,n){if(n.profile_id==h&&k)b(f,g,false);});var l=false;Arbiter.subscribe([FriendRequestMessage.SENDING,FriendRequestMessage.CONFIRMING],function(m,n){if(n.uid==h){l=CSS.shown(f);l&&b(f,g,true);}});Arbiter.subscribe([FriendRequestMessage.SEND_FAIL,FriendRequestMessage.CONFIRM_FAIL],function(m,n){if(n.uid==h&&l)b(f,g,false);});Arbiter.subscribe(FriendRequestMessage.UNFRIEND,function(m,n){(n.uid==h)&&b(f,g,false);});}};})();
__e("legacy:dom-collect",["collectDataAttributes"],function(a,b,c,d){a.collect_data_attribs=b('collectDataAttributes');},3);
var AddFriendButton={ERROR_ALREADY_ADDED:1431005,init:function(a,b,c,d,e,f,g,h,i,j,k){var l=null,m=DOM.scry(a,'.addButton')[0],n=DOM.scry(a,'.outgoingButton')[0],o=DOM.scry(a,'.incomingButton')[0],p=DOM.scry(a,'.friendButton')[0];function q(w,x,y){var z=new URI(m.getAttribute('ajaxify'));link_data=collect_data_attribs(a,['ft','gt']);new AsyncRequest().setURI(f).setData({to_friend:b,action:w,how_found:d,ref_param:e,link_data:link_data,outgoing_id:n.id,xids:z.getQueryData().xids,logging_location:g,no_flyout_on_click:h,ego_log_data:i,http_referer:k,unwanted_pymk_ids:r()}).setErrorHandler(x).setServerDialogCancelHandler(y).setRelativeTo(n).send();}function r(){var w=Parent.byClass(a,'chainPymkList');if(!w)return [];var x=[];DOM.scry(w,'.outgoingButton').forEach(function(y){var z=y.getAttribute('data-profileid');if(z)x.push(z);});return x;}function s(w,x){m&&CSS.hide(m);n&&CSS.hide(n);o&&CSS.hide(o);p&&CSS.hide(p);if(w)CSS.show(w);if('Outgoing'==x&&l!=x&&j)animation(w).from('backgroundColor','#FFF8CC').to('backgroundColor','#FFFFFF').from('borderColor','#FFE222').to('borderColor','#FFFFFF').duration(2000).go();l&&CSS.removeClass(a,'fStatus'+l);l=x;CSS.addClass(a,'fStatus'+x);}function t(w){if(CSS.hasClass(w,'enableFriendListFlyout')){FriendListFlyoutController.show(w);}else FriendListFlyoutController.hide();}var u=Arbiter.subscribe(FriendRequestMessage.STATUS,function(w,x){if(x.uid!=b)return;switch(x.status){case FriendStatus.ARE_FRIENDS:return s(p,'Friends');case FriendStatus.INCOMING_REQUEST:return s(o,'Incoming');case FriendStatus.OUTGOING_REQUEST:return s(n,'Outgoing');case FriendStatus.CAN_REQUEST:return s(m,'Requestable');}}),v;if(c)v=Arbiter.subscribe(FriendRequestMessage.CONFIRM,function(w,x){x.uid==b&&goURI(c);});m&&Event.listen(m,'click',function(){Arbiter.inform(FriendRequestMessage.SENDING,{uid:b});if(h){FriendListFlyoutController.setActiveNode(n);}else t(n);q("add_friend",function(w){var x=w.error==AddFriendButton.ERROR_ALREADY_ADDED?FriendRequestMessage.SENT:FriendRequestMessage.SEND_FAIL;Arbiter.inform(x,{uid:b});FriendListFlyoutController.hide();AsyncResponse.defaultErrorHandler(w);},function(w){Arbiter.inform(FriendRequestMessage.SEND_FAIL,{uid:b});FriendListFlyoutController.hide();});});PageTransitions.registerHandler(function(){Arbiter.unsubscribe(u);v&&Arbiter.unsubscribe(v);});}};
var FriendButtonIcon={init:function(a,b,c){var d=DOM.find(b,'.defaultIcon'),e=DOM.find(b,'.closeIcon'),f=DOM.find(b,'.acqIcon');Arbiter.subscribe('FriendListMembershipChange',function(g,h){if(h.uid==c){var i=h.lists.contains(FriendStatus.CLOSE_FRIENDS),j=h.lists.contains(FriendStatus.ACQUAINTANCES);if(i&&!j){Button.setIcon(a,e);}else if(j&&!i){Button.setIcon(a,f);}else Button.setIcon(a,d);}});}};
__e("legacy:menu-legacy",["Menu"],function(a,b,c,d){a.Menu=b('Menu');},3);
var RespondToRequestButton={init:function(a,b,c){Event.listen(a,'click',function(){CSS.addClass(a,'uiButtonConfirm');CSS.addClass(a,'selected');b.show();});b.subscribe('hide',function(){CSS.removeClass(a,'uiButtonConfirm');CSS.removeClass(a,'selected');});Menu.subscribe('select',function(d,e){if(!CSS.hasClass(e.menu,'requestResponseMenu'))return;if(CSS.hasClass(e.item,'reject')){CSS.hide(a);CSS.show(c);}b.hide();});}};
function RenderManager(a){copy_properties(this,{_isDirty:false,_obj:a});}copy_properties(RenderManager.prototype,{dirty:function(){if(!this._isDirty){this._isDirty=true;bind(this,this.doPaint).defer();}},doPaint:function(){this._isDirty=false;this._obj.paint();}});
function CounterDisplay(a,b,c,d,e,f){copy_properties(this,{_name:a,_valueNode:$(b),_wrapperNode:$(c)||null,_statusClass:e,_rm:new RenderManager(this),_arbiterSubscription:null,_count:0});var g=this._valueNode.firstChild;if(g){var h=parseInt(g.nodeValue,10);if(!isNaN(h))this._count=h;}this._statusNode=d?$(d):null;this._subscribeAll();CounterDisplay.instances.push(this);if(!f)onleaveRegister(this._destroy.bind(this),true);}copy_properties(CounterDisplay,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(a,b){Arbiter.inform(CounterDisplay.EVENT_TYPE_ADJUST+'/'+a,b);},setCount:function(a,b){Arbiter.inform(CounterDisplay.EVENT_TYPE_UPDATE+'/'+a,b);}});Class.mixin(CounterDisplay,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){Arbiter.unsubscribe(this._arbiterSubscription);delete this._arbiterSubscription;}CounterDisplay.instances.remove(this);},adjustCount:function(a){this._count=Math.max(0,this._count+a);this._rm.dirty();return this;},setCount:function(a){this._count=Math.max(0,a);this._rm.dirty();return this;},paint:function(){DOM.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)CSS.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)CSS.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var a=[CounterDisplay.EVENT_TYPE_ADJUST+'/'+this._name,CounterDisplay.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=Arbiter.subscribe(a,this._onInform.bind(this),Arbiter.SUBSCRIBE_NEW);},_onInform:function(a,b){b=parseInt(b);if(isNaN(b))return;if(a.indexOf(CounterDisplay.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(b);}else if(a.indexOf(CounterDisplay.EVENT_TYPE_UPDATE)!=-1){this.setCount(b);}else return;return;}});
__e("legacy:array-utils",["ArrayUtils","hasArrayNature"],function(a,b,c,d){a.$A=b('ArrayUtils').createFrom;a.hasArrayNature=b('hasArrayNature');},3);
function show(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='';}return false;}function hide(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='none';}return false;}function shown(a){a=ge(a);return (a.style.display!='none'&&!(a.style.display==''&&a.offsetWidth==0));}function toggle(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);b.style.display=CSS.getStyle(b,"display")=='block'?'none':'block';}return false;}function toggleDisplayNone(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);if(shown(b)){hide(b);}else show(b);}return false;}
__e("legacy:Toggler",["Toggler"],function(a,b,c,d){a.Toggler=b('Toggler');},3);
__e("UntrustedLink",["copyProperties","event-extensions","URI"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("event-extensions"),i=b("URI");function j(k,l,m,n){this.dom=k;this.url=k.href;this.hash=l;this.func_get_params=n||function(){return {};};Event.listen(this.dom,'click',this.onclick.bind(this));Event.listen(this.dom,'mousedown',this.onmousedown.bind(this));Event.listen(this.dom,'mouseup',this.onmouseup.bind(this));Event.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(h.$E(m));}j.bootstrap=function(k,l,m,n){if(k.__untrusted)return;k.__untrusted=true;new j(k,l,m,n);};j.prototype.getRewrittenURI=function(){var k=g({u:this.url,h:this.hash},this.func_get_params(this.dom)),l=new i('l.php');return l.setQueryData(k).setSubdomain('www').setProtocol('http');};j.prototype.onclick=function(){(function(){this.dom.href=this.url;}).bind(this).defer(100);this.dom.href=this.getRewrittenURI();};j.prototype.onmousedown=function(k){if(k.button==2)this.dom.href=this.getRewrittenURI();};j.prototype.onmouseup=function(){this.dom.href=this.getRewrittenURI();};j.prototype.onmouseout=function(){this.dom.href=this.url;};e.exports=j;});
__e("htmlHyperlink",["Env","UntrustedLink","URLScraper"],function(a,b,c,d,e,f){var g=b("Env"),h=b("UntrustedLink"),i=b("URLScraper");function j(k,l,m,n){if(typeof k==='undefined'||!k.toString)return '';if(typeof l!=='function')l=htmlize;if(typeof m!=='function')m=htmlize;var k=k.toString(),o=[],p;while((p=i.match(k))){var q=k.indexOf(p);if(q>=0)o.push(l(k.substring(0,q)));var r=m(p),s=p.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(p)))s='http://'+s;o.push('<a target="_blank" rel="nofollow" href="'+s+'"');if(n)o.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');o.push('>'+r+'</a>');k=k.substring(q+p.length);}k&&o.push(l(k));return o.join('');}e.exports=j;});
__e("isEmail",[],function(a,b,c,d,e,f){function g(h){return (/^([\w!.%+\-])+@([\w\-])+(?:\.[\w\-]+)+$/).test(h);}e.exports=g;});
__e("legacy:string-misc",["htmlHyperlink","isEmail"],function(a,b,c,d){a.html_hyperlink=b('htmlHyperlink');a.is_email=b('isEmail');},3);
__e("legacy:dom-html",["HTML"],function(a,b,c,d){a.HTML=b('HTML');},3);
function XHPTemplate(a){this._model=a;}XHPTemplate.prototype={render:function(){if(HTML.isHTML(this._model))this._model=DOM.setContent(document.createDocumentFragment(),this._model)[0];return this._model.cloneNode(true);},build:function(){return new XHPTemplateInstance(this.render());}};copy_properties(XHPTemplate,{getNode:function(a,b){return XHPTemplate.getNodes(a)[b];},getNodes:function(a){var b=DataStore.get(a,'XHPTemplate:nodes');if(!b){b={};var c=DOM.scry(a,'[data-jsid]');c.push(a);var d=c.length;while(d--){var e=c[d];b[e.getAttribute('data-jsid')]=e;e.removeAttribute('data-jsid');}DataStore.set(a,'XHPTemplate:nodes',b);}return b;}});function XHPTemplateInstance(a){this._root=a;this._populateNodes();}XHPTemplateInstance.prototype={_populateNodes:function(){this._nodes={};this._leaves={};var a=this._root.getElementsByTagName('*');for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute('data-jsid');if(e){d.removeAttribute('data-jsid');this._nodes[e]=d;this._leaves[e]=!d.childNodes.length;}}},getRoot:function(){return this._root;},getNode:function(a){return this._nodes[a];},setNodeProperty:function(a,b,c){this.getNode(a)[b]=c;return this;},setNodeContent:function(a,b){if(!this._leaves[a])throw new Error("Can't setContent on non-leaf node: "+a);DOM.setContent(this.getNode(a),b);return this;}};
var UFIOptimistic={COMMENT_SEND_EVENT:'ufi/comment',_commentSeqNo:0,init:function(a){this._commentTemplate=a;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var a=event.getTarget(),b=a.name=='comment'&&a.parentNode&&Parent.byClass(a,'optimistic_submit');if(!b)return true;var c=a.form,d=DOM.find(c,'textarea');if(Input.isEmpty(d))return true;fc_uncollapse(c);var e=this._commentTemplate.render(),f=XHPTemplate.getNode(e,'text');DOM.setContent(f,HTML(htmlize(trim(d.value))));var g=DOM.scry(c,'ul.commentList')[0];if(!g)return true;CSS.show(g.parentNode);g.appendChild(e);var h=g.lastChild,i=rand32();h.id='optimistic_comment_'+i+'_'+this._commentSeqNo++;var j=Form.serialize(c);j.comment_replace=h.id;j.comment=1;function k(){new AsyncRequest(Form.getAttribute(c,'action')).setData(j).setRelativeTo(c).setErrorHandler(function(m){CSS.addClass(h,'uiUfiCommentFailed');AsyncResponse.defaultErrorHandler(m);}).send();}Event.listen(XHPTemplate.getNode(e,'retry_link'),'click',k);k();d.value=d.style.height='';d.focus();var l=window.MentionsInput&&MentionsInput.getInstance(d);l&&l.reset();Arbiter.inform(UFIOptimistic.COMMENT_SEND_EVENT,{form:c});return false;}};
__e("legacy:user-activity",["UserActivity"],function(a,b,c,d){a.UserActivity=a.UserActivity||b('UserActivity');},3);
function TickerController(){}!function(){var a=1,b=2,c=3,d=4;copy_properties(TickerController,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(e){var f=Parent.byClass($(e),'fbFeedTicker');return f?TickerController._instances[f.id]:null;},isLoaded:function(e){var f=TickerController._placeholders[e.id];return !f||f.status==c;},show:function(e,f){f=f||bagofholding;for(var g in TickerController._instances){var h=ge(g);if(!h||h.parentNode.id==e.id)continue;TickerController.hide(h.parentNode);}TickerController._doPositionChange(e);CSS.show(e);var i=TickerController._placeholders[e.id];if(i&&i.status==a){TickerController._fetchTickerForPlaceholder(e,f);}else{var j=DOM.scry(e,'.fbFeedTicker')[0],k=j&&TickerController.getInstance(j);TickerController._activeInstance=k;k&&k._poll();TickerController._placeholders[e.id]={status:d,callback:f};f();}},_doPositionChange:function(e){if(!TickerController._logPositionChange||CSS.shown(e))return;new AsyncSignal('common/ods_endpoint.php',{k:'ticker.render.switch.'+e.id}).send();},hide:function(e){var f=DOM.scry(e,'.fbFeedTicker')[0],g=f&&TickerController.getInstance(f);g&&g.hideActiveStory();CSS.hide(e);},hideStoriesByClass:function(e){for(var f in TickerController._instances)DOM.scry($(f),e).forEach(CSS.hide);},hideStory:function(e){var f=e&&TickerController.getInstance(e);f&&f.hideStory(e);},undoHideStory:function(e){var f=e&&TickerController.getInstance(e);f&&f.undoHideStory(e);},_fetchTickerForPlaceholder:function(e,f){var g={handler:function(){TickerController._placeholders[e.id].status=c;f();}};UIPagelet.loadFromEndpoint('TickerPagelet',e.id,TickerController._placeholders[e.id].pageletData,g);TickerController._placeholders[e.id].status=b;},registerStoryDialog:function(e,f){Arbiter.subscribe('ticker/init',function(){var g=ge(e),h=g&&TickerController.getInstance(g);h&&h.registerStoryDialog(g,f);},Arbiter.SUBSCRIBE_ALL);},registerPlaceholder:function(e,f){var g=TickerController._placeholders[e];TickerController._placeholders[e]={status:a,pageletData:f};if(g&&g.status==d){TickerController.show($(e));g.callback();}}});}();TickerController.prototype={ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(a,b,c){TickerController._instances[a.id]=this;TickerController._activeInstance=this;this._root=a;this._content=DOM.find(a,'.ticker_stream');this._stories=DOM.find(this._root,'.tickerActivityStories');this._scrollableArea=b;this._container=DOM.find(a,'div.uiScrollableAreaWrap');this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var d=Date.now();this._initTime=d;this._lastUpdate=d;this._lastPull=d;this._lastInsert=d;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=DOM.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!Parent.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();this._ua={flyout:user_action('ticker_flyout').set_namespace('ticker').set_ua_id('flyout'),flyout_prefetch:user_action('ticker_flyout_prefetch').set_namespace('ticker').set_ua_id('flyout_prefetch'),flyout_loadtime:user_action('ticker_flyout_loadtime').set_namespace('ticker').set_ua_id('flyout_loadtime'),stream:user_action('ticker_stream').set_namespace('ticker').set_ua_id('stream')};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var e=$N('div',{className:'storyQueue hidden_elem'});this._storyQueue=e;DOM.appendContent(this._root,e);this._initObjectIDs();this._initPageletCache(c);this._initConfig(c);this._resetMorePager();this._initListeners();this._initSubscriptions(c);Arbiter.inform('ticker/init',this,Arbiter.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}},_loadStoriesWithActions:function(){var a=ge('rightCol');if(!a)return;this._toggleWrapper=DOM.scry(a,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var b=DOM.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var c=0;c<b.length;c++){var d=b[c];this._storiesWithActions[d.getAttribute('data-story-key')]=d;}}},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController(this._root.parentNode.id,this);if(this._cache){copy_properties(a,this._cache.loadData());this._cache.registerCleanup('Ticker/cleanup');}}},_initConfig:function(a){copy_properties(this,{_newest:a.newest,_page_newest:a.newest,_timeout:a.timeout,_heartbeatTimeout:Math.max(15000,a.heartbeatTimeout),_pullTimeout:Math.max(30000,a.pullTimeout),_insertTimeout:a.insertTimeout,_friendCount:a.friendCount,_maxQueueLength:a.maxQueueLength,_heartbeatEndpoint:a.heartbeatEndpoint,_maxCustomQueueLength:a.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,a.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:a.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(a.insertTimeout,a.minForceUpdateInterval),_popupOnHover:a.popupOnHover,_priorityAppId:a.priorityAppId,_prefetchOnHover:a.prefetchStoriesOnHover,_userIdleTimeout:a.userIdleTimeout,_firstCustomStoryDelay:a.firstCustomStoryDelay,_pollOnly:a.pollOnly,_tickerDebug:a.tickerDebug,_tickerSource:a.tickerSource,_prefetchAfterLoad:a.prefetchAfterLoad,_logFlyouts:a.logFlyouts});this._queueCustomStories(a.customStories);},_initListeners:function(){this._listeners=Event.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=Event.listen(this._container,'scroll',throttle(this._handleScroll.bind(this)));this._initInfiniteScrollListener.bind(this).defer();},_initSubscriptions:function(a){onleaveRegister(this._cleanup.bind(this));this._subscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),Arbiter.subscribe(PresenceMessage.getArbiterMessageType('ticker_update'),this._handleTickerPush.bind(this)),Arbiter.subscribe('composer/publish',this._handleComposerPublish.bind(this)),Arbiter.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),Arbiter.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),Arbiter.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),Arbiter.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),Arbiter.subscribe(UFIOptimistic.COMMENT_SEND_EVENT,this._scrollDialogToBottom.bind(this)),Arbiter.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(a.pushChannel)this.setPushChannel(a.pushChannel);},_handleClick:function(event){var a=event.getTarget();if(this._getButtonFromNode(a)){this._logUserAction(a,'click',event);this._handleActionButton(event);return;}var b=this._getStoryFromNode(a),c=Parent.byClass(a,'tickerStoryAllowClick');if(!b||b==this._selectedStory||c)return;if(this._storyIsHidden(b))return;if(b==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(b)){var d=b.getAttribute('data-href');if(d&&!a.getAttribute('href')){var e={href:d},f=collect_data_attribs(a,['ft','gt']);user_action('click',e,event,'FORCE',f);}else this._logUserAction(a,'click',event);this._openStoryExternally(b,event);return;}this._logUserAction(a,'flyout',event);this._activateStory(b,'click');this._selectStory(b);},_handleMouseover:function(event){this._setLocked(true);var a=event.getTarget(),b=this._getOpenableStory(a);if(!b)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(b.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=b.id;}this._fetchStory(b);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var c=this._storyCanOpenExternally(b)?500:1000,d=this._activeStory?75:c;if(!window.addEventListener&&document.createEventObject)event=document.createEventObject(event);this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',d);this._logUserEvent('flyout_loadtime','open');this._activateStory(b,'hover');this._logUserAction(a,'flyout',event);}.bind(this),d);}},_handleMouseout:function(event){var a=event.getTarget();this._setLocked(false);if(a==this._getStoryFromNode(a)){var b=DOM.scry(a.parentNode,'.openToggler');for(var c=0;c<b.length;c++)Selector.toggle(b[c]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var a=this._activeStory;if(!a)return;var b=Event.getKeyCode(event);switch(b){case KEYS.UP:case KEYS.DOWN:var c=this._getInsertedStories(),d;if(event.getModifiers().any){d=b===KEYS.UP?0:c.length-1;}else d=c.indexOf(a)+(b===KEYS.UP?-1:1);a=c[d];break;case KEYS.ESC:this._deactivateStory(true);return;default:return;}if(!a)return;event.kill();this._activateStory(a,'keypress');this._selectStory(a);},_fadeTopmostStoryButton:function(){var a=0,b=15;if(this._storiesWithActions)for(var c in this._storiesWithActions){var d=this._storiesWithActions[c],e=DOM.scry(d,'.tickerInlineActionButton')[0],f=DOM.scry(e,'.tickerActionIcon')[0],g=Vector2.getElementPosition(e).y-Vector2.getElementPosition(this._toggleWrapper).y;if(g<a){CSS.setStyle(e,'opacity',0);CSS.setStyle(f,'opacity',0);}else if(g>=a&&g<b){var h=(g-a)/(b-a);CSS.setStyle(e,'opacity',h);CSS.setStyle(f,'opacity',h);break;}else{CSS.setStyle(e,'opacity',1);CSS.setStyle(f,'opacity',1);}}},_handleScroll:function(){this._fadeTopmostStoryButton();!this._preventScrollDismiss&&this._deactivateStory(true);this._checkInfiniteScroll();if(!this._scrollLogged){this._scrollLogged=true;var a=this._stories.childNodes.length,b=this._stories.getAttribute('data-gt'),c={ticker_scroll:1,number_stories:a,source:b};report_data('scroll',{gt:c});}},_handleStoriesInserted:function(){this._initInfiniteScrollListener();this._scrollableArea.adjustGripper();this._logUserEvent('stream','insert');},_handleActionButton:function(event){var a=event.getTarget(),b=this._getButtonFromNode(a),c=this._getOpenableStory(a),d=this._getStoryDialog(c);if(d)var e=d.subscribe('beforehide',function(){d.unsubscribe(e);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scrollToTop:function(a){animation(this._container).to('scrollTop',0).ease(animation.ease.end).ondone(a).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return DOM.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(a){return !CSS.hasClass(a,'queuedStory')&&!CSS.hasClass(a,'customStory');});},_getQueuedStories:function(){return DOM.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return DOM.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(a){return Parent.byClass(a,'tickerInlineOverlay');},_getStoryFromNode:function(a){return Parent.byClass(a,'fbFeedTickerStory');},_getActionButtonFromStory:function(a){return DOM.scry(a,'.tickerInlineActionButton')[0];},_getOpenableStory:function(a){var b=this._getStoryFromNode(a);return this._storyCanOpenDialog(b)?b:null;},_getStoryDialog:function(a){return window.ContextualDialogX&&ContextualDialogX.getInstance(a)||null;},_getStoryDialogEndpoint:function(a){return a&&a.getAttribute('data-rel')=='async'&&a.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(a){return !!this._getStoryDialogEndpoint(a)&&!this._storyIsHidden(a);},_storyCanOpenExternally:function(a){return !!a.getAttribute('data-href')||!this._storyCanOpenDialog(a);},_storyIsHidden:function(a){return CSS.hasClass(a,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(a){this._deactivateStory();CSS.addClass(a,'tickerStoryHidden');CSS.removeClass(a,'tickerStoryClickable');},undoHideStory:function(a){CSS.addClass(a,'tickerStoryClickable');CSS.removeClass(a,'tickerStoryHidden');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(a){this._scrollTopPromptVisible=a;CSS.conditionShow(this._scrollTopPrompt,a);if(a&&!this._listeners.scrollTop){this._listeners.scrollTop=Event.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!a&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !UserActivity.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){this._debug('poll');if(!this._isTickerVisible()){this._debug('not polling: ticker not visible');return;}if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var a=this._storiesToRemove.pop();this.removeStory(a);}if(this._isUserIdle()){this._debug('not polling: idle');return UserActivity.subscribeOnce(this._poll.bind(this));}var b=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(b);var c=Date.now(),d=c-this._lastInsert;if(d<this._insertTimeout||this._isLocked())return this._schedulePoll();var e=this._getQueuedStories(),f=this._getQueuedCustomStories(),g=e.length>0,h=f.length>0&&(c-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!g&&(c-this._lastCustomStory)>this._customStoryInsertTimeout));if(h){this.insertStory(f.shift());this._lastCustomStory=c;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;this._debug('not polling: should insert custom story');return this._schedulePoll();}if(g){this.insertStory(e.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;this._debug('not polling: should insert story');return this._schedulePoll();}var i=f.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&UserActivity.isActive(this.ADS_IDLE_MS)&&((c-this._lastUpdate)>this._minForceUpdateInterval),j=false,k=false;if(this._pollOnly){k=c-this._lastUpdate>this._heartbeatTimeout;}else j=(c-this._lastPull>this._pullTimeout);var l=(i&&this._doCustomUpdate)||j||k;if(!l)return this._schedulePoll();if(i)this._doCustomUpdate=false;this._debug('polling for new stories');this.update({pull:j,fullpoll:k,needcustomstory:i});},update:function(a){var b={newest:(a.fullpoll||a.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};copy_properties(b,a);new AsyncRequest().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(b).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(b.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(a,b,c){this._lastInsert=Date.now();window.LiveTimer&&LiveTimer.addTimeStamps(a);CSS.removeClass(a,'queuedStory');CSS.removeClass(a,'customStory');if(b!==false){var d=c?this._fadeStoryIn:this._flyStoryIn;if(this._isScrolledToTop()){this._scrollToTop(d.bind(this,a));}else d.call(this,a);}else DOM.prependContent(this._stories,a);if(this._storiesWithActions&&CSS.hasClass(a,'tickerStoryWithButton'))this._storiesWithActions[a.getAttribute('data-story-key')]=a;this._removeOldStories();},_removeOldStories:function(){var a=this._getInsertedStories();if(a.length<=this._maxStoriesToKeep)return;var b=this._minStoriesToKeep,c=a.slice(b);c.each(DOM.remove);if(this._storiesWithActions)for(var d=0;d<c.length;d++)delete this._storiesWithActions[c[d].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var a=this._getInsertedStories();if(!a||!a.length)return;var b=a[a.length-1].getAttribute('data-ticker-timestamp'),c=DOM.scry(this._root,'.tickerMorePager a')[0];if(!c||!b)return;var d=new URI(c.getAttribute('ajaxify'));d.addQueryData({oldest:b});c.setAttribute('ajaxify',d);},_setLocked:function(a){this._locked=a;},_isLocked:function(){return !!(this._scrollTopPromptVisible||this._locked||this._activeStory);},informAndRemoveStory:function(a,b,c){var d=this._getStoryFromNode(a),e=d.getAttribute('data-story-key');DOM.setContent(d,b);CSS.addClass(d,'highlightedStory');this._setTimeout(this.removeStory.bind(this,e),c||6000);},_getStoryByStoryKey:function(a){var b=this._getAllStories();for(var c=0;c<b.length;c++){var d=b[c];if(d.getAttribute('data-story-key')==a)return d;}return null;},removeStory:function(a){this._removedStoryIDs[a]=true;var b=this._getStoryByStoryKey(a);if(!b)return;if(this._storiesWithActions)delete this._storiesWithActions[a];if(b==this._activeStory)this._deactivateStory();var c=this._getStoryDialog(b);c&&c.destroy();if(CSS.hasClass(b,'queuedStory')){DOM.remove(b);return;}this._animateStoryOut(b);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(a){var b=$N('div',{style:{marginTop:'-1000px'}},a);CSS.setStyle(b,'opacity',0);DOM.prependContent(this._stories,b);var c=Vector2.getElementDimensions(b).y;CSS.setStyle(b,'marginTop','-'+c+'px');this._isInsertingStory=true;animation(b).to('marginTop',0).ease(animation.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){DOM.replace(b,a);this._afterInsert(a);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(a){animation(this._stories).to('opacity',.5).ondone(function(){DOM.prependContent(this._stories,a);animation(this._stories).to('opacity',1).ondone(function(){this._afterInsert(a);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(a){var b=$N('div',{style:{overflow:'hidden',position:'relative'}});DOM.insertBefore(b,a);DOM.appendContent(b,a);animation(b).to('top',20).to('height',0).to('opacity',0).ease(animation.ease.end).ondone(function(){DOM.remove.curry(b);Arbiter.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(a){Arbiter.inform('Ticker/afterInsert');if(a&&CSS.hasClass(a,'tickerSponsoredStory')){ad=DOM.scry(a,'.fbEmuStreamStory')[0];ad&&ad.id&&Arbiter.inform('tickerad_'+ad.id);}},setPushChannel:function(a){this._pushSubscription&&Arbiter.unsubscribe(this._pushSubscription);this._pushSubscription=Arbiter.subscribe(PresenceMessage.getArbiterMessageType(a),this._handleTickerPush.bind(this));requireLazy(['ChatConfig','ChannelConnection'],function(b,c){if(b.get('channel_disconnect_warning')){this._channelConnection=c;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}}.bind(this));},_checkChannelConnection:function(){CSS.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(a){this._priorityAppId=a;},_handleTickerPush:function(a,b){if(this._isUserIdle()){this._debug('discarding story: user is idle');return;}var c=b.obj;if(c.delete_id){this._storiesToRemove.push(c.delete_id);return;}var d=c.story_xhp;if(!d){this._debug('discarding story: no markup');return;}this._newest=c.story_time;var e=HTML(d).getRootNode();this.queueStory(e,c.flyout_js_cmds);},_handleComposerPublish:function(a,b){b.tickerMarkup&&this.insertStory(b.tickerMarkup);},_clearNux:function(){var a=DOM.scry(document.body,'div.tickerNUXContainer');if(a.length){a.each(function(b){var c=ContextualDialogX.getInstance(b);c&&c.hide();});new AsyncRequest().setURI('ajax/feed/ticker/nux.php').send();}this._clearNux=bagofholding;},_logRender:function(){if(this._loggedRender)return;var a=this._tickerInSidebarMode;if(a||Parent.byClass(this._content,'home_right_column')){new AsyncSignal('ajax/log_ticker_render.php',{sidebar_mode:a}).send();this._loggedRender=true;}},_isTickerVisible:function(){var a=(TickerController._activeInstance==this);a&&this._logRender();return a;},_handleResponse:function(a){var b=a.getPayload();if(b.newest)this._newest=this._page_newest=b.newest;if(b.content)if(b.cache_update&&this._cache){this._cache.insertStory(b.content);}else if(b.content instanceof Array){for(var c=0;c<b.content.length;c++)this.queueStoryMarkup(b.content[c]);}else this.queueStoryMarkup(b.content);if(b.custom_stories&&b.custom_stories.length){this._queueCustomStories(b.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(a){var b=HTML(a).getRootNode();this.queueStory(b);},dedupeStory:function(a){var b=a.getAttribute('data-story-key'),c=b&&(!!this._objectIDs[b]||!!this._removedStoryIDs[b]);if(c)this._debug('discarding story: duplicated object id');b&&(this._objectIDs[b]=true);return c;},queueStory:function(a,b){if(this.dedupeStory(a))return;CSS.addClass(a,'queuedStory');DOM.appendContent(this._storyQueue,a);var c=b&&b.length;if(c)b.each(function(e){new Function(e).apply();});a.setAttribute('id',a.id+'_'+this._root.id);var d=this._getQueuedStories();d.slice(0,-this._maxQueueLength).each(DOM.remove);if(c)this._fetchedStories[a.id]=true;},_queueCustomStories:function(a){while(a.length){var b=a.shift();b=HTML(b).getRootNode();var c=b.getAttribute('data-story-key');if(this.dedupeStory(b))continue;CSS.addClass(b,'customStory');DOM.appendContent(this._storyQueue,b);}var d=this._getQueuedCustomStories();d.slice(0,-this._maxQueueLength).each(DOM.remove);},_cleanup:function(){TickerController._placeholders.pagelet_rhc_ticker=null;if(!Parent.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.each(Arbiter.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&Arbiter.unsubscribe(this._pushSubscription);for(var a in this._listeners)this._listeners[a]&&this._listeners[a].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();Arbiter.inform('Ticker/cleanup');},_onNavHandler:function(a,b){var c=b.params.key;if(c!='lf'&&c!='h')this._cleanup();},registerStoryDialog:function(a,b){if(this._uaCurStoryIDFetch==a.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==a.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[a.id]=true;b.setContext(a);b.subscribe('hide',this._deactivateStory.bind(this,true));b.subscribe('success',this._focusStory.bind(this,a));b.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){b.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));b.subscribe('mouseleave',this._scheduleHide.bind(this));b.subscribe('show',function(){this._highlightDialogScrollbar.bind(this,b).defer();var c=Event.listen(b.getContent(),'click',function(){this._selectStory(a);c.remove();}.bind(this));}.bind(this));}if(a==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(b);}},_highlightDialogScrollbar:function(a){var b=DOM.scry(a.getContent(),'.uiScrollableArea')[0];b&&ScrollableArea.poke(b);},_openStoryExternally:function(a,event){var b=a.getAttribute('data-href');if(!b||b=='#')return;var c=a.getAttribute('data-story-rel');switch(c){case 'theater':this._deactivateAndClearStory();Bootloader.loadComponents('PhotoSnowbox',function(){PhotoSnowbox.bootstrap(b,a);});return;case 'async':this._deactivateAndClearStory();Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(b,a);});return;}var d=a.getAttribute('data-target'),e=(event.which!=1||event.getModifiers().any||d=='_blank');e?window.open(b,'_blank'):goURI(b);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStory:function(a){clearTimeout(this._scrollDismissal);this._preventScrollDismiss=true;this._scrollDismissal=this._setTimeout(function(){this._preventScrollDismiss=false;}.bind(this),100);a.focus();},_selectStory:function(a){this._selectedStory=a;CSS.addClass(a,'tickerStorySelected');CSS.addClass(this._root,'tickerChildSelected');},_activateStory:function(a,b){this._clearHoverTimeouts();if(a==this._activeStory||!this._storyCanOpenDialog(a))return;this._deactivateStory();this._focusStory(a);this._activeStory=a;CSS.addClass(a,'tickerStoryActive');window.Toggler&&Toggler.hide();if(this._logFlyouts){b=b||'unknown';new AsyncSignal('ajax/feed/ticker/flyout.php',{src:b}).send();}var c=this._getStoryDialog(a);if(c){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(c);return;}if(!(a.id in this._fetchedStories)){this._uaCurStoryIDFetch=a.id;this._logUserEvent('flyout','fetch');}this._fetchStory(a);},_deactivateStory:function(a){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){this._dialog.setFadeOnHide(a===true).hide();this._logUserEvent('flyout','close');}if(this._activeStory){CSS.removeClass(this._activeStory,'tickerStoryActive');CSS.removeClass(this._activeStory,'tickerStorySelected');CSS.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;document.activeElement.blur();},_logUserAction:function(a,b,event){user_action(b,a,event,'FORCE',null);},_logUserEvent:function(a,event){if(this._ua[a])this._ua[a].add_event(event);},_fetchStory:function(a){clearTimeout(this._fetchToken);var b=[],c=this._getInsertedStories(),d=c.indexOf(a);[-2,-1,0,1,2].each(function(e){var f=c[d+e];f&&b.push(f);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,b),100);},_fetchStories:function(a){var b=[],c,d=function(e){clearTimeout(c);a.each(function(f){CSS.conditionClass(f,'tickerStoryFetching',e);});};a=a.filter(function(e){if(e.id in this._fetchedStories)return false;this._fetchedStories[e.id]=true;var f=this._getStoryDialogEndpoint(e),g=URI(f).getQueryData();if(!f||!g)return false;g.uniq_id=e.getAttribute('id');g.referrer=this._tickerSource;b.push(g);return true;},this);if(!b.length)return;c=this._setTimeout(d.curry(true),500);new AsyncRequest('ajax/feed/ticker/multi_story').setFinallyHandler(d.curry(false)).setErrorHandler(bagofholding).setData({stories:b}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var a=event.getTarget(),b=Parent.byTag(a,'a'),c=this._getStoryFromNode(a),d=this._getButtonFromNode(a);if(c&&b&&!d&&CSS.hasClass(c,'tickerStoryClickable')&&!CSS.hasClass(b,'tickerStoryAllowClick')&&!this._storyIsHidden(c)){b.setAttribute('rel','ignore');b.removeAttribute('onclick');b.removeAttribute('ajaxify');b.removeAttribute('href');}var e=(event.button==2),f=this._getActionButtonFromStory(c);if(!e&&f)this._setClickedStory(c);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(a){this._clearClickedStory();CSS.addClass(a,'tickerStoryClicked');this._clickedStory=a;},_clearClickedStory:function(){if(this._clickedStory){CSS.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var a=this._getInsertedStories();if(this._storiesWithActions)for(var b=0;b<a.length;b++){var c=a[b];if(CSS.hasClass(c,'tickerStoryWithButton'))this._storiesWithActions[c.getAttribute('data-story-key')]=c;}var d=Math.max(0,a.length-this._autoloadStoryIndex);this._infiniteScrollStory=a[d];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var a=Vector2.getElementPosition(this._infiniteScrollStory).y,b=Vector2.getElementPosition(this._container).y+Vector2.getElementDimensions(this._container).y;if(a<b){var c=DOM.scry(this._root,'.tickerMorePager a')[0];if(c){var d=Parent.byClass(c,'stat_elem')||c,e=new AsyncRequest(c.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(c).setStatusElement(d).setAllowCrossPageTransition(true).send();this._logUserEvent('stream','scroll');}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(a){if(!this._selectedStory)return;var b=this._getStoryDialog(this._selectedStory);if(b){b.setFixed(a);b.updatePosition();}},_setTimeout:function(a,b){return setTimeout(a,b,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.uiScrollableAreaWrap')[0],c=b&&ScrollableArea.getInstance(b);c&&c.scrollToBottom();},_openDialog:function(a){this._dialog=a.show();this._updateDialogPosition();this._writeSwfFrame(a);this._initCommentFocusListener.bind(this).defer();this._initContentResizeListener.bind(this).defer();this._stupidIE7VideoResizeHack(a);},_stupidIE7VideoResizeHack:function(a){if(ua.ie()===7){var b=DOM.scry(a.getContent(),'.uiVideoThumb .img');b.each(function(c){CSS.setStyle(c,'width','');});}},_updateDialogPosition:function(){var a=this._tickerInSidebarMode||!!Parent.byClass(this._root,'fixed_elem');this._dialog.setFixed(a);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(a){var b=this._dialog&&this._dialog.getContent(),c=DOM.scry(b,'.swfObject')[0];if(!c)return;var d=c.getAttribute('data-swfid');if(d&&window[d]){var e=window[d];e.write(c);}},_initCommentFocusListener:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.tickerDialogFooter textarea')[0];if(!b)return;this._listeners.inputFocus=Event.listen(b,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var a=this._dialog&&this._dialog.getContent();if(!a)return;this._listeners.contentResize=Event.listen(a,'click',function(){this._dialog.updatePosition.bind(this._dialog).defer();}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.uiScrollableAreaWrap')[0];if(!b)return;var c=Vector2.getElementDimensions(b),d=Vector2.getElementPosition(b),e=DOM.scry(b,'.uiUfi .uiUfiComment'),f=Vector2.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,g=Math.min(this.FLYOUT_MAX_HEIGHT,f),h=g-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var i=0;i<e.length;i++){var j=e[i],k=Vector2.getElementPosition(j),l=k.y-d.y;if(Math.abs(l-h)<=this.FLYOUT_OFFSET_THRESHOLD){h=l+this.FLYOUT_COMMENT_OFFSET;break;}}if(c.y>h){CSS.setStyle(b,'height',h+'px');CSS.setStyle(b,'max-height',null);}else{CSS.setStyle(b,'max-height',g+'px');CSS.setStyle(b,'height',null);}},_initObjectIDs:function(){stories=this._getAllStories();for(var a=0;a<stories.length;++a){var b=stories[a].getAttribute('data-story-key');b&&(this._objectIDs[b]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},_debug:function(a){this._tickerDebug&&console.log('ticker: ',a);},getNewest:function(){return this._newest;}};
__e("ImageUtils",["ua"],function(a,b,c,d,e,f){var g=b("ua"),h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.safari()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;});
__e("legacy:image-has-loaded",["ImageUtils"],function(a,b,c,d){a.image_has_loaded=b('ImageUtils').hasLoaded;},3);
__e("legacy:intl-locale",["Locale"],function(a,b,c,d){a.intl_locale_is_rtl=b('Locale').isRTL;},3);
__e("legacy:control-dom",["DOMControl"],function(a,b,c,d){a.DOMControl=b('DOMControl');},3);
function TextInputControl(a){this.parent.construct(this,a);var b=this.getRoot(),c=function(){this.update.bind(this).defer();}.bind(this);Event.listen(b,{keydown:c,paste:c});}Class.extend(TextInputControl,'DOMControl');TextInputControl.prototype={setMaxLength:function(a){Input.setMaxLength(this.getRoot(),a);return this;},getValue:function(){return Input.getValue(this.getRoot());},isEmpty:function(){return Input.isEmpty(this.getRoot());},setValue:function(a){Input.setValue(this.getRoot(),a);this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(a){Input.setPlaceholder(this.getRoot(),a);return this;}};
function TextMetrics(a){this._node=a;var b=this._shadow=$N('textarea',{className:'textMetrics'}),c=['fontSize','fontStyle','fontWeight','fontFamily','lineHeight','wordWrap'];c.each(function(d){CSS.setStyle(b,d,CSS.getStyle(a,d));});document.body.appendChild(b);}TextMetrics.prototype={measure:function(){var a=this._node,b=this._shadow,c=a.clientWidth-CSS.getStyleFloat(a,'paddingLeft')-CSS.getStyleFloat(a,'paddingRight');CSS.setStyle(b,'width',c+'px');b.value=a.value+'...';return {width:b.scrollWidth,height:b.scrollHeight};},destroy:function(){DOM.remove(this._shadow);}};
function TextAreaControl(a){this.autogrow=false;this.parent.construct(this,a);this.width=null;Event.listen(a,{focus:this._handleFocus.bind(this)});}Class.extend(TextAreaControl,'TextInputControl');Class.mixin(TextAreaControl,'Arbiter',{setAutogrow:function(a){this.autogrow=a;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var a=this.getRoot();if(!this.metrics)this.metrics=new TextMetrics(a);if(typeof this.minHeight==='undefined'){var b=CSS.getStyleFloat(a,'height');this.minHeight=b>0?b:a.offsetHeight-8;}if(typeof this.isBorderBox==='undefined')if(CSS.getStyle(a,'box-sizing')=='border-box'||CSS.getStyle(a,'-moz-box-sizing')=='border-box'||CSS.getStyle(a,'-webkit-box-sizing')=='border-box'){this.isBorderBox=true;this.borderBoxOffset=CSS.getStyleFloat(a,'padding-top')+CSS.getStyleFloat(a,'padding-bottom')+CSS.getStyleFloat(a,'border-top-width')+CSS.getStyleFloat(a,'border-bottom-width');}else this.isBorderBox=false;var c=this.metrics.measure(),d=Math.max(this.minHeight,c.height);if(this.isBorderBox)d+=this.borderBoxOffset;if(d!=this.height){CSS.setStyle(a,'height',d+'px');this.height=d;Arbiter.inform('reflow');this.inform('resize');}}else if(this.metrics){this.metrics.destroy();this.metrics=null;}},resetHeight:function(){this.height=-1;this.update();},_handleFocus:function(){this.width=null;}});TextAreaControl.getInstance=function(a){var b=DOMControl.getInstance(a);if(!b){b=new TextAreaControl(a);CSS.hasClass(a,'uiTextareaAutogrow')&&b.setAutogrow(true);a._has_control=true;}return b;};
__e("legacy:dom-scroll",["DOMScroll"],function(a,b,c,d){a.DOMScroll=b('DOMScroll');},3);
__e("legacy:dom-untrusted",["UntrustedLink"],function(a,b,c,d){a.UntrustedLink=b('UntrustedLink');},3);
__e("legacy:key-event-constants",["Keys"],function(a,b,c,d){a.KEYS=b('Keys');},3);
function KeyEventController(){this.handlers={};document.onkeyup=this.onkeyevent.bind(this,'onkeyup');document.onkeydown=this.onkeyevent.bind(this,'onkeydown');document.onkeypress=this.onkeyevent.bind(this,'onkeypress');}copy_properties(KeyEventController,{instance:null,getInstance:function(){return KeyEventController.instance||(KeyEventController.instance=new KeyEventController());},defaultFilter:function(event,a){event=$E(event);return KeyEventController.filterEventTypes(event,a)&&KeyEventController.filterEventTargets(event,a)&&KeyEventController.filterEventModifiers(event,a);},filterEventTypes:function(event,a){if(a==='onkeydown')return true;return false;},filterEventTargets:function(event,a){var b=event.getTarget();return !DOM.isNodeOfType(b,KeyEventController._interactiveElements)||(b.type in KeyEventController._uninterestingTypes)||(DOM.isNodeOfType(b,['input','textarea'])&&b.value.length===0&&event.keyCode in KeyEventController._controlKeys);},filterEventModifiers:function(event,a){if(event.ctrlKey||event.altKey||event.metaKey||event.repeat)return false;return true;},registerKey:function(a,b,c,d){if(c===undefined)c=KeyEventController.defaultFilter;var e=KeyEventController.getInstance(),f=e.mapKey(a);if(is_empty(e.handlers))onleaveRegister(e.resetHandlers.bind(e));for(var g=0;g<f.length;g++){a=f[g];if(!e.handlers[a]||d)e.handlers[a]=[];e.handlers[a].push({callback:b,filter:c});}},keyCodeMap:{BACKSPACE:[8],TAB:[9],RETURN:[13],ESCAPE:[27],LEFT:[37,63234],UP:[38,63232],RIGHT:[39,63235],DOWN:[40,63233],DELETE:[46],COMMA:[188],PERIOD:[190],'`':[192],'[':[219],']':[221]},_interactiveElements:['input','select','textarea','object','embed'],_uninterestingTypes:{checkbox:1,radio:1,submit:1},_controlKeys:{8:1,9:1,13:1,27:1,37:1,63234:1,38:1,63232:1,39:1,63235:1,40:1,63233:1,46:1}});copy_properties(KeyEventController.prototype,{mapKey:function(a){if(a>=0&&a<=9){if(typeof(a)!='number')a=a.charCodeAt(0)-48;return [48+a,96+a];}var b=KeyEventController.keyCodeMap[a.toUpperCase()];if(b)return b;return [a.toUpperCase().charCodeAt(0)];},onkeyevent:function(a,b){b=$E(b);var c=null,d=this.handlers[b.keyCode],e,f,g;if(d)for(var h=0;h<d.length;h++){e=d[h].callback;f=d[h].filter;try{if(!f||f(b,a)){g=e(b,a);if(g===false)return Event.kill(b);}}catch(i){}}return true;},resetHandlers:function(){this.handlers={};}});
__e("legacy:link-controller",["LinkController"],function(a,b,c,d){a.LinkController=b('LinkController');},3);
__e("legacy:input-selection",["InputSelection","copyProperties"],function(a,b,c,d){var e=b('InputSelection'),f=b('copyProperties');f(a.Input||(a.Input={}),{getSelection:e.get,setSelection:e.set});},3);
__e("legacy:rect",["Rect"],function(a,b,c,d){a.Rect=b('Rect');},3);
__e("AsyncRequestNectarLogging",["string-extensions","AsyncRequest","Env","copyProperties"],function(a,b,c,d,e,f){b("string-extensions");var g=b("AsyncRequest"),h=b("Env"),i=b("copyProperties");i(g.prototype,{setNectarModuleData:function(j){if(this.method=='POST'){var k=h.module;if(j&&k===undefined){var l={fbpage_fan_confirm:1},m=null;for(var n=j;n&&n!=document.body;n=n.parentNode){if(!n.id||typeof n.id!=='string')continue;if(n.id.startsWith('pagelet_')){k=n.id;break;}if(!m&&l[n.id])m=n.id;}if(k===undefined&&m)k=m;}if(k!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._mod=k;}}},setNectarImpressionId:function(){if(this.method=='POST'){var j=h.impid;if(j!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._impid=j;}}}});});
__e("legacy:async-postlude",["AsyncRequestNectarLogging"],function(a,b,c,d){b('AsyncRequestNectarLogging');},3);
var Base64=(function(){var a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function b(e){e=(e.charCodeAt(0)<<16)|(e.charCodeAt(1)<<8)|e.charCodeAt(2);return String.fromCharCode(a.charCodeAt(e>>>18),a.charCodeAt((e>>>12)&63),a.charCodeAt((e>>>6)&63),a.charCodeAt(e&63));}var c='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function d(e){e=(c.charCodeAt(e.charCodeAt(0)-43)<<18)|(c.charCodeAt(e.charCodeAt(1)-43)<<12)|(c.charCodeAt(e.charCodeAt(2)-43)<<6)|c.charCodeAt(e.charCodeAt(3)-43);return String.fromCharCode(e>>>16,(e>>>8)&255,e&255);}return {encode:function(e){e=unescape(encodeURI(e));var f=(e.length+2)%3;e=(e+'\0\0'.slice(f)).replace(/[\s\S]{3}/g,b);return e.slice(0,e.length+f-2)+'=='.slice(f);},decode:function(e){e=e.replace(/[^A-Za-z0-9+\/]/g,'');var f=(e.length+3)&3;e=(e+'AAA'.slice(f)).replace(/..../g,d);e=e.slice(0,e.length+f-3);try{return decodeURIComponent(escape(e));}catch(g){throw new Error('Not valid UTF-8');}},encodeObject:function(e){return Base64.encode(JSON.stringify(e));},decodeObject:function(e){return JSON.parse(Base64.decode(e));},encodeNums:function(e){return String.fromCharCode.apply(String,e.map(function(f){return a.charCodeAt((f|-(f>63))&-(f>0)&63);}));}};})();
if(window==window.top)!function(){var a=function(){var b=0;return function(){if(!b){b=1;setTimeout(function(){b=0;var c=Vector2.getViewportDimensions();setCookie('wd',c.x+'x'+c.y);if(window.AsyncSignal&&Math.random()<.01)new AsyncSignal('ajax/dimension_context.php',{x:c.x,y:c.y}).send();},100);}};}();onloadRegister_DEPRECATED(a);onloadRegister_DEPRECATED(function(){Event.listen(window,'resize',a);});onloadRegister_DEPRECATED(function(){Event.listen(window,'focus',a);});}();
__e("ErrorDialog",["Dialog"],function(a,b,c,d,e,f){var g=b("Dialog"),h={showAsyncError:function(i){try{return h.show(i.getErrorSummary(),i.getErrorDescription());}catch(j){alert(i);}},show:function(i,j,k,l){return (new g()).setTitle(i).setBody(j).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(k||bagofholding).setButtonsMessage(l||'').show();}};e.exports=h;});
__e("legacy:error-dialog",["ErrorDialog"],function(a,b,c,d){var e=b('ErrorDialog');a.ErrorDialog=e;},3);
__e("legacy:ContextualDialogX",["ContextualDialogX"],function(a,b,c,d){a.ContextualDialogX=b('ContextualDialogX');},3);
Hovercard=window.Hovercard||{RESERVED_WIDTH:297,RESERVED_HEIGHT:237,dialogs:{},active:{},contextElem:null,hoverElem:null,showingDialog:null,fetchDelay:150,showDelay:700,loadingDelay:1000,hideDelay:250,fetchTimer:null,showTimer:null,loadingTimer:null,hideTimer:null,init:function(){if(ua.ie()<7)return;Event.listen(document.documentElement,'mouseover',this.handle.bind(this));Event.listen(window,'scroll',bind(this,'hide',true));Arbiter.subscribe('page_transition',function(){this.abort();this.dirtyAll();}.bind(this),Arbiter.SUBSCRIBE_NEW);Arbiter.subscribe('layer_shown',function(a,b){b.type!='Hovercard'&&b.type!='Overlay'&&this.abort();}.bind(this),Arbiter.SUBSCRIBE_NEW);this.init=bagofholding;},handle:function(event){var a=Parent.byTag(event.getTarget(),'a');if(a&&this.setActive(a)){this.process(a);event.stop();}},setActive:function(a){this.hoverElem=a;if(!this.isActive(a)){var b;if(!a||!(b=this.getEndpoint(a))){this.active.moveToken&&this.active.moveToken.remove();this.active={};return false;}if(this.active.node!=a){this.active.moveToken&&this.active.moveToken.remove();this.active={node:a,endpoint:b,pos:null};}}return true;},isActive:function(a){return a&&this.contextElem&&this.active.node==a;},getEndpoint:function(a){return a.getAttribute('data-hovercard');},process:function(a){var b=Event.listen(a,'mouseout',function(){clearTimeout(this.fetchTimer);clearTimeout(this.showTimer);b.remove();this.hoverElem=null;this.hide();}.bind(this));if(!this.active.moveToken)this.active.moveToken=Event.listen(a,'mousemove',function(event){this.active.pos=Vector2.getEventPosition(event);}.bind(this));clearTimeout(this.fetchTimer);clearTimeout(this.showTimer);clearTimeout(this.hideTimer);var c=this.fetchDelay,d=this.contextElem?this.hideDelay:this.showDelay;if(a.getAttribute('data-hovercard-instant'))c=d=50;this.fetchTimer=setTimeout(this.fetch.bind(this,a),c);this.showTimer=setTimeout(this.show.bind(this,a),d);},show:function(a,b){if(this.active.node!=a)return;var c=this.dialogs[this.getEndpoint(a)];if(c){this.showDialog(c);}else if(b){this.showDialog(this._getLoadingDialog());}else{var d=this.contextElem?this.hideDelay:this.showDelay;this.loadingTimer=setTimeout(this.show.bind(this,a,true),this.loadingDelay-d);}},hide:function(a){if(!this.contextElem)return;if(a){if(this.showingDialog){Arbiter.inform('layer_hidden',{type:'Hovercard'});Arbiter.inform('Hovercard/hide',{node:this.contextElem});this.showingDialog.hide();}this.hoverElem=null;this.contextElem=null;this.showingDialog=null;}else this.hideTimer=setTimeout(this.hide.bind(this,true),this.hideDelay);},abort:function(){this.hide(true);clearTimeout(this.showTimer);},showDialog:function(a){var b=this.active.node,c=this.contextElem,d=c!=b;if(this.contextElem){var e=ContextualDialogX.getInstance(this.contextElem);e&&e.hide();}if(!DOM.contains(document.body,b)){this.hide(true);return;}this.contextElem=b;this.showingDialog=a;this.position();a.setContext(b).show();if(d){(function(){new AsyncSignal('ajax/hovercard/shown.php').send();user_action('himp',this.contextElem,null,'FORCE',{ft:{evt:39}});}.bind(this)).defer();if(c){Arbiter.inform('Hovercard/hide',{node:c});}else Arbiter.inform('layer_shown',{type:'Hovercard'});Arbiter.inform('Hovercard/show',{node:b});}},position:function(){var a=Vector2.getViewportDimensions(),b=Vector2.getElementPosition(this.contextElem,'viewport'),c=b.convertTo('document'),d=this.getBounds(this.contextElem),e='above',f='left',g=this.calcOffsetY(c,d,'above');if(b.y+g<=this.RESERVED_HEIGHT){var h=this.calcOffsetY(c,d,'below');if(b.y+h+this.contextElem.offsetHeight+this.RESERVED_HEIGHT<a.y){e='below';g=h;}}var i=a.x;window.ChatSidebar&&(i-=ChatSidebar.getVisibleWidth());var j=this.calcOffsetX(c,d,'left');if(b.x+j+this.RESERVED_WIDTH>=i){var k=this.calcOffsetX(c,d,'right');if(b.x+k+this.contextElem.offsetWidth>this.RESERVED_WIDTH){f='right';j=k;}}this.showingDialog.setPosition(e).setAlignH(f).setOffsetX(j).setOffsetY(g);},calcOffsetX:function(a,b,c){if(c=='left')return b.l-a.x;return b.r-(a.x+this.contextElem.offsetWidth);},calcOffsetY:function(a,b,c){if(c=='above')return b.t-a.y;return b.b-(a.y+this.contextElem.offsetHeight);},getBounds:function(a){var b=this.active.pos,c=a.getClientRects();if(!b||c.length===0)return Rect.getElementBounds(a);var d,e=false;for(var f=0;f<c.length;f++){var g=new Rect(Math.round(c[f].top),Math.round(c[f].right),Math.round(c[f].bottom),Math.round(c[f].left),'viewport').convertTo('document'),h=g.getPositionVector(),i=h.add(g.getDimensionVector());if(!d||(h.x<=d.l&&h.y>d.t)){if(e)break;d=new Rect(h.y,i.x,i.y,h.x,'document');}else{d.t=Math.min(d.t,h.y);d.b=Math.max(d.b,i.y);d.r=i.x;}if(g.contains(b))e=true;}return d;},fetch:function(a){if(a.id&&this.dialogs[a.id]!=null)return;var b=this.getEndpoint(a);if(this.dialogs[b]!=null)return;this.setFetchInProgress(b);var c=function(){this.dirty(b);this.abort();}.bind(this);new AsyncRequest(b).setData({endpoint:b}).setMethod('GET').setReadOnly(true).setErrorHandler(c).setTransportErrorHandler(c).send();},setFetchInProgress:function(a){this.dialogs[a]=false;},_getLoadingDialog:function(){var a=new ContextualDialogX();a.init($N('div',{className:'HovercardLoading'},"\u52a0\u8f7d\u4e2d...")).setDestroyOnHide(false).setFadeOnShow(false).setFadeOnHide(false);this._initDialogSubscriptions(a);this._getLoadingDialog=bagof(a);return a;},setDialog:function(a,b){this.dialogs[a]=b;this._initDialogSubscriptions(b);if(this.active.endpoint==a&&this.hoverElem==this.active.node)this.showDialog(b);},_initDialogSubscriptions:function(a){a.subscribe('mouseenter',function(){clearTimeout(this.hideTimer);this.hoverElem=this.active.node;}.bind(this));a.subscribe('mouseleave',function(){this.hide(false);this.hoverElem=null;}.bind(this));},contains:function(a){if(this.showingDialog)return DOM.contains(this.showingDialog.getOverlay(),a);return false;},dirty:function(a){var b=this.dialogs[a];if(b){b.destroy();delete this.dialogs[a];}},dirtyAll:function(){for(var a in this.dialogs){var b=this.dialogs[a];b&&this.dirty(a);}}};onloadRegister_DEPRECATED(Hovercard.init.bind(Hovercard));
__e("StickyController",["event-extensions","css","Vector","FunctionUtils"],function(a,b,c,d,e,f){b('event-extensions');var g=b('css'),h=b('Vector'),i=b('FunctionUtils');function j(k,l,m,n){this._element=k;this._marginTop=l;this._onchange=m;this._proxy=n||k.parentNode;}j.prototype={handleScroll:function(){var k=h.getElementPosition(this._proxy,'viewport').y<=this._marginTop;if(this.isFixed()!==k){g.setStyle(this._element,'top',k?this._marginTop+'px':'');g.conditionClass(this._element,'fixed_elem',k);this._onchange&&this._onchange(k);}},start:function(){if(this._event)return;this._event=Event.listen(window,'scroll',i.throttle(this.handleScroll.bind(this),100));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return g.hasClass(this._element,'fixed_elem');}};a.StickyController=e.exports=j;},3);
__e("DocumentTitle",["array-extensions","Arbiter"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=document.title,i=1500,j=[],k=0,l=null,m=true;function n(){if(j.length>0){if(m){o.set(j[k].title,true);k=++k%j.length;m=false;}else o.reset();}else{clearInterval(l);l=null;o.reset();}}var o={get:function(){return h;},set:function(p,q){document.title=p;if(!q){h=p;g.inform('update_title',p);}},reset:function(){o.set(o.get(),true);m=true;},blink:function(p){var q={title:p};j.push(q);if(l===null)l=setInterval(n,i);return {stop:function(){var r=j.indexOf(q);if(r>=0){j.splice(r,1);if(k>r){k--;}else if(k==r&&k==j.length)k=0;}}};}};a.DocumentTitle=e.exports=o;},3);
__e("Poller",["AsyncRequest","Cookie","copyProperties","Env","Util"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Cookie'),i=b('copyProperties'),j=b('Env'),k=b('Util');function l(m,n,o){this._clearOnQuicklingEvent=!o;this._requestCallback=n;this.setTimePeriod(m);}l.MIN_TIME_PERIOD=2000;i(l.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod,this._clearOnQuicklingEvent);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(m){m=m||null;if(m&&(isNaN(m)||m<l.MIN_TIME_PERIOD))return;if(m&&this._timePeriod==null)this._token=this._makeRequest.bind(this).defer(m,this._clearOnQuicklingEvents);this._timePeriod=m;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var m=new g(),n=true;m.setInitialHandler(function(){return n;});this._cancelRequest=function(){n=false;};m.setFinallyHandler(this.scheduleRequest.bind(this));m.setInitialHandler=bagofholding;m.setFinallyHandler=bagofholding;this._requestCallback(m);if(n)m.send();},_isLoadUser:function(){return j.user==getCookie('c_user');},_cancelRequest:bagofholding,getTimePeriod:function(){return this._timePeriod;}});a.Poller=e.exports=l;},3);
__e("legacy:eval-global",["evalGlobal"],function(a,b,c,d){a.eval_global=b('evalGlobal');},3);
__e("legacy:onkeypress-flip-direction",["event-extensions","css","dom","Input"],function(a,b,c,d){b('event-extensions');var e=b('css'),f=b('dom'),g=b('Input');Event.listen(document.documentElement,'keyup',function(event){var h=event.getTarget();if(!f.isNodeOfType(h,['input','textarea']))return;if(f.isNodeOfType(h,'input')&&h.type=='password')return;if(h.getAttribute('data-prevent-auto-flip'))return;var i=g.getValue(h),j=(h.style&&h.style.direction);if(!j){for(var k=0;k<i.length;k++){var l=i.charCodeAt(k);if(l>=48){var m=(l>=1470&&l<=1920);e.setStyle(h,'direction',m?'rtl':'ltr');return;}}}else if(i.length===0)e.setStyle(h,'direction','');});},3);
onloadRegister_DEPRECATED(function(){Event.listen(document.documentElement,'submit',function(a){var b=a.getTarget().getElementsByTagName('*');for(var c=0;c<b.length;c++)if(b[c].getAttribute('placeholder')&&Input.isEmpty(b[c]))Input.setValue(b[c],'');});});
onloadRegister_DEPRECATED(function(){Event.listen(document.documentElement,'submit',function(a){var b=a.getTarget().getElementsByTagName('*');for(var c=0;c<b.length;c++)if(b[c].getAttribute('required')&&Input.isEmpty(b[c])){b[c].focus();return false;}},Event.Priority.URGENT);});
__e("LiveTimer",["css","dom","ua"],function(a,b,c,d,e,f){var g=b("css"),h=b("dom"),i=b("ua");e.exports=a.LiveTimer||{restart:function(j){this.serverTime=j;this.localStartTime=Date.now()/1000;this.updateTimeStamps();},updateTimeStamps:function(){LiveTimer.timestamps=h.scry(document.body,'abbr.livetimestamp');LiveTimer.startLoop(20000);},addTimeStamps:function(j){if(!j)return;LiveTimer.timestamps=LiveTimer.timestamps||[];if(h.isNodeOfType(j,'abbr')&&g.hasClass(j,'livetimestamp')){LiveTimer.timestamps.push(j);}else{var k=h.scry(j,'abbr.livetimestamp');for(var l=0;l<k.length;++l)LiveTimer.timestamps.push(k[l]);}LiveTimer.startLoop(0);},startLoop:function(j){this.stop();this.timeout=setTimeout(function(){LiveTimer.loop();},j);},stop:function(){clearTimeout(this.timeout);},updateNode:function(j,k){LiveTimer.updateNode=(i.ie()<7)?function(l,m){l.nextSibling.nodeValue=m;}:function(l,m){l.firstChild.nodeValue=m;};LiveTimer.updateNode(j,k);},loop:function(j){if(j)LiveTimer.updateTimeStamps();var k=Math.floor(Date.now()/1000-LiveTimer.localStartTime),l=-1;LiveTimer.timestamps&&LiveTimer.timestamps.each(function(n){var o=n.getAttribute('data-utime'),p=LiveTimer.renderRelativeTime(LiveTimer.serverTime+k,o);if(p.text)LiveTimer.updateNode(n,p.text);if(p.next!=-1&&(p.next<l||l==-1))l=p.next;});if(l!=-1){var m=Math.max(20000,l*1000);LiveTimer.timeout=setTimeout(function(){LiveTimer.loop();},m);}},renderRelativeTime:function(j,k){var l={text:"",next:-1};if(j-k>(12*3600)||(new Date(j*1000).getDay()!=new Date(k*1000).getDay()))return l;var m=j-k,n=Math.floor(m/60),o=Math.floor(n/60);if(n<1){l.text="\u51e0\u79d2\u949f\u524d";l.next=60-m%60;return l;}if(o<1){if(n==1){l.text="\u7ea61\u5206\u949f\u524d";}else l.text=tx._("{number}\u5206\u949f\u524d\u53d1\u5e03",{number:n});l.next=60-m%60;return l;}if(o!=11)l.next=3600-m%3600;if(o==1){l.text="\u7ea61\u5c0f\u65f6\u524d";return l;}l.text=tx._("{number}\u5c0f\u65f6\u524d",{number:o});return l;}};});
__e("legacy:live-timer",["LiveTimer"],function(a,b,c,d){a.LiveTimer=b('LiveTimer');},3);
__e("MessagingEvents",["array-extensions","Arbiter","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('copyProperties'),i=b('isEmpty'),j={},k=new g();function l(m){if(!i(j))return;for(var n in m)k.inform('count/'+n,m[n]);}k.subscribe('mark-as-read',function(m,n){(n.tids||n.chat_ids||[]).forEach(function(o){o=''+o;if(!(o in j)){j[o]=true;var p=function(){k.unsubscribe(q);clearTimeout(r);delete j[o];},q=k.subscribe('read',function(s,t){if((t.tids||[]).contains(o)||(t.chat_ids||[]).contains(o))p();}),r=p.defer(60000);}});});g.subscribe('presence/message:messaging',function(m,n){var o=h({},n.obj),event=o.event||'';delete o.type;delete o.event;k.inform(event,o);if('unread_counts' in o){var p=o.unread_counts;l({unread:p.inbox,other_unseen:p.other});}});g.subscribe('presence/message:inbox',function(m,n){var o=h(n.obj);delete o.type;l(o);});a.MessagingEvents=e.exports=k;},3);
var MessagingConst={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'}};
__e("DynamicIconSelector",["Button","css","dom","Selector"],function(a,b,c,d,e,f){var g=b("Button"),h=b("css"),i=b("dom"),j=b("Selector"),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__e("PrivacyConst",["copyProperties"],function(a,b,c,d,e,f){var g=b("copyProperties"),h={FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},i={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},j={ONLY_CORP_NETWORK:200,COLLEGE_NETWORK_FRIENDS_OF_FRIENDS:201,COLLEGE_NETWORK_FRIENDS:202},k={TYPE_COLLEGE:1,TYPE_HS:2,TYPE_CORP:3,TYPE_GEO:4,TYPE_MANAGED:14,TYPE_TEST:50},l=1;g(h,j);var m={BaseValue:h,FriendsValue:i,NetworksAll:l,NetworkTypes:k,SpecialPreset:j};e.exports=m;});
__e("AudienceSelector",["Arbiter","css","dom","DynamicIconSelector","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("css"),i=b("dom"),j=b("DynamicIconSelector"),k=b("PrivacyConst"),l=b("Selector");l.subscribe('select',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;var o=l.getOptionValue(n.option);if(o==k.BaseValue.CUSTOM){l.toggle(n.selector);return false;}if(h.hasClass(n.selector,'dataTooltip')){var p=i.find(n.option,'.itemAnchor').getAttribute('data-tooltip');l.setButtonTooltip(n.selector,p||null);}if(!h.hasClass(n.option,'specialOption'))return;var q=i.find(n.option,'a').getAttribute('data-type');if(h.hasClass(n.option,'moreOption')){h.addClass(n.selector,q);h.addClass(n.selector,'showSecondaryOptions');return false;}else if(h.hasClass(n.option,'returnOption')){h.removeClass(n.selector,'showSecondaryOptions');h.removeClass(n.selector,'friendList');return false;}});g.subscribe('CustomPrivacyOption/update',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;l.setSelected(n.selector,l.getOptionValue(n.option));j.swapIcon(n.selector);l.setButtonTooltip(n.selector,n.tooltip);g.inform('AudienceSelector/update',n.selector);});});
__e("ContextualLayerHideOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("copyProperties");function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('contextchange',this._handleContextChange.bind(this)),this._layer.subscribe('show',this.attach.bind(this)),this._layer.subscribe('hide',this.detach.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this.detach();},attach:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();if(j===window)return;this._listener=Event.listen(j,'scroll',this._layer.hide.bind(this._layer));},detach:function(){this._listener&&this._listener.remove();this._listener=null;},_handleContextChange:function(){this.detach();if(this._layer.isShown())this.attach();}});e.exports=i;});
__e("PopupWindow",["copyProperties","ua","Vector","dom"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("ua"),i=b("Vector"),j=b("dom"),k={_opts:{allowShrink:true,strategy:'vector',timeout:100,widthElement:null},init:function(l){copy_properties(k._opts,l);setInterval(k._resizeCheck,k._opts.timeout);},_resizeCheck:function(){var l=i.getViewportDimensions(),m=k._getDocumentSize(),n=m.y-l.y,o=m.x-l.x;if(o<0&&!k._opts.widthElement)o=0;if(!k._opts.allowShrink&&n<0)n=0;if(n||o)try{if(window.console&&window.console.firebug)console.log('Resizing will not work in firefox with firebug enabled. '+'See https_3A/bugzilla.mozilla.org/show_bug.cgi@id=691693');window.resizeBy(o,n);if(o)window.moveBy(o/-2,0);}catch(p){}},_getDocumentSize:function(){var l=i.getDocumentDimensions();if(k._opts.strategy==='offsetHeight')l.y=document.body.offsetHeight;if(k._opts.widthElement){var m=j.scry(document.body,k._opts.widthElement)[0];if(m)l.x=i.getElementDimensions(m).x;}if(window.Dialog&&Dialog.max_bottom&&Dialog.max_bottom>l.y)l.y=Dialog.max_bottom;return l;},open:function(l,m,n){var o=typeof window.screenX!='undefined'?window.screenX:window.screenLeft,p=typeof window.screenY!='undefined'?window.screenY:window.screenTop,q=typeof window.outerWidth!='undefined'?window.outerWidth:document.body.clientWidth,r=typeof window.outerHeight!='undefined'?window.outerHeight:(document.body.clientHeight-22),s=parseInt(o+((q-n)/2),10),t=parseInt(p+((r-m)/2.5),10),u=('width='+n+',height='+m+',left='+s+',top='+t);return window.open(l,'_blank',u);}};e.exports=k;});
__e("PrivacyModel",["PrivacyConst","copyProperties"],function(a,b,c,d,e,f){var g=b("PrivacyConst"),h=b("copyProperties");function i(){this.value=g.BaseValue.ALL_FRIENDS;this.friends=g.FriendsValue.NO_FRIENDS;this.networks=[];this.objects=[];this.lists=[];this.lists_x=[];this.list_anon=0;this.ids_anon=[];this.list_x_anon=0;this.ids_x_anon=[];this.tdata={};return this;}h(i.prototype,{init:function(j,k,l,m,n,o,p,q,r,s,t){this.value=j;this.friends=k;this.networks=l.slice();this.objects=m.slice();this.lists=n.slice();this.lists_x=o.slice();this.list_anon=p;this.ids_anon=q.slice();this.list_x_anon=r;this.ids_x_anon=s.slice();t=t||{};h(this.tdata,t);},clone:function(){var j=new i();j.init(this.value,this.friends,this.networks,this.objects,this.lists,this.lists_x,this.list_anon,this.ids_anon,this.list_x_anon,this.ids_x_anon,this.tdata);return j;},getData:function(){var j=['value','friends','networks','objects','lists','lists_x','list_anon','ids_anon','list_x_anon','ids_x_anon'],k={};for(var l=0;l<j.length;++l){var m=j[l];k[m]=this[m];}return k;}});e.exports=i;});
var MusicEvents=new Arbiter(),MusicProviders={SPOTIFY:'open.spotify.com'},MusicConstants=window.MusicConstants||{DEBUG:false,sameURLs:function(a,b){var c=/\/$/;if(a&&b){a=URI(a);b=URI(b);return a.getDomain()==b.getDomain()&&a.getPath()==b.getPath();}return false;},greaterOrEqualToMinimumVersion:function(a,b){var c=/(?:\d+\.)+/,d=a.match(c)[0].split('.').slice(0,-1),e=b.match(c)[0].split('.').slice(0,-1);if(d.length!==e.length)return false;for(var f=0;f<e.length;f++)if(+d[f]<+e[f]){return false;}else if(+d[f]>+e[f])return true;return true;},sanitizeForProviders:function(a){var b={};for(var c in a)if(this.ALLOWED_EXTERNAL_CONTEXT_PARAMS[c])b[c]=a[c];return b;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR',INCORRECT_ONLINE_STATE:'INCORRECT_ONLINE_STATE',LOG_SEND_OP:'LOG_SEND_OP',REQUEUE_OP:'REQUEUE_OP'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};
__e("legacy:Tooltip",["Tooltip"],function(a,b,c,d){a.Tooltip=b('Tooltip');},3);
var MusicButton=function(a,b,c,d,e,f){this.provider=a;this.buttonElem=b;this.url=c;this.context=d||{};this.mediaType=e;this.setState(this.STATES.OFFLINE);this.tooltip=f||'';MusicEvents.subscribe(MusicConstants.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};copy_properties(MusicButton,{tracksetableTypes:[]});copy_properties(MusicButton.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:4000,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(a){if(a!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||a;}if(a===this.STATES.PLAYING){Tooltip.set(this.buttonElem,this.tooltip);}else Tooltip.set(this.buttonElem,'');var b=this.buttonElem.parentNode;this.state&&CSS.removeClass(b,this.state);this.state=a;CSS.addClass(b,this.state);},isTracksetable:function(a){return MusicButton.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(a,b){clearTimeout(this._showLoadingTimer);if(b&&b.provider&&b.provider!=this.provider)return;switch(a){case MusicConstants.DIAGNOSTIC_EVENT.ONLINE:case MusicConstants.STATUS_CHANGE_EVENT.track:case MusicConstants.STATUS_CHANGE_EVENT.playing:var c=b&&b.track&&b.track.uri,d=b&&b.context&&b.context.uri;if(b&&b.playing&&(MusicConstants.sameURLs(c,this.url)||MusicConstants.sameURLs(d,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=this.setState.bind(this,this.STATES.PAUSED).defer(this.RECENTLY_ONLINE_TIMEOUT,false);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case MusicConstants.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case MusicConstants.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(a,b){if(b!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}var c=this.isTracksetable()&&Parent.byClass(this.buttonElem,'music_trackset_container'),d=[];if(c){var e=c.getAttribute('data-trackset-title'),f=this.provider,g=DOM.scry(c,'.music_button');for(var h=0;h<g.length;h++){var i=MusicButtonManager.getButton([g[h].id]);if(i&&i.provider==f&&i.isTracksetable())d.push(i.url);}}var j=function(){return (c&&d.length>1)?Music.playPauseSongList(this.provider,this.url,d,e,this.context):Music.playPauseSong(this.provider,this.url,this.context);}.bind(this);if(!window.Music){this.showLoading(true);Bootloader.loadComponents('Music',j);return;}var k=j();this.showLoading(!k);},showLoading:function(a){this.resetLoadingTimers();this._hideLoadingTimer=this._timeout.bind(this,a).defer(this.HIDE_LOADING_TIMEOUT,false);this._showLoadingTimer=this.setState.bind(this,this.STATES.LOADING).defer(this.SHOW_LOADING_TIMEOUT,false);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(a){window.Music&&Music.reInform([this.provider]);if(!a&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});
__e("legacy:Overlay",["Overlay"],function(a,b,c,d){a.Overlay=b('Overlay');},3);
var MusicButtonManager=(function(){var a=null,b={},c={};function d(event){var i=$E(event).getTarget(),j=Parent.byClass(i,'music_button');j=j||(!event.getModifiers().any&&e(i));if(!j)return;return f(j,event);}function e(i){var j=Parent.byClass(i,'music_button_trigger')&&Parent.byClass(i,'music_button_trigger_group');if(j){var k=DOM.scry(j,'.music_button');if(k.length)return k[0];}return null;}function f(i,event){event&&$E(event).stop();MusicEvents.inform(MusicConstants.MUSIC_BUTTON.ACTIVATE,i);return false;}function g(i){window.Music&&Music.reInform(i);}function h(i,j){for(var k in b)if(b[k].noGC||ge(k)){b[k].handleIncomingEvent(i,j);}else MusicButtonManager.removeButton(k);}return {init:function(i){if(a)return;a=true;MusicButton.tracksetableTypes=i||[];Event.listen(document.body,'click',d);MusicEvents.subscribe([MusicConstants.STATUS_CHANGE_EVENT.playing,MusicConstants.STATUS_CHANGE_EVENT.track,MusicConstants.DIAGNOSTIC_EVENT.OFFLINE,MusicConstants.DIAGNOSTIC_EVENT.ALL_OFFLINE,MusicConstants.DIAGNOSTIC_EVENT.ONLINE],h);},getButton:function(i){return b[i];},addButton:function(i,j,k,l,m,n){a||MusicButtonManager.init();if(!ge(j))return;b[j];b[j]=new MusicButton(i,$(j),k,copy_properties({button_id:j},l),m,n);var o=Parent.byClass($(j),'uiOverlay');if(o){b[j].noGC=true;Overlay.getInstance(o).subscribe('destroy',MusicButtonManager.removeButton.curry(j));}if(i&&!c[i])c[i]=function(){var p=keys(c);p.length&&g(p);c={};}.defer();return b[j];},removeButton:function(i){b[i]&&b[i].resetLoadingTimers();delete b[i];}};})();
function OnVisible(a,b,c,d,e){this.element=a;this.handler=b;this.strict=c;this.buffer=coalesce(d,300);this.options=e||{};this.lastY=Vector2.getScrollPosition().y;this.lastTime=Date.now();this.reset();onleaveRegister(this.remove.bind(this));}copy_properties(OnVisible.prototype,{reset:function(){if(this.scrollListener)return;var a=throttle(function(){var b=Vector2.getElementPosition(this.element);if(!b){this.remove();return;}this.targetY=b.y;var c=Vector2.getScrollPosition().y,d=Vector2.getViewportDimensions().y,e=c+d+this.buffer;if(e>this.targetY){var f=!this.strict||(c-this.buffer<(this.targetY+Vector2.getElementDimensions(this.element).y));if(f){this.remove();if(this.options.detect_speed){var g=(c-this.lastY),h=g/(Date.now()-this.lastTime+1);if((h>d/100)||(e>=Vector2.getDocumentDimensions().y&&g>1000))return true;}this.handler();}}if(this.options.detect_speed){this.lastY=c;this.lastTime=Date.now();}return true;}.bind(this),100);this.scrollListener=Event.listen(window,'scroll',a);this.resizeListener=Event.listen(window,'resize',a);a();},remove:function(){if(this.scrollListener){this.scrollListener.remove();this.resizeListener.remove();this.scrollListener=this.resizeListener=null;}}});
function fbpage_set_fan_status(a,b,c,d,e,f,g){e=e?e:function(j){_fbpage_show_change_status_feedback(a,j.getPayload());};var h={fbpage_id:b,add:c,reload:d};if(g!=null)copy_properties(h,g);var i=new AsyncRequest().setURI('ajax/pages/fan_status.php').setData(h).setNectarModuleDataSafe(a).setHandler(e);if(f)i.setErrorHandler(f);i.send();return false;}function fbpage_set_favorite_status(a,b,c){var d=function(){_fbpage_show_change_status_feedback(a,this.getUserData());},e={fbpage_id:b,add:c},f=new AsyncRequest().setMethod('POST').setURI('ajax/pages/favorite_status.php').setData(e);new Dialog().setAsync(f).setCloseHandler(d).show();return false;}function _fbpage_show_change_status_feedback(a,b){if(!b||!a)return;if(b.reload){fbpage_reload_on_fan_status_changed(b.preserve_tab);}else fbpage_redraw_on_fan_status_changed(a,b.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a){var c=FutureSideNav.getInstance().selected.textKey;if(!b.getQueryData().sk&&c)b.addQueryData({sk:c});}window.location.href=b;}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;var c=document.createElement('span');c.innerHTML=b;CSS.setClass(c,'fan_status_inactive');a.parentNode.replaceChild(c,a);var d=function(){if(data.can_repeat_action)c.parentNode.replaceChild(a,c);};animation(c).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(d).go();}
var PhotosConst={VIEWER_PERMALINK:0,VIEWER_SNOWBOX:2,VIEWER_SNOWLIFT:6,BULK_EDITOR:3,FLASH_UPLOADER:4,inCenterStage:function(a){return a==PhotosConst.VIEWER_SNOWLIFT||a==PhotosConst.VIEWER_SNOWBOX;},SIZE_NORMAL:'n'};
var PhotoInlineCaptionEditor=function(a){this.instanceId=a;PhotoInlineCaptionEditor.instances[a]=this;};copy_properties(PhotoInlineCaptionEditor,{instances:{},getInstance:function(a){return this.instances[a];}});PhotoInlineCaptionEditor.prototype={init:function(a){this.element=a;Event.listen(a,'click',this.handleClick.bind(this));var b=DOM.scry(a,'input[name="caption_id"]');if(b.length)b[0].value=this.instanceId;this.inputStr='';var c=DOM.scry(this.element,'textarea.fbPhotoCaptionInput')[0];if(c)this.inputStr=Input.getValue(c);},handleClick:function(event){var a=event.getTarget();if(Parent.byClass(a,'editIcon')||Parent.byClass(a,'noCaption')){this.toggleEditDescription(true);}else if(Parent.byClass(a,'cancelEdit')){Input.setValue(DOM.find(this.element,'textarea.fbPhotoCaptionInput'),this.inputStr);this.toggleEditDescription(false);}},setCaption:function(a){DOM.setContent(DOM.find(this.element,'.fbPhotoCaptionText'),a);this.toggleEditDescription(false);this.inputStr=Input.getValue(DOM.find(this.element,'textarea.fbPhotoCaptionInput'));},getCaption:function(){return DOM.getText(DOM.find(this.element,'.fbPhotoCaptionText'));},toggleEditDescription:function(a){if(!a)DOM.find(this.element,'textarea.fbPhotoCaptionInput').blur();CSS.conditionClass(this.element,'fbPhotoInlineCaptionEditorEditMode',!!a);if(a){var b=DOM.find(this.element,'textarea.fbPhotoCaptionInput'),c=DOMControl.getInstance(b);c&&c.update();b.focus();}else{CSS.conditionClass(DOM.find(this.element,'.noCaption'),'hidden_elem',this.getCaption().length);CSS.conditionClass(DOM.find(this.element,'.withCaption'),'hidden_elem',!this.getCaption().length);}}};
var TypeaheadUtil=(function(){var a=/[ ]+/g,b=/[^ ]+/g,c=/[.,+*?$|#{}()\^\-\[\]\\\/!@%'"~=<>_:;\u2010\u2011\u2012\u2013\u2014\u2015\u30fb]/g,d={},e={a:"\u0430 \u00e0 \u00e1 \u00e2 \u00e3 \u00e4 \u00e5",b:"\u0431",c:"\u0446 \u00e7 \u010d",d:"\u0434 \u00f0 \u010f \u0111",e:"\u044d \u0435 \u00e8 \u00e9 \u00ea \u00eb \u011b",f:"\u0444",g:"\u0433 \u011f",h:"\u0445 \u0127",i:"\u0438 \u00ec \u00ed \u00ee \u00ef \u0131",j:"\u0439",k:"\u043a \u0138",l:"\u043b \u013e \u013a \u0140 \u0142",m:"\u043c",n:"\u043d \u00f1 \u0148 \u0149 \u014b",o:"\u043e \u00f8 \u00f6 \u00f5 \u00f4 \u00f3 \u00f2",p:"\u043f",r:"\u0440 \u0159 \u0155",s:"\u0441 \u015f \u0161 \u017f",t:"\u0442 \u0165 \u0167 \u00fe",u:"\u0443 \u044e \u00fc \u00fb \u00fa \u00f9 \u016f",v:"\u0432",y:"\u044b \u00ff \u00fd",z:"\u0437 \u017e",ae:"\u00e6",oe:"\u0153",ts:"\u0446",ch:"\u0447",ij:"\u0133",sh:"\u0448",ss:"\u00df",ya:"\u044f"};for(var f in e){var g=e[f].split(' ');for(var h=0;h<g.length;h++)d[g[h]]=f;}var i={};function j(s){return s?s.replace(c,' '):'';}function k(s){s=(''+s).toLowerCase();var t='',u='';for(var v=s.length;v--;){u=s.charAt(v);t=(d[u]||u)+t;}return t.replace(a,' ');}function l(s){var t=[],u=b.exec(s);while(u){u=u[0];t.push(u);u=b.exec(s);}return t;}function m(s,t){s=''+s;if(!i.hasOwnProperty(s)){var u=k(s),v=j(u);i[s]={value:s,flatValue:u,tokens:l(v),isPrefixQuery:v&&v[v.length-1]!=' '};}if(t&&typeof i[s].sortedTokens=='undefined'){i[s].sortedTokens=copy_properties([],i[s].tokens);i[s].sortedTokens.sort(function(w,x){return x.length-w.length;});}return i[s];}function n(s,t,u){var v=m(t,s=='prefix'),w=s=='prefix'?v.sortedTokens:v.tokens,x=m(u).tokens,y={},z=v.isPrefixQuery&&s=='query'?w.length-1:null,aa=function(ba,ca){for(var da=0;da<x.length;++da){var ea=x[da];if(!y[da]&&(ea==ba||((s=='query'&&ca===z||s=='prefix')&&ea.indexOf(ba)===0)))return (y[da]=true);}return false;};return w.length&&w.every(aa);}var o=n.curry('exact'),p=n.curry('query'),q=n.curry('prefix'),r={parse:m,isExactMatch:o,isQueryMatch:p,isPrefixMatch:q};return r;})();
function DataSource(a){this._maxResults=a.maxResults||10;this.token=a.token;this.queryData=a.queryData||{};this.queryEndpoint=a.queryEndpoint||'';this.bootstrapData=a.bootstrapData||{};this.bootstrapEndpoint=a.bootstrapEndpoint||'';this._exclusions=a.exclusions||[];this._indexedFields=a.indexedFields||['text','tokens'];this._alwaysPrefixMatch=a.alwaysPrefixMatch||false;this._deduplicationKey=a.deduplicationKey||null;this._minExactMatchLength=4;}Class.mixin(DataSource,'Arbiter',{events:['activity','bootstrap','query','respond'],init:function(){this.init=bagofholding;this._fields=Object.from(this._indexedFields);this._activeQueries=0;this.dirty();},dirty:function(){this.value='';this._bootstrapped=false;this._bootstrapping=false;this._data={};this.localCache={};this.queryCache={};this.inform('dirty',{});},bootstrap:function(){if(this._bootstrapped)return;this.bootstrapWithoutToken();this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});},bootstrapWithoutToken:function(){this.fetch(this.bootstrapEndpoint,this.bootstrapData,{bootstrap:true,token:this.token});},bootstrapWithToken:function(){var a=copy_properties({},this.bootstrapData);a.token=this.token;this.fetch(this.bootstrapEndpoint,a,{bootstrap:true,replaceCache:true});},query:function(a,b,c){this.inform('beforeQuery',{value:a});var d=this.buildUids(a,[],c),e=this.respond(a,d);this.value=a;this.inform('query',{value:a,results:e});var f=TypeaheadUtil.parse(a).flatValue;if(b||!f||!this.queryEndpoint||this.getQueryCache().hasOwnProperty(f)||!this.shouldFetchMoreResults(e))return false;this.inform('queryEndpoint',{value:a});this.fetch(this.queryEndpoint,this.getQueryData(a,d),{value:a,exclusions:c});return true;},shouldFetchMoreResults:function(a){return a.length<this._maxResults;},getQueryData:function(a,b){var c=copy_properties({value:a},this.queryData||{});b=b||[];if(b.length)c.existing_ids=b.join(',');if(this._bootstrapping)c.bsp=true;return c;},setQueryData:function(a,b){if(b)this.queryData={};copy_properties(this.queryData,a);return this;},setBootstrapData:function(a,b){if(b)this.bootstrapData={};copy_properties(this.bootstrapData,a);return this;},getExclusions:function(){return $A(this._exclusions);},setExclusions:function(a){this._exclusions=a||[];},setFilter:function(a){this.filter=a;},respond:function(a,b,c){var d=this.buildData(b);this.inform('respond',{value:a,results:d,isAsync:!!c});return d;},asyncErrorHandler:bagofholding,fetch:function(a,b,c){if(!a)return;var d=new AsyncRequest().setURI(a).setData(b).setMethod('GET').setReadOnly(true).setHandler(function(e){this.fetchHandler(e,c||{});}.bind(this));if(a===this.queryEndpoint)d.setFinallyHandler(function(){this._activeQueries--;if(!this._activeQueries)this.inform('activity',{activity:false});}.bind(this));d.setErrorHandler(this.asyncErrorHandler);this.inform('beforeFetch',{request:d,fetch_context:c});d.send();if(a===this.queryEndpoint){if(!this._activeQueries)this.inform('activity',{activity:true});this._activeQueries++;}},fetchHandler:function(a,b){var c=b.value,d=b.exclusions;if(!c&&b.replaceCache)this.localCache={};this.addEntries(a.getPayload().entries,c);this.inform('fetchComplete',{response:a,value:c,fetch_context:b});var e=(!c&&this.value)?this.value:c;this.respond(e,this.buildUids(e,[],d),true);if(!c){if(this._bootstrapping){this._bootstrapping=false;this.inform('bootstrap',{bootstrapping:false});}if(b.token&&a.getPayload().token!==b.token)this.bootstrapWithToken();}},addEntries:function(a,b){var c=this.processEntries($A(a||[]),b),d=this.buildUids(b,c);if(b){var e=this.getQueryCache();e[TypeaheadUtil.parse(b).flatValue]=d;}else this.fillCache(d);},processEntries:function(a,b){return a.map(function(c,d){var e=(c.uid=c.uid+''),f=this.getEntry(e);if(!f){f=c;f.query=b;this.setEntry(e,f);}else copy_properties(f,c);f.index===undefined&&(f.index=d);return e;},this);},getAllEntries:function(){return this._data||{};},getEntry:function(a){return this._data[a]||null;},setEntry:function(a,b){this._data[a]=b;},fillCache:function(a){var b=this.localCache;a.each(function(c){var d=this.getEntry(c);if(!d)return;d.bootstrapped=true;var e=TypeaheadUtil.parse(this.getTextToIndex(d)).tokens;for(var f=0,g=e.length;f<g;++f){var h=e[f];if(!b.hasOwnProperty(h))b[h]={};b[h][c]=true;}},this);},getTextToIndex:function(a){if(a.textToIndex)return a.textToIndex;var b=[];for(var c in this._fields){var d=a[c];if(d)b.push(d.join?d.join(' '):d);}return (a.textToIndex=b.join(' '));},mergeUids:function(a,b,c,d){var e=function(f,g){var h=this.getEntry(f),i=this.getEntry(g);if(h.extended_match!==i.extended_match)return h.extended_match?1:-1;if(h.index!==i.index)return h.index-i.index;if(h.text.length!==i.text.length)return h.text.length-i.text.length;return h.uid<i.uid;}.bind(this);this._checkExtendedMatch(d,a);return this._deduplicateByKey(a.sort(e).concat(b,c));},_checkExtendedMatch:function(a,b){var c=this._alwaysPrefixMatch?TypeaheadUtil.isPrefixMatch:TypeaheadUtil.isQueryMatch;for(var d=0;d<b.length;++d){var e=this.getEntry(b[d]);e.extended_match=e.tokens?!c(a,e.text):false;}},buildUids:function(a,b,c){if(!b)b=[];if(!a)return b;if(!c)c=[];var d=this.buildCacheResults(a,this.localCache),e=this.buildQueryResults(a),f=this.mergeUids(d,e,b,a),g=Object.from(c.concat(this._exclusions)),h=f.filter(function(i){if(g.hasOwnProperty(i)||!this.getEntry(i))return false;if(this.filter&&!this.filter(this.getEntry(i)))return false;return (g[i]=true);},this);return this.uidsIncludingExact(a,h,g);},uidsIncludingExact:function(a,b,c){var d=b.length;if(a.length<this._minExactMatchLength||d<=this._maxResults)return b;for(var e=0;e<d;++e){var f=this.getEntry(b[e]);f.text_lower||(f.text_lower=f.text.toLowerCase());if(f.text_lower===TypeaheadUtil.parse(a).flatValue){if(e>=this._maxResults){var g=b.splice(e,1);b.splice(this._maxResults-1,0,g);}break;}}return b;},buildData:function(a){var b=[],c=Math.min(a.length,this._maxResults);for(var d=0;d<c;++d)b.push(this.getEntry(a[d]));return b;},findQueryCache:function(a){var b=0,c=null,d=this.getQueryCache();for(var e in d)if(a.indexOf(e)==0&&e.length>b){b=e.length;c=e;}return d[c]||[];},buildQueryResults:function(a){var b=TypeaheadUtil.parse(a).flatValue,c=this.findQueryCache(b);if(this.getQueryCache().hasOwnProperty(b))return c;return this.filterQueryResults(a,c);},filterQueryResults:function(a,b){var c=this._alwaysPrefixMatch?TypeaheadUtil.isPrefixMatch:TypeaheadUtil.isQueryMatch;return b.filter(function(d){return c(a,this.getTextToIndex(this.getEntry(d)));},this);},buildCacheResults:function(a,b){var c=TypeaheadUtil.parse(a,this._alwaysPrefixMatch),d=this._alwaysPrefixMatch?c.sortedTokens:c.tokens,e=d.length,f=c.isPrefixQuery?e-1:null,g={},h={},i={},j=[],k=false,l={},m=0;for(var n=0;n<e;++n){var o=d[n];if(!l.hasOwnProperty(o)){m++;l[o]=true;}else continue;for(var p in b)if((!g.hasOwnProperty(p)&&p===o)||((this._alwaysPrefixMatch||f===n)&&p.indexOf(o)===0)){if(p===o){if(h.hasOwnProperty(p))k=true;g[p]=true;}else{if(g.hasOwnProperty(p)||h.hasOwnProperty(p))k=true;h[p]=true;}for(var q in b[p])if(n===0||(i.hasOwnProperty(q)&&i[q]==m-1))i[q]=m;}}for(var r in i)if(i[r]==m)j.push(r);if(k||m<e)j=this.filterQueryResults(a,j);return j;},_deduplicateByKey:function(a){if(!this._deduplicationKey)return a;var b=Object.from(a.map(this._getDeduplicationKey.bind(this)),a);return a.filter(function(c){return b[this._getDeduplicationKey(c)]==c;}.bind(this));},_getDeduplicationKey:function(a){var b=this.getEntry(a);return b[this._deduplicationKey]||'__'+a+'__';},getQueryCache:function(){return this.queryCache;},setMaxResults:function(a){this._maxResults=a;this.value&&this.respond(this.value,this.buildUids(this.value));},updateToken:function(a){this.token=a;this.dirty();return this;}});
function PhotosTaggingWaterfall(a){PhotosTaggingWaterfall._queueName=a||PhotosTaggingWaterfall._queueName;}copy_properties(PhotosTaggingWaterfall,{BEGIN:"begin",TAG_FACE:"tag_face",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:'type_name',SELECT_NAME:'select_name',_queueName:null,sendSignal:function(a,b){new AsyncSignal('ajax/photos/tag_waterfall.php',{data:JSON.stringify(a)}).setHandler(b).send();}});
function photos_viewer_version(){if(CSS.hasClass(document.documentElement,'theaterMode')){return PhotosConst.VIEWER_SNOWBOX;}else return PhotosConst.VIEWER_PERMALINK;}
function Typeahead(a,b,c,d){this.args={data:a,view:b,core:c};DataStore.set(d,'Typeahead',this);this.element=d;}Typeahead.getInstance=function(a){var b=Parent.byClass(a,'uiTypeahead');return b?DataStore.get(b,'Typeahead'):null;};Class.mixin(Typeahead,'Arbiter',{init:function(a){this.init=bagofholding;this.getCore();this.proxyEvents();this.initBehaviors(a||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var a=this.args.data;this.data=a;this.data.init();}return this.data;},getView:function(){if(!this.view){var a=this.args.view,b=ge(a.node_id);if(!b){b=$N('div',{className:'uiTypeaheadView'});DOM.appendContent(this.element,b);}this.view=new window[a.ctor](b,a.options||{});this.view.init();}return this.view;},getCore:function(){if(!this.core){var a=this.args.core;this.core=new window[a.ctor](a.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(a){var b=this.core;this.data=this.args.data=a;a.init();if(b){b.data=a;b.initData();b.reset();}a.bootstrap();return a;},proxyEvents:function(){[this.data,this.view,this.core].each(function(a){a.subscribe(a.events,this.inform.bind(this));},this);},initBehaviors:function(a){if(window.TypeaheadBehaviors)a.each(function(b){(TypeaheadBehaviors[b]||bagofholding)(this);},this);}});
function PhotoTagger(a){this.version=a;PhotoTagger.instances[a]=this;}PhotoTagger.instances={};PhotoTagger.ACTIVATE_TAGGING='PhotoTagger.ACTIVATE_TAGGING';PhotoTagger.getInstance=function(a){return PhotoTagger.instances[a];};copy_properties(PhotoTagger.prototype,{TAG_BOX_SIZE:100,datasources:{},photoData:{},elemNames:{2:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons',tagAction:'fbPhotosPhotoActionsTag',image:'div.stage img.spotlight'},6:{addTagLink:'div.fbPhotosPhotoOwnerButtons',overlayActions:'div.fbPhotosPhotoButtons',tagAction:'fbPhotosPhotoActionsTag',image:'div.stage img.spotlight'}},userActionData:{action:'tagging',namespace:'snowbox'},init:function(a,b,c){this.setupUserActionLogging();this.root=a;this.tagger=b;this.tokenizer=c;this._qn=null;this.typeahead=c.getTypeahead();this.clickState=DOM.find(this.root,'div.stageActions');this.faceBox=DOM.find(this.tagger,'div.faceBox');this.newTagBox=DOM.find(this.clickState,'div.newTagBox');this.addTagLink=DOM.find(this.root,this.elemNames[this.version].addTagLink);this.overlayActions=DOM.find(this.root,this.elemNames[this.version].overlayActions);this.setupHandlers();this.hideNewTagTimer=null;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());return this;},setupUserActionLogging:function(){this.ua=user_action(this.userActionData.action).set_namespace(this.userActionData.namespace).set_ua_id('tagging').add_event('init');},logUserActionEvent:function(a){this.ua.add_event(a);},fetchTaggingSuggestions:function(a){this.logUserActionEvent('sugg_fetch');new AsyncRequest().setURI('ajax/photos/photo/tags/tags_init.php').setData(a).setOption('retries',1).setAllowCrossPageTransition(true).setHandler(function(c){this.typeahead.getView().setSuggestions(c.getPayload().taggees);this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();var b=this.typeahead.subscribe('bootstrap',function(c,d){if(d&&!d.bootstrapping){this.updateWithSuggestions();this.typeahead.unsubscribe(b);this.typeahead.subscribe('focus',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('removeToken',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('addToken',this.addSuggestion.bind(this));this.typeahead.subscribe('respond',function(e,f){if(f&&!f.results.length)this.updateWithSuggestions();}.bind(this));}}.bind(this));},setupHandlers:function(){this.handlers=[Event.listen(this.clickState,'click',this.addTag.bind(this)),Event.listen(window,'resize',this.hideTagger.bind(this)),Event.listen(this.addTagLink,'click',this.checkActions.bind(this)),Event.listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[Arbiter.subscribe(this.getPhotoViewerObj().PAGE,this.restartTagging.bind(this)),Arbiter.subscribe(this.getPhotoViewerObj().DATA_CHANGE,this.setPhotoData.bind(this)),Arbiter.subscribe(this.getPhotoViewerObj().CLOSE,this.deactivateTagging.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));},getTaggingSource:function(){switch(this.version){case PhotosConst.VIEWER_SNOWBOX:return 'snowbox';case PhotosConst.VIEWER_SNOWLIFT:return 'snowlift';default:return null;}},updateWithSuggestions:function(a,b){var c=this.typeahead.getData().buildUids(' ',this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!c.length)return;var d=this.typeahead.getData().respond('',c);for(var e=0;e<d.length;e++)d[e].index=-1000+e;},addSuggestion:function(a,b){var c=b.info&&b.info.uid;if(c)this.typeahead.getView().addSuggestion(c);},setQueueName:function(a){this._qn=a;return this;},_sendWaterfallLogSignal:function(a){PhotosTaggingWaterfall.sendSignal({qn:this._qn,source:this.getTaggingSource(),step:a,pid:this.photoData.pid});},_bumpQueueName:function(){if(this._qn)this._qn+=1;},activateTagging:function(){this.logUserActionEvent('activate');Arbiter.inform(PhotoTagger.ACTIVATE_TAGGING);if(this.getDataSource()){this.dataSourceFetched(this.getDataSource());}else new AsyncRequest('ajax/photos/photo/tags/fetch_datasource.php').setData({fbid:this.photoData.fbid,version:this.version}).send();},restartTagging:function(){this.hideNewTag();this.hideTagger();if(this.taggingMode===true)this.activateTagging();},getDataSource:function(){return this.datasources[this.getDataSourceKey()];},getDataSourceKey:function(){if(this.photoData.ownertype=='user'&&!this.photoData.obj_id)return 'friends';return this.photoData.obj_id||this.photoData.owner;},setDataSource:function(a){if(this.typeahead.getData()!=a)this.typeahead.swapData(a);this.datasources[this.getDataSourceKey()]=a;},dataSourceFetched:function(a){this.taggingMode=true;CSS.addClass(this.root,'taggingMode');this._bumpQueueName();this._sendWaterfallLogSignal(PhotosTaggingWaterfall.BEGIN);this.setDataSource(a);},deactivateTagging:function(){this.logUserActionEvent('deactivate');if(this.taggingMode===true)this._sendWaterfallLogSignal(PhotosTaggingWaterfall.FINISH);this.taggingMode=false;this.hideNewTag();this.hideTagger();CSS.removeClass(this.root,'taggingMode');},checkActions:function(event){var a=event.getTarget();if(Parent.byClass(a,this.elemNames[this.version].tagAction))this.taggingMode?this.deactivateTagging():this.activateTagging();},hideTagger:function(){CSS.hide(this.tagger);},showTagger:function(){CSS.show(this.tagger);var a=DOM.find(this.tagger,'input.textInput');Input.reset(a);a.focus();this.updateWithSuggestions();this.hideNewTag();},showNewTag:function(a){if(!this.newTagBox)return;DOM.setContent(DOM.find(this.newTagBox,'div.tagName'),$N('span',null,a));CSS.show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3000);},hideNewTag:function(){if(!this.newTagBox)return;if(this.hideNewTagTimer!==null){clearTimeout(this.hideNewTagTimer);this.hideNewTagTimer=null;}CSS.hide(this.newTagBox);},getTaggerPositioningOrigin:function(){return Vector2.getElementPosition(this.clickState,'document');},addTag:function(event){var a=event.getTarget(),b=Parent.byClass(a,'fbPhotosPhotoButtons');if(!this.taggingMode||(b&&a!==b)||Parent.byClass(a,'photoTagTypeahead'))return;var c=this.getPhotoOnStage(),d=Vector2.getEventPosition(event),e=this.calcTaggerPosition(c,d);this.calcClickPoint(c,d);if(!e){this.hideTagger();return;}e.setElementPosition(this.tagger);if(this.newTagBox)e.setElementPosition(this.newTagBox);this.showTagger();this._sendWaterfallLogSignal(PhotosTaggingWaterfall.TAG_FACE);},getPhotoOnStage:function(){return DOM.find(this.root,this.elemNames[this.version].image);},calcTaggerPosition:function(a,b){var c=Vector2.getElementPosition(a),d=Vector2.getElementDimensions(a),e=new Vector2(this.TAG_BOX_SIZE/2,this.TAG_BOX_SIZE/2),f=b.sub(c);for(var g in f){if(b[g]<c[g]||b[g]>c[g]+d[g])return null;if(f[g]<(this.TAG_BOX_SIZE/2)){e[g]=f[g];}else if(d[g]<f[g]+(this.TAG_BOX_SIZE/2))e[g]=this.TAG_BOX_SIZE-(d[g]-f[g]);}var h=b.sub(this.getTaggerPositioningOrigin());return h.sub(e.x,e.y);},calcClickPoint:function(a,b){var c=Vector2.getElementDimensions(a),d=Vector2.getElementPosition(a),e=b.sub(d);this.clickPoint={x:e.x/c.x,y:e.y/c.y};},saveTag:function(a,b){var c=this.getTaggingData('add',b.isFreeform()?'':b.getValue(),b.getText());c.x=this.clickPoint.x*100;c.y=this.clickPoint.y*100;this.logUserActionEvent('save');new AsyncRequest().setURI('ajax/photo_tagging_ajax.php').setMethod('POST').setData(c).setAllowCrossPageTransition(true).setHandler(function(d){this.tagsChangeHandler(d);this.logUserActionEvent('save_done');}.bind(this)).setErrorHandler(this.checkError.bind(this,b)).send();this.showNewTag(b.getText());this.hideTagger();},getTaggingData:function(a,b,c){return {cs_ver:this.version,pid:this.photoData.pid,id:this.photoData.owner,subject:b,name:c,action:a,source:this.getTaggingSource(),qn:this._qn,position:this.getPosition()};},getPosition:function(){var a=this.getPhotoViewerObj();return a&&a.position;},getPhotoViewerObj:function(){switch(this.version){case PhotosConst.VIEWER_SNOWBOX:return window.PhotoSnowbox;case PhotosConst.VIEWER_SNOWLIFT:return window.PhotoSnowlift;default:return null;}},tagsChangeHandler:function(a){var b=this.getPhotoViewerObj();if(b&&b.isOpen)b.saveTagComplete(a);},checkError:function(a,b){if(b.getPayload()&&b.getPayload().clear_tag){a.already_untagged=true;this.tokenizer.removeToken(a);}ErrorDialog.showAsyncError(b);},removeTag:function(a,b,c){if(b.already_untagged)return;var d='remove';if(DOM.scry(b.element,'a.pending')[0])d='retract';if(b.blockUser)d='remove_block';this.logUserActionEvent('save');new AsyncRequest().setURI('ajax/photo_tagging_ajax.php').setMethod('POST').setData(this.getTaggingData(d,b.isFreeform()?'':b.getInfo().uid,b.getInfo().text)).setHandler(function(e){this.tagsChangeHandler(e);this.logUserActionEvent('save_done');c&&c();}.bind(this)).setAllowCrossPageTransition(true).send();},removeTagByID:function(a,b,c){var d=this.tokenizer.tokens;for(var e=0;e<d.length;e++)if(d[e].info.uid==b)return this.removeTag(null,d[e],c);},removeTagByIDFromHovercardLink:function(a,b,c){this.removeTagByID(a,b,function(){if(window.Hovercard)Hovercard.contains(c)&&Hovercard.hide(true);});},setPhotoData:function(a,b){this.photoData=b;return this;},markTagAsSpam:function(a,b){new AsyncRequest().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(this.getTaggingData('mark_as_spam',b,null)).send();}});
function PhotoInlineEditor(a){this.version=a;PhotoInlineEditor.instances[a]=this;}PhotoInlineEditor.CANCEL_INLINE_EDITING='CANCEL_INLINE_EDITING';PhotoInlineEditor.instances={};PhotoInlineEditor.getInstance=function(a){return PhotoInlineEditor.instances[a];};copy_properties(PhotoInlineEditor.prototype,{toggleEditMode:function(a,b){var c=Parent.byClass($(a),'photoUfiContainer');if(!c)return;CSS.conditionClass(c,'inlineEditMode',b);if(this.version==PhotosConst.VIEWER_SNOWLIFT){var d=this.getViewerObject();CSS.conditionClass($('fbPhotoSnowlift'),'fbPhotoSnowliftEditMode',b);Arbiter.inform('reflow');d&&d.adjustScroller();}},activate:function(a){this.toggleEditMode(a,true);},deactivate:function(a){this.toggleEditMode(a,false);if(this.arbiterToken)Arbiter.unsubscribe(this.arbiterToken);},cancel:function(a){this.deactivate(a);Arbiter.inform(PhotoInlineEditor.CANCEL_INLINE_EDITING);},attachForm:function(a){this._form=a;return this;},getForm:function(){return this._form;},getViewerObject:function(){switch(this.version){case PhotosConst.VIEWER_PERMALINK:return window.PhotoPermalink;case PhotosConst.VIEWER_SNOWBOX:return window.PhotoSnowbox;case PhotosConst.VIEWER_SNOWLIFT:return window.PhotoSnowlift;}return null;},subscribeCancel:function(a){var b=this.getViewerObject();if(!b){this.arbiterToken=null;return;}var c=[b.PAGE,PhotoTagger.ACTIVATE_TAGGING];if(PhotosConst.inCenterStage(this.version))c.push(b.CLOSE);this.arbiterToken=Arbiter.subscribe(c,this.cancel.bind(this,a),Arbiter.SUBSCRIBE_NEW);}});
function PhotoSessionLog(){}copy_properties(PhotoSessionLog,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWBOX:2,SNOWLIFT:6,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,buttonLikes:0,pagingAction:'',initLogging:function(a){this.set=null;this.time=new Date();this.views=0;this.first=true;this.last=false;this.logIds=false;this.version=a;this.buttonLikes=0;this.pagingAction='';if(a===PhotoSessionLog.SNOWBOX||a===PhotoSessionLog.SNOWLIFT){var b=Vector2.getViewportDimensions();this.width=b.x;this.height=b.y;}},setLogFbids:function(a){this.logIds=a;},setPhotoSet:function(a){this.set=a;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(a){this.pagingAction=a;},addPhotoView:function(a){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(a)this.fbidList.push([a.fbid,a.owner,Date.now()]);},addDetailData:function(a,b){if(!this.details[a])this.details[a]={t:b.num_tags,l:b.has_location,c:b.has_caption,cm:b.comment_count,lk:b.like_count,w:b.width,h:b.height,ad:'{}',p:this.pagingAction};},updateAdData:function(a,b){if(this.details[a])this.details[a].ad=JSON.stringify(b);},logPhotoViews:function(a){if((!this.views)||((this.version===PhotoSessionLog.SNOWBOX||this.version===PhotoSessionLog.SNOWLIFT)&&(a==PhotoSessionLog.LEAVE)))return;if(a!=this.AGGREGATE)this.last=true;var b={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:a?a:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version};if(this.version===PhotoSessionLog.SNOWBOX||this.version===PhotoSessionLog.SNOWLIFT){var c=Vector2.getViewportDimensions();b.width=c.x||this.width;b.height=c.y||this.height;}new AsyncRequest().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(a!=PhotoSessionLog.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(b).send();this.views=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;}}});onunloadRegister(function(){PhotoSessionLog.logPhotoViews(PhotoSessionLog.UNLOAD);});onleaveRegister(function(){PhotoSessionLog.logPhotoViews(PhotoSessionLog.LEAVE);});
__e("UIPagelet",["json","dom","AjaxPipeRequest","AsyncRequest","copyProperties"],function(a,b,c,d,e,f){b('json');var g=b('dom'),h=b('AjaxPipeRequest'),i=b('AsyncRequest'),j=b('copyProperties');function k(l,m,n,o){this._id=l||null;this._element=ge(l||g.$N('div'));this._src=m||null;this._context_data=n||{};this._data=o||{};this._handler=bagofholding;this._request=null;this._use_ajaxpipe=false;this._is_bundle=true;this._allow_cross_page_transition=false;this._append=false;return this;}k.loadFromEndpoint=function(l,m,n,o){o=o||{};var p='ajax/pagelet/generic.php/';if(o.intern)p='intern'+p;var q=(p+l).replace(/\/+/g,'./');if(o.subdomain)q=URI(q).setSubdomain(o.subdomain);var r=new k(m,q,n).setUseAjaxPipe(o.usePipe).setBundleOption(l.substring(0,8)!='intern/default.htm'&&o.bundle!==false).setAppend(o.append).setJSNonBlock(o.jsNonblock).setDisplayCallback(o.displayCallback).setConstHeight(o.constHeight).setAllowCrossPageTransition(o.crossPage);o.handler&&r.setHandler(o.handler);r.go();return r;};j(k.prototype,{getElement:function(l){l=l||false;if(l)this._element=ge(this._id);return this._element;},setHandler:function(l){this._handler=l;return this;},go:function(l,m){if(arguments.length>=2||typeof l=='string'){this._src=l;this._data=m||{};}else if(arguments.length==1)this._data=l;this.refresh();return this;},setAllowCrossPageTransition:function(l){this._allow_cross_page_transition=l;return this;},setBundleOption:function(l){this._is_bundle=l;return this;},refresh:function(l){var m=function(o){this._request=null;if(l&&this._id)this._element=ge(this._id);var p=HTML(o.getPayload());if(this._append){g.appendContent(this._element,p);}else g.setContent(this._element,p);this._handler();}.bind(this);if(this._use_ajaxpipe){this._request=new h();this._request.setCanvasId(this._id).setAppend(this._append).setConstHeight(this._constHeight).setJSNonBlock(this._jsNonblock).setDisplayCallback(this._displayCallback);}else{var n=this._displayCallback;this._request=new i().setMethod('GET').setReadOnly(true).setOption('bundle',this._is_bundle).setHandler(function(o){if(n){n(m.curry(o));}else m(o);});}this._request.setURI(this._src).setAllowCrossPageTransition(this._allow_cross_page_transition).setData({data:JSON.stringify(merge(this._context_data,this._data))}).send();return this;},cancel:function(){if(this._request)this._request.abort();},setUseAjaxPipe:function(l){this._use_ajaxpipe=!!l;return this;},setAppend:function(l){this._append=!!l;return this;},setJSNonBlock:function(l){this._jsNonblock=!!l;return this;},setDisplayCallback:function(l){this._displayCallback=l;return this;},setConstHeight:function(l){this._constHeight=!!l;return this;}});a.UIPagelet=e.exports=k;},3);
function PhotoStreamCache(){}copy_properties(PhotoStreamCache,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1});copy_properties(PhotoStreamCache.prototype,{init:function(a){this.version=a;this.bufferSize=PhotoStreamCache.BUFFER_SIZE;this.fullBucketSize=PhotoStreamCache.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.leftLock=false;this.rightLock=false;this.reset();},reset:function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;},destroy:function(){this.reset();this.isActive=false;},isLoaded:function(){return this.loaded;},canPage:function(){if(this.totalCount!==null)return this.totalCount>1;return this.getLength()>1;},errorInCurrent:function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());},getLength:function(){return this.fbidList.length;},getPhotoSet:function(){return this.photoSetQuery.set;},getCurrentImageData:function(){return this.getImageData(this.getCursor());},getImageData:function(a){return this.getCacheContent(a,PhotoStreamCache.IMAGE_DATA);},getCurrentHtml:function(){return this.getCacheContent(this.getCursor(),PhotoStreamCache.HTML);},getCurrentExtraData:function(){return this.getCacheContent(this.getCursor(),PhotoStreamCache.EXTRA);},getCacheContent:function(a,b){if(!a||a===PhotoStreamCache.ERROR_ID)return null;return this.cache[b][a];},getCursorPos:function(){return this.position;},getCursor:function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;},getCursorForURI:function(a){return this.permalinkMap[a];},calculatePositionForMovement:function(a){var b=this.position+a;if(this.allLoaded){var c=this.getLength();b=(c+b%c)%c;}return b;},isValidMovement:function(a){if(!this.isLoaded()||!this.canPage())return false;var b=this.calculatePositionForMovement(a);return this.getCursor()>0||(b>=0&&b<this.getLength());},moveCursor:function(a){if(!this.isValidMovement(a))return;this.position=this.calculatePositionForMovement(a);if(a!==0)this.loadMoreIfNeccessary(a>0);},checkErrorAt:function(a){if(!this.isLoaded())return false;if(a===PhotoStreamCache.ERROR_ID)return true;return false;},getRelativeMovement:function(a){for(var b=0;b<this.getLength();b++)if(this.fbidList[b]==a)return b-this.position;return null;},preloadImages:function(){var a,b,c=this.getLength(),d=this.cache.image,e=PhotoStreamCache.BUFFER_SIZE;if(c>e*2){a=(this.position+c-e%c)%c;b=(this.position+e)%c;}else{a=0;b=c-1;}while(a!=b){var f=this.fbidList[a];if(d[f]&&!d[f].resource&&d[f].url){d[f].resource=new Image();d[f].resource.src=d[f].url;}a=(a+1)%c;}},loadMoreIfNeccessary:function(a){if(this.allLoaded||(a&&this.rightLock)||(!a&&this.leftLock))return;var b=a?1:-1,c=this.fullBucketSize*b,d=this.position+this.bufferSize*b;if(d<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(d>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}},getEndCursor:function(a){return a?this.fbidList[this.getLength()-1]:this.fbidList[0];},calculateRelativeIndex:function(a,b,c){if(!this.totalCount)return null;var d=this.fbidList.indexOf(b),e=this.fbidList.indexOf(c);if(d===-1||e===-1)return null;var f=e-d;return (a+f+this.totalCount)%this.totalCount;},fetch:function(a,b){var c=this.getEndCursor(b),d=copy_properties({cursor:c,version:this.version,end:this.getEndCursor(!b),fetchSize:b?a:-1*a},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){d.total=this.totalCount;d.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,c);}UIPagelet.loadFromEndpoint('PhotoViewerPagelet',null,d,{usePipe:true,jsNonblock:true,crossPage:true});},storeToCache:function(a){var b={};if(!this.isActive)return b;if('error' in a){this.processErrorResult(a.error);b.error=true;return b;}if('init' in a){this.processInitResult(a.init);b.init={logids:a.init.logids,fbid:a.init.fbid,loggedin:a.init.loggedin,fromad:a.init.fromad};}if('image' in a){this.processImageResult(a.image);b.image=true;}if('data' in a){this.processDataResult(a.data);b.data=true;}return b;},processInitResult:function(a){if(this.loaded)return;this.loaded=true;this.photoSetQuery=a.query;if(a.bufferSize)this.bufferSize=a.bufferSize;if(a.fullBucketSize)this.fullBucketSize=a.fullBucketSize;this.fbidList.push(a.fbid);this.firstCursor=a.fbid;if('initIndex' in a&&'totalCount' in a){this.firstCursorIndex=a.initIndex;this.totalCount=a.totalCount;}this.rightLock=true;if(this.version==PhotosConst.VIEWER_PERMALINK)this.fetch(PhotoStreamCache.INIT_BUCKET_SIZE,true);},processImageResult:function(a){for(var b in a){this.cache.image[b]=a[b];if(a[b].dimensions)this.cache.image[b].dimensions=Vector2.deserialize(a[b].dimensions);this.permalinkMap[URI(a[b].info.permalink).getUnqualifiedURI().toString()]=b;}},attachToFbidsList:function(a,b,c){if(this.allLoaded)return;if(b===-1){for(var d=a.length-1;d>=0;d--){this.fbidList.unshift(a[d]);this.position++;}this.leftLock=false;}else{for(var e=0;e<a.length;e++)this.fbidList.push(a[e]);this.rightLock=false;}if(c)this.setAllLoaded();},setAllLoaded:function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);},processDataResult:function(a){for(var b in a){if(!this.cache.html[b])this.cache.html[b]={};for(var c in a[b].html){var d=HTML(a[b].html[c]).getRootNode();this.cache.html[b][c]=$A(d.childNodes);}if(!('extra' in a[b])){this.cache.extra[b]=null;continue;}this.cache.extra[b]={tagRects:{}};if(a[b].extra.tagRects)for(var e in a[b].extra.tagRects)if(a[b].extra.tagRects[e])this.cache.extra[b].tagRects[e]=Rect.deserialize(a[b].extra.tagRects[e]);}},processErrorResult:function(a){if(!this.isLoaded()){this.initError=true;return;}var b=a.side,c=[PhotoStreamCache.ERROR_ID];this.attachToFbidsList(c,b);},setTotalCount:function(a){this.totalCount=a;},setFirstCursorIndex:function(a){this.firstCursorIndex=a;}});
function PhotosUtils(){}PhotosUtils.getNearestBox=function(a,b,c,d,e,f){var g=a.sub(b),h=c.magnitude(),i=null;for(var j in f){var k=f[j],l=new Rect(k.t/100*c.y*d,k.r/100*c.x*d,k.b/100*c.y*d,k.l/100*c.x*d),m=l.getCenter().sub(g);if(Math.abs(m.x)<=e&&Math.abs(m.y)<=e&&m.magnitude()<=h){h=m.magnitude();i=j;if(0===h)break;}}return i;};
var PhotoSnowbox=window.PhotoSnowbox||{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',CLOSE:'PhotoSnowbox.CLOSE',DATA_CHANGE:'PhotoSnowbox.DATA_CHANGE',GO:'PhotoSnowbox.GO',OPEN:'PhotoSnowbox.OPEN',PAGE:'PhotoSnowbox.PAGE',RESET_HELP:'PhotoSnowbox.RESET_HELP',LOADING_TIMEOUT:2000,STAGE_MAX:{x:960,y:960},STAGE_MIN:{x:720,y:402},STAGE_CHROME:{x:225,y:117},TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,WIDE_ADS:855,MIN_TAG_DISTANCE:83,ADS_REFRESH_RATE:30000,switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,extraClass:null,normalSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,ua:null,bootstrap:function(a,b){this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=user_action('snowbox',b,null).set_namespace('snowbox').set_ua_id('open');this.returningToStart=false;this.loading&&CSS.removeClass(this.loading,'loading');if(b){CSS.addClass((this.loading=b),'loading');this.getThumbAndSize(b);}else this.loading=null;Arbiter.inform(PhotoSnowbox.GO,a,Arbiter.BEHAVIOR_STATE);this.loadFrameIfUninitialized();},getThumbAndSize:function(a){this.normalSize=null;this.thumbSrc=null;var b=URI(a.getAttribute('ajaxify')).getQueryData();if(!b.size)return;var c=Vector2.deserialize(b.size);if(!c.x||!c.y)return;this.normalSize=c;if(!CSS.hasClass(a,'uiMediaThumb')&&!CSS.hasClass(a,'uiPhotoThumb')&&!CSS.hasClass(a,'uiScaledThumb'))return;var d=DOM.scry(a,'img')[0],e=DOM.scry(a,'i')[0],f=Parent.byAttribute(a,'data-size');this.shouldStretch=f&&this.normalSize&&d&&f.getAttribute('data-size')==="2"&&this.normalSize.x>this.normalSize.y&&this.normalSize.x<=PhotoSnowbox.TIMELINE_STRETCH_WIDTH&&d.offsetWidth===PhotoSnowbox.TIMELINE_STRETCH_WIDTH;if(d){thumbSrc=d.src;}else if(e){thumbSrc=CSS.getStyle(e,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=thumbSrc;},loadFrameIfUninitialized:function(){if(this.root)return;new AsyncRequest('/ajax/photos/snowbox/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();},init:function(a){var b=ge('fbPhotoSnowbox');if(!b){b=DOM.appendContent(DOM.getDocumentBodyElement(),a)[0];this.initialLoad=false;}if(this.root==b)return;this.initializeNodes(b);if(!this.subscription){LinkController.registerHandler(this.handleNavigateAway.bind(this));this.subscription=Arbiter.subscribe(PhotoSnowbox.GO,function(c,d){this.openExplicitly=true;this.loading&&CSS.removeClass(this.loading,'loading');this.open(d);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;PageTransitions.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;Arbiter.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));Arbiter.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));},initializeNodes:function(a){this.root=a;this.closeTheater=DOM.find(a,'a.closeTheater');this.container=DOM.find(a,'div.container');this.infoWrapper=DOM.find(a,'div.photoInfoWrapper');this.stageWrapper=DOM.find(a,'div.stageWrapper');this.errorBox=DOM.find(this.stageWrapper,'div.stageError');this.image=DOM.find(this.stageWrapper,'img.spotlight');this.pivotBar=DOM.find(this.stageWrapper,'div.pivotWrapper');this.stage=DOM.find(this.stageWrapper,'div.stage');this.videoStage=DOM.find(this.stageWrapper,'div.videoStage');this.stagePagers=DOM.find(a,'div.stagePagers');this.stageActions=DOM.find(a,'div.stageActions');this.buttonActions=DOM.find(this.stageActions,'div.fbPhotosPhotoButtons');this.actionList=$('fbPhotoSnowboxActions');this.sideAdUnit=$('fbPhotoSnowboxAdsSide');this.bottomAdUnit=$('fbPhotoSnowboxAdsBottom');this.sideAdDiv=DOM.find(a,'div.fbPhotoSnowboxAdsSide');this.bottomAdDiv=DOM.find(a,'div.fbPhotoSnowboxAdsBottom');},getRoot:function(){return this.root;},openHandler:function(a){if(this.isOpen||a.getPath()!='/photo.php'||this.returningToStart||a.getQueryData().closeTheater||a.getQueryData().permPage||a.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}if(window.PhotoSnowlift&&PhotoSnowlift.isOpen)return false;this.open(a);this._uriStack.push(URI(a).getQualifiedURI().toString());PageTransitions.transitionComplete();return true;},open:function(a){var b=URI(a).getQueryData(),c=b.src;if(c)delete b.src;if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){b.firstLoad=true;this.initialLoad=true;}this.loadQuery=b;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.lastAdsLoad=0;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.stream=new PhotoStreamCache();this.stream.init(PhotosConst.VIEWER_SNOWBOX);this.fetchInitialData();this.setLoadingState(PhotoSnowbox.STATE_HTML,true);KeyEventController.registerKey('ESCAPE',this.closeListener.bind(this));Bootloader.loadComponents(['fb-photos-photo-css','fb-photos-snowbox-css'],function(){this._open(a,c);}.bind(this));},_open:function(a,b){this.createLoader(b);CSS.show(this.root);(function(){var e=Vector2.getScrollPosition();if(!CSS.hasClass(document.documentElement,'wrapped')){CSS.addClass(document.documentElement,'theaterMode');var f=DOMScroll.getScrollbarSize();if(f===0){this.extraClass='zeroScrollbar';}else if(f===20){this.extraClass='scrollbar20';}else this.extraClass='defaultScrollbar';CSS.addClass(document.body,this.extraClass);}DOMScroll.scrollTo(e,0);}).defer();this.ua&&this.ua.add_event('frame');Arbiter.inform('layer_shown',{type:'PhotoSnowbox'});Arbiter.inform(PhotoSnowbox.OPEN);Bootloader.loadComponents(['Hovercard','live-js','photocrop2','PhotoTag','PhotoTagger','TagToken','TagTokenizer','ui-ufi-css']);this.stageHandlers=[Event.listen(window,'resize',this.adjustForResize.bind(this)),Event.listen(this.root,'click',this.closeListener.bind(this)),Event.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),Event.listen(this.actionList,'click',this.rotateListener.bind(this))];var c=ge('fbPhotoSnowboxFeedback');if(c)this.stageHandlers.push(Event.listen(c,'click',function(event){if(Parent.byClass(event.getTarget(),'like_link'))CSS.toggleClass(DOM.find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}.bind(this)));var d=ge('fbPhotoSnowboxOnProfile');if(d)this.stageHandlers.push(Event.listen(d,'click',function(event){if(Parent.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=URI.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!b)this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){PageTransitions.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}PhotoSessionLog.initLogging(PhotoSessionLog.SNOWBOX);if(ua.firefox()&&!CSS.hasClass(document.documentElement,'wrapped'))this.turnFlashAutoplayOff.defer();(function(){this.adjustForResize();if(ua.ie()){this.container.focus();}else this.root.focus();}).bind(this).defer();},getStream:function(){return this.stream;},fetchInitialData:function(){this.ua&&this.ua.add_event('init_data');UIPagelet.loadFromEndpoint('PhotoViewerInitPagelet',null,this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});},turnFlashAutoplayOff:function(){DOM.scry(document,'div.swfObject').each(function(a){var b=a.getAttribute('data-swfid');if(b&&window[b]){var c=window[b];c.addParam('autostart','false');c.addParam('autoplay','false');c.addParam('play','false');c.addVariable('video_autoplay','0');c.addVariable('autoplay','0');c.addVariable('play','0');var d=URI(c.getAttribute('swf'));d.addQueryData({autoplay:'0'});d.setPath(d.getPath().replace('autoplay=1','autoplay=0'));c.setAttribute('swf',d.toString());c.write(a);}});},closeHandler:function(){if(!this.isOpen)return;if(URI.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.close();this.returnToStartingURI(this.refreshOnClose);},returnToStartingURI:function(a,b){if(!a)if(b){this.squashNextTransition(goURI.curry(b));}else this.squashNextTransition();this.returningToStart=true;var c=Arbiter.subscribe('page_transition',function(){this.returningToStart=false;Arbiter.unsubscribe(c);}),d=a||isNaN(ua.opera()),e=this._uriStack.length;if(d&&e<window.history.length){window.history.go(-e);}else{var f=PhotoSnowbox.startingURI,g=new URI(f).removeQueryData('closeTheater');if(f.getQueryData().sk=='approve'&&f.getPath()=='/profile.php'){g.removeQueryData('highlight');g.removeQueryData('notif_t');}goURI(g);}},squashNextTransition:function(a){PhotoSnowbox.squashNext=true;PageTransitions.registerHandler(function _squash(){if(PhotoSnowbox.squashNext){PhotoSnowbox.squashNext=false;if(a)a.defer();PageTransitions.transitionComplete();return true;}return false;});},handleNavigateAway:function(a){var b=computeRelativeURI(window.PageTransitions._most_recent_uri.getQualifiedURI(),a.getAttribute('href'));if(this.isOpen&&(b instanceof URI)&&b.getUnqualifiedURI().toString()!=this.startingURI.toString()&&b.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=PhotoSessionLog.NAVIGATE;this.close();this.returnToStartingURI(false,b);return false;}return true;},closeListener:function(event){if(this.isOpen&&!(window.Dialog&&Dialog.getCurrent())){var a=event.getTarget(),b=Parent.byClass(a,'closeTheater'),c=(b||a==this.root||a==this.infoWrapper);if(c){if(b){this.closingAction=PhotoSessionLog.X;}else this.closingAction=PhotoSessionLog.OUTSIDE;Event.kill(event);this.closeHandler();}else if(Event.getKeyCode(event)==KEYS.ESC){this.closingAction=PhotoSessionLog.ESC;Event.kill(event);this.closeHandler();}}},close:function(){if(!this.isOpen)return;CSS.hide(this.root);this.openExplicitly=false;this.closeCleanup.bind(this).defer();},closeCleanup:function(){var a=Vector2.getScrollPosition();if(!CSS.hasClass(document.documentElement,'wrapped')){CSS.removeClass(document.documentElement,'theaterMode');CSS.removeClass(document.body,this.extraClass);}CSS.removeClass(this.root,'dataLoaded');DOMScroll.scrollTo(a,0);KeyEventController.getInstance().resetHandlers();PhotoSessionLog.logPhotoViews(this.closingAction);this.destroy();CSS.hide(this.errorBox);CSS.hide(this.image);this.normalSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;CSS.removeClass(this.stageWrapper,'showVideo');DOM.empty(this.videoStage);this.currentMinSize=null;this.pinPagers=false;CSS.removeClass(this.stagePagers,'pagingReady');this.recacheData();DOM.empty(this.sideAdUnit);DOM.empty(this.bottomAdUnit);this.stream.destroy();var b=this.closingAction===PhotoSessionLog.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){PageTransitions.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}Arbiter.inform('layer_hidden',{type:'PhotoSnowbox'});Arbiter.inform(PhotoSnowbox.CLOSE,b);this.root.setAttribute('aria-busy','true');this.isOpen=false;},createLoader:function(a){if(this.thumbSrc!==null&&this.normalSize!==null){var b=this.getMaxImageSize(this.normalSize);this.useImage($N('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:b.x+'px',height:b.y+'px'}}),b,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(a)(function(){var c=new Image();c.onload=async_callback(function(){if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(a,this.normalSize);this.ua&&this.ua.add_event('image');}}.bind(this),'photo_theater');c.src=a;}).bind(this).defer();CSS.hide(this.stageActions);CSS.addClass(this.stagePagers,'pagingDisabled');},initDataFetched:function(a){PhotoSessionLog.setPhotoSet(this.stream.getPhotoSet());PhotoSessionLog.setLogFbids(a.logids);PhotoSessionLog.addPhotoView(this.stream.getCurrentImageData().info);this.position=this.stream.getCursor();var b={click:this.pageListener.bind(this),mouseleave:this.mouseLeaveListener.bind(this),mousemove:this.mouseMoveListener.bind(this)};if(!this.pageHandlers){this.pageHandlers=values(Event.listen(this.root,b));KeyEventController.registerKey('LEFT',this.pageListener.bind(this));KeyEventController.registerKey('RIGHT',this.pageListener.bind(this));}CSS.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=a.loggedin;this.disableAds=!this.isLoggedInViewer||a.fromad;this.loadAds();},adjustForResize:function(){this.currentMinSize=null;this.pinPagers=false;this.adjustStageSize();this.adjustForNewData();},getMaxImageSize:function(a){var b=Vector2.getViewportDimensions(),c=b.sub(new Vector2(PhotoSnowbox.STAGE_CHROME.x,PhotoSnowbox.STAGE_CHROME.y)),d=new Vector2(Math.min(a.x,c.x,PhotoSnowbox.STAGE_MAX.x),Math.min(a.y,c.y,PhotoSnowbox.STAGE_MAX.y));if(d.x===0&&d.y===0)return new Vector2(0,0);var e=a.x/a.y,f=d.x/d.y;if(f<e)return new Vector2(d.x,Math.round(d.x/e));return new Vector2(Math.round(d.y*e),d.y);},adjustStageSize:function(a){var b,c=this.stream&&this.stream.getCurrentImageData();if(a){b=a;}else if(c&&c.dimensions){b=c.dimensions;}else if(this.image&&this.image.src&&image_has_loaded(this.image)){b=Vector2.getElementDimensions(this.image);}else return;if(this.shouldStretch&&!this.getVideoOnStage()&&b.x>b.y&&b.x<=PhotoSnowbox.TIMELINE_STRETCH_WIDTH&&b.x>=PhotoSnowbox.TIMELINE_STRETCH_MIN){b.y=Math.round(b.y*PhotoSnowbox.TIMELINE_STRETCH_WIDTH/b.x);b.x=PhotoSnowbox.TIMELINE_STRETCH_WIDTH;CSS.setStyle(this.image,'height',b.y+'px');CSS.setStyle(this.image,'width','auto');}var d=this.getMaxImageSize(b);if(!this.currentMinSize){this.currentMinSize=new Vector2(Math.max(d.x,PhotoSnowbox.STAGE_MIN.x),Math.max(d.y,PhotoSnowbox.STAGE_MIN.y));}else this.currentMinSize=new Vector2(Math.max(d.x,this.currentMinSize.x),Math.max(d.y,PhotoSnowbox.STAGE_MIN.y));CSS.setStyle(this.container,'width',this.currentMinSize.x+'px');CSS.setStyle(this.stageWrapper,'height',this.currentMinSize.y+'px');CSS.setStyle(this.stage,'lineHeight',this.currentMinSize.y+'px');CSS.setStyle(this.videoStage,'lineHeight',this.currentMinSize.y+'px');CSS.conditionClass(this.container,'adsOnSide',this.currentMinSize.x>=PhotoSnowbox.WIDE_ADS);this.adjustForAdUnit();if(!this.pinPagers)CSS.setStyle(this.stagePagers,'height',this.currentMinSize.y/2+'px');this.pinPagers=true;},adjustForNewData:function(){if(!this.image)return;var a=DOM.scry(this.stage,'div.tagsWrapper')[0],b=Vector2.getElementDimensions(this.image);if(a){CSS.setStyle(a,'width',b.x+'px');CSS.setStyle(a,'height',b.y+'px');if(ua.ie()<=7){var c=DOM.scry(this.root,'div.tagContainer')[0];if(c)CSS.conditionClass(a,'ie7VerticalFix',Vector2.getElementDimensions(c).y>b.y);}}},setLoadingState:function(a,b){switch(a){case PhotoSnowbox.STATE_IMAGE_PIXELS:CSS.conditionClass(this.root,'imagePixelsLoading',b);break;case PhotoSnowbox.STATE_IMAGE_DATA:this.loadingStates[a]=b;CSS.conditionClass(this.root,'imageLoading',b);break;case PhotoSnowbox.STATE_HTML:this.loadingStates[a]=b;CSS.conditionClass(this.root,'dataLoading',b);CSS.conditionClass(this.root,'dataLoaded',!b);this.infoWrapper.setAttribute('aria-busy',b?'true':'false');break;}},destroy:function(){this.stageHandlers.each(function(a){a.remove();});if(this.pageHandlers){this.pageHandlers.each(function(a){a.remove();});this.pageHandlers=null;}},checkState:function(a){if(a!=PhotoSnowbox.STATE_ERROR&&!this.loadingStates[a])return;switch(a){case PhotoSnowbox.STATE_IMAGE_DATA:var b=this.stream.getCurrentImageData();if(b){if(b.url){this.switchImage(b.url,null,true);}else if(b.video)this.switchVideo(b.video,true);this.setLoadingState(a,false);}break;case PhotoSnowbox.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(a,false);}break;default:if(this.stream.errorInCurrent()){CSS.hide(this.image);CSS.show(this.errorBox);}break;}},buttonListener:function(event){var a=event.getTarget(),b=Date.now();if(Parent.byClass(a,'fbPhotoTagApprovalBox'))return;if(b-this.lastPage<350)return;if(Parent.byClass(a,'likeButton')){DOM.find($('fbPhotoSnowboxFeedback'),'button.like_link').click();}else if(Parent.byClass(a,'commentButton')){DOM.find(this.root,'div.commentBox textarea').focus();this.root.scrollTop=this.root.scrollHeight;}else if(Parent.byClass(a,'tagApproveIgnore'))this.updateTagBox(event,a);},rotateListener:function(event){var a=event.getTarget();if(Parent.byClass(a,'rotateRight')){this.rotate('right');}else if(Parent.byClass(a,'rotateLeft'))this.rotate('left');},updateTagBox:function(a,b){this.unhiliteAllTags();var c=ge(a);if(!c)return;CSS.addClass(c,'tagBox');CSS.addClass(c,'tagBoxPendingResponse');CSS.removeClass(c,'tagBoxPending');CSS.hide(DOM.find(c,'span.tagForm'));if(b){CSS.show(DOM.find(c,'span.tagApproved'));}else CSS.show(DOM.find(c,'span.tagIgnored'));},rotate:function(a){var b=this.stream.getCursor();if(this.getVideoOnStage()){var c=(a=='left')?270:90;Bootloader.loadComponents(['video-rotate-viewer'],new VideoRotate(b,this.actionList).motionRotate(c));return;}var d={fbid:b,cs_ver:PhotosConst.VIEWER_SNOWBOX};d[a]=1;this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);CSS.hide(this.image);new AsyncRequest('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(d).setErrorHandler(this.rotationError.bind(this,b)).setHandler(this.rotationComplete.bind(this,b)).setMethod('POST').setReadOnly(false).send();},rotationComplete:function(a,b){this.storeResponseForRotate(a,b);if(a==this.stream.getCursor()){this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}},storeResponseForRotate:function(a,b){this.storeFromResponse(b);var c=this.stream.getImageData(a);c.url=b.getPayload().new_urls[PhotosConst.SIZE_NORMAL];c.dimensions=Vector2.deserialize(b.getPayload().dimensions);},rotationError:function(a,b){if(a==this.stream.getCursor()){this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);AsyncResponse.defaultErrorHandler(b);}},saveTagComplete:function(a){this.saveTagsFromPayload(a.getPayload());},saveTagsFromPayload:function(a){this.storeFromData(a);if('data' in a&&this.stream.getCursor() in a.data)this.swapData();},mouseLeaveListener:function(event){this.unhiliteAllTags();this.reHilitePendingTag();},mouseMoveListener:function(event){var a=event.getTarget(),b=(Parent.byClass(a,'stageActions')||Parent.byClass(a,'stageWrapper'));if(!b)CSS.hide(this.pivotBar);if(this.hasPivotData()&&!this.loadingStates.html)CSS.show(this.pivotBar);this.hiliteTagsOnMouseMove(event);},hasPivotData:function(){var a=this.stream.getCurrentHtml();return a&&a.fbPhotoSnowboxPivots;},unhiliteAllTags:function(){DOM.scry(this.stage,'div.tagsWrapper div.hover').each(function(a){CSS.removeClass(a,'hover');});this.hilitedTag=null;},switchHilitedTags:function(a,b){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();var c=ge(a);if(c){this.hilitedTag=a;CSS.addClass(c,'hover');if(CSS.hasClass(c,'tagBoxPending')&&!CSS.hasClass(c,'showPendingTagName')&&b===true){DOM.scry(this.stage,'div.tagsWrapper div.showPendingTagName').each(function(d){CSS.removeClass(d,'showPendingTagName');});CSS.addClass(c,'showPendingTagName');}}},reHilitePendingTag:function(){var a=ge(this.hilitedTag);if(a&&CSS.hasClass(a,'showPendingTagName'))return;var b=DOM.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(b)this.switchHilitedTags(b.id);},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var a=event.getTarget();if(Parent.byClass(a,'fbPhotoSnowboxTagApproval'))return;var b=Parent.byClass(a,'tagBoxPending'),c=(this.hilitedTag&&CSS.hasClass($(this.hilitedTag),'tagBoxPending')),d=((!this.hilitedTag&&b)||(!c&&b));if(d){this.switchHilitedTags(b.id);return;}if(b&&(b.id==this.hilitedTag))return;var e=250,f=Vector2.getEventPosition(event),g=Vector2.getElementPosition(this.image),h=Vector2.getElementDimensions(this.image),i=this.stream.getCurrentImageData().dimensions,j=h.x/i.x,k=PhotosUtils.getNearestBox(f,g,i,j,PhotoSnowbox.MIN_TAG_DISTANCE*j,this.stream.getCurrentExtraData().tagRects);if(!k){if(!c){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var l=null;if(c){var m={};m[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];l=PhotosUtils.getNearestBox(f,g,i,j,PhotoSnowbox.MIN_TAG_DISTANCE*j,m);}if(l!==null&&c)return;if(this.hilitedTag!=k)if(c){this.switchTimer=this.switchHilitedTags.bind(this,k).defer(e);}else this.switchHilitedTags(k);},getVideoOnStage:function(){var a=this.stream&&this.stream.getCurrentImageData();return a&&a.video;},shouldGoForward:function(a){var b=(this.getVideoOnStage()||CSS.hasClass(this.root,'taggingMode')||Parent.byClass(a,'tagBoxPending')||Parent.byClass(a,'tagBoxPendingResponse')||Parent.byClass(a,'fbPhotoTagApprovalBox'));if(b)return false;return DOM.isNode(a)&&Parent.byClass(a,'stage');},pageListener:function(event){var a=Event.getKeyCode(event),b=event.getTarget(),c=0;if(a==KEYS.RIGHT){c=1;PhotoSessionLog.setPagingAction('key_right');}else if(a==KEYS.LEFT){c=-1;PhotoSessionLog.setPagingAction('key_left');}else if(Parent.byClass(b,'next')){c=1;PhotoSessionLog.setPagingAction('click_next');}else if(Parent.byClass(b,'prev')){c=-1;PhotoSessionLog.setPagingAction('click_prev');}else if(this.shouldGoForward(b)){c=1;PhotoSessionLog.setPagingAction('click_stage');}if(c){this.page(c,false);user_action('a',b,event);}},page:function(a,b){if(!this.stream.isValidMovement(a))return;this.lastPage=Date.now();this.unhiliteAllTags();var c=this.getVideoOnStage();if(c)this.switchVideo(c,false);Arbiter.inform(PhotoSnowbox.PAGE);this.recacheData();this.stream.moveCursor(a);CSS.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(PhotoSnowbox.STATE_HTML,true);CSS.show(this.errorBox);return;}var d=this.stream.getCurrentImageData();if(d){if(d.url){this.switchImage(d.url,null,true);}else if(d.video)this.switchVideo(d.video,true);if(!b){this.replaceUrl=true;goURI(d.info.permalink);}}else{this.setLoadingState(PhotoSnowbox.STATE_IMAGE_PIXELS,true);this.setLoadingState(PhotoSnowbox.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(PhotoSnowbox.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();},logImpressionDetailsForPhoto:function(){var a=[].concat(DOM.scry($('fbPhotoSnowboxTagList'),'input.photoImpressionDetails'),DOM.scry($('fbPhotoSnowboxFeedback'),'input.photoImpressionDetails'));if(a.length===0)return;var b={};for(var c=0;c<a.length;c++)b[a[c].name]=a[c].value;if(this.getVideoOnStage()){b.width=0;b.height=0;}else{b.width=this.stream.getCurrentImageData().dimensions.x;b.height=this.stream.getCurrentImageData().dimensions.y;}PhotoSessionLog.addDetailData(this.stream.getCursor(),b);},loadAds:function(){if(this.disableAds)return;var a=Date.now();if(a-this.lastAdsLoad>PhotoSnowbox.ADS_REFRESH_RATE){UIPagelet.loadFromEndpoint('WebEgoPane','fbPhotoSnowboxAdsSide',{pid:34,data:[this.loadQuery.set]},{crossPage:true});this.lastAdsLoad=a;}},adjustForAdUnit:function(){var a=this.sideAdUnit.childNodes,b=this.bottomAdUnit.childNodes;if(CSS.hasClass(this.container,'adsOnSide')){if(b.length>0&&a.length===0)DOM.setContent(this.sideAdUnit,$A(b));DOM.empty(this.bottomAdUnit);}else if(a.length>0){DOM.setContent(this.bottomAdUnit,$A(a));DOM.empty(this.sideAdUnit);}CSS.conditionClass(this.sideAdDiv,'fbPhotoSnowboxAdsNone',a.length===0);CSS.conditionClass(this.bottomAdDiv,'fbPhotoSnowboxAdsNone',b.length===0);},transitionHandler:function(a){if(a.getQueryData().closeTheater||a.getQueryData().permPage||a.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(a.getQualifiedURI().toString());PageTransitions.transitionComplete();return true;}var b=this._uriStack.length;if(b>=2&&this._uriStack[b-2]==a.getQualifiedURI().toString())this._uriStack.pop();var c=this.stream.getCursorForURI(a.getUnqualifiedURI().toString());if(c){var d=this.stream.getRelativeMovement(c);this.page(d,true);PageTransitions.transitionComplete();return true;}if(this.isOpen){this.close();PageTransitions.transitionComplete();return true;}this.transitionHandlerRegistered=false;return false;},recacheData:function(){if(!this.loadingStates.html){var a=this.stream.getCurrentHtml();for(var b in a){a[b]=$A($(b).childNodes);DOM.empty($(b));}}},reloadIfTimeout:function(){if(!image_has_loaded(this.image)){var a=this.makeNewImage(this.image.src,true);Event.listen(a,'load',this.useImage.bind(this,a,null,true));}},useImage:function(a,b,c){if(c&&image_has_loaded(this.image))return;DOM.replace(this.image,a);this.image=a;this.adjustStageSize(b);},makeNewImage:function(a,b){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!b)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),PhotoSnowbox.LOADING_TIMEOUT);var c=$N('img',{className:'spotlight',alt:''});c.setAttribute('aria-describedby','fbPhotosSnowboxCaption');c.setAttribute('aria-busy','true');Event.listen(c,'load',async_callback(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){this.adjustStageSize();this.adjustForNewData();}).bind(this).defer();}.bind(this),'photo_theater'));c.src=a;return c;},switchImage:function(a,b,c){CSS.hide(this.image);CSS.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var d=this.stream&&this.stream.getCurrentImageData();if(d)PhotoSessionLog.addPhotoView(d.info);this.useImage(this.makeNewImage(a,false),b,false);if(c)this.stream.preloadImages();},switchVideo:function(a,b){var c='swf_'+a;if(b){CSS.addClass(this.stageWrapper,'showVideo');this.videoStage.id=a;if(window[c]&&!ge(c))window[c].write(a);this.adjustStageSizeForVideo.bind(this,c).defer();}else{this.videoStage.id='fbVideoStage';window[c]&&window[c].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);DOM.empty(this.videoStage);CSS.removeClass(this.stageWrapper,'showVideo');}},checkVideoStatus:function(a){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);video=this.getVideoOnStage();if(!video){return;}else{currentSwfID='swf_'+video;if(a!==currentSwfID)return;this.adjustStageSizeForVideo(a);}},adjustStageSizeForVideo:function(a){var b=ge(a);if(!b){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,a),200);}else this.adjustStageSize(new Vector2(b.width,b.height));},setErrorBoxContent:function(a){DOM.setContent(this.errorBox,a);},swapData:function(){var a,b=this.stream.getCurrentHtml();if(b){this.setLoadingState(PhotoSnowbox.STATE_HTML,false);for(var c in b){a=ge(c);a&&DOM.setContent(a,b[c]);}var d=DOM.scry($('fbPhotoSnowboxCaption'),'div.fbPhotoInlineCaptionEditor');if(d.length)new PhotoInlineCaptionEditor('snowbox').init(d[0]);Arbiter.inform(PhotoSnowbox.DATA_CHANGE,this.stream.getCurrentImageData().info,Arbiter.BEHAVIOR_STATE);this.position=this.stream.getCursor();}this.adjustForNewData();this.logImpressionDetailsForPhoto();},updateTotalCount:function(a,b,c){element=ge('fbPhotoSnowboxPositionAndCount');element&&DOM.setContent(element,c);this.stream.setTotalCount(a);this.stream.setFirstCursorIndex(b);},addPhotoFbids:function(a,b,c){var d=this.stream.getCursor()===null;this.stream.attachToFbidsList(a,b,c);if(c&&d)this.page(0,true);if(!this.pagersShown&&this.stream.canPage())this.setStagePagersReady();},storeFromResponse:function(a){window.ArbiterMonitor&&ArbiterMonitor.stopTtiMeasurement();this.storeFromData(a.getPayload());},storeFromData:function(a){if(!this.isOpen)return;var b=this.stream.storeToCache(a);if('error' in b){this.checkState(PhotoSnowbox.STATE_ERROR);return;}if('init' in b){this.initDataFetched(b.init);if(this.openExplicitly){this.replaceUrl=true;goURI(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersReady();this.ua&&this.ua.add_event('ufi');}if('image' in b)this.checkState(PhotoSnowbox.STATE_IMAGE_DATA);if('data' in b)this.checkState(PhotoSnowbox.STATE_HTML);},setStagePagersReady:function(){CSS.removeClass(this.stagePagers,'pagingDisabled');CSS.addClass(this.stagePagers,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');},deletePhoto:function(a){this.closeRefresh();},closeRefresh:function(){this.refreshOnClose=true;this.closeHandler();},onHiliteTag:function(a,b){if(b.version!=PhotosConst.VIEWER_SNOWBOX)return;id=b.tag;if(id){this.switchHilitedTags(id,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(a,b){if(b.version==PhotosConst.VIEWER_SNOWBOX)this.updateTagBox(b.id,b.approve);}};
__e("legacy:popup-resizer",["PopupWindow"],function(a,b,c,d){a.PopupResizer=b('PopupWindow');},3);
__e("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__e("legacy:privacy-common",["PrivacyConst","PrivacyModel"],function(a,b,c,d){var e=b('PrivacyConst');a.PrivacyModel=b('PrivacyModel');a.PrivacyBaseValue=e.BaseValue;a.PrivacyFriendsValue=e.FriendsValue;a.PrivacyNetworksAll=e.NetworksAll;a.PrivacyNetworkTypes=e.NetworkTypes;a.PrivacySpecialPreset=e.SpecialPreset;},3);
function ScrollingPager(a,b,c,d){this.scroll_loader_id=a;this.pagelet_src=b;this.data=c;this.options=d||{};if(this.options.target_id){this.target_id=this.options.target_id;this.options.append=true;}else this.target_id=a;this.handler=null;}copy_properties(ScrollingPager,{_instances:{},getInstance:function(a){return ScrollingPager._instances[a];}});ScrollingPager.prototype={register:function(){this.onvisible=new OnVisible($(this.scroll_loader_id),this.getHandler(),false,this.options.buffer,this.options);ScrollingPager._instances[this.scroll_loader_id]=this;},getInstance:function(a){return ScrollingPager._instances[a];},getHandler:function(){if(this.handler)return this.handler;function a(){var b=ge(this.scroll_loader_id);if(!b){this.onvisible.remove();return;}CSS.addClass(b.firstChild,'async_saving');var c=this.options.handler;this.options.handler=function(){Arbiter.inform('ScrollingPager/loadingComplete');c&&c.apply(null,arguments);};UIPagelet.loadFromEndpoint(this.pagelet_src,this.target_id,this.data,this.options);}return a.bind(this);},setHandler:function(a){this.handler=a;},removeOnVisible:function(){this.onvisible.remove();}};
add_properties('TypeaheadBehaviors',{buildBestAvailableNames:function(a){var b=a.getView();b.subscribe('beforeRender',function(c,d){var e=d.value;for(var f=0;f<d.results.length;++f){var g=d.results[f];if(g.alternate_names==null)continue;if(TypeaheadUtil.isQueryMatch(e,g.default_name)){g.text=g.default_name;return;}for(var h=0;h<g.alternate_names.length;h++)if(TypeaheadUtil.isQueryMatch(e,g.alternate_names[h])){g.text=g.alternate_names[h];return;}g.text=g.default_name;}});}});
function StreamProfileComposer(){}StreamProfileComposer.prototype={init:function(a){var b=$(a);Arbiter.subscribe('composer/publish',function(event,c){if(c.streamStory)animation.prependInsert(b,c.streamStory);});}};
function tz_calculate(a){var b=new Date(),c=b.getTimezoneOffset()/30,d=b.getTime()/1000,e=Math.round((a-d)/1800),f=Math.round(c+e)%48;if(f==0){return 0;}else if(f>24){f-=Math.ceil(f/48)*48;}else if(f<-28)f+=Math.ceil(f/-48)*48;return f*30;}function tz_autoset(a,b){if(!a||undefined==b)return;if(window.tz_autoset.calculated)return;window.tz_autoset.calculated=true;var c=-tz_calculate(a);if(c!=b){var d='ajax/autoset_timezone_ajax.php';new AsyncRequest().setURI(d).setData({gmt_off:c}).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding).setOption('suppressErrorAlerts',true).send();}}
function ufi_add_ft_hidden_node(a){if(a.link_data)return;var b=collect_data_attribs(a,['ft']).ft;if(count(b)){var c=$N('input',{type:'hidden',name:'link_data',value:JSON.stringify(b)});a.appendChild(c);}}function ufi_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.commentable_item').forEach(ufi_add_ft_hidden_node);});}function question_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.fbEigenpollForm').forEach(ufi_add_ft_hidden_node);});}
onloadRegister_DEPRECATED(function(){add_properties('__behaviors',{});if(__behaviors.Scrollable)return;__behaviors.Scrollable=true;var a='scrollable',b=function(event){var d=Parent.byClass(event.getTarget(),a);if(!d)return;if((typeof event.axis!=='undefined'&&event.axis===event.HORIZONTAL_AXIS)||(event.wheelDeltaX&&!event.wheelDeltaY)){event.prevent();return;}var e=event.wheelDelta?event.wheelDelta:-event.detail,f=d.scrollHeight,g=d.clientHeight;if(f>g){var h=d.scrollTop;if((e>0&&h===0)||(e<0&&h>=f-g)){event.prevent();}else if(ua.ie()<9){var i=CSS.getStyle(d,'font-size');if(i.indexOf('px')<0){var j=$N('div');j.style.fontSize=i;j.style.height='1em';i=j.style.pixelHeight;}else i=parseInt(i,10);d.scrollTop=h-Math.round(e/120*i);event.prevent();}}},c=document.documentElement;if(ua.firefox()){c.addEventListener('DOMMouseScroll',b,false);}else Event.listen(c,'mousewheel',b);});
function MentionsInput(a){DataStore.set(a,'MentionsInput',this);this._root=a;}MentionsInput.getInstance=function(a){var b=Parent.byClass(a,'uiMentionsInput');return b?DataStore.get(b,'MentionsInput'):null;};(function(){var a=['@','\\uff20','+','\\uff0b'].join(''),b='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',c='\\b[A-Z][^ A-Z'+b+']',d='([^'+a+b+']|['+b+'][^ '+b+'])',e='(?:^|\\s)(?:['+a+']('+d+'{0,20}))',f='(?:(?:'+c+'+)|'+e+')',g='(?:'+c+'{4,})';MentionsInput.prototype={_triggers:new RegExp('['+a+']$'),_matcher:new RegExp(e+'$'),_autoMatcher:new RegExp(f+'$'),_userMatcher:new RegExp(g+'$')};})();Class.mixin(MentionsInput,'Arbiter',{init:function(a,b,c){this.init=bagofholding;this._initialized=true;this._typeahead=Typeahead.getInstance(DOM.find(this._root,'.mentionsTypeahead'));this._highlighter=DOM.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=DOM.find(this._root,'.highlighterContent');this._hiddenInput=DOM.find(this._root,'.mentionsHidden');this._input=this._typeahead.getCore().getElement();this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=a.max||6;this._metrics=c;if(ua.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var d=this._input.name;this._input.name=d+'_text';this._hiddenInput.name=d;}this._initEvents();this._initTypeahead();this.reset(b);this.inform('init',null,Arbiter.BEHAVIOR_STATE);},reset:function(a){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&DOM.empty(this._highlighterContent);this._highlighterAuxContent&&DOM.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;Input.setPlaceholder(this._input,this._placeholder);CSS.setStyle(this._typeahead.getElement(),'height','auto');if(a){Input.setValue(this._input,a.flattened);for(var b in a.mention_data)this._addToken({uid:b,text:a.mention_data[b],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getRawValue:function(){return Input.getValue(this._hiddenInput);},checkValue:function(){var a=this._typeahead.getCore().getValue();if(this._triggers.exec(a)||a==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var a=this._update.bind(this);Event.listen(this._input,{input:a,keyup:a,change:a,focus:this._updateWidth.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(e,f){var g=f.selected;this._addToken({uid:g.uid,text:g.text,type:g.type});this.updateValue();}.bind(this));var a=this._input,b=null,c=function(){if(b===null){b=Input.getSubmitOnEnter(a);Input.setSubmitOnEnter(a,false);}},d=function(){if(b!==null){Input.setSubmitOnEnter(a,b);b=null;}};this._typeahead.subscribe('render',c);this._typeahead.subscribe('reset',d);this._typeahead.subscribe('highlight',function(e,f){f.index>=0?c():d();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._typeahead.getData().setFilter(this._filterResults.bind(this));},_filterResults:function(a){if(this._filterData===null){var b=Input.getSelection(this._input).start||0;for(var c=0;c<this._offsets.length;c++){var d=this._offsets[c];if(b>d[0]&&b<=d[1]){this._filterData={caretIsInsideMention:true};return false;}}var e=this._typeahead.getCore();this._filterData={value:e.getValue(),rawValue:e.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(this._matcher.test(this._filterData.rawValue))return true;if(a.type!='user')return false;if(this._userMatcher.test(this._filterData.value))return true;return TypeaheadUtil.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(a));},_addToken:function(a){var b=a.uid;if(!this._mentioned.hasOwnProperty(b)){this._mentioned[b]=a;this._orderedUIDs.push(b);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(a){if(this._mentioned.hasOwnProperty(a)){delete this._mentioned[a];this._orderedUIDs.remove(a);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(a,b){var c=b.split(' '),d=[];for(var e=0;e<c.length;e++)if(a.indexOf(c[e])!=-1)d.push(c[e]);c=d;for(e=1;e<c.length;e++)for(var f=1;f<c[e-1].length+1;f++)if(a.indexOf(c[e-1].substr(0,f)+c[e])!=-1)c.splice(e-1,1);while(a.indexOf(c.join(' '))==-1)c.splice(0,1);return c.join(' ');},_update:function(){var a=Input.getValue(this._input);if(a==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var a=Input.getValue(this._input),b=false;for(var c=0;c<this._orderedUIDs.length;++c){var d=this._orderedUIDs[c],e=this._mentioned[d],f=e.text,g;if(e.type=='user'&&(g=this._reduceToken(a,f))!==''){if(g==f.substring(0,f.lastIndexOf(' '))&&a==this._value.substring(0,this._value.length-1)){a=a.substring(0,a.lastIndexOf(' '));b=true;}e.text=g;}else if(!f||a.indexOf(f)==-1||typeof f!=='string')this._removeToken(d);}this._value=a;if(b)Input.setValue(this._input,a);},updateValue:function(){var a=Input.getValue(this._input),b=this._orderedUIDs,c=[],d,e,f,g;for(g=0;g<b.length;++g){e=this._mentioned[b[g]].text;a=a.replace(e,function(h,i){c.push([i,i+e.length]);return e;});}for(g=0;g<b.length;++g){f=b[g];e=this._mentioned[f].text;a=a.replace(e,'@['+f+':]');}d=htmlize(a);for(g=0;g<b.length;++g){f=b[g];e=this._mentioned[f].text;d=d.replace('@['+f+':]','<b>'+htmlize(e)+'</b>');e=e.replace(/[\\\]:]/g,function(h){return '\\'+h;});a=a.replace('@['+f+':]','@['+f+':'+e+']');}if(ua.ie())d=d.replace(/ {2}/g,'&nbsp; ');this._offsets=c;this._hiddenInput.value=a;DOM.setContent(this._highlighterContent,HTML(d));this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var a=CSS.getStyle(this._input,'direction');if(a==this._dir)return;this._dir=a;CSS.setStyle(this._highlighter,'direction',a);if(a=='rtl'){CSS.setStyle(this._highlighter,'text-align','right');}else CSS.setStyle(this._highlighter,'text-align','left');},_updateWidth:function(){var a=CSS.getStyleFloat.curry(this._input),b=this._input.offsetWidth-a('paddingLeft')-a('paddingRight')-a('borderLeftWidth')-a('borderRightWidth');if(ua.firefox())b-=2;if(ua.ie()<=7){b-=CSS.getStyleFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(b,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var a=this._highlighter.offsetHeight,b=this._typeahead.getElement();if(a>b.offsetHeight){CSS.setStyle(b,'height',a+'px');Arbiter.inform('reflow');}}},_updateTypeahead:function(){var a=this._typeahead.getCore(),b=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)b=this._autoMatcher;a.matcher=b;a.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},_updateHighlighter:function(){if(this._highlighterContent)CSS.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(a){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=$N('span',{className:'highlighterAuxContent'});DOM.insertAfter(this._highlighterContent,this._highlighterAuxContent);}DOM.setContent(this._highlighterAuxContent,a);if(a){Input.setPlaceholder(this._input,'');}else Input.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var a=this.getAuxContentRoot();return a&&a.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(a){var b=Input.getValue(this._input);Input.setValue(this._input,b+" "+a.text);this._addToken(a);this._update();},getMentions:function(){return this._mentioned;}});
var TooltipLink={setTooltipText:function(a,b){a=Parent.byTag(a,'a');a&&Tooltip.set(a,b);}};
__e("legacy:contextual-layer-hide-on-scroll",["ContextualLayerHideOnScroll"],function(a,b,c,d){a.ContextualLayerHideOnScroll=b('ContextualLayerHideOnScroll');},3);
__e("legacy:ContextualLayer",["ContextualLayer"],function(a,b,c,d){a.ContextualLayer=b('ContextualLayer');},3);
function TypeaheadView(a,b){this.element=this.content=$(a);copy_properties(this,b);}Class.mixin(TypeaheadView,'Arbiter',{events:['highlight','render','reset','select'],renderer:'basic',autoSelect:false,init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){Event.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},getElement:function(){return this.element;},mouseup:function(event){if(event.button!=2){this.select(true);event.kill();}},mouseover:function(event){if(this.visible)this.highlight(this.getIndex(event));},reset:function(a){if(!a)this.disableAutoSelect=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(Parent.byTag(event.getTarget(),'li'));},getSelection:function(){var a=this.results[this.index]||null;return this.visible?a:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){CSS.show(this.element);this.visible=true;return this;},hide:function(){CSS.hide(this.element);this.visible=false;return this;},render:function(a,b,c){this.value=a;if(!b.length){this.reset(true);return;}var d={results:b,value:a};this.inform('beforeRender',d);b=d.results;var e=this.getDefaultIndex(b);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var f=this.results[this.index];for(var g=0,h=b.length;g<h;++g)if(f.uid==b[g].uid){e=g;break;}}this.results=b;DOM.setContent(this.content,this.buildResults(b));this.items=this.getItems();this.highlight(e,false);this.inform('render',b);},getItems:function(){return DOM.scry(this.content,'li');},buildResults:function(a){var b,c=null;if(typeof this.renderer=='function'){b=this.renderer;}else{b=TypeaheadRenderers[this.renderer];c=this.renderer;}b=b.bind(this);var d=a.map(function(e,f){return e.node||b(e,f);});return $N('ul',{className:c},d);},getDefaultIndex:function(a){var b=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!b?-1:0;},next:function(){this.highlight(this.index+1);},prev:function(){this.highlight(this.index-1);},highlight:function(a,b){this.selected&&CSS.removeClass(this.selected,'selected');if(a>this.items.length-1){a=-1;}else if(a<-1)a=this.items.length-1;if(a>=0&&a<this.items.length){this.selected=this.items[a];CSS.addClass(this.selected,'selected');}this.index=a;this.disableAutoSelect=(a==-1);if(b!==false)this.inform('highlight',{index:a,selected:this.results[a]});},select:function(a){var b=this.index,c=this.results[b];if(c){this.inform('select',{index:b,clicked:!!a,selected:c});this.inform('afterSelect');}}});
function ContextualTypeaheadView(a,b){this.parent.construct(this,a,b);}Class.extend(ContextualTypeaheadView,'TypeaheadView');ContextualTypeaheadView.prototype={init:function(){this.initializeLayer();this.parent.init();},initializeLayer:function(){this.context=this.element.parentNode;this.wrapper=$N('div');DOM.appendContent(this.wrapper,this.element);this.layer=new ContextualLayer().init(this.wrapper).enableBehaviors([ContextualLayerHideOnScroll]).setContext(this.context).setAutoFlip(CSS.isFixed(this.context)).setPosition('below');this.subscribe('render',this.renderLayer.bind(this));},show:function(){this.layer.show();Vector2.getElementDimensions(this.context).setElementWidth(this.wrapper);return this.parent.show();},hide:function(){this.layer.hide();return this.parent.hide();},renderLayer:function(){if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();}};
function MultiBootstrapDataSource(a){this._bootstrapEndpoints=a.bootstrapEndpoints;this.parent.construct(this,a);}Class.extend(MultiBootstrapDataSource,'DataSource');MultiBootstrapDataSource.prototype={bootstrapWithoutToken:function(){for(var a=0;a<this._bootstrapEndpoints.length;a++)this.fetch(this._bootstrapEndpoints[a].endpoint,this._bootstrapEndpoints[a].data||{},{bootstrap:true});}};
function TypeaheadCore(a){copy_properties(this,a);}Class.mixin(TypeaheadCore,'Arbiter',{events:['blur','focus','unselect'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(a,b,c){this.init=bagofholding;this.data=a;this.view=b;this.root=c;this.initInput();this.inputWrap=DOM.find(c,'div.wrap');this.hiddenInput=DOM.find(c,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&CSS.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initInput:function(){this.element=DOM.find(this.root,'.textInput');var a=DOM.scry(this.element,'input')[0];if(a)this.element=a;},initView:function(){this.view.subscribe('highlight',function(){this.element.focus();}.bind(this));this.view.subscribe('select',function(a,b){this.select(b.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(a,b){if(b.forceDisplay||b.value==this.getValue()&&!this.element.disabled)this.view.render(b.value,b.results,b.isAsync);}.bind(this));this.data.subscribe('activity',function(a,b){this.fetching=b.activity;if(!this.fetching)this.nextQuery&&this.performQuery();}.bind(this));},initEvents:function(){Event.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var a={blur:bind(this,'blur'),focus:bind(this,'focus'),click:bind(this,'click'),keyup:bind(this,'keyup'),keydown:bind(this,'keydown')};if(ua.firefox())a.text=a.keyup;if(ua.firefox()<4){a.keypress=a.keydown;delete a.keydown;}Event.listen(this.element,a);Event.listen(this.element,'keypress',bind(this,'keypress'));},initToggle:function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){var a=Input.getSelection(this.element);if(a.start==a.end)this.element.select();},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(Event.getKeyCode(event)){case KEYS.TAB:this.handleTab(event);return;case KEYS.UP:this.view.prev();break;case KEYS.DOWN:this.view.next();break;case KEYS.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&Event.getKeyCode(event)==KEYS.RETURN){this.view.select();event.kill();}},handleTab:function(event){this.view.select();this.preventFocusChangeOnTab&&event.kill();},select:function(a){if(a&&this.setValueOnSelect){this.setValue(a.text);this.setHiddenValue(a.uid);this.selectedText=a.text;CSS.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.keepFocused?this.element.focus():this.element.blur();this.resetOnSelect?this.reset():this.view.reset();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;CSS.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(a){var b=a===false;this.element.disabled=b;CSS.conditionClass(this.root,'uiTypeaheadDisabled',b);},reset:function(){this.unselect();this.setValue();!this.keepFocused&&Input.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(a){this._exclusions=a;},getExclusions:function(){return this._exclusions;},setValue:function(a){this.value=this.nextQuery=a||'';Input.setValue(this.element,this.value);},setHiddenValue:function(a){this.hiddenInput.value=(a||a===0)?a:'';Arbiter.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return Input.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var a=this.getValue();if(a==this.value)return;if(this.selectedText&&this.selectedText!=a)this.unselect();var b=Date.now(),c=b-this.time;this.time=b;this.value=this.nextQuery=a;this.performQuery(c);},performQuery:function(a){if(this.selectedText)return;a=a||0;if(this.fetching&&a<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions);}else{this.data.query(this.nextQuery,false,this._exclusions);this.nextQuery=null;}}});
function TypeaheadAreaCore(a){this.parent.construct(this,a);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}Class.extend(TypeaheadAreaCore,'TypeaheadCore');TypeaheadAreaCore.prototype={prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(a){this.parent.select(a);var b=this.element.value,c=this.prefix+a.text+this.suffix;this.expandBounds(b,c);var d=b.substring(0,this.start),e=b.substring(this.end);this.element.value=d+c+e;Input.setSelection(this.element,d.length+c.length);},expandBounds:function(a,b){a=a.toLowerCase().trim();b=b.toLowerCase();var c,d,e,f,g=/\s/;d=a.substring(this.start,this.end);e=b.indexOf(d);c=this.start;while(c>=0&&e>=0){f=a.charAt(c-1);if(!f||g.test(f))this.start=c;d=f+d;e=b.indexOf(d);c--;}d=a.substring(this.start,this.end);e=b.indexOf(d);c=this.end;while(c<=a.length&&e>=0){f=a.charAt(c);if(!f||g.test(f))this.end=c;d=d+f;e=b.indexOf(d);c++;}},getRawValue:function(){var a=Input.getSelection(this.element).start||0;return this.parent.getValue().substring(0,a);},getValue:function(){var a=this.matcher&&this.matcher.exec(this.getRawValue());if(!a)return '';var b=a[0],c=a.index+b.length;b=b.replace(/^\s/,'');var d=b.length;b=b.replace(/\s$/,'');var e=d-b.length;this.start=c-d;this.end=c+e;return a[1]||a[0];}};
function TypeaheadMetrics(a){this.extraData={};copy_properties(this,a);}TypeaheadMetrics.prototype={endPoint:'ajax/typeahead/record_basic_metrics.php',init:function(a){this.init=bagofholding;this.core=a.getCore();this.view=a.getView();this.data=a.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(a){var b=a.selected;if(b.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',b.uid);this.recordStat('selected_type',b.type);this.recordStat('selected_position',a.index);this.recordStat('selected_with_mouse',a.clicked?1:0);this._sessionEnd();},bindSessionStart:function(a,event,b){if(b)for(var c=0;c<this._sessionStartEvents.length;++c){var d=this._sessionStartEvents[c];d.obj.unsubscribe(d.token);}this._sessionStartEvents.push({obj:a,token:a.subscribe(event,function(e,f){this._sessionStart();}.bind(this))});},bindSessionEnd:function(a,event,b){if(b)for(var c=0;c<this._sessionEndEvents.length;++c){var d=this._sessionEndEvents[c];d.obj.unsubscribe(d.token);}this._sessionEndEvents.push({obj:a,token:a.subscribe(event,function(e,f){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(a,b){this.recordSelect(b);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(a,b){this.results=b;}.bind(this));this.data.subscribe('beforeQuery',function(a,b){if(!b.value)return;this.query=b.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(a,b){if(b.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else b.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(a,b){if(b.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);bootstrap_result={};b.response.payload.entries.each(function(c){if(!bootstrap_result[c.type]){bootstrap_result[c.type]=1;}else bootstrap_result[c.type]++;});this.recordStat('bootstrap_response_types',bootstrap_result);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-b.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(a,b){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(a,b){this.stats[a]=b;},recordCountStat:function(a){var b=this.stats[a];this.stats[a]=b?b+1:1;},recordAvgStat:function(a,b){if(this.avgStats[a]){this.avgStats[a][0]+=b;++this.avgStats[a][1];}else this.avgStats[a]=[b,1];},submit:function(){if(count(this.stats)>0){copy_properties(this.stats,this.extraData);if(this.results){var a=(this.results).map(function(d,e){return d.uid;});this.recordStat('candidate_results',JSON.stringify(a));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var b in this.avgStats){var c=this.avgStats[b];this.stats[b]=c[0]/c[1];}new AsyncRequest().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}};
add_properties('TypeaheadBehaviors',{hoistFriends:function(a){var b=a.getView();b.subscribe('beforeRender',function(c,d){var e=[],f=[];for(var g=0;g<d.results.length;++g){var h=d.results[g];if(h.type=='user'&&h.bootstrapped){f.push(h);}else e.push(h);}d.results=f.concat(e);});}});
add_properties('TypeaheadBehaviors',{setPhotoOnSelect:function(a){var b=DOM.scry(a.getElement(),'.photo')[0];if(b){if(!DOM.isNodeOfType(b,'img')){var c=DOM.create('img',{className:b.className});DOM.replace(b,c);b=c;}var d=CSS.hide.curry(b),e=CSS.show.curry(b);Event.listen(b,{load:e,error:d,abort:d});a.subscribe('select',function(f,g){var h=g.selected.photo||a.view.fallbackPhoto;h?b.setAttribute('src',h):d();});}}});
add_properties('TypeaheadBehaviors',{showLoadingIndicator:function(a){a.subscribe('activity',function(b,c){CSS.conditionClass(a.getElement(),'typeaheadLoading',c.activity);CSS.conditionClass(a.getView().getElement(),'typeaheadViewLoading',c.activity);});}});
add_properties('TypeaheadRenderers',{basic:function(a,b){var c=[];if(a.icon)c.push($N('img',{alt:'',src:a.icon}));if(a.text)c.push($N('span',{className:'text'},[a.text]));if(a.subtext)c.push($N('span',{className:'subtext'},[a.subtext]));return $N('li',{className:a.type||''},c);}});
add_properties('TypeaheadRenderers',{compact:function(a,b){var c=[],d=a.photo;if(d){if(d instanceof Array){var e=[$N('span',{className:'splitpic leftpic'},[$N('img',{alt:'',src:d[0]})]),$N('span',{className:'splitpic'+(d[2]?' toppic':'')},[$N('img',{alt:'',src:d[1]})])];if(d[2])e.push($N('span',{className:'splitpic bottompic'},[$N('img',{alt:'',src:d[2]})]));d=$N('span',{className:'splitpics clearfix'},e);}else d=$N('img',{alt:'',src:d});c.push(d);}if(a.text)c.push($N('span',{className:'text'},[a.text]));var f=a.subtext,g=a.category;if(f||g){var h=[];f&&h.push(f);f&&g&&h.push(" \u00b7 ");g&&h.push(g);c.push($N('span',{className:'subtext'},h));}return $N('li',{className:a.type||''},c);}});
add_properties('TypeaheadRenderers',{search:function(a,b){var c=[];if(a.photo){c.push($N('img',{className:'photo',alt:'',src:a.photo}));if(a.song){c.push($N('span',{className:'playButton'}));c.push($N('span',{className:'playLoader'}));}}if(a.text){var d=a.alias,e=this.value,f=a.text,g=[f];if(d&&TypeaheadUtil.isQueryMatch(e,d)&&!TypeaheadUtil.isQueryMatch(e,f))g.push($N('span',{className:'alias'},[' \xB7 '+d]));c.push($N('span',{className:'text'},g));}if(a.category){var h=[a.category];if(a.is_external)h.push($N('span',{className:'arrow'}));c.push($N('span',{className:'category'},h));}if(a.subtext)c.push($N('span',{className:'subtext'},[a.subtext]));var i=a.classNames||a.type||'',j=a.is_external?'_blank':'',k=!a.song&&a.path||'';if(k){if(!(/^https?\:\/\//).test(k))k=Env.www_base+k.substr(1);k+=(k.indexOf('?')>0?'&':'?')+'ref=ts';}var l=$N('a',{href:k,rel:'ignore',target:j},c);if(a.song){l.id='mb_'+(Math.random()*1e+06|0);MusicButtonManager.addButton.curry(a.song.provider,l.id,a.song.url,a.song.context,a.song.media_type).defer();l.onclick=this.ignoreClick;}return $N('li',{className:i},[l]);}});
WidgetArbiter={_findSiblings:function(){if(WidgetArbiter._siblings)return;WidgetArbiter._siblings=[];for(var a=parent.frames.length-1;a>=0;a--)try{if(parent.frames[a]&&parent.frames[a].Arbiter&&parent.frames[a].Arbiter.inform)WidgetArbiter._siblings.push(parent.frames[a].Arbiter);}catch(b){}},inform:function(){WidgetArbiter._findSiblings();var a=$A(arguments);WidgetArbiter._siblings.each(function(b){b.inform.apply(b,a);});}};
var PlatformOptInPopup=function(){};copy_properties(PlatformOptInPopup,{DIALOG_URL:'connect/uiserver.php',DIALOG_WIDTH:420,DIALOG_HEIGHT:450,APP_ID:127760087237610,open:function(a,b,c){if(!a)a='generic';if(!b)b='opt.in';var d=new URI(PlatformOptInPopup.DIALOG_URL);d.addQueryData({social_plugin:a,method:b,display:'popup',secure:URI.getRequestURI().isSecure(),app_id:PlatformOptInPopup.APP_ID});if(c)d.addQueryData(c);return PopupResizer.open(d.toString(),PlatformOptInPopup.DIALOG_WIDTH,PlatformOptInPopup.DIALOG_HEIGHT);}});
WindowComm={_callbacks:{},makeHandler:function(a,b){b=b||'opener';var c='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[c]=a;return new URI('connect/window_comm.php').setQueryData({_id:c,_relation:b}).getQualifiedURI().toString();},_recv:function(a){var b=new URI(a).getQueryData();WindowComm._callbacks[b._id](b);}};