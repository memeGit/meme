/*1328509748,176820664*/

if (window.CavalryLogger) { CavalryLogger.start_js(["oW\/FK"]); }

__e("Live",["array-extensions","json","Arbiter","AsyncDOM","ArrayUtils","AsyncSignal","DataStore","dom","presence-arbiter-message","Util","invokeCallbacks"],function(a,b,c,d,e,f){b("array-extensions");b("json");var g=b("Arbiter"),h=b("AsyncDOM"),i=b("ArrayUtils"),j=b("AsyncSignal"),k=b("DataStore"),l=b("dom"),m=b("presence-arbiter-message"),n=b("Util"),o=b("invokeCallbacks"),p={logAll:false,startup:function(){p.startup=bagofholding;g.subscribe(m.getArbiterMessageType('live'),p.handleMessage.bind(p));},lookupLiveNode:function(q,r){var s=l.scry(document.body,'.live_'+q+'_'+r);s.forEach(function(t){if(k.get(t,'seqnum')===undefined){var u=JSON.parse(t.getAttribute('data-live'));k.set(t,'seqnum',u.seq);}});return s;},handleMessage:function(q,r){var s=r.obj,t=s.fbid,u=s.assoc,v=this.lookupLiveNode(t,u);if(!v)return false;v.forEach(function(w){if(s.expseq){var x=k.get(w,'seqnum'),y=k.get(w,'message_buffer');if(y===undefined){y={};k.set(w,'message_buffer',y);}var z={obj:s};y[s.expseq]=z;if(s.expseq!=x){p.log('mismatch',s.fbid,s.expseq,x);return false;}while(true){x=k.get(w,'seqnum');var aa=y[x];if(aa){p._applyUpdates(aa.obj.updates,w);p.log('seqmatch',s.fbid,'exp',s.expseq,'cur',x);delete y[x];}else break;}}else p._applyUpdates(s.updates,w);});},_applyUpdates:function(q,r){try{if(typeof q[0]=='string'){r={getRelativeTo:bagof(r)};o(i.createFrom(q),r);}else h.invoke(q,r);}catch(s){}},log:function(){if(p.logAll){var q=i.createFrom(arguments).join(":");new j('common/scribe_endpoint.php',{c:'live_sequence',m:q}).send();}}};e.exports=p;});
__e("legacy:live-js",["Live"],function(a,b,c,d){a.Live=b('Live');},3);