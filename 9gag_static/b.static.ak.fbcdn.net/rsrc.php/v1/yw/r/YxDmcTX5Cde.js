/*1328552908,169775555*/

if (window.CavalryLogger) { CavalryLogger.start_js(["yhiyK"]); }

function addHoverClass(a){Event.listen(a,'mouseover',function(){CSS.addClass(a,'hovered');});Event.listen(a,'mouseout',function(){CSS.removeClass(a,'hovered');});}
function SortableSideNav(a,b,c,d){this.list=a;this.inEdit=false;this.sortables={};this.endpoint=b;this.divider=DOM.scry(a,'li.divider')[0];this.visible=a.childNodes.length;this.sortableGroup=null;this.linked=[];this.droppable=c===undefined?true:c;this.oneCommit=d||false;if(this.divider)for(var e=0;e<this.visible;e++)if(a.childNodes[e]==this.divider){this.visible=e;break;}}SortableSideNav.prototype={inEditMode:function(){return this.inEdit;},beginEdit:function(){this.createSortableGroup();this.dragToken=Event.listen(this.list,'click',this.onClick.bind(this));this.inEdit=true;},endEdit:function(){if(this.droppable&&this.oneCommit)new AsyncRequest().setURI(this.endpoint).setData({ids:this.sortableGroup.getOrder()}).send();this.destroySortableGroup();if(this.divider&&this.visible<this.list.childNodes.length){DOM.remove(this.divider);DOM.insertAfter(this.list.childNodes[this.visible-1],this.divider);var a=$A(this.list.childNodes),b=a.indexOf(this.divider);for(var c=1,d=a.length;c<d;c++){var e=a[c];if(e===this.divider)continue;CSS.conditionClass(e,'hidden',c>b);}}this.dragToken.remove();this.inEdit=false;},isDroppable:function(){return this.droppable;},setDraggable:function(a){for(var b=0;b<this.linked.length;b++)if(!this.linked[b].isDroppable())this.linked[b].getSortableGroup().setDraggable(a);},createSortableGroup:function(){this.sortables={};for(var a=0;a<this.list.childNodes.length;a++)if(this.list.childNodes[a]!=this.divider&&DOM.scry(this.list.childNodes[a],'span.mover').length)this.sortables[this.list.childNodes[a].id.replace('navItem_','')]=this.list.childNodes[a];this.sortableGroup=new SortableGroup().setBeforeGrabCallback(this.beforeGrab.bind(this)).setGrabCallback(this.onGrab.bind(this)).setDropCallback(this.onDrop.bind(this)).setOrderChangeHandler(this.onReorder.bind(this)).setDroppable(this.droppable);for(var b in this.sortables)this.sortableGroup.addSortable(b,this.sortables[b]);},resetSortableGroup:function(){this.destroySortableGroup();this.createSortableGroup();var a=this.linked;this.linked=[];for(var b=0;b<a.length;b++)this.linkNav(a[b]);},destroySortableGroup:function(){this.sortableGroup.destroy();},getRoot:function(){return this.list;},getSortableGroup:function(){if(!this.sortableGroup)this.createSortableGroup();return this.sortableGroup;},linkNav:function(a){if(!this.linked.length)this.linked.push(this);if(this.linked.indexOf(a)===-1){for(var b=0;b<this.linked.length;b++)this.linked[b].getSortableGroup().link(a.getSortableGroup());this.linked.push(a);a.linked=this.linked;}},beforeGrab:function(){this.resetBounds();},onGrab:function(a){var b=parseInt(CSS.getStyle(a,'paddingRight'),10)+parseInt(CSS.getStyle(a,'paddingLeft'),10),c=Vector2.getElementDimensions(a).x-b;CSS.setStyle(a,'opacity',.7);CSS.setStyle(a,'width',c+"px");CSS.setStyle(a,'zIndex',1);this.draggingItem=a;for(var d=0;d<this.linked.length;d++)CSS.addClass(this.linked[d].getRoot(),'draggingMode');},onDrop:function(a,b){if(!b)b=this.draggingItem;CSS.setStyle(b,'opacity',1);CSS.setStyle(b,'width','');CSS.setStyle(b,'zIndex','');this.draggingItem=null;for(var c=0;c<this.linked.length;c++)CSS.removeClass(this.linked[c].getRoot(),'draggingMode');},onReorder:function(){if(!this.oneCommit)new AsyncRequest().setURI(this.endpoint).setData({ids:this.sortableGroup.getOrder()}).setHandler(bagofholding).send();},onClick:function(event){var a=event.getTarget();if(CSS.hasClass(a,'arrow')){this.onMove(a);}else if(DOM.isNodeOfType(a,['input','label']))this.onRemove(a,event.clientX===0);},onMove:function(a){if(CSS.hasClass(a,'up')){this.moveItem(a,'up');}else if(CSS.hasClass(a,'down'))this.moveItem(a,'down');},onRemove:function(a,b){var c=Parent.byTag(a,'li');CSS.hide(c);this.resetSortableGroup(c);if(!b)return;if(c.nextSibling){DOM.find(c.nextSibling,'a.item').focus();}else if(c.previousSibling)DOM.find(c.previousSibling,'a.item').focus();},moveItem:function(a,b){var c=Parent.byTag(a,'li'),d=b=='up'?c.previousSibling:c.nextSibling;if(d==this.divider)d=b=='up'?d.previousSibling:d.nextSibling;if(d&&values(this.sortables).indexOf(d)!=-1){b=='up'?DOM.insertBefore(c,d):DOM.insertAfter(d,c);this.onReorder();a.focus();}},resetBounds:function(){if(this.isDroppable()&&this.sortables){var a=this.sortableGroup.getOrder(),b=this.sortableGroup.hasEmptyMessage?2:1,c=$('navItem_'+a[0]),d=$('navItem_'+a[a.length-b]),e=new Rect(Vector2.getElementPosition(c).y,0,Vector2.getElementPosition(d).y+d.offsetHeight,0);this.sortableGroup.setBoundingBox(e);}}};
function OGToolSortableList(a,b,c,d){var e=$(c),f=$(d),g=function(){};g.prototype=new SortableSideNav(a,b,true,false);copy_properties(g.prototype,{resetBounds:function(){var h=new Rect(a);this.sortableGroup.setBoundingBox(h);}});this.sortableNav=new g();Event.listen(e,'click',function(){this.sortableNav.beginEdit();CSS.addClass(a,"editMode");CSS.hide(e);CSS.show(f);}.bind(this));Event.listen(f,'click',function(){this.sortableNav.endEdit();CSS.removeClass(a,"editMode");CSS.show(e);CSS.hide(f);}.bind(this));}