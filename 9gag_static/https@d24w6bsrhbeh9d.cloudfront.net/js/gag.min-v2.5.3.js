var cookieOption={path:"../default.htm"};var headerNavFixedOffset=52;var topMargin=20+headerNavFixedOffset;var GAG={};GAG.Foo=function(){};GAG.GA={track:function(b,d,a,c){try{if(c==undefined){c=1}_gaq.push(["_trackEvent",b,d,a,c])}catch(f){}}};GAG.getProtocol=function(){return("https:"==document.location.protocol)?"https":"http"};GAG.getDomain=function(){if($("siteDomain")){return $("siteDomain").get("text")}return"9gag.com"};GAG.getCookieOptions=function(){return{path:"/",duration:365*20}};GAG.Page={getCsrfToken:function(){return $("csrftoken")?$("csrftoken").get("value"):""},getBackUrl:function(){var a="/";if($("backUrl")){a=$("backUrl").get("text")}if(a==undefined){a="/"}return a},isLanding:function(){return $("page-landing")?true:false},isPostView:function(){return $("page-post")?true:false},isNsfwPostView:function(){return $("page-nsfw")?true:false},isPostSubmitView:function(){return $("page-post-item")?true:false}};GAG.Log={REPORT_URL:"/others/ql",createPayload:function(){return{user_agent:navigator.userAgent,opera:!!window.opera,vendor:navigator.vendor,platform:navigator.platform}},checkLastSubmission:function(d){var g="last_err_msg";var f="last_err_ts";var b=Cookie.read(f);var c=Cookie.read(g);var a=(new Date()).getTime();if(!b||c!=d){Cookie.write(f,a,GAG.getCookieOptions());Cookie.write(g,d,GAG.getCookieOptions());return true}return false},report:function(b){if(!this.checkLastSubmission(b)){return}var c=this.createPayload();c.err=encodeURIComponent(b);c.url=window.location.href;c.time=(new Date()).toString();var d="";if($("profile-username")){d=$("profile-username").get("text")}c.username=d;var a=new Request({method:"post",url:this.REPORT_URL,data:c,onSuccess:function(){}}).send()},getStackTrace:function(g){var l=[];var c=false;if(g.stack){var m=g.stack.split("\n");for(var d=0,f=m.length;d<f;d++){if(m[d].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){l.push(m[d])}}l.shift();c=true}else{if(window.opera&&g.message){var m=g.message.split("\n");for(var d=0,f=m.length;d<f;d++){if(m[d].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){var j=m[d];if(m[d+1]){j+=" at "+m[d+1];d++}l.push(j)}}l.shift();c=true}}if(!c){var b=arguments.callee.caller;while(b){var h=b.toString();var a=h.substring(h.indexOf("function")+8,h.indexOf(""))||"anonymous";l.push(a);b=b.caller}}return l}};GAG.Ads={adsUrls:["../static/ads/list-ads-300x250.html"],getAds:function(a){return this.adsUrls[0]},reloadIframe:function(b){var a=$(b);if(a){a.set("src",a.get("src"))}}};GAG.getResponseInstance=function(){return new GAG.Response()};GAG.Response=function(){};GAG.Response.prototype={_isSuccess:false,_message:"",init:function(){},isSuccess:function(){return this._isSuccess},succeed:function(a){this._isSuccess=true;this.setMessage(a)},failed:function(a){this._isSuccess=false;this.setMessage(a)},setMessage:function(a){if(a!=undefined){this._message=a}},getMessage:function(a){return this._message}};GAG.Utils={parseJSON:function(a){if(a.substring(0,8)=="for(;;);"){a=a.substring(8)}return JSON.decode(a)},getViewPort:function(){var b;var a;if(typeof window.innerWidth!="undefined"){b=window.innerWidth,a=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){b=document.documentElement.clientWidth,a=document.documentElement.clientHeight}else{b=document.getElementsByTagName("body")[0].clientWidth,a=document.getElementsByTagName("body")[0].clientHeight}}return{width:b,height:a}},formatPostLink:function(a){return"http://"+GAG.getDomain()+"/gag/"+a}};GAG.Validator={isValidLoginKey:function(a){return this.isValidUsername(a)||this.isValidEmail(a)},isValidUsername:function(a){return a.test("^[0-9a-zA-Z_]{3,15}$")},isValidEmail:function(a){return a.test("^([a-zA-Z0-9._-]+)@([a-zA-Z0-9.-]+)\\.([a-zA-Z]{2,4})$")},isValidPassword:function(b,c,a){var d=true;if(c!=undefined){if(b.length<c){d=false}}if(a!=undefined){if(b.length>a){d=false}}if(b.length==0){d=false}return d},isValidGender:function(a){return a=="F"||a=="M"},MONTH_DAYS:[31,29,31,30,31,30,31,31,30,31,30,31],isValidDateValues:function(c,d,f){var b=c%400==0||(c%100!=0&&c%4==0);this.MONTH_DAYS[1]=b?29:28;var e=(f>=1&&f<=31)&&(d>=1&&d<=12)&&(c>=1900);var a=f<=this.MONTH_DAYS[d-1];return e&&a},isValidPostLink:function(a){var b=new RegExp("^http(s?):../../https@/"+GAG.getDomain()+"/gag/([1-9])([0-9]*)(\\?[^ ]*)?$");return a.trim().test(b)},lookLikeURL:function(a){var b=new RegExp("^http(s?)://");return a.trim().test(b)}};GAG.isReadOnly=function(){if($("readOnlyMode")){return true}return false};GAG.enabledSignUp=function(){if(!$("enabledSignUp")||$("enabledSignUp").get("text")=="1"){return true}return false};GAG.requiredAccountSetup=function(){if($("requiredAccountSetup")){return true}return false};GAG.newSignupOn=function(){if($("nsuon")){return true}return false};var FV={tick:function(a){a.removeClass("failed").addClass("success")},cross:function(a){a.removeClass("success").addClass("failed")},reset:function(a){a.removeClass("success").removeClass("failed")},isEmpty:function(a){return a.get("value").length==0},checkLength:function(b,a){var c=b.get("value");if(c.length>=a){FV.tick(b);return true}else{FV.cross(b);return false}},checkRequired:function(a){if(a==null){return false}var b=a.get("value").trim();if(b.length>=1){FV.tick(a);return true}else{FV.cross(a);return false}},checkUrl:function(a,c){var b=a.get("value");if(c&&b.length==0){FV.reset(a);return true}if(b.toLowerCase().test("^http://")){FV.tick(a);return true}else{FV.cross(a);return false}},checkImage:function(a){var b=a.get("value");if(b.toLowerCase().test(".(jpeg|jpg|gif|png)$")){FV.tick(a);return true}else{FV.cross(a);return false}},checkUsername:function(el,allowEmpty,checkOnEdited){if(!FV.checkLength(el,3)){return false}var val=el.get("value");if(val.length>=3){var req=new Request({method:"post",url:"../member/check",data:{field:"u",value:val},onComplete:function(j,v){var data=eval("("+j+")");if(data.okay){FV.tick(el)}else{FV.cross(el)}}}).send();return true}else{FV.cross(el);return false}},checkPassword:function(b,c,a){return FV.checkLength(b,6)},checkEmailAvailability:function(el){if(!FV.checkEmailFormat(el)){return false}var val=el.get("value");if(val.length>0){var req=new Request({method:"post",url:"../member/check",data:{field:"e",value:val},onComplete:function(j,v){var data=eval("("+j+")");if(data.okay){FV.tick(el)}else{FV.cross(el)}}}).send();return true}else{FV.cross(el);return false}},checkEmailFormat:function(b,d,a){var c=b.get("value");if(c.test("^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,4}$")){FV.tick(b);return true}else{FV.cross(b);return false}}};var ScrollSpy=new Class({Implements:[Options,Events],options:{min:0,mode:"vertical",max:0,referenceElement:null,offsetY:0,container:window,onEnter:$empty,onLeave:$empty,onTick:$empty},initialize:function(a){this.setOptions(a);this.container=$(this.options.container);this.enters=this.leaves=0;this.max=this.options.max;this.referenceElement=this.options.referenceElement;if(this.max==0){var b=this.container.getScrollSize();this.max=this.options.mode=="vertical"?b.y:b.x}this.addListener()},addListener:function(){this.inside=false;this.container.addEvent("scroll",function(){var a=this.container.getScroll();var e=this.options.mode=="vertical"?a.y:a.x;var c=this.container.getScrollSize();var d=$(this.referenceElement);var f=d.getCoordinates();var b=GAG.Utils.getViewPort();e+=b.height;this.options.min=(f.top>c.y?c.y:f.top)+this.options.offsetY;this.options.max=f.bottom+this.options.offsetY;if(e>=this.options.min){if(!this.inside){this.inside=true;this.enters++;this.fireEvent("enter",[a,this.enters])}this.fireEvent("tick",[a,this.inside,this.enters,this.leaves])}else{if(this.inside){this.inside=false;this.leaves++;this.fireEvent("leave",[a,this.leaves])}}}.bind(this))}});var LazyLoad=new Class({Implements:[Options,Events],options:{range:200,elements:"img",container:window,mode:"vertical",realSrcAttribute:"data-src",useFade:true},initialize:function(a){this.setOptions(a);this.container=document.id(this.options.container);this.elements=$$(this.options.elements);this.largestPosition=0;var b=(this.options.mode=="vertical"?"y":"x");var d=(this.container!=window&&this.container!=document.body?this.container:"");this.elements=this.elements.filter(function(f){if(this.options.useFade){f.setStyle("visibility","hidden")}var e=f.getPosition(d)[b];if(e<this.container.getSize()[b]+this.options.range){this.loadImage(f);return false}return true},this);var c=function(f){var g=this.container.getScroll()[b];if(g>this.largestPosition){this.elements=this.elements.filter(function(e){if((g+this.options.range+this.container.getSize()[b])>=e.getPosition(d)[b]){this.loadImage(e);return false}return true},this);this.largestPosition=g}this.fireEvent("scroll");if(!this.elements.length){this.container.removeEvent("scroll",c);this.fireEvent("complete")}}.bind(this);this.container.addEvent("scroll",c)},loadImage:function(j){j.setStyle("visibility","visible");var f=j.get("itemType");if(f=="list"){var e=j.getElement("img");if(e){e.set("src",e.get(this.options.realSrcAttribute))}var a=j.get("data-url");var i=encodeURIComponent(j.get("data-url"));var h=encodeURIComponent(j.get("data-text"));var c=j.get("gagId");var g='<fb:like href="'+i+'@ref=fb" layout="button_count" send="false" show_faces="false" label="List"></fb:like>';var b='<iframe allowtransparency="true" frameborder="0" scrolling="no" src="../../platform.twitter.com/widgets/tweet_button.html@url='+i+"&amp;text="+h+'&amp;via=9GAG" style="width:55px; height:20px; " allowTransparency="true" frameborder="0" class="twitter-share-button twitter-count-none"></iframe>';var d='<g:plusone size="medium" count="true" href="'+a+'"></g:plusone>';$("list-share-facebook-"+c).set("html",g);FB.XFBML.parse(document.getElementById("list-share-facebook-"+c));if($("list-share-twitter-"+c)){$("list-share-twitter-"+c).set("html",b)}$("list-share-gplus-"+c).set("html",d);gapi.plusone.go("list-share-gplus-"+c)}else{if(f=="related"){var e=j.getElement("img");if(e){e.set("src",e.get(this.options.realSrcAttribute))}}}}});GAG.Ajax={};GAG.Effect={};function requiredLogin(){var a=window.location;if(!$("profile-menu")){if(GAG.newSignupOn()){GAG.Login.loginAndRedirect(GAG.Page.getBackUrl())}else{GAG.Login.connectFacebook(a)}return false}if(GAG.requiredAccountSetup()){GAG.Login.setupAccount(GAG.Page.getBackUrl());return false}return true}GAG.Ajax.LoadPage={_isUnlimitedScrollOn:false,_isLoading:false,_currPage:1,_loadCount:0,_loadCoutMax:10,_onOffCookieKey:"unlimitedScroll",_onOffFlagId:"unlimitedScroll",_loadButtonId:"more_button",_listId:"entry-list-ul",init:function(){this._isUnlimitedScrollOn=$(this._onOffFlagId)?true:false;var a=Cookie.read(this._onOffCookieKey);this._isUnlimitedScrollOn=this._isUnlimitedScrollOn||(a=="1");if($(this._loadButtonId)){this._currPage=parseInt($(this._loadButtonId).get("currPage"),10)}this.bindElements()},enable:function(a){Cookie.write(this._onOffCookieKey,a?"1":"0",GAG.getCookieOptions())},isUnlimitedScrollOn:function(){return this._isUnlimitedScrollOn},getMorePostId:function(){return $(this._loadButtonId).get("data-more")},getLoadCountMax:function(){if(this._loadCoutMax==null){}return this._loadCoutMax},loadPage:function(b,e){if(this._loadCount>=this.getLoadCountMax()){return}if(GAG.Ajax.LoadPage._isLoading){return}var h=this.getMorePostId();if(!h){return}var g=$(this._loadButtonId).get("list");GAG.GA.track("InfiniteScrolling","Loaded-"+g,"Load-"+(this._loadCount+1),1);GAG.Ads.reloadIframe("sidebar-ads2");var f=$(this._loadButtonId).get("plink");var a="list";GAG.Ajax.LoadPage._isLoading=true;GAG.Ajax.LoadPage.showLoading(true);var c="../new/json@list="+g+"&id="+h;var d=new Request.JSON({url:c,onSuccess:function(q){GAG.Ajax.LoadPage._currPage++;$(GAG.Ajax.LoadPage._loadButtonId).set("data-more",q.prevId);GAG.Ajax.LoadPage.updateButtons(1,q.prevId);var p="items-wrap-"+h;if(a=="list"){var n="";if(q.items){for(var m in q.items){if(!$(m)){n+=q.items[m]}}}var o=new Element("div",{id:p,html:n,style:"display:none"});$(GAG.Ajax.LoadPage._listId).adopt(o);GAG.Social.Facebook.parseElement(p);GAG.Ajax.Vote.bindVoteUpElements("#"+p+" .badge-vote-up","click",GAG.Ajax.Vote.voteUpEntrySuccessCb,GAG.Ajax.Vote.voteUpEntryFailureCb,GAG.Ajax.Vote.unvoteEntrySuccessCb,GAG.Ajax.Vote.unvoteEntryFailureCb);GAG.Ajax.Vote.bindVoteDownElements("#"+p+" .badge-vote-down","click",GAG.Ajax.Vote.voteDownEntrySuccessCb,GAG.Ajax.Vote.voteDownEntryFailureCb,GAG.Ajax.Vote.unvoteEntrySuccessCb,GAG.Ajax.Vote.unvoteEntryFailureCb);GAG.Ajax.Report.bindReportLink("#"+p+" .report-item","click");FB.Share._onFirst();var j=o.getElements("li.entry-item");if(j){for(var l=0;l<j.length;l++){$(GAG.Ajax.LoadPage._listId).adopt(j[l])}}o.dispose()}GAG.Ajax.LoadPage._isLoading=false},onFailure:function(i){GAG.Ajax.LoadPage._isLoading=false;GAG.Ajax.LoadPage.showLoading(false)}}).post()},updateButtons:function(d,c){this._loadCount+=d;var a=$("next_button");var b=$("more_button");if(c==0){a.set("href","../"+a.get("list"))}else{a.set("href","../"+a.get("list")+"../id/"+c)}a.set("data-more",c);if(c==0){b.setStyle("display","none");$("more_img").setStyle("display","none");a.set("text","Start Over").setStyle("display","")}else{if(this._loadCount>=this.getLoadCountMax()){b.setStyle("display","none");$("more_img").setStyle("display","none");a.setStyle("display","")}else{this.showLoading(false)}}},showLoading:function(a){if(a){$("more_button").setStyle("display","none");$("more_img").setStyle("display","")}else{$("more_img").setStyle("display","none");$("more_button").setStyle("display","")}},bindFooterEvent:function(){if(!$("more_button")){return}var b=this.getLoadCountMax();if(this._loadCount>=b){return}var a=new ScrollSpy({referenceElement:"footer",offsetY:-800,onEnter:function(c){GAG.Ajax.LoadPage.loadPage()},onLeave:function(c){}})},bindLoadButton:function(){if(!$("more_button")){return}$("more_button").addEvent("click",function(a){if(a){a.preventDefault()}GAG.Ajax.LoadPage.loadPage()})},bindOnOffToggler:function(){$$(".badge-unlimited-scroll-toggler").addEvent("click",function(a){a.preventDefault();GAG.Ajax.LoadPage.enable(!GAG.Ajax.LoadPage._isUnlimitedScrollOn);window.location.reload()})},bindScrollBackButtons:function(){$$(".badge-back-to-top").addEvent("click",function(a){a.preventDefault();new Fx.Scroll(window,{duration:500}).toTop()})},bindElements:function(){this.bindOnOffToggler();this.bindScrollBackButtons();if(this.isUnlimitedScrollOn()){this.bindLoadButton();this.bindFooterEvent()}}};GAG.Effect.CountDown={pad:function(b,a){if(a==undefined){a="0"}return b<10?a+""+b:b},convertTime:function(g){var f=0;var c=0;var a=0;var b=0;if(g<0){g=0}f=parseInt(g/86400);g-=f*86400;c=parseInt(g/3600);g-=c*3600;a=parseInt(g/60);g-=a*60;b=g;var e="";if(f>0){e+=this.pad(f)+":"}e+=this.pad(c)+":";e+=this.pad(a)+":";e+=this.pad(b);return e},updateDisplay:function(c){var d=c.get("timestamp");var b=Math.round((new Date()).getTime()/1000);var e=c.get("start");if(e==null){e=b;c.set("start",e)}var a=b-e;c.set("text",this.convertTime(d-a))},updateAll:function(){$$(".badge-countdown").each(function(b,a){GAG.Effect.CountDown.updateDisplay($(b))})},bindElements:function(){var a=$$(".badge-countdown");if(a.length>0){GAG.Effect.CountDown.updateAll();setInterval("GAG.Effect.CountDown.updateAll();",1000)}}};GAG.Effect.Scroll={_checker:null,_checkInterval:2000,_lastScrollY:0,_stickyItems:null,monitor:function(){if(this._checker==null){this._checker=setInterval("GAG.Effect.Scroll.positionCheck();",this._checkInterval)}},positionCheck:function(){var a=$(window).getScrollSize();if(this._lastScrollY!=a.y){this._lastScrollY=a.y;this.initElementsData(true);this.checkStickyMenu()}},getStickyItems:function(a){var c=(new Date()).getTime();if(!this._stickyItems||a){this._stickyItems=$$("div.sticky-items")}var b=(new Date()).getTime();return this._stickyItems},_itemsData:{},getItemData:function(a){},initElementsData:function(a){if(!this.isStickyMenuSupported){return}this.monitor();if(!window.isBindScroll||a){var g=this.getStickyItems(true);for(var f=g.length-1;f>=0;f--){var n=g[f];$(n).setStyle("position","");var h=$(n).getPosition();var j=$(n).getCoordinates();var e=80;var m=40;var c=$(n).getParent().getPrevious().getCoordinates().height;var b=f<g.length-1?(g[f+1]).getPosition():{x:0,y:h.y+c+e-m};var l=$(n).get("id");var d={};d["data-x"]=h.x;d["data-y"]=h.y;d["data-width"]=j.width;d["data-height"]=j.height;d["data-y1"]=h.y;d["data-y2"]=b.y-j.height-e;d["data-y3"]=b.y-e;this._itemsData[l]=d}window.isBindScroll=true}},checkStickyMenu:function(){if(this.isStickyMenuSupported&&window.onloaded){GAG.Effect.Scroll.initElementsData();var a=$(window).getScroll();var b=this.getStickyItems();var d=(new Date()).getTime();this.getStickyItems().each(function(s,g){var r=$(s).get("id");var f=GAG.Effect.Scroll._itemsData[r];if(f){var o=parseInt(f["data-x"],10);var m=parseInt(f["data-y"],10);var p=parseInt(f["data-y1"],10);var n=parseInt(f["data-y2"],10);var j=parseInt(f["data-y3"],10)}else{var o=parseInt($(s).get("data-x"),10);var m=parseInt($(s).get("data-y"),10);var p=parseInt($(s).get("data-y1"),10);var n=parseInt($(s).get("data-y2"),10);var j=parseInt($(s).get("data-y3"),10)}var h=72;var q=a.y+h;var l=$(s).getStyle("position");var i;if(q>p&&q<=n){i={top:h,left:o-a.x};if(i!="fixed"){i.position="fixed"}$(s).setStyles(i)}else{if(q>n&&q<=j){var e=q-n;i={top:h-e,left:o-a.x};if(i!="fixed"){i.position="fixed"}$(s).setStyles(i)}else{if(l!="static"&&l!=""){$(s).setStyles({position:"",top:m,left:o})}}}});var c=(new Date()).getTime()}},_isFormMessageShown:null,isFormMessageShown:function(){if(this._isFormMessageShown==null){this._isFormMessageShown=$$("p.form-message:not(.hide)").length>0}return this._isFormMessageShown},isStickyMenuSupported:(Browser.Platform.mac||Browser.Platform.win||Browser.Platform.linux||Browser.Platform.webos)&&(Browser.chrome||Browser.firefox||Browser.safari||Browser.ie),elements:{searchbarHeight:68,postControlBarTop:120,headerbarSignupTop:70,formMessageOffset:64},checkPostSharBar:function(){var c=this.isSearchBarOpened();var b=this.getPostShareBarTop();if($("page-post")){var a=$("post-control-bar");if(window.XMLHttpRequest&&a){if(document.documentElement.scrollTop>b||self.pageYOffset>b){a.style.position="fixed";a.style.top=(52+(c?this.elements.searchbarHeight:0))+"px"}else{if(document.documentElement.scrollTop<b||self.pageYOffset<b){a.style.position="absolute";a.style.top=""}}}}},checkNavSignupButton:function(){var b=this.getHeaderBarSignupTop();var a=$("headbar-signup-button");if(window.XMLHttpRequest&&a){if(document.documentElement.scrollTop>b||self.pageYOffset>b){a.style.display="block"}else{if(document.documentElement.scrollTop<b||self.pageYOffset<b){a.style.display="none"}}}},checkSidebarAd:function(){if(window.XMLHttpRequest){var b=$("top-gag-stay");var d=$("profile-menu")?true:false;var e=1061-545;var c=60;var a=72;if(!d&&!GAG.isReadOnly()){e+=c}if(this.isFormMessageShown()){e+=this.elements.formMessageOffset}if(b){if(document.documentElement.scrollTop>e||self.pageYOffset>e){if(b.style.position!="fixed"){b.style.position="fixed";b.style.top=a+"px"}}else{if(document.documentElement.scrollTop<e||self.pageYOffset<e){b.style.position="";b.style.top=""}}}}},isSearchBarOpened:function(){return false;var a=GAG.Effect.searchBar.slider&&GAG.Effect.searchBar.slider.open;a=false},getPostShareBarTop:function(){var a=this.elements.postControlBarTop;if(this.isSearchBarOpened()){a+=this.elements.searchbarHeight}if(this.isFormMessageShown()){a+=this.elements.formMessageOffset}return a},getHeaderBarSignupTop:function(){var a=this.elements.headerbarSignupTop;if(this.isFormMessageShown()){a+=this.elements.formMessageOffset}return a},_footerBackToTopButton:false,getFooterBackToTopButton:function(){if(this._footerBackToTopButton===false){this._footerBackToTopButton=$("footer-back-to-top")}return this._footerBackToTopButton},checkBackToTopButton:function(){var c=this.getFooterBackToTopButton();if(!c){return}var b=$(window).getScroll();var a=800;if(b.y>a){c.removeClass("offscreen")}else{c.addClass("offscreen")}},onPageScroll:function(){this.checkPostSharBar();this.checkNavSignupButton();this.checkSidebarAd();this.checkStickyMenu();this.checkBackToTopButton()},bindStickyElements:function(){window.onscroll=function(){GAG.Effect.Scroll.onPageScroll()}},bindElements:function(){this.bindStickyElements()}};GAG.Effect.searchBar={slider:null,bindElements:function(){if($("search_wrapper")){GAG.Effect.searchBar.slider=new Fx.Slide("search_wrapper",{duration:250}).hide();$$("#search_wrapper_, .search-toggler").addEvent("click",function(){$("header_searchbar").setStyle("display","");if(GAG.Effect.searchBar.slider.open){$("sitebar_search_header").blur()}else{$("sitebar_search_header").set("value","").focus()}GAG.Effect.searchBar.slider.toggle()})}}};GAG.Effect.AutoComplete={bindElements:function(){$$(".tag_input").each(function(a){new Autocompleter.Ajax.Json(a.get("id"),"../tags/suggest",{postVar:"tag",delay:1,multiple:true,separatorSplit:"../[,;]+/default.htm"})});$$(".search_input").each(function(a){new Autocompleter.Ajax.Json(a.get("id"),"../tags/suggest",{postVar:"tag",delay:1,separatorSplit:"../[,;]+/default.htm"})})}};GAG.Ajax.Report={bindReportLink:function(a,b){$$(a).addEvent(b,function(c){$("overlay-shadow").removeClass("hide");$("overlay-container").removeClass("hide");$("modal-report").removeClass("hide");$$("#modal-report input[type=text]").set("value","").removeClass("failed");$$("#modal-report input[type=radio]").set("checked",false);$("report_entry_id").set("value",$(this).get("entryId"));window.reportOn=true})},bindReportElements:function(){$$("#modal-report input[type=radio]").addEvent("click",function(e){var btn=$(this);if(btn.get("value")==4){$("repost_link").focus();return}$("repost_link").set("value","")});$$("#repost_link").addEvent("focus",function(e){$("repost").set("checked",true)});$$("#modal-report a.close-btn").addEvent("click",function(e){e.preventDefault();$$("#modal-report a.cancel").fireEvent("click")});$$("#modal-report a.cancel").addEvent("click",function(e){if(e){e.preventDefault()}window.reportOn=false;$("modal-report").addClass("hide");$("overlay-container").fireEvent("click");$$("#modal-report a.loading").getParent().addClass("hide");$$("#modal-report a.cancel").getParent().removeClass("hide");$$("#modal-report a.submit-button").getParent().removeClass("hide")});$$("#modal-report a.submit-button").addEvent("click",function(e){e.preventDefault();var entryId=$("report_entry_id").get("value");var check=$$("#modal-report input[name=report-reason]:checked");var type=0;if(check&&check.length>0){type=check[0].value}else{return}var params={};params.entryId=entryId;params.type=type;if(type==4){var link=$("repost_link").get("value").toLowerCase();var currLink="http://"+GAG.getDomain()+"../gag/"+entryId;if(!link.test("^http://")||(link.test("^"+currLink)&&!link.test("^"+currLink+"[0-9]"))){$("repost_link").addClass("failed");return}else{$("repost_link").removeClass("failed")}params.link=link}$$("#modal-report a.cancel").getParent().addClass("hide");$$("#modal-report a.submit-button").getParent().addClass("hide");$$("#modal-report a.loading").getParent().removeClass("hide");var req=new Request({method:"post",url:"../report-post",data:params,onComplete:function(j,v){var data=eval("("+j+")");if(data&&data.okay){$$("#modal-report a.cancel").fireEvent("click");return}if(data.invalidLink){$("repost_link").addClass("failed")}$$("#modal-report a.loading").getParent().addClass("hide");$$("#modal-report a.cancel").getParent().removeClass("hide");$$("#modal-report a.submit-button").getParent().removeClass("hide")}}).send()})},bindElements:function(){this.bindReportLink("a.report-item","click");this.bindReportElements()}};GAG.Overlay={bindElements:function(){if($("overlay-shadow")){$("overlay-shadow").addEvent("click",function(a){$("overlay-container").fireEvent("click")});$("overlay-container").addEvent("click",function(a){if(window.reportOn||window.postShareOn||GAG.Overlay.Language.isShown()){return}if(a){a.preventDefault()}$("overlay-shadow").addClass("hide");$$("div.keyboard-instruction").addClass("hide")})}}};GAG.Overlay.Language={_isShown:false,isShown:function(){return this._isShown},showMenu:function(a){if(a){this.resetMenu();$("overlay-shadow").removeClass("hide");$("overlay-container").removeClass("hide");$("modal-language").removeClass("hide")}else{$("overlay-shadow").addClass("hide");$("overlay-container").addClass("hide");$("modal-language").addClass("hide")}this._isShown=a},resetMenu:function(){$$("#form-modal-language input.current").set("checked","true")},updateLanguage:function(c,a){if($("backUrl")){a=$("backUrl").get("text")}if(a==undefined){a="../default.htm"}var b="http://"+GAG.getDomain()+"/pref/setlanguage/lang/"+c+"?url="+a;window.location.href=b},bindElements:function(){$$(".badge-language-selector").addEvent("click",function(a){a.preventDefault();GAG.Overlay.Language.showMenu(true)});$$(".badge-language-close").addEvent("click",function(a){a.preventDefault();GAG.Overlay.Language.showMenu(false)});if($("language-submit-button")){$("language-submit-button").addEvent("click",function(b){b.preventDefault();var a=$$("#form-modal-language input[name=lang-code]:checked");if(a.length>0){GAG.Overlay.Language.updateLanguage(a[0].value)}})}}};GAG.Overlay.postShare={timer:null,startTs:0,timeout:5000,showPostShareBox:function(a){if(a){if(a.timeout){this.timeout=a.timeout}}$("overlay-shadow").removeClass("hide");$("overlay-container").removeClass("hide");$("modal-share").removeClass("hide")},hidePostShareBox:function(){$("overlay-shadow").addClass("hide");$("overlay-container").addClass("hide");$("modal-share").addClass("hide")},updatePostShareBox:function(){var b=this.timeout-((new Date()).getTime()-this.startTs);var a=Math.round(b/1000);if(a<0){this.clearTimer();this.hidePostShareBox()}else{$("post-share-dismiss-counter").set("text","("+a+")")}},bindElements:function(){$("modal-share").addEvent("click",function(a){GAG.Overlay.postShare.clearTimer()});$$("div#modal-share a.close-btn").addEvent("click",function(a){window.postShareOn=false;$("modal-share").addClass("hide");$("overlay-container").addClass("hide");$("overlay-shadow").addClass("hide")});$$("#post-share-entry-url").addEvent("click",function(b){b.preventDefault();var a=$("post-share-entry-url").get("value");if(a.length>0){_gaq.push(["_trackEvent","Post-Share-Url","Clicked",a,1]);$("post-share-entry-url").selectRange(0,a.length)}GAG.Overlay.postShare.clearTimer()});this.setTimer()},setTimer:function(){this.startTs=(new Date()).getTime();this.timer=setInterval("GAG.Overlay.postShare.updatePostShareBox();",1000);this.updatePostShareBox()},clearTimer:function(){if(this.timer){clearInterval(this.timer);this.timer=null}$("post-share-dismiss-counter").set("text","")}};GAG.Social={};GAG.Social.Facebook={appId:null,_isLoggedIn:false,_isReady:false,_parseQueue:[],INIT_FAILURE_MESSAGE:"Facebook Connect is not enabled, please check if there's any browser plugin blocking the function.",init:function(){var a=$("fb-app-id");if(!a){return}this.appId=a.get("text");this.bindEvents()},onReady:function(){while(this._parseQueue.length>0){var a=this._parseQueue.shift();FB.XFBML.parse(document.getElementById(a))}},parseElement:function(a){try{FB.XFBML.parse(document.getElementById(a))}catch(b){this._parseQueue.push(a)}},bindFailureCb:function(){$$(".facebook-init-failed").set("text",this.INIT_FAILURE_MESSAGE).setStyle("display","")},bindEvents:function(){try{var c=GAG.getProtocol();var a=c+"://"+GAG.getDomain()+"/static/"+c+"_channel.html";FB.init({appId:this.appId,status:true,cookie:true,xfbml:true,channelUrl:a,oauth:true});if(Browser.ie8){FB.UIServer.setActiveNode=function(e,d){FB.UIServer._active[e.id]=d}}FB.Event.subscribe("edge.create",function(e,h,d){var f=h.dom;var g=$(f).get("label");if(g.length==0){g="Default"}_gaq.push(["_trackEvent","Facebook-Like-Button",g+"Liked",e,1])});FB.Event.subscribe("edge.remove",function(d,g){var e=g.dom;var f=$(e).get("label");if(f.length==0){f="Default"}_gaq.push(["_trackEvent","Facebook-Like-Button",f+"RemovedLike",d,1])});FB.Event.subscribe("comment.create",function(f,e){var d=f.href;_gaq.push(["_trackEvent","Facebook-Comment","PostCommentAdded",d,1])});FB.Event.subscribe("comment.remove",function(f,e){var d=f.href;_gaq.push(["_trackEvent","Facebook-Comment","PostCommentRemoved",d,1])})}catch(b){this.bindFailureCb();return}},bindElements:function(){$$(".badge-fb-perm-publish-action").addEvent("click",function(a){FB.login(function(b){if(b.authResponse){}else{}},{scope:"publish_actions"})})},isLoggedIn:function(){return this._isLoggedIn},isPermsGranted:function(){return},getTimelineApiUri:function(){return $("fbTimelineApi").get("text")},laughAtPost:function(b){if(!this.isLoggedIn()){return}try{var a=GAG.Utils.formatPostLink(b);var d="/me/"+this.getTimelineApiUri()+"="+a;FB.api(d,"post",function(e){if(!e||e.error){}else{}})}catch(c){}}};GAG.Login={FB_PERMS:"email",FB_CONNECT_CALLBACK_URL:"/connect/facebook-callback",_isRequesting:false,additionalParams:{},addParam:function(a,b){this.additionalParams[a]=b},getConnectParamsString:function(){var b="";var a=0;for(k in this.additionalParams){b+=(a==0?"":"&")+k+"="+encodeURIComponent(this.additionalParams[k]);a++}return b},getConnectUrl:function(b){var a=GAG.Login.FB_CONNECT_CALLBACK_URL;a+="?"+this.getConnectParamsString();return a},connectFacebook:function(f,c,h){try{if(f==undefined||f==null){f="/"}var d=true;if(Browser.chrome){d=false}if(d){this.addParam("next",f);FB.login(function(i){if(i.authResponse){var e=response.authResponse.accessToken;window.location=GAG.Login.getConnectUrl(e)}},{scope:this.FB_PERMS})}else{var a="https:../../https@/"+GAG.getDomain()+"/connect/facebook";var b="next="+encodeURIComponent(f+"?"+this.getConnectParamsString());a+="?"+b;window.location=a}}catch(g){if(Browser.ie7||Browser.ie8){}else{alert(GAG.Social.Facebook.INIT_FAILURE_MESSAGE)}return}},setupAccount:function(b){var a="../../https@/"+GAG.getDomain()+"/member/setup?next="+encodeURIComponent(b);window.location=a},loginAndRedirect:function(b){var a="https://"+GAG.getDomain()+"/login?ref="+b;window.location=a},setRequestInvitationLoading:function(a){if(a){$("request-invite-block").setStyle("display","none");$("request-invite-loading").setStyle("display","")}else{$("request-invite-loading").setStyle("display","none");$("request-invite-block").setStyle("display","")}},requestInvitation:function(){if(this._isRequesting){return}var b=$("signup-request-email").get("value");var d=GAG.Page.getCsrfToken();var a="/member/request-invitation";var e={email:b,csrftoken:d};$("signup-msg").setStyle("display","none").set("text","");if(!GAG.Validator.isValidEmail(b)){$("signup-msg").setStyle("display","").set("text",GAG.Login.MSGS.WRONG_EMAIL);return}this._isRequesting=true;this.setRequestInvitationLoading(true);var c=new Request.JSON({url:a,data:e,onSuccess:function(h,g){GAG.Login._isRequesting=false;GAG.Login.setRequestInvitationLoading(false);var f=false;if(h.okay){f=true}switch(h.code){case"ALREADY_IN_LIST":f=true;break;case"ALREADY_MEMBER":msg="Sorry. You don't need an invite.";break;case"NOT_IN_LIST":case"INVALID_EMAIL":case"BLACKLIST_EMAIL":msg=GAG.Login.MSGS.WRONG_EMAIL;break;default:msg="Sorry. Please try again later.";break}if(f){$("signup-desc").setStyle("display","none");$(GAG.Login.ids.inviteBlock).setStyle("display","none");$("signup-desc-done").setStyle("display","")}else{$("signup-msg").setStyle("display","").set("text",msg)}},onFailure:function(g,f){GAG.Login._isRequesting=false;GAG.Login.setRequestInvitationLoading(false)}}).post()},ids:{username:"login-username",password:"login-password",email:"login-email",loginForm:"form-signup-login",loginBtn:"login-submit",loginToRecoverBtn:"login-to-recover",recoverToLoginBtn:"recover-to-login",loginUsernameBlock:"login-username-block",loginEmailBlock:"login-email-block",loginPasswordBlock:"login-password-block",loginSubmitType:"login-submit-type",loginMsg:"login-msg",setupMsg:"setup-msg",setupUsername:"setup-username",setupPassword:"setup-password",inviteBlock:"request-invite-block",noFacebookBtn:"no-facebook-account",inviteEmail:"signup-request-email",inviteRequestBtn:"get-email-invitation"},MSGS:{INVALID_LOGIN_COMBINATION:"Wrong Username/Email and password combination.",WRONG_EMAIL:"Sorry, something is wrong with your email."},showLoginMessage:function(a){if(a.length>0){$(this.ids.loginMsg).set("text",a).setStyle("display","")}else{$(this.ids.loginMsg).set("text","").setStyle("display","none")}},validateInviteSignup:function(){var c=$("invite-signup-username").get("value");var h=$("invite-signup-password").get("value");var g=$("invite-signup-gender").get("value");var b=$("invite-signup-dob-day").get("value");var e=$("invite-signup-dob-month").get("value");var f=$("invite-signup-dob-year").get("value");var a="Something wrong with your information: ";var d=new Array();var i=true;if(!GAG.Validator.isValidUsername(c)){d.push("Username");i=false}if(!GAG.Validator.isValidPassword(h,6,30)){d.push("Password");i=false}if(!GAG.Validator.isValidGender(g)){d.push("Gender");i=false}if(!GAG.Validator.isValidDateValues(f,e,b)){d.push("Date of Birth");i=false}if(!i){a+=d.join(", ");$("invite-signup-msg").set("text",a).setStyle("display","")}return i},validateReset:function(){var b=$("reset-password").get("value");var a=GAG.Validator.isValidPassword(b,6,30);if(a){$("reset-msg").set("text","").setStyle("display","none")}else{$("reset-msg").set("text","Invalid password.").setStyle("display","")}return a},validateRecover:function(){var b=$("recover-email").get("value");var a=GAG.Validator.isValidEmail(b);if(a){$("recover-msg").set("text","").setStyle("display","none")}else{$("recover-msg").set("text","Invalid email.").setStyle("display","")}return a},bindResetForm:function(){if(!$("reset-submit")){return}$("reset-submit").addEvent("click",function(a){a.preventDefault();if(GAG.Login.validateReset()){$("form-signup-login").submit()}})},bindRecoverForm:function(){if(!$("recover-submit")){return}$("recover-submit").addEvent("click",function(a){a.preventDefault();if(GAG.Login.validateRecover()){$("form-signup-login").submit()}})},showSetupMessage:function(a){if(a.length>0){$(this.ids.setupMsg).set("text",a).setStyle("display","")}else{$(this.ids.setupMsg).set("text","").setStyle("display","none")}},validateLoginSetup:function(){this.showSetupMessage("");var d=$(this.ids.setupUsername).get("value");var c=$(this.ids.setupPassword).get("value");var b=GAG.Validator.isValidLoginKey(d);var a=GAG.Validator.isValidPassword(c,6,30);if(!b||!a){if(b){this.showSetupMessage("Invalid password.")}else{if(a){this.showSetupMessage("Invalid username.")}else{this.showSetupMessage("Invalid email and password.")}}return false}return true},validateLogin:function(){this.showLoginMessage("");var e=$(this.ids.username).get("value");var c=$(this.ids.email)?$(this.ids.email).get("value"):false;var b=$(this.ids.password).get("value");var d=$(this.ids.loginSubmitType).get("value");var a=true;if(d=="login"){a=GAG.Validator.isValidLoginKey(e);a=a&&GAG.Validator.isValidPassword(b);if(!a){this.showLoginMessage(this.MSGS.INVALID_LOGIN_COMBINATION);return false}}else{a=GAG.Validator.isValidEmail(c);if(!a){this.showLoginMessage(this.MSGS.WRONG_EMAIL);return false}}return true},bindSigninForm:function(){if(!$(this.ids.loginBtn)){return}var a="#"+this.ids.username+",#"+this.ids.password;$$(a).addEvent("keydown",function(b){if(b.key=="enter"){b.preventDefault();b.stopPropagation();if(GAG.Login.validateLogin()){$(GAG.Login.ids.loginForm).submit()}}});$(this.ids.username).focus();if($(this.ids.loginToRecoverBtn)){$(this.ids.loginToRecoverBtn).addEvent("click",function(b){b.preventDefault();$(GAG.Login.ids.loginUsernameBlock).setStyle("display","none");$(GAG.Login.ids.loginPasswordBlock).setStyle("display","none");$(GAG.Login.ids.loginEmailBlock).setStyle("display","");$(GAG.Login.ids.loginForm).set("action","../recover");$(GAG.Login.ids.loginBtn).set("value","Reset");$(GAG.Login.ids.loginSubmitType).set("value","reset");$(GAG.Login.ids.username).set("value","");$(GAG.Login.ids.email).set("value","");$(GAG.Login.ids.password).set("value","");$(GAG.Login.ids.loginMsg).set("text","")})}if($(this.ids.recoverToLoginBtn)){$(this.ids.recoverToLoginBtn).addEvent("click",function(b){b.preventDefault();$(GAG.Login.ids.loginEmailBlock).setStyle("display","none");$(GAG.Login.ids.loginUsernameBlock).setStyle("display","");$(GAG.Login.ids.loginPasswordBlock).setStyle("display","");$(GAG.Login.ids.loginForm).set("action","../login");$(GAG.Login.ids.loginBtn).set("value","Login");$(GAG.Login.ids.loginSubmitType).set("value","login");$(GAG.Login.ids.username).set("value","");$(GAG.Login.ids.email).set("value","");$(GAG.Login.ids.password).set("value","");$(GAG.Login.ids.loginMsg).set("text","")})}},bindSignupForm:function(){if(!$(this.ids.noFacebookBtn)){return}$(this.ids.noFacebookBtn).addEvent("click",function(a){a.preventDefault();$(this).getParent().setStyle("display","none");$(GAG.Login.ids.inviteBlock).setStyle("display","");$(GAG.Login.ids.inviteEmail).focus()});$("form-signup-login").addEvent("submit",function(a){a.preventDefault()});$(this.ids.inviteEmail).addEvent("keydown",function(a){if(a.key=="enter"){a.preventDefault();a.stopPropagation();GAG.Login.requestInvitation()}});$(this.ids.inviteRequestBtn).addEvent("click",function(a){a.preventDefault();GAG.Login.requestInvitation()})},bindDateElements:function(d){var c=$(d+"-dob-day");var b=$(d+"-dob-month");var a=$(d+"-dob-year");if(c&&b&&a){b.addEvent("change",function(h){var g=c.get("value");var f=b.get("value");if(f>=1){if(g>GAG.Validator.MONTH_DAYS[f-1]){c.set("value",-1)}}});c.addEvent("change",function(h){var g=c.get("value");var f=b.get("value");if(f>=1){if(g>GAG.Validator.MONTH_DAYS[f-1]){b.set("value",-1)}}})}},bindInviteSignupForm:function(){var a="invite-signup";this.bindDateElements(a)},bindSetupForm:function(){if($("setup-submit")){$("setup-username").focus()}},bindBadgeFbConnect:function(){$$(".badge-facebook-connect").addEvent("click",function(c){c.preventDefault();var a=$(this).get("label");if(a==null){a="Others"}GAG.GA.track("Facebook-Signup","Clicked",a);var b=$(this).get("next");var d=$(this).hasClass("nsfw-post");if(d){GAG.Login.addParam("nsfw",1)}GAG.Login.connectFacebook(b)})},bindElements:function(){this.bindBadgeFbConnect();this.bindSignupForm();this.bindSigninForm();this.bindInviteSignupForm();this.bindRecoverForm();this.bindSetupForm();this.bindResetForm()}};GAG.Ajax.Vote={URL_VOTE_UP:"../vote/like/id/default.htm",URL_VOTE_DOWN:"../vote/dislike/id/default.htm",URL_UNVOTE:"../vote/unlike/id/default.htm",doVote:function(e,d,f,g){var b=requiredLogin();if(!b){return}var a="";switch(e){case"down":a=this.URL_VOTE_DOWN;break;case"unvote":a=this.URL_UNVOTE;break;case"up":default:a=this.URL_VOTE_UP}a+=d;f({id:d});var c=new Request.JSON({url:a,onSuccess:f,onFailure:g}).get()},voteUp:function(a,b,c){this.doVote("up",a,b,c)},voteDown:function(a,b,c){this.doVote("down",a,b,c)},unvote:function(a,b,c){this.doVote("unvote",a,b,c)},voteUpEntryPc:function(){},voteUpEntrySuccessCb:function(d){var b=d.id;if($("love_count_"+b)&&d.msg){var a=parseInt($("love_count_"+b).get("score"),10);var c=parseInt($("love_count_"+b).get("votes"),10)-a+1;if(!isNaN(c)){$("love_count_"+b).set("text",c)}}if($("vote-down-btn-"+b)){$("vote-down-btn-"+b).removeClass("unloved")}if($("vote-up-btn-"+b)){$("vote-up-btn-"+b).addClass("loved")}},voteUpEntryFailureCb:function(a){},voteDownEntryPc:function(){},voteDownEntrySuccessCb:function(d){var b=d.id;if($("love_count_"+b)&&d.msg){var a=parseInt($("love_count_"+b).get("score"),10);var c=parseInt($("love_count_"+b).get("votes"),10)-a-1;if(!isNaN(c)){$("love_count_"+b).set("text",c)}}if($("vote-up-btn-"+b)){$("vote-up-btn-"+b).removeClass("loved")}if($("vote-down-btn-"+b)){$("vote-down-btn-"+b).addClass("unloved")}},voteDownEntryFailureCb:function(){},unvoteEntryPc:function(){},unvoteEntrySuccessCb:function(d){var b=d.id;if($("love_count_"+b)&&d.msg){var a=parseInt($("love_count_"+b).get("score"),10);var c=parseInt($("love_count_"+b).get("votes"),10)-a;if(!isNaN(c)){$("love_count_"+b).set("text",c)}}if($("vote-up-btn-"+b)){$("vote-up-btn-"+b).removeClass("loved")}if($("vote-down-btn-"+b)){$("vote-down-btn-"+b).removeClass("unloved")}},unvoteEntryFailureCb:function(){},bindPostViewSmileIcon:function(){if(!$("post_view_love")){return}$("post_view_love").addEvent("click",function(h){if(h){h.preventDefault()}if(GAG.isReadOnly()){return}var d=requiredLogin();if(!d){return}scroll(0,0);var i=$(this);var c=i.get("rel");var f=i.get("data-token");var j=i.hasClass("current");var b=0;var g=function(n){if(j){i.removeClass("current");b=0}else{i.addClass("current");b=1}var l="love_count_"+n.id;if($chk(l)&&n.msg!=undefined){var e=parseInt($(l).get("score"),10);var m=parseInt($(l).get("votes"),10)-e+b;if(!isNaN(m)){$(l).set("text",m)}}};var a=function(e){if(j){i.addClass("current")}else{i.removeClass("current")}};if(j){GAG.Ajax.Vote.unvote(c,g,a)}else{GAG.Ajax.Vote.voteUp(c,g,a)}})},bindVoteUpElements:function(b,c,a,e,d,f){$$(b).addEvent(c,function(i){if(i){i.preventDefault()}var g=$(this).get("entryId");var h=$(this).hasClass("loved");if(h){GAG.Ajax.Vote.unvote(g,d,f)}else{GAG.Ajax.Vote.voteUp(g,a,e)}})},bindVoteDownElements:function(a,c,b,e,d,f){$$(a).addEvent(c,function(i){if(i){i.preventDefault()}var g=$(this).get("entryId");var h=$(this).hasClass("unloved");if(h){GAG.Ajax.Vote.unvote(g,d,f)}else{GAG.Ajax.Vote.voteDown(g,b,e)}})},bindElements:function(){if(GAG.isReadOnly()){return}var a="#entry-list a.badge-vote-up";var c="click";var d="#entry-list a.badge-vote-down";var b="click";this.bindVoteUpElements(a,c,this.voteUpEntrySuccessCb,this.voteUpEntryFailureCb,this.unvoteEntrySuccessCb,this.unvoteEntryFailureCb);this.bindVoteDownElements(d,b,this.voteDownEntrySuccessCb,this.voteDownEntryFailureCb,this.unvoteEntrySuccessCb,this.unvoteEntryFailureCb);this.bindPostViewSmileIcon()}};GAG.Keyboard={JUMP_PREV:"JUMP_PREV",JUMP_NEXT:"JUMP_NEXT",VOTE_UP:"VOTE_UP",VOTE_DOWN:"VOTE_DOWN",UNVOTE:"UNVOTE",JUMP_COMMENT:"JUMP_COMMENT",getKeyOptions:function(){return{type:"keypress",propagate:false,target:document,disable_in_input:true}},jump:function(j){var b;var n;var e;var o=false;var l=(Browser.Engine.trident)?document.documentElement.scrollTop:window.pageYOffset;$$(".jump_stop").each(function(p){if(!o){b=n;n=p}else{if(!$chk(e)){e=p;return}else{return}}if(n.getPosition().y>=l+topMargin){o=true}});var m=$("shortcut-event-label")?$("shortcut-event-label").innerHTML:null;scroll(0,n.getPosition().y-topMargin);var f="Keyboard-Shortcut";var d="";var a="";var i;switch(j){case this.VOTE_DOWN:_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-H",m?m:"Dislike",1]);i=n.getElement("ul li a.unlove");break;case this.VOTE_UP:_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-L",m?m:"Love",1]);i=n.getElement("ul li a.love");break;case this.JUMP_COMMENT:_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-C",m?m:"Comment",1]);i=n.getElement("ul li a.comment");if(i){window.location=i.get("href")}break;case this.JUMP_PREV:_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-K",m?m:"Previous",1]);if($chk(b)){scroll(0,b.getPosition().y-topMargin);b.focus();var h=b.getElement(".jump_focus");if($chk(h)){h.focus()}}else{if($chk($("jump_prev"))){Cookie.write("jumpGAG","goLast",cookieOption);window.location=$("jump_prev").get("href")}else{scroll(0,0)}}break;case this.JUMP_NEXT:_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-J",m?m:"Next",1]);var c=(Browser.Engine.trident)?(document.documentElement.scrollHeight-document.documentElement.clientHeight):(document.documentElement.scrollHeight-window.innerHeight);if(l==c&&$chk($("jump_next"))){Cookie.write("jumpGAG","goFirst",cookieOption);window.location=$("jump_next").get("href")}else{if($chk(e)){var g;if(n.getPosition().y==(l+topMargin)){g=e}else{g=n}scroll(0,g.getPosition().y-topMargin);g.focus();var h=g.getElement(".jump_focus");if($chk(h)){h.focus()}if($chk($("more_button"))&&e.get("do_more")==1){e.set("do_more",0);$("more_button").fireEvent("click")}}else{if($chk($("more_button"))){$("more_button").fireEvent("click")}else{if($chk($("jump_next"))){Cookie.write("jumpGAG","goFirst",cookieOption);window.location=$("jump_next").get("href")}}}}break}if(i){i.fireEvent("click")}},bindAction:function(a,b){shortcut.add(a,b,this.getKeyOptions())},bindJumpPrev:function(a){this.bindAction(a,function(){GAG.Keyboard.jump(GAG.Keyboard.JUMP_PREV)})},bindJumpNext:function(a){this.bindAction(a,function(){GAG.Keyboard.jump(GAG.Keyboard.JUMP_NEXT)})},bindPostVoteUp:function(a){this.bindAction(a,function(){$("post_view_love").fireEvent("click")})},goPrevPost:function(){if($("prev_post")){var a=$("prev_post").get("href");if(!a.test("^http")){return}window.location.href=a}},goNextPost:function(){if($("next_post")){var a=$("next_post").get("href");if(!a.test("^http")){return}window.location.href=a}},bindPostPrev:function(a){this.bindAction(a,this.goPrevPost)},bindPostNext:function(a){this.bindAction(a,this.goNextPost)},bindPostPrevCode:function(b){var a=this.getKeyOptions();a.type="keydown";shortcut.add(b,this.goPrevPost,a)},bindPostNextCode:function(b){var a=this.getKeyOptions();a.type="keydown";shortcut.add(b,this.goNextPost,a)},bindOverlay:function(){$$("a.keyboard-nav-button, a.keyboard_link").addEvent("click",function(a){GAG.Keyboard.showKeyboardOverlay(true)})},showKeyboardOverlay:function(){$("overlay-shadow").removeClass("hide");$("overlay-container").removeClass("hide");$$("#overlay-container div.keyboard-instruction").removeClass("hide");_gaq.push(["_trackEvent","Keyboard-Shortcut","Clicked","Popup",1])},bindElements:function(){if(GAG.Page.isLanding()){}if(GAG.Page.isPostView()){this.bindPostVoteUp("l")}if(GAG.Page.isPostView()||GAG.Page.isNsfwPostView()){this.bindPostPrev("k");this.bindPostNext("j");this.bindPostPrevCode("left");this.bindPostNextCode("right")}this.bindOverlay();if(window.location.hash&&window.location.hash=="#keyboard"){this.showKeyboardOverlay(true)}}};window.addEvent("domready",function(){try{$$("div.url-box input").addEvent("click",function(h){$(this).selectRange(0,$(this).get("value").length)});GAG.Overlay.bindElements();$$("input.tipped, textarea.tipped").addEvent("focus",function(i){i.preventDefault();var h=$(this).getParent("div.field").getElements("p.info");if(h){h.setStyle("visibility","visible")}});$$("input.tipped, textarea.tipped").addEvent("blur",function(i){i.preventDefault();var h=$(this).getParent("div.field").getElements("p.info");if(h){h.setStyle("visibility","hidden")}});if($("page-post-item")||$("page-edit-item")){$$("#form-modal-post-image input[name=title], #form-modal-post-video input[name=title]").addEvent("blur",function(h){h.preventDefault();FV.checkRequired($(this))});$$("#form-modal-post-image input[name=url], #form-modal-post-video input[name=video]").addEvent("blur",function(h){h.preventDefault();FV.checkUrl($(this),$("page-edit-item")!=null)});GAG.Submit={TITLE_MIN_LENGTH:6,_errorMessages:[],resetErrors:function(){$$("p.form-message.error").set("html","").addClass("hide");this._errorMessages=[]},putError:function(e){this._errorMessages.push(e)},getErrors:function(){return this._errorMessages},showErrorMessage:function(){var h="";for(var e=0;e<this._errorMessages.length;e++){if(e>0){h+=" "}h+=this._errorMessages[e]}$$("p.form-message.error").set("html",h).removeClass("hide")},getBannedTitlePhrases:function(){return window.title_filters?window.title_filters:[]},getBannedTitles:function(){return window.title_blacklist?window.title_blacklist:[]},isBadTitle:function(m){m+="";m=m.replace(/(\t|!|\?|,|:|;|-| )/gi,"");if(m.length<this.TITLE_MIN_LENGTH){return true}var e=this.getBannedTitlePhrases();if(e){for(var h=0;h<e.length;h++){var j=new RegExp(e[h],"i");if(m.test(j)){return true}}}var l=this.getBannedTitles();if(l){for(var h=0;h<l.length;h++){var j=new RegExp("^"+l[h]+"$","i");if(m.test(j)){return true}}}return false},isOriginalPost:function(){if(this.isFixedPost){return false}return($("submit-original")&&$("submit-original").get("checked"))},isFixedPost:function(h){if($("page-edit-item")){return false}var e=new RegExp("fixed","i");return h.test(e)},isValidSource:function(e){return GAG.Validator.isValidPostLink(e)},enableSourceField:function(h,e){return;h.setStyle("opacity",e?1:0.5).set("disabled",e?false:"disabled");if(!e){h.set("value","")}},enableOriginalField:function(e){return;var h=$("submit-original");if(h){h.set("checked",false).setStyle("opacity",e?1:0.5).set("disabled",e?false:"disabled")}},MSG_INVALID_TITLE:"The <b>Post Title</b> doesn't look funny enough to Chuck Norris and other 9gaggers. Think of a descriptive or creative one!",MSG_INCOMPLETE_FIXED_POST:"It looks like to be a FIXED post, please provide a valid source URL.",MSG_INVALID_SOURCE:"Please provide a valid source URL.",MSG_FIXED_DISALLOWED:'Please use "Fix this post" button to submit [Fixed] posts.',MSG_FILE_REQUIRED:"Please select a file to upload.",checkImageForm:function(){var e=true;var j=false;var r=false;var q=false;var h=$("form-modal-post-image");var l=h.getElement("input[name=image]");var p=h.getElement("input[name=url]");var n=h.getElement("input[name=title]");var t=h.getElement("input[name=source]");if($("page-post-item")){e=(FV.checkRequired(l)||(FV.checkRequired(p)&&FV.checkUrl(p)))&&e;if(!e){j=true}}if($("page-edit-item")){e=FV.checkUrl(p,true)&&e}if(l.get("value").length!=0){if(!FV.checkImage(l)){e=false;r=true}}if(!FV.checkRequired(n)){e=false;q=true}if(!e){var i=(j||r);var m=q;if(i&&m){if(j){this.putError("Valid image URL or file is required and title is missing.")}else{if(r){this.putError("Invalid image format and title is missing.")}}}else{if(j){this.putError("Valid image URL or file is required.")}else{if(r){this.putError("Invalid image format.")}else{if(m){this.putError("Title is missing.")}}}}this.showErrorMessage()}var s=n.get("value");if(e&&this.isBadTitle(s)){FV.cross(n);this.putError(this.MSG_INVALID_TITLE);this.showErrorMessage();e=false}var o=t.get("value");if(this.isFixedPost(s)){FV.cross(n);if(e){this.putError(this.MSG_FIXED_DISALLOWED);this.showErrorMessage();e=false}}else{this.enableOriginalField(true);if(this.isOriginalPost()){this.enableSourceField(t,false)}else{this.enableSourceField(t,true)}if(false&&o.trim().length>0){if(GAG.Validator.lookLikeURL(o)){FV.tick(t)}else{FV.cross(t);if(e){this.putError(this.MSG_INVALID_SOURCE);this.showErrorMessage();e=false}}}else{FV.reset(t)}}return e?h:false},checkVideoForm:function(){var e=true;var q=false;var s=false;var o=false;var h=$("form-modal-post-video");var l=h.getElement("input[name=video]");var m=h.getElement("input[name=title]");var r=h.getElement("input[name=source]");if($("page-post-item")){if(!FV.checkRequired(l)){e=false;q=true}if(!FV.checkUrl(l)){e=false;s=true}}if($("page-edit-item")){e=FV.checkUrl(l,true)&&e}if(!FV.checkRequired(m)){e=false;o=true}if(!e){var i=q||s;var j=o;if(i&&j){this.putError("Invalid video URL and title is missing.")}else{if(i){this.putError("Invalid video URL.")}else{if(j){this.putError("Title is missing.")}}}this.showErrorMessage()}var p=m.get("value");if(e&&this.isBadTitle(p)){FV.cross(m);this.putError(this.MSG_INVALID_TITLE);this.showErrorMessage();e=false}var n=r.get("value");if(this.isFixedPost(p)){FV.cross(m);if(e){this.putError(this.MSG_FIXED_DISALLOWED);this.showErrorMessage();e=false}}else{if(false&&n.trim().length>0){if(GAG.Validator.lookLikeURL(n)){FV.tick(r)}else{FV.cross(r);if(e){this.putError(this.MSG_INVALID_SOURCE);this.showErrorMessage();e=false}}}else{FV.reset(r)}}return e?h:false},checkForm:function(){var h=$("post_type").get("value")=="Photo";this.resetErrors();var e=h?this.checkImageForm():this.checkVideoForm();return e},checkFixPostForm:function(){this.resetErrors();var i=$("form-modal-post-fix");var e=$("photo_file_upload");var h=FV.checkRequired(e);if(!h){this.putError(this.MSG_FILE_REQUIRED);this.showErrorMessage();h=false}if(h&&e.get("value").length!=0){if(!FV.checkImage(e)){this.putError("Invalid image format.");this.showErrorMessage();h=false}}return h?i:false}};var d=function(j){j.preventDefault();var h=$("form-modal-post-fix")?true:false;if(h){var i=GAG.Submit.checkFixPostForm();if(i){$$("#modal-post ul li.form-btn, #modal-edit ul li.form-btn").addClass("hide");$$("#modal-post a.button.send, #modal-edit a.button.send").removeEvent("click",d).addEvent("click",function(l){l.preventDefault()});$$("#modal-post ul li.loading-btn").removeClass("hide").setStyle("visibility","visible");i.submit()}}else{var i=GAG.Submit.checkForm();if(i){$$("#modal-post ul li.form-btn, #modal-edit ul li.form-btn").addClass("hide");$$("#modal-post a.button.send, #modal-edit a.button.send").removeEvent("click",d).addEvent("click",function(l){l.preventDefault()});if($("modal-post")){$$("#modal-post ul li.loading-btn").removeClass("hide").setStyle("visibility","visible")}if($("modal-edit")){$$("#modal-edit ul li.loading-btn").removeClass("hide").setStyle("visibility","visible")}$$("#modal-edit div.actions a.delete-button").setStyle("visibility","hidden");i.submit()}}};$$("#modal-post a.button.send, #modal-edit a.button.send").addEvent("click",d);$$("#form-modal-post-image div.field input, #form-modal-post-video div.field input").addEvent("keydown",function(h){if(h.key=="enter"){h.preventDefault()}});if($("page-edit-item")){$$("#form-modal-post-image a.upload_photo").addEvent("click",function(i){i.preventDefault();var j=$("form-modal-post-image").getElement("input[name=url]").set("value","");var h=$("form-modal-post-image").getElement("input[name=image]").set("value","");FV.reset(j);FV.reset(h);$(this).getParent("p").getElement("a.post_link").removeClass("hide");$(this).addClass("hide");$("photo_post_url").setStyle("display","none");$("photo_file_upload").setStyle("display","")});$$("#form-modal-post-image a.post_link").addEvent("click",function(i){i.preventDefault();var j=$("form-modal-post-image").getElement("input[name=url]").set("value","");var h=$("form-modal-post-image").getElement("input[name=image]").set("value","");FV.reset(j);FV.reset(h);$(this).getParent("p").getElement("a.upload_photo").removeClass("hide");$(this).addClass("hide");$("photo_file_upload").setStyle("display","none");$("photo_post_url").setStyle("display","")})}}GAG.Effect.AutoComplete.bindElements();$$(".badge-lazyload-toggler").addEvent("click",function(j){j.preventDefault();var m={path:"/",duration:365*20};var i="lazyload_on";var h=300;var l=$(this).hasClass("current")?"0":"1";if(l=="1"){if(!confirm("Lazyload is an experimental feature, do you want to enable it?")){return}}Cookie.write(i,l,m);setTimeout("window.location.reload();",h)});GAG.Ajax.LoadPage.init();GAG.Social.Facebook.init();GAG.Social.Facebook.bindElements();GAG.Ajax.Vote.bindElements();GAG.Login.bindElements();function g(x){var r;var v;var s;var p=false;var z=(Browser.Engine.trident)?document.documentElement.scrollTop:window.pageYOffset;if(x=="L"||x=="H"){var l=$$(".jump_stop");var j=(Browser.Engine.trident)?(document.documentElement.scrollHeight-document.documentElement.clientHeight):(document.documentElement.scrollHeight-window.innerHeight);if(j<=z){if(l.length>0){v=$(l[l.length-1])}}else{for(var u=0;!p&&u<l.length;u++){r=v;v=$(l[u]);var o=v.getPosition().y;var m=o-topMargin;if(u==l.length-1){}else{if(u==0){m=0}s=$(l[u+1]);var w=s.getPosition().y;var A=w-topMargin;if(m<=z&&z<A){p=true}else{}}}}}else{$$(".jump_stop").each(function(i){if(!p){r=v;v=i}else{if(!$chk(s)){s=i;return}else{return}}if(v.getPosition().y>=z+topMargin){p=true}})}var q=$("shortcut-event-label")?$("shortcut-event-label").innerHTML:null;if(x=="H"||x=="L"||x=="S"||x=="C"||x=="V"||x=="R"){if(x!="V"&&x!="R"&&x!="L"&&x!="H"){scroll(0,v.getPosition().y-topMargin)}var n;switch(x){case"H":_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-H",q?q:"Dislike",1]);n=v.getElement("ul li a.unlove");break;case"L":_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-L",q?q:"Love",1]);n=v.getElement("ul li a.love");break;case"S":_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-S",q?q:"Share",1]);n=v.getElement("ul li a.share");break;case"C":_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-C",q?q:"Comment",1]);n=v.getElement("ul li a.comment");if(n){window.location=n.get("href")}break;case"V":_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-V",q?q:"Change View",1]);window.location=$("current_view").get("href");return;break;case"R":_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-R",q?q:"Random",1]);window.location="/random";return;break}if(n){n.fireEvent("click")}}else{if(x<0){_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-K",q?q:"Previous",1]);if($chk(r)){scroll(0,r.getPosition().y-topMargin);r.focus();var e=r.getElement(".jump_focus");if($chk(e)){e.focus()}}else{if($chk($("jump_prev"))){Cookie.write("jumpGAG","goLast",cookieOption);window.location=$("jump_prev").get("href")}else{scroll(0,0)}}}else{_gaq.push(["_trackEvent","Keyboard-Shortcut","Pressed-J",q?q:"Next",1]);var j=(Browser.Engine.trident)?(document.documentElement.scrollHeight-document.documentElement.clientHeight):(document.documentElement.scrollHeight-window.innerHeight);if(z==j&&$chk($("jump_next"))){Cookie.write("jumpGAG","goFirst",cookieOption);window.location=$("jump_next").get("href")}else{if($chk(s)){var y;if(v.getPosition().y==(z+topMargin)){y=s}else{y=v}scroll(0,y.getPosition().y-topMargin);y.focus();var e=y.getElement(".jump_focus");if($chk(e)){e.focus()}if($chk($("more_button"))&&s.get("do_more")==1){if(x=="J"||x==1){s.set("do_more",0);$("more_button").fireEvent("click")}}}else{if($chk($("more_button"))){var h=$("more_button");var t=$("next_button");if(t.getStyle("display")!="none"){t.fireEvent("click");window.location=t.get("href")}else{h.fireEvent("click")}}else{if($chk($("jump_next"))){Cookie.write("jumpGAG","goFirst",cookieOption);window.location=$("jump_next").get("href")}}}}}}}var a={type:"keypress",propagate:false,target:document,disable_in_input:true};if(!$("page-post")){shortcut.add("j",function(){g(1)},a);shortcut.add("k",function(){g(-1)},a);shortcut.add("l",function(){g("L")},a)}shortcut.add("h",function(){g("H")},a);shortcut.add("c",function(){g("C")},a);if($("page-landing")||$("page-profile")||$("page-post")||$("page-nsfw")){shortcut.add("r",function(){g("R")},a)}if($("page-post")){var a={type:"keypress",propagate:false,target:document,disable_in_input:true};a.keycode=37;a.keycode=39}GAG.Keyboard.bindElements();function b(){$$("div.info ul.actions li a.vote").addEvent("click",function(n){if(n){n.preventDefault()}if(GAG.isReadOnly()){return}var i=requiredLogin();if(!i){return}var m=$(this);var l=0;var h;if(m.hasClass("loved")){h="/vote/unlike/id/";m.removeClass("loved");l=0}else{h="/vote/like/id/";m.addClass("loved");l=1}var j=new Request.JSON({url:h+m.get("rel"),onSuccess:function(q,p){var o="love_count_"+q.id;if($chk(o)){var e=parseInt($(o).get("score"),10);var r=parseInt($(o).get("votes"),10)-e+l;if(!isNaN(r)){$(o).set("text",r)}}},onFailure:function(o,e){if(m.hasClass("loved")){m.removeClass("loved")}else{m.addClass("loved")}}}).get()})}if($("page-landing")||$("page-profile")){b()}$$("a.color-picker").addEvent("click",function(i){if(i){i.preventDefault()}var h=$(this).getParent("div").getElement("input.text.color");if($(this).hasClass("show")){$(this).removeClass("show");h.color.hidePicker()}else{$(this).addClass("show");h.color.showPicker()}});$$("input.text.color").addEvent("focus",function(i){i.preventDefault();var h=$(this).getParent("div").getElement("a.color-picker").addClass("show")});$$("input.text.color").addEvent("blur",function(h){new Event(h).stop()});if($("post_view_share")){$("post_view_share").addEvent("click",function(h){h.preventDefault();$$("div.sharing-bar").toggleClass("hide")})}if($("post_view_comment")){$("post_view_comment").addEvent("click",function(h){h.preventDefault();$("post_view_comment_box").focus()})}$$("div.profile-menu ul, #footer ul.menu").addEvent("mouseover",function(h){$(this).getPrevious().addClass("hover")});$$("div.profile-menu ul, #footer ul.menu").addEvent("mouseout",function(h){$(this).getPrevious().removeClass("hover")});GAG.Ajax.Report.bindElements();if($("page-settings")){$("settings_submit").addEvent("click",function(j){j.preventDefault();var h=$("form-settings").getElement("input[name=avatar]").get("value");var i=true;if(h.length!=0){if(!h.toLowerCase().test(".(jpeg|jpg|gif|png)$")){i=false}}if(i){$("form-settings").submit()}else{$$("p.form-message.success").addClass("hide");$$("p.form-message.error").removeClass("hide")}})}function c(h,e){new Request({url:"../ql@t="+h+"&l="+e}).send()}GAG.Overlay.Language.bindElements();GAG.Effect.CountDown.bindElements();GAG.Effect.searchBar.bindElements();GAG.Effect.Scroll.bindElements();if($("bookmark-badge")){$("bookmark-badge").addEvent("click",function(){c("bookmark","click");bookmarkSite("9GAG - Just for Fun!","../@utm_source=bookmark");_gaq.push(["_trackEvent","Bookmark","Clicked","Header",1])})}$$(".badge-js").each(function(h,e){$(h).set("html",$(h).get("key"))})}catch(f){GAG.Log.report(f)}});function initJumpGAG(c){var a=Cookie.read("jumpGAG");if($chk(a)){var e=$$(".jump_stop");var d=0;if($chk(e)&&e.length>0){if(c&&a=="goLast"){var b=e.getLast();d=b.getPosition().y-topMargin;scroll(0,d)}else{if(false&&a=="goFirst"){var b=e[0];d=b.getPosition().y-topMargin;scroll(0,d)}}}}}function bookmarkSite(d,a){var c=navigator.userAgent;if(window.sidebar){window.sidebar.addPanel(d,a,"")}else{if(window.opera&&window.print){var b=document.createElement("a");b.setAttribute("href",a);b.setAttribute("title",d);b.setAttribute("rel","sidebar");b.click()}else{if(document.all){window.external.AddFavorite(a,d)}}}}function bookmark(a){Cookie.write("bookmark",a,cookieOption)}window.addEvent("resize",function(){GAG.Effect.Scroll.initElementsData(true);GAG.Effect.Scroll.onPageScroll()});window.addEvent("load",function(){initJumpGAG(true);Cookie.dispose("jumpGAG",cookieOption);window.onloaded=true});